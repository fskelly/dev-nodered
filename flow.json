[{"id":"6e4e7309.81165c","type":"tab","label":"Google API Testing","disabled":false,"info":""},{"id":"247a7db4.488d62","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"690339e0.145a08","type":"tab","label":"Owntracks Tracker","disabled":false,"info":""},{"id":"eddcae95.aa2d6","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"15c157a1.27c788","type":"tab","label":"Alexa Testing","disabled":false,"info":""},{"id":"95334549.408f08","type":"tab","label":"Presence Detection","disabled":true,"info":""},{"id":"d58c58f8.8219f8","type":"tab","label":"Telemetry","disabled":true,"info":""},{"id":"8c52d380.fec46","type":"tab","label":"Sample Playpen","disabled":false,"info":""},{"id":"a7fe27bd.2509f8","type":"tab","label":"Life360 Tracker","disabled":false,"info":""},{"id":"b9fe7189.3c263","type":"tab","label":"House Telemetry","disabled":false,"info":""},{"id":"d90740e8.853308","type":"tab","label":"DEV - Data Collection","disabled":false,"info":""},{"id":"4770c0d7.397b","type":"tab","label":"Home Assistant States","disabled":true,"info":""},{"id":"8a955ac7.209038","type":"tab","label":"Flow 6","disabled":false,"info":""},{"id":"67c3431e.c4b74c","type":"tab","label":"Are we home?","disabled":false,"info":""},{"id":"82378b51.cc8e28","type":"tab","label":"Flow 8","disabled":false,"info":""},{"id":"d597f158.7ca1b","type":"tab","label":"Prod Ready - Tuya Lights - Sunset","disabled":true,"info":""},{"id":"7481132e.5fea8c","type":"tab","label":"Presence Detection","disabled":false,"info":""},{"id":"d335ec1.d977a1","type":"tab","label":"Away from Home","disabled":true,"info":""},{"id":"edadc6b3.2cb078","type":"tab","label":"Come Home","disabled":true,"info":""},{"id":"9ed92167.b9b4c","type":"tab","label":"Flow 3","disabled":true,"info":""},{"id":"745da3b4.61597c","type":"tab","label":"Test - IOS Notify","disabled":false,"info":""},{"id":"48181911.c321a8","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"541a1cc7.93adc4","type":"tab","label":"Flow 7","disabled":false,"info":""},{"id":"931c0c64.df3c6","type":"tab","label":"Dashboards","disabled":false,"info":""},{"id":"d74e98b0.1e98b8","type":"tab","label":"Flow 11","disabled":false,"info":""},{"id":"dac6431f.f0681","type":"tab","label":"Flow 12","disabled":false,"info":""},{"id":"8584cb39.51bb48","type":"tab","label":"Flow 9","disabled":false,"info":""},{"id":"cbfb483a.9b43f8","type":"tab","label":"Flow 10","disabled":false,"info":""},{"id":"59cb08a.8905ff8","type":"tab","label":"Alarm Panel","disabled":false,"info":""},{"id":"767d6cf4.74a3f4","type":"tab","label":"Flow 13","disabled":false,"info":""},{"id":"44dd03cf.d563cc","type":"tab","label":"Flow 14","disabled":false,"info":""},{"id":"213f77cb.cd9998","type":"tab","label":"Home Away","disabled":false,"info":""},{"id":"e7a4486b.b864c8","type":"tab","label":"Pre-prod - bedroom lights","disabled":true,"info":""},{"id":"8b9a916e.ca4ec","type":"tab","label":"BigTimer - Bedroom Lights","disabled":false,"info":""},{"id":"fb4a9edc.82ff2","type":"tab","label":"Flow 15","disabled":false,"info":""},{"id":"9b2a9527.03a138","type":"tab","label":"Alexa Speak","disabled":false,"info":""},{"id":"590246e0.d58c08","type":"tab","label":"Alexa Play Music","disabled":false,"info":""},{"id":"4d548667.7a6948","type":"tab","label":"Flow 18","disabled":false,"info":""},{"id":"153e4bbb.7f4624","type":"tab","label":"Home Automation","disabled":false,"info":""},{"id":"6991cee1.63833","type":"tab","label":"Location Tracking","disabled":false,"info":""},{"id":"7955d68b.f231b8","type":"tab","label":"Notifications","disabled":false,"info":""},{"id":"a8777efe.89265","type":"tab","label":"Security","disabled":false,"info":""},{"id":"f89ee080.71ad2","type":"tab","label":"Utilities","disabled":false,"info":""},{"id":"a3edbf89.1b4e7","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"bfbb9b56.a1ffa8","type":"tab","label":"Dev","disabled":false,"info":""},{"id":"bd389fb.6c2456","type":"tab","label":"Flow 17","disabled":true,"info":""},{"id":"62b25e5c.7bcc","type":"tab","label":"Bedroom Lights","disabled":true,"info":""},{"id":"30ed7e94.3c6102","type":"tab","label":"Flow 4","disabled":false,"info":""},{"id":"9507aa40.718448","type":"tab","label":"Sheet 1"},{"id":"2301760b.f35afa","type":"tab","label":"LoungeRGBW","disabled":false,"info":""},{"id":"1febc63c.43c2fa","type":"tab","label":"Fletch Lamp","disabled":false,"info":""},{"id":"ecc500b.f2543","type":"tab","label":"Karien Lamp","disabled":false,"info":""},{"id":"90bcc8ae.363a88","type":"tab","label":"Flow 16","disabled":false,"info":""},{"id":"f5dbb3c3.e11ac","type":"tab","label":"Flow 19","disabled":false,"info":""},{"id":"98fe7404.95a9b8","type":"tab","label":"Flow 20","disabled":false,"info":""},{"id":"ca178713.ccfa58","type":"tab","label":"Flow 21","disabled":false,"info":""},{"id":"54a63624.62e0c8","type":"tab","label":"Geofence - Test","disabled":false,"info":""},{"id":"404de206.015e2c","type":"tab","label":"Prod Ready - Tuya Lights - Sunset","disabled":false,"info":""},{"id":"b9243eac.e962e","type":"tab","label":"Notifications","disabled":true,"info":""},{"id":"83e9ea4f.1c5db8","type":"tab","label":"Home Assistant - Logs","disabled":false,"info":""},{"id":"8c3854a8.1ec5c8","type":"subflow","name":"Startup Delay","info":"","category":"","in":[{"x":60,"y":120,"wires":[{"id":"9b33cb8d.70f6c8"}]}],"out":[{"x":480,"y":120,"wires":[{"id":"3b4abb08.ef19e4","port":0}]}]},{"id":"f27aa045.98e9d","type":"subflow","name":"Fletcher - Alexa Messages","info":"","category":"Notifications","in":[{"x":200,"y":140,"wires":[{"id":"aa993341.a2e07"}]}],"out":[],"env":[]},{"id":"63d82af5.88cf84","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"89877c86.8bf5d","type":"subflow","name":"Karien - Alexa Messages","info":"","category":"","in":[{"x":100,"y":200,"wires":[{"id":"cbcc5460.e82ce8"}]}],"out":[],"env":[]},{"id":"d270455.fae9bb8","type":"subflow","name":"Subflow 2","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"3e0f074.3fe70f8"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"3e0f074.3fe70f8","port":0}]}],"env":[]},{"id":"5217c125.f919f","type":"subflow","name":"Stop if family is home or guest mode on","info":"","in":[{"x":40,"y":560,"wires":[{"id":"3ed73a8d.c4d496"}]}],"out":[{"x":1060,"y":560,"wires":[{"id":"8347bdcb.ad5f1","port":1}]}]},{"id":"a685a6b4.db4368","type":"subflow","name":"Format payload and geozone logic","info":"","in":[{"x":40,"y":40,"wires":[{"id":"c77b4311.2ef9b"}]}],"out":[{"x":820,"y":120,"wires":[{"id":"de37d45a.712b58","port":0}]},{"x":1240,"y":40,"wires":[{"id":"b49ccc24.44d33","port":0}]}],"inputLabels":["Device tracker event"],"outputLabels":["Left Zone","Entered new zone apart from spouse"]},{"id":"2c797f21.c25cb","type":"subflow","name":"Voice Alerts","info":"","in":[{"x":34.9999961853027,"y":151.071425437927,"wires":[{"id":"66cd790b.46acd8"}]}],"out":[{"x":1315.49995040894,"y":438.714291572571,"wires":[{"id":"3c965b6c.a89704","port":0}]},{"x":360,"y":260,"wires":[{"id":"66cd790b.46acd8","port":1}]}],"outputLabels":["Speak, no guests, normal output","No speaks, guest mode on, continue flow"]},{"id":"76bb0065.30dc2","type":"subflow","name":"Play theme song","info":"","in":[{"x":40,"y":60,"wires":[{"id":"68073f91.50041"}]}],"out":[{"x":1560,"y":320,"wires":[{"id":"366971a8.da52ce","port":0}]}]},{"id":"ccf6acb1.0f2c9","type":"subflow","name":"Stop if guest mode is on","info":"","in":[{"x":200,"y":180,"wires":[{"id":"ef68b066.a69e7"}]}],"out":[{"x":1080,"y":200,"wires":[{"id":"65b77bf6.b68014","port":1}]}]},{"id":"6b84347a.0dfbcc","type":"subflow","name":"Stop if family is away","info":"","in":[{"x":80,"y":300,"wires":[{"id":"1b7ae196.6e8c4e"}]}],"out":[{"x":980,"y":300,"wires":[{"id":"f009ccd1.7ddb7","port":1}]}]},{"id":"736c12c5.92637c","type":"subflow","name":"Device offline for four hours","info":"","in":[{"x":200,"y":720,"wires":[{"id":"af3a87ae.749c28"}]}],"out":[]},{"id":"3289c817.6b0be8","type":"subflow","name":"ZWave Stats","info":"","in":[{"x":120,"y":720,"wires":[{"id":"30c56597.0b9caa"}]}],"out":[{"x":1040,"y":740,"wires":[{"id":"aa4f4875.585f78","port":0}]}]},{"id":"7224a2bd.67bcdc","type":"subflow","name":"Stop if family is home","info":"","in":[{"x":80,"y":260,"wires":[{"id":"405c8407.39c03c"}]}],"out":[{"x":880,"y":280,"wires":[{"id":"be61735.74a4f9","port":0}]}]},{"id":"c2be485b.36c738","type":"subflow","name":"Stop if guest mode or vacation mode is on","info":"","in":[{"x":100,"y":220,"wires":[{"id":"2c035753.dd6468"}]}],"out":[{"x":1220,"y":280,"wires":[{"id":"c0685c15.446a7","port":1}]}]},{"id":"66726911.b76f98","type":"mqtt-broker","z":"","name":"Mosquitto - Whale","broker":"192.168.1.41","port":"1883","clientid":"Node-RED-Dev","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"abc5f2b.6bde21","type":"server","z":"","name":"Home Assistant - DeathStar","legacy":false,"hassio":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"6eb36010.171f5","type":"mqtt-broker","z":"","name":"unRaid-MQTT","broker":"192.168.1.4","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"beb2d5b5.e9a6f8","type":"influxdb","z":"","hostname":"192.168.1.4","port":"8086","protocol":"http","database":"telemetry","name":"","usetls":false,"tls":""},{"id":"60641eba.4e311","type":"mongodb","z":"d58c58f8.8219f8","hostname":"192.168.1.4","port":"27017","db":"node-red","name":""},{"id":"16ebb146.299d6f","type":"mqtt-broker","z":"","name":"orca-dev-mqtt","broker":"192.168.1.43","port":"21883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"39e7b6cc.400702","type":"mongodb","z":"","hostname":"192.168.1.43","port":"37017","db":"node-red","name":""},{"id":"87bc6ced.c12878","type":"influxdb","z":"","hostname":"192.168.1.4","port":"8086","protocol":"http","database":"telemetry","name":"","usetls":false,"tls":""},{"id":"e613cf86.3feb98","type":"influxdb","z":"","hostname":"192.168.1.4","port":"8086","protocol":"http","database":"dev_weather","name":"dev_weather","usetls":false,"tls":""},{"id":"b08dc7ea.aabfd","type":"influxdb","z":"","hostname":"192.168.1.43","port":"28086","protocol":"http","database":"sensortelemetry","name":"","usetls":false,"tls":""},{"id":"c6bdf57c.59baa8","type":"mqtt-broker","z":"","name":"192.168.1.159","broker":"192.168.1.159","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"a3722ee8.c88ce","type":"server","z":"","name":"Orca - 8124","legacy":false,"hassio":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"bdabb112.821d2","type":"server","z":"","name":"Home Assistant"},{"id":"d80b819d.21ee7","type":"server","z":"","name":"Home Assistant"},{"id":"faf6f8d3.47cb18","type":"server","z":"","name":"Home Assistant"},{"id":"c1cdb871.aa2988","type":"server","z":"","name":"Home Assistant"},{"id":"2aa1db5b.2cc8b4","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#17c42b","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#17c42b","edited":true},"page-titlebar-backgroundColor":{"value":"#17c42b","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#3fe853","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#17c42b","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"6cd20504.9b61cc","type":"ui_tab","z":"","name":"Bedroom","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"aa4f59ff.e959e8","type":"ui_group","z":"","name":"Lights","tab":"6cd20504.9b61cc","order":1,"disp":true,"width":"6","collapse":false},{"id":"394c9b3f.da6e44","type":"ui_group","z":"","name":"flowtest","tab":"8dbceec7.ef77c","disp":true,"width":"12","collapse":false},{"id":"8dbceec7.ef77c","type":"ui_tab","z":0,"name":"Test","icon":"dashboard","order":6},{"id":"228f61f1.0e31ce","type":"ui_group","z":"","name":"flowtest","tab":"20ecb5b2.2aea2a","disp":true,"width":"12","collapse":false},{"id":"20ecb5b2.2aea2a","type":"ui_tab","z":0,"name":"Test","icon":"dashboard","order":6},{"id":"36f19b4a.9303c4","type":"light-scheduler-settings","z":"","name":"Sunset","latitude":"-26.0188","longitude":"28.0194"},{"id":"cbae6ef5.500b8","type":"server","z":"","name":"Home Assistant"},{"id":"b33c9b3c.0231a8","type":"ui_group","z":"","name":"Keypad","tab":"56b206e1.e48ee8","order":1,"disp":true,"width":"6","collapse":false},{"id":"d42c7e99.0018","type":"server","z":"","name":"Home Assistant"},{"id":"f203cb2a.343698","type":"ui_group","z":"","name":"Door Status","tab":"6004c38a.0ab34c","order":3,"disp":true,"width":"6","collapse":false},{"id":"56b206e1.e48ee8","type":"ui_tab","z":"","name":"Alarm Panel","icon":"dashboard","order":1},{"id":"6004c38a.0ab34c","type":"ui_tab","z":"","name":"Pool Controls","icon":"dashboard","order":2},{"id":"84ee05c2.2bb708","type":"server","z":"","name":"Home Assistant"},{"id":"d934dccd.6ebae","type":"server","z":"","name":"Home Assistant"},{"id":"7a64aeda.d1efb","type":"mqtt-broker","z":"","broker":"192.168.86.168","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"35d4fcd5.04deb4","type":"server","z":"","name":"Home Assistant"},{"id":"11ac16b6.0ab969","type":"light-scheduler-settings","z":"","name":"my settings","latitude":"38.8977","longitude":"77.0365"},{"id":"a3342807.115888","type":"server","z":"","name":"Home Assistant"},{"id":"a0afaa39.4de1a8","type":"ui_group","z":"","name":"Alexa Speak","tab":"dc2eeab7.0a26c8","order":1,"disp":true,"width":"6","collapse":false},{"id":"dc2eeab7.0a26c8","type":"ui_tab","z":"","name":"Alexa Speak","icon":"speaker","order":2},{"id":"5d0de7fb.a20278","type":"alexa-remote-account","z":"","name":"Fletcher Alexa","authMethod":"cookie","proxyOwnIp":"192.168.1.43","proxyPort":"88","cookieFile":"","refreshInterval":"3","alexaServiceHost":"pitangui.amazon.com","amazonPage":"amazon.com","acceptLanguage":"en-US","userAgent":"","useWsMqtt":"on","autoInit":"on"},{"id":"2631de14.3000c2","type":"ui_group","z":"","name":"Choose","tab":"37f3731e.e9d04c","order":1,"disp":true,"width":"6","collapse":false},{"id":"8ed891bd.550a7","type":"ui_group","z":"","name":"Controls","tab":"37f3731e.e9d04c","order":2,"disp":true,"width":"6","collapse":false},{"id":"363b5f3e.6e4e2","type":"ui_group","z":"","name":"Music","tab":"37f3731e.e9d04c","order":3,"disp":true,"width":"6","collapse":false},{"id":"37f3731e.e9d04c","type":"ui_tab","z":"","name":"Alexa Play Music","icon":"speaker","order":12,"disabled":false,"hidden":false},{"id":"5a92f1da.a8503","type":"server","z":"","name":"Home Assistant"},{"id":"aea3d1f8.3aa12","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"node-red","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cf49b477.229318","type":"tls-config","z":"","name":"HASS-TLS","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","verifyservercert":false},{"id":"7026be24.29b","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":2},{"id":"fd6b3884.0b6fb8","type":"ui_group","z":"","name":"Environmental","tab":"7026be24.29b","order":1,"disp":true,"width":"6","collapse":false},{"id":"65d76e91.9f04f","type":"ui_group","z":"","name":"Batteries","tab":"7026be24.29b","order":3,"disp":true,"width":"6","collapse":false},{"id":"a6578627.d6e238","type":"ui_group","z":"","name":"Z-Wave","tab":"7026be24.29b","order":4,"disp":true,"width":"6","collapse":false},{"id":"93371ca1.dbf4d","type":"ui_group","z":"","name":"Thermostat","tab":"7026be24.29b","order":2,"disp":true,"width":"6","collapse":false},{"id":"1b366c36.b7b814","type":"server","z":"","name":"Home Assistant - HassioNuc","legacy":false,"hassio":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"477fc8ec.536878","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":""},{"id":"ff74e238.fe90b","type":"mqtt-broker","z":"","name":"unRaid-MQTT","broker":"192.168.1.4","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"54b210d6.f2a3e","type":"mqtt-broker","z":"","name":"unRaid-MQTT","broker":"192.168.1.4","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"f72d7efe.eb28e","type":"server","z":"","name":"Home Assistant"},{"id":"1b4c328e.81cadd","type":"mqtt-broker","z":"","broker":"homeauto.vpn.glasgownet.com","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"7bb58db8.1423e4","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":""},{"id":"feb63a70.687138","type":"http request","z":"6e4e7309.81165c","name":"Karien Travel Time","method":"GET","ret":"obj","paytoqs":false,"url":"https://maps.googleapis.com/maps/api/distancematrix/json?origins=18+Forest+Drive+Lonehill&destinations=NetFlorist+Waterfall+Commercial+District+Midrand&key={{secret}}&mode=driving&traffic_model=pessimistic&departure_time=now","tls":"","proxy":"","authType":"","x":450,"y":140,"wires":[["8b6353a0.5542d"]]},{"id":"39bd73db.ff4c8c","type":"inject","z":"6e4e7309.81165c","name":"","topic":"1","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":400,"wires":[["253083b6.febbcc","4dc3c2a9.9b28ec"]]},{"id":"b794425b.97b8b","type":"switch","z":"6e4e7309.81165c","name":"RAG scale","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"11","vt":"str"},{"t":"btwn","v":"12","vt":"str","v2":"20","v2t":"str"},{"t":"gte","v":"21","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1030,"y":220,"wires":[["7d2760d2.febd6"],["82631610.583b78"],["5ac48bb7.fde664"]]},{"id":"7d2760d2.febd6","type":"function","z":"6e4e7309.81165c","name":"kk - green","func":"msg.topic ='karien'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'green'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":120,"wires":[["e6223a2b.130d28","f9a2bf40.e17e2"]]},{"id":"d7d6cc3a.f3411","type":"switch","z":"6e4e7309.81165c","name":"RAG scale","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"8","vt":"str"},{"t":"btwn","v":"9","vt":"str","v2":"12","v2t":"str"},{"t":"gte","v":"13","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1030,"y":340,"wires":[["80822b2b.0ebc18"],["ffbc4453.ac9408"],["30c8eb76.72fa54"]]},{"id":"75a3e0c8.9585b","type":"http request","z":"6e4e7309.81165c","name":"Fletcher Travel Time","method":"GET","ret":"obj","paytoqs":false,"url":"https://maps.googleapis.com/maps/api/distancematrix/json?origins=18+Forest+Drive+Lonehill&destinations=3012+william+Nicol+Drive+Bryanston&key={{secret}}&mode=driving&traffic_model=pessimistic&departure_time=now","tls":"","proxy":"","authType":"","x":420,"y":320,"wires":[["7ab08437.e641dc","dce5a2c4.8dd14"]]},{"id":"3b4abb08.ef19e4","type":"switch","z":"8c3854a8.1ec5c8","name":"","property":"StartupDelay","propertyType":"global","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":120,"wires":[[],["66ff4b09.c97e84"]]},{"id":"66ff4b09.c97e84","type":"delay","z":"8c3854a8.1ec5c8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":180,"wires":[["3b4abb08.ef19e4"]]},{"id":"9b33cb8d.70f6c8","type":"delay","z":"8c3854a8.1ec5c8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":180,"y":120,"wires":[["3b4abb08.ef19e4"]]},{"id":"d679ca69.a5eff8","type":"mqtt in","z":"247a7db4.488d62","name":"OwnTracks","topic":"owntracks/+/+","qos":"2","datatype":"auto","broker":"66726911.b76f98","x":100,"y":220,"wires":[["19de6bc8.135374"]]},{"id":"2456d521.b9e6fa","type":"json","z":"247a7db4.488d62","name":"","property":"payload","action":"","pretty":false,"x":410,"y":220,"wires":[["3a89732c.33e0dc"]]},{"id":"3a89732c.33e0dc","type":"function","z":"247a7db4.488d62","name":"Parse","func":"if (msg.payload._type === \"location\")\n{\n//    var date = new Date(parseInt(msg.payload.tst) * 1000);\n    \n    msg.payload.data = {\n        \"battery\" : parseInt(msg.payload.batt),\n        \"dev_id\" : msg.topic.replace(/\\/|-/g, \"_\").toLowerCase(),\n        \"gps\" : [parseFloat(msg.payload.lat),parseFloat(msg.payload.lon)],\n        \"gps_accuracy\" : msg.payload.acc\n    };\n    msg.timestamp = msg.payload.tst;\n}\nelse\n    msg = null;\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":220,"wires":[["168ca38f.8671fc"]]},{"id":"2f3f7007.462dd","type":"switch","z":"247a7db4.488d62","name":"At Home?","property":"location.inarea","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":220,"wires":[["ed3c34.610fd3d"],["3662be20.6c7fc2","53657ae0.e1e554"]]},{"id":"3662be20.6c7fc2","type":"change","z":"247a7db4.488d62","name":"Home","rules":[{"t":"set","p":"payload.data.location_name","pt":"msg","to":"home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":240,"wires":[["c0e92bed.0c7bd8","3aa1a5f6.11028a"]]},{"id":"ed3c34.610fd3d","type":"change","z":"247a7db4.488d62","name":"Away","rules":[{"t":"set","p":"payload.data.location_name","pt":"msg","to":"not_home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":200,"wires":[["3aa1a5f6.11028a","c0e92bed.0c7bd8","d3c2f4af.3d9fc8"]]},{"id":"c0e92bed.0c7bd8","type":"debug","z":"247a7db4.488d62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1070,"y":200,"wires":[]},{"id":"3aa1a5f6.11028a","type":"api-call-service","z":"247a7db4.488d62","name":"Update device_tracker","server":"","service_domain":"device_tracker","service":"see","data":"","mergecontext":"","x":1120,"y":240,"wires":[[]]},{"id":"19de6bc8.135374","type":"subflow:8c3854a8.1ec5c8","z":"247a7db4.488d62","name":"","env":[],"x":260,"y":220,"wires":[["2456d521.b9e6fa"]]},{"id":"53657ae0.e1e554","type":"api-current-state","z":"247a7db4.488d62","name":"Recent Door Activity?","server":"","outputs":1,"halt_if":"","override_topic":false,"entity_id":"input_boolean.door_activity","override_payload":true,"override_data":true,"x":940,"y":320,"wires":[["d72f7d3b.51632","1a2c4c63.6126f4"]]},{"id":"d72f7d3b.51632","type":"switch","z":"247a7db4.488d62","name":"On / Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1140,"y":320,"wires":[["d3c2f4af.3d9fc8"],["7c4518f1.d4e128"]]},{"id":"d3c2f4af.3d9fc8","type":"function","z":"247a7db4.488d62","name":"OwnTracks variable","func":"distance = parseInt(msg.location.distances.Home);\ninterval = parseInt(0.000000000000475 * Math.pow(distance,4) - 0.00000000475 * Math.pow(distance,3) + 0.0000265 * Math.pow(distance,2) + 0.0037 * distance + 1.43);\ndev_id = msg.topic.replace(/\\/|-/g, \"_\").toLowerCase();\n\nif (interval < 3) interval = 3;\nif (interval > 300) interval = 300;\n\nlastInterval = flow.get(dev_id + '_last_owntracks_interval');\nlastTimestamp = flow.get(dev_id + '_last_owntracks_timestamp');\n\nvar temp = new Date(parseInt(msg.timestamp) * 1000);\nnode.status({fill: \"green\", shape: \"dot\", text: interval + \" at \" + temp.toLocaleString()});\n\nif (typeof(lastInterval) != \"undefined\")\n{\n\tif ((msg.timestamp - 3600) < lastTimestamp) // less than 1 hour since last update?\n\t{\n\t\tif (lastInterval > (interval / 1.05) && lastInterval < (interval * 1.05)) // within 5% of last update?\n        {\n            node.status({fill: \"red\", shape: \"ring\", text: interval + \" at \" + temp.toLocaleString()});\n            msg = null;\n        }\n        else\n\t\t{\n            node.status({fill: \"green\", shape: \"dot\", text: msg.timestamp + \" versus \" + lastTimestamp});\n            flow.set('_last_owntracks_interval', interval);\n            flow.set('_last_owntracks_timestamp', msg.timestamp);\n\n            msg.topic = msg.topic + \"/cmd\";\n            msg.payload = {\n                \"_type\" : \"cmd\",\n                \"action\" : \"setConfiguration\",\n                \"configuration\" : {\n                    \"_type\" : \"configuration\",\n                    \"beaconMode\" : 2,\n                    \"locatorDisplacement\" : interval * 2,\n                    \"locatorInterval\" : interval,\n                    \"pub\" : \"true\",\n                    \"pubQos\" : 2\n                }\n            };\n        }\n    }\n    else\n    {\n        flow.set(dev_id + '_last_owntracks_interval', interval);\n        flow.set(dev_id + '_last_owntracks_timestamp', msg.timestamp);\n\n        msg.topic = msg.topic + \"/cmd\";\n        msg.payload = {\n            \"_type\" : \"cmd\",\n            \"action\" : \"setConfiguration\",\n            \"configuration\" : {\n                \"_type\" : \"configuration\",\n                \"beaconMode\" : 2,\n                \"locatorDisplacement\" : interval * 2,\n                \"locatorInterval\" : interval,\n                \"pub\" : \"true\",\n                \"pubQos\" : 2\n            }\n        };\n    }\n}\nelse\n{\n    flow.set(dev_id + '_last_owntracks_interval', interval);\n    flow.set(dev_id + '_last_owntracks_timestamp', msg.timestamp);\n\n    msg.topic = msg.topic + \"/cmd\";\n    msg.payload = {\n        \"_type\" : \"cmd\",\n        \"action\" : \"setConfiguration\",\n        \"configuration\" : {\n            \"_type\" : \"configuration\",\n            \"beaconMode\" : 2,\n            \"locatorDisplacement\" : interval * 2,\n            \"locatorInterval\" : interval,\n            \"pub\" : \"true\",\n            \"pubQos\" : 2\n        }\n    };\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":300,"wires":[["91909a7c.9cb358","7b34452e.482e8c"]]},{"id":"7c4518f1.d4e128","type":"function","z":"247a7db4.488d62","name":"OwnTracks 120sec","func":"var timestamp = new Date(parseInt(msg.timestamp) * 1000);\nnode.status({fill: \"green\", shape: \"dot\", text: 120 + \" at \" + timestamp.toLocaleString()});\ndev_id = msg.topic.replace(/\\/|-/g, \"_\").toLowerCase();\n\nflow.set(dev_id + '_last_owntracks_timestamp', msg.timestamp);\nflow.set(dev_id + '_last_owntracks_interval', 120);\n\nmsg.topic = msg.topic + \"/cmd\";\nmsg.payload = {\n    \"_type\" : \"cmd\",\n    \"action\" : \"setConfiguration\",\n    \"configuration\" : {\n        \"_type\" : \"configuration\",\n        \"beaconMode\" : 2,\n        \"locatorDisplacement\" : 50,\n        \"locatorInterval\" : 120,\n        \"pub\" : \"true\",\n        \"pubQos\" : 2\n    }\n};\n// beaconMode was 0\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":360,"wires":[["7b34452e.482e8c","91909a7c.9cb358"]]},{"id":"91909a7c.9cb358","type":"mqtt out","z":"247a7db4.488d62","name":"","topic":"","qos":"2","retain":"false","broker":"66726911.b76f98","x":1510,"y":340,"wires":[]},{"id":"7b34452e.482e8c","type":"debug","z":"247a7db4.488d62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1510,"y":300,"wires":[]},{"id":"5025b575.b2191c","type":"comment","z":"247a7db4.488d62","name":"Note: override topic is OFF","info":"","x":930,"y":360,"wires":[]},{"id":"1a2c4c63.6126f4","type":"debug","z":"247a7db4.488d62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1130,"y":360,"wires":[]},{"id":"168ca38f.8671fc","type":"geofence","z":"247a7db4.488d62","name":"Home","mode":"polyline","inside":"both","rad":0,"points":[{"latitude":0.470799056043745,"longitude":40.95746326446533},{"latitude":0.47222352757142,"longitude":40.95632600784302},{"latitude":0.4736796205139,"longitude":40.95759201049805},{"latitude":0.4736796205139,"longitude":40.96282768249512},{"latitude":0.47220770028812,"longitude":40.96387910842896},{"latitude":0.47083071131877,"longitude":40.96278476715088}],"centre":{},"x":650,"y":220,"wires":[["2f3f7007.462dd"]]},{"id":"28eff82f.ca78b8","type":"server-state-changed","z":"690339e0.145a08","name":"owntracks - fk_s9_2","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.fk_fsksg9","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":220,"wires":[["fe3bbea7.0d5d6","9410eb33.646268"]]},{"id":"114de7e4.3e35a8","type":"debug","z":"690339e0.145a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1090,"y":120,"wires":[]},{"id":"c7104eaf.bb384","type":"comment","z":"690339e0.145a08","name":"Track FK S9 OwnTracks","info":"","x":150,"y":180,"wires":[]},{"id":"9d234afc.ff0698","type":"secret","z":"eddcae95.aa2d6","name":"IFTTT API Key","x":400,"y":260,"wires":[["45c311e4.b3ef6"]]},{"id":"45c311e4.b3ef6","type":"template","z":"eddcae95.aa2d6","name":"Set msg.url","field":"url","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"https://maker.ifttt.com/trigger/doorbell/with/key/{{secret}}","x":510,"y":320,"wires":[["cd2b4da9.7683d","5c498709.f71758"]]},{"id":"5c498709.f71758","type":"http request","z":"eddcae95.aa2d6","name":"IFTTT","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","x":670,"y":340,"wires":[[]]},{"id":"cd2b4da9.7683d","type":"debug","z":"eddcae95.aa2d6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":300,"wires":[]},{"id":"eaef44f7.309e58","type":"inject","z":"eddcae95.aa2d6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":280,"y":200,"wires":[["9d234afc.ff0698"]]},{"id":"2cc6e2d8.58622e","type":"switch","z":"690339e0.145a08","name":"==home, Check if state has actually changed","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"neq","v":"data.new_state.state","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":120,"wires":[["114de7e4.3e35a8"]]},{"id":"fe3bbea7.0d5d6","type":"switch","z":"690339e0.145a08","name":"Home? or Not Home?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":220,"wires":[["2cc6e2d8.58622e"],["e5e844b8.4a7478","545cbe7d.2f528"]]},{"id":"e5e844b8.4a7478","type":"switch","z":"690339e0.145a08","name":"==not_home, Check if state has actually changed","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"neq","v":"data.new_state.state","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":340,"wires":[["263a43f6.68bdfc"]]},{"id":"263a43f6.68bdfc","type":"debug","z":"690339e0.145a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1110,"y":340,"wires":[]},{"id":"9410eb33.646268","type":"debug","z":"690339e0.145a08","name":"owntracks_status","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":370,"y":340,"wires":[]},{"id":"545cbe7d.2f528","type":"debug","z":"690339e0.145a08","name":"not_home_debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":220,"wires":[]},{"id":"363494c0.c247ac","type":"pushover","z":"6e4e7309.81165c","name":"","device":"","title":"Travel Time","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1750,"y":240,"wires":[]},{"id":"80822b2b.0ebc18","type":"function","z":"6e4e7309.81165c","name":"fk - green","func":"msg.topic ='fletcher'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'green'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":320,"wires":[["77e84e5f.cac4f","2c2befab.60d54"]]},{"id":"e78056ed.d2c348","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","version":1,"service_domain":"media_player","service":"alexa_tts","entityId":"media_player.fletcher_s_echo_plus","data":"{\"message\":\"{{payload.message}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":240,"wires":[[]]},{"id":"e09804ce.b2c8e8","type":"inject","z":"15c157a1.27c788","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":260,"wires":[["e811d255.7c29d","8727ab18.ed3a88"]]},{"id":"8727ab18.ed3a88","type":"function","z":"15c157a1.27c788","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":260,"wires":[[]]},{"id":"a317812d.8fab6","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":320,"wires":[[]]},{"id":"e811d255.7c29d","type":"function","z":"15c157a1.27c788","name":"create Karien Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: 'Weclome home ' + name ,\n};\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":320,"wires":[[]]},{"id":"b3aa40d6.c99f9","type":"switch","z":"95334549.408f08","name":"HOME / NOT HOME","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":180,"wires":[["27c84a0d.495506"],["2db90c5e.f2e6c4"]],"outputLabels":["Fletcher",""]},{"id":"fc784599.17c248","type":"switch","z":"95334549.408f08","name":"HOME / NOT HOME","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":500,"wires":[["3b91f5b.b89f90a"],["63cb3cd9.29a4c4"]],"outputLabels":["Fletcher",null]},{"id":"8e13aa60.5dc868","type":"server-state-changed","z":"95334549.408f08","name":"karien-home-devicetracker","server":"abc5f2b.6bde21","version":1,"entityidfilter":"device_tracker.karien_s_s8","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":500,"wires":[["fc784599.17c248"]]},{"id":"c0ae4fd.b6596b","type":"server-state-changed","z":"95334549.408f08","name":"fletcher-home-devicetracker","server":"abc5f2b.6bde21","version":1,"entityidfilter":"device_tracker.fletcher_s_s9","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":80,"wires":[["b3aa40d6.c99f9","ba93698d.f96ba8"]]},{"id":"cb418d52.19d0d","type":"api-call-service","z":"95334549.408f08","name":"Alexa Plus - Karien is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"Welcome home babe!!\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":440,"wires":[[]]},{"id":"8c367b1a.45e958","type":"api-call-service","z":"95334549.408f08","name":"Alexa Dot - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\" media_player.fletcher_s_echo_dot\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1120,"y":140,"wires":[[]]},{"id":"694d285d.0cade8","type":"api-call-service","z":"95334549.408f08","name":"Alexa - Karien is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\" media_player.fletcher_s_echo_dot\",\"message\":\"Welcome home babe!!\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1080,"y":500,"wires":[[]]},{"id":"27c84a0d.495506","type":"function","z":"95334549.408f08","name":"create \"fletcher\" home message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":100,"wires":[["d387f597.672e18","8c367b1a.45e958","14d036c2.d8f819"]]},{"id":"d387f597.672e18","type":"api-call-service","z":"95334549.408f08","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1120,"y":80,"wires":[[]]},{"id":"2db90c5e.f2e6c4","type":"function","z":"95334549.408f08","name":"create \"fletcher\" away message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is away',\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":340,"wires":[["14d036c2.d8f819"]]},{"id":"14d036c2.d8f819","type":"change","z":"95334549.408f08","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":280,"wires":[["6e9500b0.89b8"]]},{"id":"6e9500b0.89b8","type":"pushover","z":"95334549.408f08","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1120,"y":280,"wires":[]},{"id":"131463a6.8be71c","type":"change","z":"95334549.408f08","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":580,"wires":[["8bae1578.74a698"]]},{"id":"8bae1578.74a698","type":"pushover","z":"95334549.408f08","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1180,"y":580,"wires":[]},{"id":"3b91f5b.b89f90a","type":"function","z":"95334549.408f08","name":"create Karien Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: 'Weclome home ' + name ,\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":440,"wires":[["131463a6.8be71c","cb418d52.19d0d","694d285d.0cade8"]]},{"id":"63cb3cd9.29a4c4","type":"function","z":"95334549.408f08","name":"create Karien away Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: name + ' is away' ,\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":640,"wires":[["131463a6.8be71c"]]},{"id":"b0ff6576.7a4728","type":"inject","z":"15c157a1.27c788","name":"","topic":"node-red-tracker","payload":"Test from Node-red","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":120,"wires":[["f35c8f94.5f047"]]},{"id":"f35c8f94.5f047","type":"pushover","z":"15c157a1.27c788","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":580,"y":120,"wires":[]},{"id":"31618ae6.532246","type":"comment","z":"15c157a1.27c788","name":"Node-red-contrib-testing","info":"","x":130,"y":80,"wires":[]},{"id":"a7f1c5aa.7b4528","type":"comment","z":"15c157a1.27c788","name":"Alexa testing with Home Assistant service","info":"","x":180,"y":220,"wires":[]},{"id":"253083b6.febbcc","type":"secret","z":"6e4e7309.81165c","name":"secret","x":250,"y":160,"wires":[["feb63a70.687138"]]},{"id":"d60ca853.67e678","type":"mqtt out","z":"6e4e7309.81165c","name":"whale - MQTT","topic":"","qos":"","retain":"","broker":"66726911.b76f98","x":1780,"y":120,"wires":[]},{"id":"e6223a2b.130d28","type":"change","z":"6e4e7309.81165c","name":"Travel Time Text","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopictext","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":120,"wires":[["d60ca853.67e678","132ac459.9fd4bc","363494c0.c247ac"]]},{"id":"77e84e5f.cac4f","type":"change","z":"6e4e7309.81165c","name":"Travel Time Text","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopictext","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":320,"wires":[["4926198c.c16bc8","858d37e.2dbe8c8","363494c0.c247ac"]]},{"id":"4926198c.c16bc8","type":"mqtt out","z":"6e4e7309.81165c","name":"whale - mqtt","topic":"","qos":"","retain":"","broker":"66726911.b76f98","x":1750,"y":320,"wires":[]},{"id":"82631610.583b78","type":"function","z":"6e4e7309.81165c","name":"kk - amber","func":"msg.topic ='karien'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'amber'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":180,"wires":[["e6223a2b.130d28","f9a2bf40.e17e2"]]},{"id":"5ac48bb7.fde664","type":"function","z":"6e4e7309.81165c","name":"kk - red","func":"msg.topic ='karien'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'red'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":240,"wires":[["f9a2bf40.e17e2","e6223a2b.130d28"]]},{"id":"f9a2bf40.e17e2","type":"change","z":"6e4e7309.81165c","name":"Travel Time Color","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopicled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"led","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":240,"wires":[["d60ca853.67e678","132ac459.9fd4bc"]]},{"id":"ffbc4453.ac9408","type":"function","z":"6e4e7309.81165c","name":"fk - amber","func":"msg.topic ='fletcher'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'amber'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":380,"wires":[["77e84e5f.cac4f","2c2befab.60d54"]]},{"id":"30c8eb76.72fa54","type":"function","z":"6e4e7309.81165c","name":"fk - red","func":"msg.topic =' fletcher'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'red'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":440,"wires":[["77e84e5f.cac4f","2c2befab.60d54"]]},{"id":"2c2befab.60d54","type":"change","z":"6e4e7309.81165c","name":"Travel Time Color","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopicled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"led","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":440,"wires":[["4926198c.c16bc8","858d37e.2dbe8c8"]]},{"id":"7dc1bb08.e935f4","type":"mqtt in","z":"d58c58f8.8219f8","name":"MXChip Telemetry","topic":"tele/mxchip1/#","qos":"0","datatype":"json","broker":"6eb36010.171f5","x":250,"y":360,"wires":[["5b55320.6d00bd","6c425fbc.46415"]]},{"id":"b42e1599.015548","type":"comment","z":"d58c58f8.8219f8","name":"MQTT -> Node-Red -> mongoDB","info":"","x":270,"y":300,"wires":[]},{"id":"6c425fbc.46415","type":"switch","z":"d58c58f8.8219f8","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"tele/mxchip1/temp","vt":"str"},{"t":"eq","v":"tele/mxchip1/humidity","vt":"str"},{"t":"eq","v":"pressure","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":580,"y":400,"wires":[["d06cae10.30a38"],["67c4d1b8.6d37a"],[]]},{"id":"d06cae10.30a38","type":"function","z":"d58c58f8.8219f8","name":"format for influx - temperature","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    temperature: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":380,"wires":[["cf8492f0.89e8a"]]},{"id":"67c4d1b8.6d37a","type":"function","z":"d58c58f8.8219f8","name":"format for influx - humidity","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    humidity: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":440,"wires":[["f337d8b6.fc67e8"]]},{"id":"cf8492f0.89e8a","type":"influxdb out","z":"d58c58f8.8219f8","influxdb":"beb2d5b5.e9a6f8","name":"influx insert","measurement":"temperature","precision":"","retentionPolicy":"","x":1210,"y":320,"wires":[]},{"id":"f337d8b6.fc67e8","type":"influxdb out","z":"d58c58f8.8219f8","influxdb":"beb2d5b5.e9a6f8","name":"influx insert","measurement":"humidity","precision":"","retentionPolicy":"","x":1210,"y":480,"wires":[]},{"id":"5b55320.6d00bd","type":"mongodb out","z":"d58c58f8.8219f8","mongodb":"60641eba.4e311","name":"","collection":"MXChip","payonly":false,"upsert":false,"multi":false,"operation":"insert","x":920,"y":260,"wires":[]},{"id":"bbd4df20.427f","type":"http in","z":"6e4e7309.81165c","name":"","url":"/karientraffic","method":"get","upload":false,"swaggerDoc":"","x":110,"y":100,"wires":[["253083b6.febbcc"]]},{"id":"7ab08437.e641dc","type":"change","z":"6e4e7309.81165c","name":"duration in traffic to traveltime","rules":[{"t":"set","p":"traveltime","pt":"msg","to":"payload.rows[0].elements[0].duration_in_traffic.text","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["b55b4d25.80e9c"]]},{"id":"bffb20b4.e6fdd","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"+CSIM: 201,\"90CC715D02E87B9BF513.....\"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":220,"wires":[["4bd8caf1.9667a4"]]},{"id":"4bd8caf1.9667a4","type":"function","z":"8c52d380.fec46","name":"Extract bit in quotes","func":"var part = msg.payload.split(\" \")[0];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":200,"wires":[["b674c484.f834b8","c06e9451.771448"]]},{"id":"b674c484.f834b8","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":550,"y":220,"wires":[]},{"id":"1bc23905.c2a187","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"16 mins","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":160,"wires":[["4bd8caf1.9667a4"]]},{"id":"b55b4d25.80e9c","type":"function","z":"6e4e7309.81165c","name":"Extract bit in quotes","func":"var part = msg.traveltime.split(\" \")[0];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":480,"wires":[["49727091.39b16"]]},{"id":"5ded3759.4b0b58","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"+CSIM: 201,\"90CC715D02E87B9BF513.....\"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":320,"wires":[["e53d6db7.21953"]]},{"id":"e53d6db7.21953","type":"function","z":"8c52d380.fec46","name":"Extract bit in quotes","func":"var part = msg.payload.split(\"\\\"\")[1];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":320,"wires":[["6d23d1ac.7a8a5"]]},{"id":"6d23d1ac.7a8a5","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":570,"y":320,"wires":[]},{"id":"c06e9451.771448","type":"change","z":"8c52d380.fec46","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":160,"wires":[["bdb4337.db257d"]]},{"id":"bdb4337.db257d","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":790,"y":180,"wires":[]},{"id":"49727091.39b16","type":"change","z":"6e4e7309.81165c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":480,"wires":[["d7d6cc3a.f3411"]]},{"id":"8b6353a0.5542d","type":"change","z":"6e4e7309.81165c","name":"duration in traffic to traveltime","rules":[{"t":"set","p":"traveltime","pt":"msg","to":"payload.rows[0].elements[0].duration_in_traffic.text","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":140,"wires":[["18f34b20.314c25"]]},{"id":"18f34b20.314c25","type":"function","z":"6e4e7309.81165c","name":"Extract bit in quotes","func":"var part = msg.traveltime.split(\" \")[0];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":60,"wires":[["4446730.a42858c"]]},{"id":"4446730.a42858c","type":"change","z":"6e4e7309.81165c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":60,"wires":[["b794425b.97b8b"]]},{"id":"132ac459.9fd4bc","type":"mqtt out","z":"6e4e7309.81165c","name":"unraid - mqtt","topic":"","qos":"","retain":"","broker":"6eb36010.171f5","x":1750,"y":180,"wires":[]},{"id":"858d37e.2dbe8c8","type":"mqtt out","z":"6e4e7309.81165c","name":"unraid - mqtt","topic":"","qos":"","retain":"","broker":"6eb36010.171f5","x":1770,"y":420,"wires":[]},{"id":"46e79f70.e37b6","type":"server-state-changed","z":"a7fe27bd.2509f8","name":"Life360 - Fletcher","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":340,"wires":[["c7361d4c.1a0fd"]]},{"id":"69b1fe35.2b348","type":"debug","z":"a7fe27bd.2509f8","name":"fletcher_work","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":965,"y":160,"wires":[]},{"id":"9f372854.a64408","type":"switch","z":"a7fe27bd.2509f8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"fletcher_work","vt":"str"},{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":610,"y":340,"wires":[["69b1fe35.2b348"],["ae8093b3.e6b9a","d15b7cca.4448"],["5256da42.a63034"]]},{"id":"5256da42.a63034","type":"debug","z":"a7fe27bd.2509f8","name":"not_home","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":955,"y":540,"wires":[]},{"id":"ae8093b3.e6b9a","type":"debug","z":"a7fe27bd.2509f8","name":"home","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":945,"y":360,"wires":[]},{"id":"abfcdd3b.9c68c","type":"pushover","z":"a7fe27bd.2509f8","name":"","device":"","title":"fletcher_work_nodered","priority":0,"sound":"","url":"","url_title":"","html":false,"x":995,"y":120,"wires":[]},{"id":"857acace.da57f8","type":"pushover","z":"a7fe27bd.2509f8","name":"","device":"","title":"fletcher_home_nodered","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1005,"y":320,"wires":[]},{"id":"c0809818.e6f5c8","type":"pushover","z":"a7fe27bd.2509f8","name":"","device":"","title":"fletcher_not_home_nodered","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1015,"y":500,"wires":[]},{"id":"2b49fd6d.c19912","type":"mqtt in","z":"b9fe7189.3c263","name":"","topic":"tele/d1minikitchen/SENSOR","qos":"2","datatype":"auto","broker":"6eb36010.171f5","x":170,"y":260,"wires":[["e88e7ac2.d7d088","ea5c971d.967638"]]},{"id":"ea5c971d.967638","type":"debug","z":"b9fe7189.3c263","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":420,"y":420,"wires":[]},{"id":"e88e7ac2.d7d088","type":"json","z":"b9fe7189.3c263","name":"","property":"payload","action":"","pretty":false,"x":480,"y":240,"wires":[["ea5c971d.967638","fa3b4b4b.d85858","9830f0df.29c7b"]]},{"id":"e8c59da0.d7771","type":"mqtt out","z":"b9fe7189.3c263","name":"","topic":"tele/mxchip1/temp","qos":"","retain":"","broker":"6eb36010.171f5","x":870,"y":100,"wires":[]},{"id":"fa3b4b4b.d85858","type":"change","z":"b9fe7189.3c263","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.AM2301.Temperature","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":160,"wires":[["e8c59da0.d7771"]]},{"id":"9830f0df.29c7b","type":"change","z":"b9fe7189.3c263","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.AM2301.Humidity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["650e86e7.ececf8"]]},{"id":"650e86e7.ececf8","type":"mqtt out","z":"b9fe7189.3c263","name":"","topic":"tele/mxchip1/humidity","qos":"","retain":"","broker":"6eb36010.171f5","x":920,"y":320,"wires":[]},{"id":"ba93698d.f96ba8","type":"debug","z":"95334549.408f08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":310,"y":300,"wires":[]},{"id":"4dc3c2a9.9b28ec","type":"secret","z":"6e4e7309.81165c","name":"secret","x":290,"y":460,"wires":[["75a3e0c8.9585b"]]},{"id":"7444290a.ae9af8","type":"http in","z":"6e4e7309.81165c","name":"","url":"/fletchertraffic","method":"get","upload":false,"swaggerDoc":"","x":110,"y":600,"wires":[["4dc3c2a9.9b28ec"]]},{"id":"5fc83e4e.e1a0a","type":"http in","z":"6e4e7309.81165c","name":"","url":"/traffic","method":"get","upload":false,"swaggerDoc":"","x":70,"y":260,"wires":[["253083b6.febbcc","4dc3c2a9.9b28ec"]]},{"id":"c7361d4c.1a0fd","type":"switch","z":"a7fe27bd.2509f8","name":"Check if state has actually changed","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"neq","v":"data.new_state.state","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":340,"wires":[["9f372854.a64408"]]},{"id":"4a3d556c.135414","type":"mqtt in","z":"d90740e8.853308","name":"D1MiniKitchen - Sensor","topic":"tele/d1minikitchen/SENSOR","qos":"0","datatype":"json","broker":"16ebb146.299d6f","x":140,"y":100,"wires":[["287e4a24.981166","78dab763.eaeac"]]},{"id":"287e4a24.981166","type":"mongodb out","z":"d90740e8.853308","mongodb":"39e7b6cc.400702","name":"","collection":"D1Mini","payonly":false,"upsert":false,"multi":false,"operation":"insert","x":630,"y":80,"wires":[]},{"id":"163d1562.ff87fb","type":"comment","z":"d90740e8.853308","name":"MQTT -> Node-Red -> InfluxDB","info":"","x":170,"y":460,"wires":[]},{"id":"13719a21.ada6e6","type":"mqtt in","z":"d90740e8.853308","name":"Temperature - MXChip Telemetry","topic":"tele/mxchip1/temp","qos":"2","datatype":"auto","broker":"16ebb146.299d6f","x":170,"y":520,"wires":[[]]},{"id":"4859cbe6.f42e5c","type":"function","z":"d90740e8.853308","name":"format for influx","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    temperature: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":540,"wires":[["26a945bc.32027a","b0b009f2.297258"]]},{"id":"26a945bc.32027a","type":"debug","z":"d90740e8.853308","name":"known","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":790,"y":600,"wires":[]},{"id":"b0b009f2.297258","type":"influxdb out","z":"d90740e8.853308","influxdb":"87bc6ced.c12878","name":"influx insert","measurement":"temperature","precision":"","retentionPolicy":"","x":730,"y":500,"wires":[]},{"id":"2c972e35.3f0502","type":"inject","z":"d90740e8.853308","name":"inject timestamp","topic":"","payload":"","payloadType":"date","repeat":"600","crontab":"","once":false,"onceDelay":"","x":130,"y":900,"wires":[["74073002.a1df8"]]},{"id":"74073002.a1df8","type":"http request","z":"d90740e8.853308","name":"OpenWeatherMap API","method":"GET","ret":"txt","paytoqs":false,"url":"http://api.openweathermap.org/data/2.5/weather?q=Sandton,ZA&units=metric&APPID=de570399625a54769eaa09cef49a3706","tls":"","proxy":"","x":380,"y":900,"wires":[["10e9a275.6b41de"]]},{"id":"10e9a275.6b41de","type":"json","z":"d90740e8.853308","name":"","property":"payload","action":"","pretty":true,"x":630,"y":900,"wires":[["9bf99611.2f7cb","566e0f01.fc23f"]]},{"id":"9bf99611.2f7cb","type":"function","z":"d90740e8.853308","name":"format for influx","func":"msg.payload ={\n    locale: msg.payload.name,\n    temperature: parseFloat(msg.payload.main.temp),\n    humidity: parseFloat(msg.payload.main.humidity),\n    pressure: parseFloat(msg.payload.main.pressure)\n}\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":900,"wires":[["566e0f01.fc23f","2132911.7e5976e"]]},{"id":"566e0f01.fc23f","type":"debug","z":"d90740e8.853308","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":800,"wires":[]},{"id":"2132911.7e5976e","type":"influxdb out","z":"d90740e8.853308","influxdb":"e613cf86.3feb98","name":"influx insert","measurement":"weatherapis","precision":"","retentionPolicy":"","x":1090,"y":900,"wires":[]},{"id":"2bc95fdf.17f0e8","type":"mqtt in","z":"d90740e8.853308","name":"humidity - MXChip Telemetry","topic":"tele/mxchip1/humidity","qos":"2","datatype":"auto","broker":"16ebb146.299d6f","x":160,"y":700,"wires":[[]]},{"id":"b0ae4f85.5e312","type":"function","z":"d90740e8.853308","name":"format for influx","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    humidity: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":720,"wires":[["79dfe1ca.060b48","a0e4c7a7.04b47"]]},{"id":"79dfe1ca.060b48","type":"influxdb out","z":"d90740e8.853308","influxdb":"87bc6ced.c12878","name":"influx insert","measurement":"humidity","precision":"","retentionPolicy":"","x":730,"y":680,"wires":[]},{"id":"ae28c4a.bd0a838","type":"comment","z":"d90740e8.853308","name":"MQTT -> Node-Red -> mongoDB","info":"","x":610,"y":40,"wires":[]},{"id":"acd84102.4793e8","type":"debug","z":"d90740e8.853308","name":"temperature debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":660,"wires":[]},{"id":"a0e4c7a7.04b47","type":"debug","z":"d90740e8.853308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":700,"y":760,"wires":[]},{"id":"eb017c9a.3fa6a","type":"inject","z":"d90740e8.853308","name":"","topic":"","payload":"{\"Time\":\"2019-09-24T08:43:06\",\"DHT11\":{\"Temperature\":23,\"Humidity\":17},\"TempUnit\":\"C\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":360,"wires":[["78dab763.eaeac"]]},{"id":"78dab763.eaeac","type":"switch","z":"d90740e8.853308","name":"checking if temp and humidity valid","property":"payload.DHT11.Temperature","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"payload.DHT11.Temperature > 0","vt":"jsonata"},{"t":"jsonata_exp","v":"payload.DHT11.Humidity > 0","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":2,"x":540,"y":260,"wires":[["76f8b781.1136e"],["a4d1adec.c3da58"]]},{"id":"76f8b781.1136e","type":"function","z":"d90740e8.853308","name":"format for influx - temperature","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    temperature: parseFloat(msg.payload.DHT11.Temperature)\n}\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":220,"wires":[["694b35a7.79f07c","d4ee81e4.c9d4a"]]},{"id":"694b35a7.79f07c","type":"debug","z":"d90740e8.853308","name":"format","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1110,"y":240,"wires":[]},{"id":"d06c203a.84d03","type":"comment","z":"d90740e8.853308","name":"MQTT -> Node-Red -> InfluxDB","info":"","x":550,"y":220,"wires":[]},{"id":"a4d1adec.c3da58","type":"function","z":"d90740e8.853308","name":"format for influx - humidity","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    humidity: parseFloat(msg.payload.DHT11.Humidity)\n}\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":280,"wires":[["694b35a7.79f07c","c5802da6.2f4d98"]]},{"id":"d4ee81e4.c9d4a","type":"influxdb out","z":"d90740e8.853308","influxdb":"b08dc7ea.aabfd","name":"influx insert temp","measurement":"temperature","precision":"","retentionPolicy":"","x":1130,"y":160,"wires":[]},{"id":"c5802da6.2f4d98","type":"influxdb out","z":"d90740e8.853308","influxdb":"b08dc7ea.aabfd","name":"influx insert humidity","measurement":"humidity","precision":"","retentionPolicy":"","x":1140,"y":320,"wires":[]},{"id":"e255beb7.73e7e","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":500,"wires":[[]]},{"id":"6cc79023.76c3e","type":"inject","z":"15c157a1.27c788","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":540,"wires":[["cbc2fcc7.443d","d1b84f37.abf41"]]},{"id":"2f833142.f32dce","type":"function","z":"15c157a1.27c788","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":520,"wires":[["e255beb7.73e7e","765b3b9f.89c684"]]},{"id":"66a32193.c9fab","type":"function","z":"15c157a1.27c788","name":"create Karien Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: 'Weclome home ' + name ,\n};\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":580,"wires":[["8f4d96df.148cb8","d7cc91f3.75619"]]},{"id":"b423f8a4.bd2348","type":"comment","z":"15c157a1.27c788","name":"Alexa testing with Home Assistant service - notify.alexa_media","info":"","x":240,"y":480,"wires":[]},{"id":"aa993341.a2e07","type":"function","z":"f27aa045.98e9d","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":140,"wires":[["4055698e.897a68","6af7711e.25cf8"]]},{"id":"4055698e.897a68","type":"api-call-service","z":"f27aa045.98e9d","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":100,"wires":[[]]},{"id":"6af7711e.25cf8","type":"api-call-service","z":"f27aa045.98e9d","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":160,"wires":[[]]},{"id":"d15b7cca.4448","type":"subflow:f27aa045.98e9d","z":"a7fe27bd.2509f8","name":"Alexa Messages","env":[],"x":980,"y":400,"wires":[]},{"id":"b0e0123c.81fd","type":"server-state-changed","z":"4770c0d7.397b","name":"Life360 - Fletcher","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":100,"wires":[["ee04eeaa.ad89f"]]},{"id":"69a38b51.df4044","type":"server-state-changed","z":"4770c0d7.397b","name":"Life360 - Karien","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":200,"wires":[["ee04eeaa.ad89f"]]},{"id":"d0f02aba.fa8a68","type":"BooleanLogicUltimate","z":"4770c0d7.397b","name":"","filtertrue":"both","persist":true,"sInitializeWith":"WaitForPayload","triggertopic":"trigger","outputtriggeredby":"all","inputCount":"2","topic":"result","x":720,"y":220,"wires":[["aaebda9e.ec9cb8","31977e07.708122","88356352.8de14"],["96d1f2eb.d94e6"],[]]},{"id":"ee04eeaa.ad89f","type":"switch","z":"4770c0d7.397b","name":"home or not_home","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"},{"t":"cont","v":"work","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":390,"y":160,"wires":[["3f52d095.c754d"],["ccdfba92.973078"],["ccdfba92.973078"]]},{"id":"3f52d095.c754d","type":"change","z":"4770c0d7.397b","name":"home","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":60,"wires":[["d0f02aba.fa8a68"]]},{"id":"ccdfba92.973078","type":"change","z":"4770c0d7.397b","name":"not_home","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":120,"wires":[["d0f02aba.fa8a68"]]},{"id":"aaebda9e.ec9cb8","type":"debug","z":"4770c0d7.397b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":40,"wires":[]},{"id":"31977e07.708122","type":"switch","z":"4770c0d7.397b","name":"not_home?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"turn_off","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":990,"y":100,"wires":[["88356352.8de14"],["96d1f2eb.d94e6"]]},{"id":"88356352.8de14","type":"api-call-service","z":"4770c0d7.397b","name":"PeopleHome - off","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1010,"y":300,"wires":[[]]},{"id":"97608325.277e","type":"api-call-service","z":"8a955ac7.209038","name":"","server":"","version":"1","service_domain":"light","service":"turn_on","entityId":"light.bedside_lights","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1090,"y":260,"wires":[[]]},{"id":"c2443c2c.41ffe","type":"change","z":"8a955ac7.209038","name":"Start Loop","rules":[{"t":"set","p":"brightness","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":245.99999237060547,"y":248.88888883590698,"wires":[["737e32bc.194b5c"]]},{"id":"a7c0f5e6.20ff98","type":"function","z":"8a955ac7.209038","name":"increase brightness","func":"msg.brightness = msg.brightness + 5\nreturn msg;","outputs":1,"noerr":0,"x":542.9999923706055,"y":410.88888931274414,"wires":[["737e32bc.194b5c"]]},{"id":"cd952f50.5613b","type":"switch","z":"8a955ac7.209038","name":"","property":"brightness","propertyType":"msg","rules":[{"t":"eq","v":"96","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":633.9999923706055,"y":246.88888883590698,"wires":[["f9433200.de3f2","5305b9ec.bd07c8"],["a7c0f5e6.20ff98","9ffc2d15.0d73a","d8b01565.f34578"]]},{"id":"d8b01565.f34578","type":"template","z":"8a955ac7.209038","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n  \"brightness_pct\": \"{{brightness\"}}\"\n  }","output":"str","x":853.9999961853027,"y":258.88888931274414,"wires":[["97608325.277e"]]},{"id":"7dbdf8d1.b3d288","type":"api-call-service","z":"8a955ac7.209038","name":"Turn Off Alarm clock","server":"","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.alarm_clock\"}","mergecontext":"","x":1416,"y":203,"wires":[[]]},{"id":"5305b9ec.bd07c8","type":"api-call-service","z":"8a955ac7.209038","name":"","server":"","version":"1","service_domain":"light","service":"turn_on","entityId":"light.bedside_lights","data":"{\"brightness_pct\":\"100\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":878.8333282470703,"y":202.11111164093018,"wires":[["a9fde19e.db9df"]]},{"id":"737e32bc.194b5c","type":"delay","z":"8a955ac7.209038","name":"","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":442.99999237060547,"y":249.43055486679077,"wires":[["cd952f50.5613b"]]},{"id":"66d4a28d.f79f4c","type":"trigger-state","z":"8a955ac7.209038","name":"Alarm Clock","server":"","entityid":"input_boolean.alarm_clock","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"a5l00itz2m","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":62.999977111816406,"y":254.11110591888428,"wires":[["c2443c2c.41ffe"],[]]},{"id":"9ffc2d15.0d73a","type":"change","z":"8a955ac7.209038","name":"disable","rules":[{"t":"set","p":"payload","pt":"msg","to":"disable","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":253.83332061767578,"y":401.1111125946045,"wires":[["66d4a28d.f79f4c"]]},{"id":"f9433200.de3f2","type":"change","z":"8a955ac7.209038","name":"enable","rules":[{"t":"set","p":"payload","pt":"msg","to":"enable","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":323.83332443237305,"y":174.11111068725586,"wires":[["66d4a28d.f79f4c"]]},{"id":"a9fde19e.db9df","type":"delay","z":"8a955ac7.209038","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1071.8333320617676,"y":202.11111068725586,"wires":[["b621b1cd.88729"]]},{"id":"b621b1cd.88729","type":"change","z":"8a955ac7.209038","name":"turn_off","rules":[{"t":"set","p":"payload","pt":"msg","to":"turn_off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1225.8333320617676,"y":202.11111068725586,"wires":[["7dbdf8d1.b3d288"]]},{"id":"2e3f4a64.97ec96","type":"comment","z":"8a955ac7.209038","name":"Disable to prevent any snooze issues","info":"","x":251.0000228881836,"y":448.3333349227905,"wires":[]},{"id":"4479ebb9.8a3e34","type":"comment","z":"8a955ac7.209038","name":"by 5 each loop","info":"","x":752.4999465942383,"y":329.9999589920044,"wires":[]},{"id":"7e6bda28.dc31a4","type":"comment","z":"8a955ac7.209038","name":"until 96","info":"","x":738.0555419921875,"y":167.77778911590576,"wires":[]},{"id":"717be497.62143c","type":"comment","z":"8a955ac7.209038","name":"enact light adjustment","info":"","x":1146.9443283081055,"y":311.11108684539795,"wires":[]},{"id":"e29209db.21cfd8","type":"comment","z":"8a955ac7.209038","name":"set light to max and turn off input_boolean.alarm_clock","info":"","x":1208.0555038452148,"y":149.99998664855957,"wires":[]},{"id":"96d1f2eb.d94e6","type":"api-call-service","z":"4770c0d7.397b","name":"PeopleHome - on","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1290,"y":40,"wires":[[]]},{"id":"65b2f9c1.81edc8","type":"server-state-changed","z":"67c3431e.c4b74c","name":"fletcher - Home?","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":160,"wires":[["4f603189.82c56"]]},{"id":"9ebf1d13.b62ba","type":"and-gate","z":"67c3431e.c4b74c","name":"AND","rules":[{"t":"eq","v":"not_home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_fletcher_kelly"},{"t":"eq","v":"not_home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_karien"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":true,"x":750,"y":160,"wires":[["8e892d93.6355"]],"icon":"node-red-contrib-bool-gate/and.png"},{"id":"984aef35.e4e5f","type":"server-state-changed","z":"67c3431e.c4b74c","name":"Karien - Home?","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":300,"wires":[["50cf83ca.08744c"]]},{"id":"4f603189.82c56","type":"switch","z":"67c3431e.c4b74c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not_home","vt":"str"},{"t":"eq","v":"fletcher_work","vt":"str"},{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":160,"wires":[["9097641b.1016f8"],["9097641b.1016f8"],["da176d54.ded89"]]},{"id":"9097641b.1016f8","type":"change","z":"67c3431e.c4b74c","name":"set to not_home","rules":[{"t":"set","p":"payload","pt":"msg","to":"not_home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":160,"wires":[["9ebf1d13.b62ba"]]},{"id":"50cf83ca.08744c","type":"switch","z":"67c3431e.c4b74c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not_home","vt":"str"},{"t":"eq","v":"karien_work","vt":"str"},{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":300,"wires":[["9097641b.1016f8"],["9097641b.1016f8"],["da176d54.ded89","350d534d.5d7d5c"]]},{"id":"da176d54.ded89","type":"or-gate","z":"67c3431e.c4b74c","name":"","rules":[{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_fletcher_kelly"},{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_karien"}],"outputTopic":"","gateType":"or","emitOnlyIfTrue":true,"x":760,"y":280,"wires":[["bb932300.9b8fa"]]},{"id":"bb932300.9b8fa","type":"api-call-service","z":"67c3431e.c4b74c","name":"PeopleHome - on","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":990,"y":280,"wires":[[]]},{"id":"8e892d93.6355","type":"api-call-service","z":"67c3431e.c4b74c","name":"PeopleHome - off","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":990,"y":160,"wires":[[]]},{"id":"301cb84d.0be808","type":"switch","z":"82378b51.cc8e28","name":"Home?","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":240,"y":260,"wires":[["d4c78ae2.07ee48"],["edb6be4a.e6579"]]},{"id":"d4c78ae2.07ee48","type":"template","z":"82378b51.cc8e28","name":"","field":"payload.entity_id","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"input_select.{{topic}}","output":"str","x":380,"y":220,"wires":[["d84d9479.555b78"]]},{"id":"d84d9479.555b78","type":"api-current-state","z":"82378b51.cc8e28","name":"Status?","server":"","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":520,"y":220,"wires":[["71499efc.15c28","9c34b86a.c59828"]]},{"id":"71499efc.15c28","type":"switch","z":"82378b51.cc8e28","name":"Just Left?","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Just Left","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":660,"y":200,"wires":[["18d00944.044dc7"],["719fdf17.48d9e"]]},{"id":"9c34b86a.c59828","type":"change","z":"82378b51.cc8e28","name":"RESET","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":240,"wires":[["59e0a0.98e16f6","29a7d352.fa5e9c"]]},{"id":"54e86573.d5828c","type":"change","z":"82378b51.cc8e28","name":"RESET","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":300,"wires":[["d3654df5.63704","29a7d352.fa5e9c"]]},{"id":"edb6be4a.e6579","type":"api-call-service","z":"82378b51.cc8e28","name":"Just Left","server":"f7db64c8.551da8","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Just Left\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":380,"y":300,"wires":[["59e0a0.98e16f6","54e86573.d5828c"]]},{"id":"18d00944.044dc7","type":"api-call-service","z":"82378b51.cc8e28","name":"Just Arrived","server":"","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Just Arrived\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":810,"y":180,"wires":[["d3654df5.63704"]]},{"id":"cf792a74.705668","type":"api-call-service","z":"82378b51.cc8e28","name":"Away","server":"f7db64c8.551da8","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Away\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":790,"y":260,"wires":[["29a7d352.fa5e9c"]]},{"id":"80ec70af.09848","type":"api-call-service","z":"82378b51.cc8e28","name":"Extended Away","server":"f7db64c8.551da8","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Extended Away\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1100,"y":240,"wires":[[]]},{"id":"59e0a0.98e16f6","type":"trigger","z":"82378b51.cc8e28","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"10","extend":false,"units":"min","reset":"","bytopic":"topic","name":"10 Min","x":650,"y":280,"wires":[["cf792a74.705668"]]},{"id":"29a7d352.fa5e9c","type":"trigger","z":"82378b51.cc8e28","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"24","extend":false,"units":"hr","reset":"","bytopic":"topic","name":"24 Hrs","x":950,"y":240,"wires":[["80ec70af.09848"]]},{"id":"d3654df5.63704","type":"trigger","z":"82378b51.cc8e28","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"10","extend":false,"units":"min","reset":"","bytopic":"topic","name":"10 Min","x":950,"y":180,"wires":[["719fdf17.48d9e"]]},{"id":"719fdf17.48d9e","type":"api-call-service","z":"82378b51.cc8e28","name":"Home","server":"","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Home\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1070,"y":200,"wires":[[]]},{"id":"d77f8eeb.331b4","type":"change","z":"82378b51.cc8e28","name":"Change","rules":[{"t":"move","p":"payload","pt":"msg","to":"status","tot":"msg"},{"t":"change","p":"topic","pt":"msg","from":"device_tracker.","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":100,"y":260,"wires":[["301cb84d.0be808"]]},{"id":"a5a8255d.21eb28","type":"api-call-service","z":"67c3431e.c4b74c","name":"Just Arrived","server":"a3722ee8.c88ce","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Just Arrived\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":790,"y":600,"wires":[[]]},{"id":"350d534d.5d7d5c","type":"function","z":"67c3431e.c4b74c","name":"kk - home","func":"msg.topic ='kk_status_dropdown'\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":460,"wires":[["a5a8255d.21eb28"]]},{"id":"e3769516.8ee298","type":"server-state-changed","z":"7481132e.5fea8c","name":"Fletcher Home","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"x":130,"y":140,"wires":[[],["4d920e37.2fb6d","4005ae3.1af685","39f8e7d6.4d0428"]]},{"id":"4d920e37.2fb6d","type":"api-call-service","z":"7481132e.5fea8c","name":"Home","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.home_occupied","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":350,"y":140,"wires":[[]]},{"id":"389d152d.bb15ba","type":"server-state-changed","z":"7481132e.5fea8c","name":"Karien Home","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"x":130,"y":200,"wires":[[],["4d920e37.2fb6d","74c0d891.465148","feb94ab7.3ffa48"]]},{"id":"4005ae3.1af685","type":"api-call-service","z":"7481132e.5fea8c","name":"Fletcher Home","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.fletcher_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":340,"y":80,"wires":[[]]},{"id":"74c0d891.465148","type":"api-call-service","z":"7481132e.5fea8c","name":"Karien Home","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.karien_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":350,"y":220,"wires":[[]]},{"id":"3759508f.fc7bb","type":"server-state-changed","z":"7481132e.5fea8c","name":"Fletcher Away","server":"a3722ee8.c88ce","version":"1","entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":130,"y":460,"wires":[[],["b8b68b15.04dcd8","76d5643f.9f7f8c"]]},{"id":"bde2d7fd.391968","type":"api-call-service","z":"7481132e.5fea8c","name":"Away","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.home_occupied","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":610,"y":500,"wires":[[]]},{"id":"8f0a8c0b.d3918","type":"server-state-changed","z":"7481132e.5fea8c","name":"Karien Away","server":"a3722ee8.c88ce","version":"1","entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":130,"y":540,"wires":[[],["d1e8f1cc.d7f15","6e00b193.0cef1"]]},{"id":"b8b68b15.04dcd8","type":"api-call-service","z":"7481132e.5fea8c","name":"Fletcher Away","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.fletcher_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":320,"y":400,"wires":[[]]},{"id":"d1e8f1cc.d7f15","type":"api-call-service","z":"7481132e.5fea8c","name":"Karien Away","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.karien_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":310,"y":600,"wires":[[]]},{"id":"76d5643f.9f7f8c","type":"api-current-state","z":"7481132e.5fea8c","name":"Check Karien Home","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_boolean.karien_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":460,"wires":[[],["bde2d7fd.391968"]]},{"id":"6e00b193.0cef1","type":"api-current-state","z":"7481132e.5fea8c","name":"Check Fletcher Home","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_boolean.fletcher_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":540,"wires":[[],["bde2d7fd.391968"]]},{"id":"965c1baf.7fee88","type":"server-state-changed","z":"d335ec1.d977a1","name":"All Away","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":80,"y":380,"wires":[[],["ad831660.a04738","538283dc.fc73ec","4aee0a13.4a42a4"]]},{"id":"ad831660.a04738","type":"api-call-service","z":"d335ec1.d977a1","name":"Turn off Inside Lights","server":"","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.1545497469252\"}","mergecontext":"","x":360,"y":60,"wires":[[]]},{"id":"10263058.e21a8","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Heat (63)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"63\"}","mergecontext":"","x":570,"y":180,"wires":[[]]},{"id":"538283dc.fc73ec","type":"api-current-state","z":"d335ec1.d977a1","name":"Heating","server":"","outputs":1,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":320,"y":180,"wires":[["10263058.e21a8"]]},{"id":"4aee0a13.4a42a4","type":"api-current-state","z":"d335ec1.d977a1","name":"Cooling","server":"","outputs":1,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":320,"y":300,"wires":[["f8487dc2.51a8d"]]},{"id":"f8487dc2.51a8d","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Cool (78)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"78\"}","mergecontext":"","x":570,"y":300,"wires":[[]]},{"id":"f0abee84.2ad48","type":"poll-state","z":"d335ec1.d977a1","name":"All Away Time","server":"a3722ee8.c88ce","version":"1","updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":false,"entity_id":"input_boolean.home","state_type":"str","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":90,"y":660,"wires":[[],["5bce50a6.ffc1"]]},{"id":"5bce50a6.ffc1","type":"function","z":"d335ec1.d977a1","name":"If Away > 20 Hours","func":"// If away less than 20 hrs, no change\nif (msg.data.timeSinceChangedMs < 72000000 ) {\n    flow.set('awayOver20',0);  // Reset if needed\n    return null\n}\n// Check if already away more than 20 hours \nif (flow.get('awayOver20') == 1 ) {\n    return null\n}\n// Set flow variable to not repeat\nflow.set('awayOver20',1);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":540,"wires":[["60fd0797.d0db18","da7e2dc2.c050b"]]},{"id":"60fd0797.d0db18","type":"api-current-state","z":"d335ec1.d977a1","name":"Heating","server":"","outputs":1,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":520,"y":480,"wires":[["1782715a.ea8a7f"]]},{"id":"da7e2dc2.c050b","type":"api-current-state","z":"d335ec1.d977a1","name":"Cooling","server":"","outputs":1,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":520,"y":580,"wires":[["308d9c.993f6264"]]},{"id":"1782715a.ea8a7f","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Heat (50)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"50\"}","mergecontext":"","x":750,"y":480,"wires":[[]]},{"id":"308d9c.993f6264","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Cool (90)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"90\"}","mergecontext":"","x":750,"y":580,"wires":[[]]},{"id":"2c2ab383.294e0c","type":"server-state-changed","z":"edadc6b3.2cb078","name":"Karien Home","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.karien_home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":90,"y":240,"wires":[[],["9c09eb2f.d50f18"]]},{"id":"2df258fb.da1c38","type":"api-current-state","z":"edadc6b3.2cb078","name":"Sun Down","server":"a3722ee8.c88ce","version":"1","outputs":2,"halt_if":"above_horizon","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sun.sun","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":530,"y":60,"wires":[[],["1c15fc3c.7e1944"]]},{"id":"1c15fc3c.7e1944","type":"api-call-service","z":"edadc6b3.2cb078","name":"Turn On Family Room Light","server":"a3722ee8.c88ce","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.family_room_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":900,"y":60,"wires":[[]]},{"id":"17a49e4d.6ea052","type":"server-state-changed","z":"edadc6b3.2cb078","name":"Fletcher Home","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.fletcher_home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":100,"y":300,"wires":[[],["9c09eb2f.d50f18"]]},{"id":"9c09eb2f.d50f18","type":"function","z":"edadc6b3.2cb078","name":"No Changes","func":"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":260,"wires":[["2df258fb.da1c38"]]},{"id":"433d0791.dd30f8","type":"server-state-changed","z":"edadc6b3.2cb078","name":"Home","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":false,"x":70,"y":680,"wires":[[],["6575da86.2d4164","e2a63dc6.c23f6"]]},{"id":"64819578.05aaec","type":"api-call-service","z":"edadc6b3.2cb078","name":"Set Away Heat (67)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"67\"}","mergecontext":"","x":570,"y":480,"wires":[[]]},{"id":"6575da86.2d4164","type":"api-current-state","z":"edadc6b3.2cb078","name":"Heating","server":"a3722ee8.c88ce","version":"1","outputs":2,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":480,"wires":[[],["64819578.05aaec"]]},{"id":"e2a63dc6.c23f6","type":"api-current-state","z":"edadc6b3.2cb078","name":"Cooling","server":"a3722ee8.c88ce","version":"1","outputs":2,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":600,"wires":[[],["e2e2eeca.7fb1c"]]},{"id":"e2e2eeca.7fb1c","type":"api-call-service","z":"edadc6b3.2cb078","name":"Set Away Cool (75)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"75\"}","mergecontext":"","x":570,"y":600,"wires":[[]]},{"id":"765b3b9f.89c684","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":940,"y":440,"wires":[[]]},{"id":"d7cc91f3.75619","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":900,"y":640,"wires":[[]]},{"id":"8f4d96df.148cb8","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":580,"wires":[[]]},{"id":"cbc2fcc7.443d","type":"delay","z":"15c157a1.27c788","name":"Delay 1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":520,"wires":[["2f833142.f32dce"]]},{"id":"d1b84f37.abf41","type":"delay","z":"15c157a1.27c788","name":"delay 6 sec","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":580,"wires":[["66a32193.c9fab"]]},{"id":"39f8e7d6.4d0428","type":"subflow:f27aa045.98e9d","z":"7481132e.5fea8c","name":"","env":[],"x":340,"y":20,"wires":[]},{"id":"cbcc5460.e82ce8","type":"function","z":"89877c86.8bf5d","name":"create \"Karien\" message","func":"var name = 'Karien';\n\nmsg.payload = { \n    message: 'Welcome Home' + name\n};\nreturn msg;","outputs":1,"noerr":0,"x":367,"y":189,"wires":[["c29e3d01.e7cba","1c465c2b.0c1d44"]]},{"id":"c29e3d01.e7cba","type":"api-call-service","z":"89877c86.8bf5d","name":"Alexa Dot - Karien is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":717,"y":149,"wires":[[]]},{"id":"1c465c2b.0c1d44","type":"api-call-service","z":"89877c86.8bf5d","name":"Alexa Plus - Karien is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":717,"y":209,"wires":[[]]},{"id":"270dd986.0c0cc6","type":"subflow:89877c86.8bf5d","z":"7481132e.5fea8c","name":"","x":490,"y":320,"wires":[]},{"id":"feb94ab7.3ffa48","type":"delay","z":"7481132e.5fea8c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":300,"wires":[["270dd986.0c0cc6"]]},{"id":"5288f2d8.e9beac","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Dot - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\" media_player.fletcher_s_echo_dot\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":80,"wires":[[]]},{"id":"17b12df0.ca7292","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":40,"wires":[[]]},{"id":"8fa4c195.aad3b","type":"function","z":"8c52d380.fec46","name":"create \"fletcher\" home message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":80,"wires":[["17b12df0.ca7292","5288f2d8.e9beac"]]},{"id":"38dd8142.57649e","type":"switch","z":"8c52d380.fec46","name":"HOME / NOT HOME","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":80,"wires":[["8fa4c195.aad3b"],[]],"outputLabels":["Fletcher",""]},{"id":"46b6afe4.58b25","type":"server-state-changed","z":"8c52d380.fec46","name":"fletcher-home-devicetracker","server":"","version":1,"entityidfilter":"device_tracker.fletcher_s_s9","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":40,"wires":[["38dd8142.57649e","4df0f067.e9d2d"]]},{"id":"4df0f067.e9d2d","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":40,"wires":[]},{"id":"4ed59c95.7cd5d4","type":"switch","z":"8c52d380.fec46","name":"","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"payload.compact.outdoor.temperature > 0","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":460,"wires":[["c91cc0de.5a2d8"]],"inputLabels":["xxx"],"outputLabels":["yyy"]},{"id":"c91cc0de.5a2d8","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":490,"y":460,"wires":[]},{"id":"8f0a9011.f8148","type":"comment","z":"8c52d380.fec46","name":"**Explanation**","info":"A JSONata Expression can be provided that will be evaluated against the whole message and will match if the expression returns a true value.","x":120,"y":400,"wires":[]},{"id":"8e4b29e.dc9e3d8","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"{\"compact\":{\"outdoor\":{\"temperature\":15.2,\"humidity\":19,\"temperatureTrend\":\"stable\",\"battery_percent\":57,\"rf_status\":71},\"rain\":{},\"temperature\":20.7,\"temperatureTrend\":\"stable\",\"co2\":486,\"humidity\":37,\"noise\":44,\"pressure\":1026,\"pressureTrend\":\"down\",\"station_name\":\"XXX\",\"last_status_store\":1542206768},\"detailed\":[{\"_id\":\"70:ee:50:00:ea:18\",\"cipher_id\":\"XXX\",\"date_setup\":1371091374,\"last_setup\":1371091374,\"type\":\"NAMain\",\"last_status_store\":1542206768,\"module_name\":\"XXX\",\"firmware\":132,\"last_upgrade\":1440121433,\"wifi_status\":50,\"co2_calibrating\":false,\"station_name\":\"XXX\",\"data_type\":[\"Temperature\",\"CO2\",\"Humidity\",\"Noise\",\"Pressure\"],\"place\":{\"altitude\":120.08533983542,\"city\":\"XXX\",\"country\":\"US\",\"timezone\":\"XXX\",\"location\":[\"XXX\",\"XXX\"]},\"dashboard_data\":{\"time_utc\":1542206753,\"Temperature\":20.7,\"CO2\":486,\"Humidity\":37,\"Noise\":44,\"Pressure\":1026,\"AbsolutePressure\":1011.5,\"min_temp\":20.6,\"max_temp\":21.4,\"date_min_temp\":1542204365,\"date_max_temp\":1542182477,\"temp_trend\":\"stable\",\"pressure_trend\":\"down\"},\"modules\":[{\"_id\":\"02:00:00:00:f8:c4\",\"type\":\"NAModule1\",\"module_name\":\"Outdoor\",\"data_type\":[\"Temperature\",\"Humidity\"],\"last_setup\":1371091749,\"dashboard_data\":{\"time_utc\":1542206723,\"Temperature\":15.2,\"Humidity\":19,\"min_temp\":14.8,\"max_temp\":17.3,\"date_min_temp\":1542203724,\"date_max_temp\":1542189727,\"temp_trend\":\"up\"},\"firmware\":44,\"last_message\":1542206762,\"last_seen\":1542206723,\"rf_status\":71,\"battery_vp\":4965,\"battery_percent\":57}]}]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":460,"wires":[["4ed59c95.7cd5d4"]]},{"id":"5a006441.51e3ec","type":"Sonoff device","z":"8c52d380.fec46","mode":"0","broker":"66726911.b76f98","device":"sonoff","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1110,"y":420,"wires":[[]]},{"id":"1a97aa50.ccb5c6","type":"function","z":"8c52d380.fec46","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":540,"wires":[["cd059f1b.57dd1","54489108.6156c"]]},{"id":"cd059f1b.57dd1","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":500,"wires":[[]]},{"id":"54489108.6156c","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":560,"wires":[[]]},{"id":"42f785b8.3296ac","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":540,"wires":[["1a97aa50.ccb5c6"]]},{"id":"995bcb87.17a158","type":"Sonoff device","z":"8c52d380.fec46","mode":"0","broker":"6eb36010.171f5","device":"sonoff-2-fibreextension","name":"test","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1110,"y":340,"wires":[["c56a72f0.1a877"]]},{"id":"2bde18d7.26a878","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":300,"wires":[["995bcb87.17a158"]]},{"id":"c56a72f0.1a877","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1250,"y":380,"wires":[]},{"id":"ef19bc03.6c28e","type":"inject","z":"8c52d380.fec46","name":"OFF","topic":"cmnd","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":360,"wires":[["995bcb87.17a158"]]},{"id":"1bb20e64.67f902","type":"inject","z":"8c52d380.fec46","name":"TELE","topic":"tele","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":440,"wires":[["995bcb87.17a158"]]},{"id":"1f22f1d7.f350ce","type":"inject","z":"8c52d380.fec46","name":"STAT","topic":"stat","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":520,"wires":[["995bcb87.17a158"]]},{"id":"c8ad468c.145c08","type":"tuya-smart","z":"9ed92167.b9b4c","deviceName":"Fletcher Lamp","deviceIp":"192.168.1.163","deviceId":"41450046cc50e314707a","deviceKey":"896da5d502f04d5c","request":"{\"schema\": true}","pollingInterval":10,"x":540,"y":140,"wires":[["e9226d51.f1f62"]]},{"id":"5589e786.558208","type":"inject","z":"9ed92167.b9b4c","name":"","topic":"on","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":340,"wires":[[]]},{"id":"4fb26c65.080984","type":"tuya-smart","z":"9ed92167.b9b4c","deviceName":"Karien Lamp","deviceIp":"192.168.1.162","deviceId":"41450046cc50e3147121","deviceKey":"4cfe12cfc5c37268","request":"{\"schema\": true}","pollingInterval":10,"x":570,"y":440,"wires":[["e9226d51.f1f62"]]},{"id":"e9226d51.f1f62","type":"debug","z":"9ed92167.b9b4c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":320,"wires":[]},{"id":"b5af18ba.dbf738","type":"api-call-service","z":"8c52d380.fec46","name":"Fletcher Lamp - On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":740,"wires":[[]]},{"id":"a07436eb.7aa228","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":740,"wires":[["b5af18ba.dbf738"]]},{"id":"5c566384.e9d70c","type":"api-call-service","z":"8c52d380.fec46","name":"Fletcher Lamp - Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":800,"wires":[[]]},{"id":"7d76c534.9df98c","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":800,"wires":[["5c566384.e9d70c"]]},{"id":"bbd53764.a62468","type":"api-call-service","z":"8c52d380.fec46","name":"Fletcher Lamp - Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"toggle","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":860,"wires":[[]]},{"id":"1f9053ca.8250fc","type":"inject","z":"8c52d380.fec46","name":"","topic":"toggle","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":860,"wires":[["bbd53764.a62468"]]},{"id":"dce5a2c4.8dd14","type":"debug","z":"6e4e7309.81165c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":660,"wires":[]},{"id":"d0866a5b.b80c18","type":"trigger-state","z":"745da3b4.61597c","name":"fk_status","server":"a3722ee8.c88ce","entityid":"sensor.fk_status","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"r96l4iynxcnj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":140,"y":220,"wires":[["143cdc40.324d64","4f2d8504.11b0fc"],[]]},{"id":"143cdc40.324d64","type":"api-call-service","z":"745da3b4.61597c","name":"Add Persitent","server":"a3722ee8.c88ce","version":1,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{\"message\":\"You've got mail.\",\"title\":\"Mailbox\",\"notification_id\":\"letter\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":480,"y":280,"wires":[[]]},{"id":"4f2d8504.11b0fc","type":"switch","z":"745da3b4.61597c","name":"where you?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not_home","vt":"str"},{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":400,"wires":[["c06e27a1.9b7e48"],["bfdcd5fa.b10728"]]},{"id":"c06e27a1.9b7e48","type":"api-call-service","z":"745da3b4.61597c","name":"Notify FK iPhone 8 Plus","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"You are NOT home anymore.\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":450,"y":380,"wires":[[]]},{"id":"bfdcd5fa.b10728","type":"api-call-service","z":"745da3b4.61597c","name":"Notify FK iPhone 8 Plus","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"Welcome home.\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":440,"wires":[[]]},{"id":"9f9c6c1f.7fdce","type":"server-state-changed","z":"48181911.c321a8","name":"Medine Reminder","server":"d80b819d.21ee7","version":1,"entityidfilter":"input_boolean.medicine_reminder","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":110,"y":240,"wires":[[],["66df9843.29ccb8"]]},{"id":"66df9843.29ccb8","type":"trigger","z":"48181911.c321a8","op1":"","op2":"on","op1type":"nul","op2type":"str","duration":"30","extend":false,"units":"min","reset":"off","bytopic":"all","name":"","x":290,"y":380,"wires":[["f0242812.df1db8"]]},{"id":"f0242812.df1db8","type":"api-call-service","z":"48181911.c321a8","name":"Notify Rob","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"Working from home?\",\"data\":{\"push\":{\"badge\":5,\"category\":\"working_from_home\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":590,"y":400,"wires":[[]]},{"id":"586f39ed.aea628","type":"server-events","z":"541a1cc7.93adc4","name":"All","server":"faf6f8d3.47cb18","x":90,"y":220,"wires":[["40e505c5.b8463c"]]},{"id":"40e505c5.b8463c","type":"switch","z":"541a1cc7.93adc4","name":"","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"SNOOZE","vt":"str"},{"t":"eq","v":"ALREADY_TAKEN","vt":"str"},{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":224.0000114440918,"y":220.0006103515625,"wires":[["695690e4.4feaa"],["2ded6529.c6801a"],["112d1f9.7b989e"]]},{"id":"695690e4.4feaa","type":"trigger","z":"541a1cc7.93adc4","op1":"","op2":"on","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"off","bytopic":"all","name":"","x":398.00000381469727,"y":124,"wires":[["d0c19ff3.137a8"]]},{"id":"d0c19ff3.137a8","type":"api-call-service","z":"541a1cc7.93adc4","name":"Notify Rob","server":"faf6f8d3.47cb18","service_domain":"notify","service":"ios_robs_iphone","data":"{   \"message\": \"Good Morning! Remember your meds!\",   \"data\": {     \"push\": {       \"badge\": 5,       \"category\": \"medicine\"     }   } }","mergecontext":"","x":657.0000343322754,"y":123.0000991821289,"wires":[[]]},{"id":"2ded6529.c6801a","type":"api-call-service","z":"541a1cc7.93adc4","name":"Turn off","server":"faf6f8d3.47cb18","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.medicine_reminder\" }","mergecontext":"","x":388.8636589050293,"y":220.63682556152344,"wires":[[]]},{"id":"3be0f02f.02c41","type":"change","z":"541a1cc7.93adc4","name":"trigger","rules":[{"t":"set","p":"trigger","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":225.86371231079102,"y":398.54698371887207,"wires":[["112d1f9.7b989e"]]},{"id":"c3748df3.49ee1","type":"server-state-changed","z":"541a1cc7.93adc4","name":"Rob Home","server":"faf6f8d3.47cb18","entityidfilter":"input_boolean.rob_home","entityidfiltertype":"substring","haltifstate":"off","outputs":1,"x":60.863651275634766,"y":398.3651657104492,"wires":[["3be0f02f.02c41"]]},{"id":"e0505a31.a866c8","type":"change","z":"541a1cc7.93adc4","name":"false","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":433.86365509033203,"y":386.7271137237549,"wires":[["112d1f9.7b989e"]]},{"id":"c87c3dd6.e97b3","type":"switch","z":"541a1cc7.93adc4","name":"","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":573.0000228881836,"y":220.9090175628662,"wires":[["d0c19ff3.137a8"]]},{"id":"112d1f9.7b989e","type":"hold","z":"541a1cc7.93adc4","name":"Hold until home","x":433.5000648498535,"y":306.5466251373291,"wires":[["e0505a31.a866c8","c87c3dd6.e97b3"]]},{"id":"79e893df.aa58ec","type":"api-call-service","z":"b9243eac.e962e","name":"Notify Fletch ","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"Node-Red: Working from home?\",\"data\":{\"push\":{\"badge\":5,\"category\":\"working_from_home\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":470,"y":220,"wires":[[]]},{"id":"6431308a.99ea9","type":"inject","z":"b9243eac.e962e","name":"Required Time - UTC","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"15 03 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"x":160,"y":220,"wires":[["79e893df.aa58ec"]]},{"id":"62da857b.80d86c","type":"inject","z":"48181911.c321a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":620,"wires":[["f0242812.df1db8"]]},{"id":"4da5f901.562be8","type":"server-events","z":"b9243eac.e962e","name":"All","server":"a3722ee8.c88ce","event_type":"","x":90,"y":580,"wires":[["aa670af2.19cc38"]]},{"id":"aa670af2.19cc38","type":"switch","z":"b9243eac.e962e","name":"Which Action?","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"WORKING_FROM_HOME_YES","vt":"str"},{"t":"eq","v":"WORKING_FROM_HOME_NO","vt":"str"},{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":340,"y":580,"wires":[["5c436d3b.6496a4","b537971.04cd268"],["fcb0091b.7cd368","421d3b40.8cc2f4"],[]]},{"id":"5c436d3b.6496a4","type":"api-call-service","z":"b9243eac.e962e","name":"Notify Fletch ","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"HOME DAY.\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":530,"y":520,"wires":[[]]},{"id":"67b4192e.4d95c8","type":"http request","z":"b9243eac.e962e","name":"","method":"GET","ret":"bin","paytoqs":false,"url":"http://192.168.1.43:22880/fletchertraffic","tls":"","proxy":"","authType":"","x":770,"y":580,"wires":[[]]},{"id":"fcb0091b.7cd368","type":"change","z":"b9243eac.e962e","name":"","rules":[{"t":"set","p":"URL","pt":"msg","to":"http://192.168.1.43:22880/fletchertraffic","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":580,"wires":[["67b4192e.4d95c8"]]},{"id":"f326d94f.1f4598","type":"inject","z":"d597f158.7ca1b","name":"ON","topic":"ON","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":400,"wires":[["d0379ddf.ce97f","1ff2eff9.10bd2"]]},{"id":"a804298b.0d1288","type":"inject","z":"d597f158.7ca1b","name":"OFF","topic":"OFF","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":460,"wires":[["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"a4c478f6.0573b8","type":"api-call-service","z":"d597f158.7ca1b","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1070,"y":160,"wires":[[]]},{"id":"bc5a55f0.1dfd78","type":"api-call-service","z":"d597f158.7ca1b","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1030,"y":420,"wires":[[]]},{"id":"1f373747.10e009","type":"api-call-service","z":"d597f158.7ca1b","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1080,"y":320,"wires":[[]]},{"id":"80376116.a0f0d","type":"api-call-service","z":"d597f158.7ca1b","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1020,"y":480,"wires":[[]]},{"id":"e9ca123.59ae8f","type":"switch","z":"d597f158.7ca1b","name":"turn on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":520,"y":180,"wires":[["786776de.e06e88"],["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"14789446.1c5d8c","type":"inject","z":"d597f158.7ca1b","name":"21:40 (19:40 in UTC)","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"40 19 * * 1,2,3,4,5","once":false,"onceDelay":"","x":120,"y":520,"wires":[["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"47cdb59e.94150c","type":"ui_button","z":"931c0c64.df3c6","name":"","group":"aa4f59ff.e959e8","order":3,"width":0,"height":0,"passthru":false,"label":"Bedtime","tooltip":"","color":"Blue","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":140,"y":140,"wires":[["a0dc2dfa.ba98d","c384d449.66fa38"]]},{"id":"a0dc2dfa.ba98d","type":"api-call-service","z":"931c0c64.df3c6","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":140,"wires":[["1ad514e7.95eddb"]]},{"id":"c384d449.66fa38","type":"api-call-service","z":"931c0c64.df3c6","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":420,"y":200,"wires":[["1ad514e7.95eddb"]]},{"id":"3e0f074.3fe70f8","type":"ui_switch","z":"d270455.fae9bb8","name":"","label":"Karien Lamp","tooltip":"","group":"aa4f59ff.e959e8","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":190,"y":80,"wires":[[]]},{"id":"3258693b.16e486","type":"switch","z":"931c0c64.df3c6","name":"on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"On","vt":"str"},{"t":"eq","v":"Off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":440,"wires":[["d4ac24d2.272288"],["8fc088b1.151318"]]},{"id":"8fc088b1.151318","type":"api-call-service","z":"931c0c64.df3c6","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1080,"y":480,"wires":[[]]},{"id":"d4ac24d2.272288","type":"api-call-service","z":"931c0c64.df3c6","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":380,"wires":[[]]},{"id":"6a5ec3ec.62a65c","type":"ui_switch","z":"931c0c64.df3c6","name":"","label":"Fletcher Lamp","tooltip":"","group":"aa4f59ff.e959e8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":180,"y":660,"wires":[["2423ca26.918406"]]},{"id":"2423ca26.918406","type":"switch","z":"931c0c64.df3c6","name":"on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"On","vt":"str"},{"t":"eq","v":"Off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":700,"y":620,"wires":[["ca2639fa.3c7ba8"],["1306b8bb.e425c7"]]},{"id":"1306b8bb.e425c7","type":"api-call-service","z":"931c0c64.df3c6","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1110,"y":640,"wires":[[]]},{"id":"ca2639fa.3c7ba8","type":"api-call-service","z":"931c0c64.df3c6","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1090,"y":580,"wires":[[]]},{"id":"7eeb5d94.b7f904","type":"function","z":"d74e98b0.1e98b8","name":"Filter msg's","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    var msg3 = { payload:true };\n    var msg1 = { background:\"red\" };\n    var msg2 = { background:\"white\" };\n    return [[ msg1],[ msg2], msg3];\n}\nreturn null;","outputs":3,"noerr":0,"x":730,"y":320,"wires":[["fd7b5395.59fd7"],["2a5c538a.877adc"],["656ce546.fbf06c"]]},{"id":"8cf970ff.d07ac","type":"ui_button","z":"d74e98b0.1e98b8","name":"","group":"394c9b3f.da6e44","order":5,"width":1,"height":1,"passthru":false,"label":"Open","tooltip":"","color":"black","bgcolor":"{{msg.background}}","icon":"","payload":"Really open garage door?","payloadType":"str","topic":"","x":390,"y":330,"wires":[["e511222e.21dbb"]]},{"id":"e511222e.21dbb","type":"ui_toast","z":"d74e98b0.1e98b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"confirm deploy","x":540,"y":330,"wires":[["7eeb5d94.b7f904"]]},{"id":"fb1d8925.f0c0e8","type":"function","z":"d74e98b0.1e98b8","name":"Filter msg's","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    var msg1 = { payload:false };\n    var msg2 = { background:\"red\" };\n    var msg3 = { background:\"white\" };\n    return [[ msg1],[ msg2], msg3];\n}\nreturn null;","outputs":3,"noerr":0,"x":730,"y":380,"wires":[["656ce546.fbf06c"],["ca9d6b7a.9f9dd8"],["bd03ea9f.59ba08"]]},{"id":"51b800a0.17915","type":"ui_button","z":"d74e98b0.1e98b8","name":"","group":"394c9b3f.da6e44","order":5,"width":1,"height":1,"passthru":false,"label":"Close","tooltip":"","color":"black","bgcolor":"{{msg.background}}","icon":"","payload":"Really close garage door?","payloadType":"str","topic":"","x":390,"y":370,"wires":[["97e4287a.ec04d8"]]},{"id":"97e4287a.ec04d8","type":"ui_toast","z":"d74e98b0.1e98b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","topic":"","name":"confirm deploy","x":540,"y":370,"wires":[["fb1d8925.f0c0e8"]]},{"id":"656ce546.fbf06c","type":"debug","z":"d74e98b0.1e98b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":350,"wires":[]},{"id":"bd03ea9f.59ba08","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["8ad31ea5.ee27a"],"x":855,"y":430,"wires":[]},{"id":"8ad31ea5.ee27a","type":"link in","z":"d74e98b0.1e98b8","name":"","links":["bd03ea9f.59ba08","fd7b5395.59fd7"],"x":295,"y":330,"wires":[["8cf970ff.d07ac"]]},{"id":"fd7b5395.59fd7","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["8ad31ea5.ee27a"],"x":855,"y":270,"wires":[]},{"id":"ca9d6b7a.9f9dd8","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["2419a428.daf46c"],"x":855,"y":390,"wires":[]},{"id":"2419a428.daf46c","type":"link in","z":"d74e98b0.1e98b8","name":"","links":["ca9d6b7a.9f9dd8","2a5c538a.877adc"],"x":295,"y":370,"wires":[["51b800a0.17915"]]},{"id":"2a5c538a.877adc","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["2419a428.daf46c"],"x":855,"y":310,"wires":[]},{"id":"1ad514e7.95eddb","type":"change","z":"931c0c64.df3c6","name":"set payload to off - update UI switches","rules":[{"t":"set","p":"payload","pt":"msg","to":"Off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":360,"wires":[["6a5ec3ec.62a65c","17d6c1c2.d75dbe"]]},{"id":"55d560f.77a98a","type":"function","z":"dac6431f.f0681","name":"Filter msg's","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    var msg1 = { payload:true };\n    var msg2 = { background:\"red\" };\n    return [[ msg1], msg2];\n}\nreturn null;","outputs":2,"noerr":0,"x":770,"y":400,"wires":[["8e663b4d.79a888"],["2709ea06.492cd6"]]},{"id":"2709ea06.492cd6","type":"ui_button","z":"dac6431f.f0681","name":"","group":"228f61f1.0e31ce","order":5,"width":1,"height":1,"passthru":false,"label":"Open","tooltip":"","color":"{{msg.background}}","bgcolor":"#2a2a2a","icon":"","payload":"Really open garage door?","payloadType":"str","topic":"","x":430,"y":450,"wires":[["febc25c.6ef31d8"]]},{"id":"febc25c.6ef31d8","type":"ui_toast","z":"dac6431f.f0681","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","topic":"","name":"confirm deploy","x":587,"y":400,"wires":[["55d560f.77a98a"]]},{"id":"8e663b4d.79a888","type":"debug","z":"dac6431f.f0681","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":940,"y":400,"wires":[]},{"id":"17d6c1c2.d75dbe","type":"ui_switch","z":"931c0c64.df3c6","name":"","label":"Karien Lamp","tooltip":"","group":"aa4f59ff.e959e8","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":190,"y":600,"wires":[["3258693b.16e486"]]},{"id":"cd50be44.04088","type":"ui_toast","z":"931c0c64.df3c6","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":320,"y":940,"wires":[]},{"id":"cf59c443.626788","type":"debug","z":"d597f158.7ca1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":350,"y":220,"wires":[]},{"id":"4351b228.94b07c","type":"light-scheduler","z":"8584cb39.51bb48","settings":"36f19b4a.9303c4","events":"[]","topic":"","name":"","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":260,"y":160,"wires":[[]]},{"id":"d5620266.7e60a","type":"light-scheduler-filter","z":"8584cb39.51bb48","settings":"","events":"[]","name":"","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":false,"x":320,"y":260,"wires":[[],[]]},{"id":"5a8fd0dc.97f5d","type":"eztimer","z":"8584cb39.51bb48","name":"","autoname":null,"tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"","lon":"","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"dawn","ontimetod":"17:00","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":240,"y":460,"wires":[[]]},{"id":"122ace01.e1e252","type":"eztimer","z":"d597f158.7ca1b","name":"Wakeup (UTC)","autoname":"03:05 - 03:35","tag":"eztimer","suspended":false,"sendEventsOnSuspend":true,"lat":"-26.0188","lon":"28.0194","timerType":"1","startupMessage":true,"ontype":"2","ontimesun":"dawn","ontimetod":"03:05","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"2","offtimesun":"dusk","offtimetod":"03:35","offduration":"00:01:00","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"sun":false,"x":100,"y":80,"wires":[["6b02cc12.05b904"]]},{"id":"8de9c3c3.49832","type":"eztimer","z":"d597f158.7ca1b","name":"Sunset (UTC)","autoname":"sunsetStart - 21:40","tag":"eztimer","suspended":false,"sendEventsOnSuspend":true,"lat":"-26.0188","lon":"28.0194","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"sunsetStart","ontimetod":"03:05","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":"-30","onrandomoffset":0,"onsuppressrepeats":false,"offtype":"2","offtimesun":"dusk","offtimetod":"21:40","offduration":"00:01:00","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":150,"y":260,"wires":[["cf59c443.626788","5ee2aee3.b8843"]]},{"id":"6f21e1c3.c6df1","type":"api-current-state","z":"d597f158.7ca1b","name":"Fletcher Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e314707a","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":420,"wires":[[],["bc5a55f0.1dfd78"]]},{"id":"6b7d8fdb.a1521","type":"api-current-state","z":"d597f158.7ca1b","name":"Karien Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e3147121","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":750,"y":480,"wires":[[],["80376116.a0f0d"]]},{"id":"d0379ddf.ce97f","type":"api-current-state","z":"d597f158.7ca1b","name":"Fletcher Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e314707a","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1100,"y":80,"wires":[[],["a4c478f6.0573b8"]]},{"id":"1ff2eff9.10bd2","type":"api-current-state","z":"d597f158.7ca1b","name":"Karien Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e3147121","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1090,"y":240,"wires":[[],["1f373747.10e009"]]},{"id":"751f9cfd.f9af54","type":"api-current-state","z":"8584cb39.51bb48","name":"At home","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":300,"y":680,"wires":[["8a687d2c.699e4"],["8a687d2c.699e4"]]},{"id":"35e04024.98b8a","type":"api-current-state","z":"8584cb39.51bb48","name":"","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":380,"y":760,"wires":[[],[]]},{"id":"8a687d2c.699e4","type":"debug","z":"8584cb39.51bb48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":860,"y":740,"wires":[]},{"id":"64312dbe.2d1154","type":"inject","z":"8584cb39.51bb48","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":660,"wires":[["751f9cfd.f9af54"]]},{"id":"786776de.e06e88","type":"api-current-state","z":"d597f158.7ca1b","name":"Is someone at home?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_occupied","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":660,"y":100,"wires":[["d0379ddf.ce97f","1ff2eff9.10bd2"],["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"f3fbe085.26eca","type":"alexa-local","z":"cbfb483a.9b43f8","devicename":"Couch Shade","inputtrigger":false,"x":260,"y":300,"wires":[["94b8f76b.d78148"]]},{"id":"99159f42.e704a","type":"function","z":"cbfb483a.9b43f8","name":"Set Payload","func":"msg.payload = { data: {'entity_id': 'input_number.slider1','value': \nmsg.bri } };\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":360,"wires":[["415246dc.a23278"]]},{"id":"b81b65a6.3242f8","type":"range","z":"cbfb483a.9b43f8","minin":"0","maxin":"100","minout":"0","maxout":"13","action":"scale","round":true,"property":"bri","name":"","x":570,"y":360,"wires":[["99159f42.e704a"]]},{"id":"94b8f76b.d78148","type":"switch","z":"cbfb483a.9b43f8","name":"on/off","property":"on_off_command","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":300,"wires":[["62119a8.9164c64"],["b81b65a6.3242f8"]]},{"id":"415246dc.a23278","type":"api-call-service","z":"cbfb483a.9b43f8","name":"Set Couch Shade","server":"cbae6ef5.500b8","version":"1","service_domain":"input_number","service":"set_value","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":990,"y":360,"wires":[[]]},{"id":"62119a8.9164c64","type":"function","z":"cbfb483a.9b43f8","name":"Set Payload","func":"if (msg.payload == \"on\")\n{\nmsg.payload = { data: {\"entity_id\": \"input_number.slider1\",\"value\": \n'13' } };\n}\nif (msg.payload == \"off\")\n{\nmsg.payload = { data: {\"entity_id\": \"input_number.slider1\",\"value\": \n\"0\" } };\n}\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":240,"wires":[["7ebbee74.12697"]]},{"id":"7ebbee74.12697","type":"api-call-service","z":"cbfb483a.9b43f8","name":"Set Couch Shade","server":"cbae6ef5.500b8","version":0,"service_domain":"input_number","service":"set_value","data":"{}","x":850,"y":240,"wires":[[]]},{"id":"478330e3.245a6","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":5,"width":"2","height":"2","passthru":false,"label":"5","color":"","bgcolor":"","icon":"","payload":"5","payloadType":"str","topic":"","x":90,"y":500,"wires":[["34375a28.2d3dd6"]]},{"id":"34375a28.2d3dd6","type":"join","z":"59cb08a.8905ff8","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"","joinerType":"str","accumulate":false,"timeout":"20","count":"4","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":330,"y":560,"wires":[["3b066395.6e252c"]]},{"id":"3699a88b.255d88","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":2,"width":"2","height":"2","passthru":false,"label":"2","color":"","bgcolor":"","icon":"","payload":"2","payloadType":"str","topic":"","x":90,"y":379,"wires":[["34375a28.2d3dd6"]]},{"id":"e597a1a.e0ba56","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":3,"width":"2","height":"2","passthru":false,"label":"3","color":"","bgcolor":"","icon":"","payload":"3","payloadType":"str","topic":"","x":90,"y":419,"wires":[["34375a28.2d3dd6"]]},{"id":"d2fb2fd4.a4c71","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":4,"width":"2","height":"2","passthru":false,"label":"4","color":"","bgcolor":"","icon":"","payload":"4","payloadType":"str","topic":"","x":90,"y":460,"wires":[["34375a28.2d3dd6"]]},{"id":"979d5c96.e7311","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":6,"width":"2","height":"2","passthru":false,"label":"6","color":"","bgcolor":"","icon":"","payload":"6","payloadType":"str","topic":"","x":90,"y":540,"wires":[["34375a28.2d3dd6"]]},{"id":"f38f496d.dea228","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":7,"width":"2","height":"2","passthru":false,"label":"7","color":"","bgcolor":"","icon":"","payload":"7","payloadType":"str","topic":"","x":90,"y":580,"wires":[["34375a28.2d3dd6"]]},{"id":"1dd0c2f4.67f9ad","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":8,"width":"2","height":"2","passthru":false,"label":"8","color":"","bgcolor":"","icon":"","payload":"8","payloadType":"str","topic":"","x":90,"y":620,"wires":[["34375a28.2d3dd6"]]},{"id":"83ddb4db.80b318","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":9,"width":"2","height":"2","passthru":false,"label":"9","color":"","bgcolor":"","icon":"","payload":"9","payloadType":"str","topic":"","x":90,"y":660,"wires":[["34375a28.2d3dd6"]]},{"id":"219e2180.0492be","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":10,"width":"2","height":"2","passthru":false,"label":"*","color":"","bgcolor":"","icon":"","payload":"*","payloadType":"str","topic":"","x":90,"y":700,"wires":[["34375a28.2d3dd6"]]},{"id":"498533d8.44697c","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":11,"width":"2","height":"2","passthru":false,"label":"0","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"","x":90,"y":740,"wires":[["34375a28.2d3dd6"]]},{"id":"70050230.cc43fc","type":"change","z":"59cb08a.8905ff8","name":"Message Complete","rules":[{"t":"set","p":"complete","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":780,"wires":[["34375a28.2d3dd6"]]},{"id":"1d38104a.5342d","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":12,"width":"2","height":"2","passthru":false,"label":"Clear","color":"","bgcolor":"","icon":"","payload":"Clear","payloadType":"str","topic":"","x":90,"y":780,"wires":[["70050230.cc43fc"]]},{"id":"f1330738.2b14a8","type":"api-current-state","z":"59cb08a.8905ff8","name":"Exterior Alarm State","server":"d42c7e99.0018","outputs":1,"halt_if":"","entity_id":"input_boolean.notify_gates","x":660,"y":500,"wires":[["7ce48d22.62f444"]]},{"id":"7ce48d22.62f444","type":"switch","z":"59cb08a.8905ff8","name":"Check State","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":500,"wires":[["c535e46.0a07e18","66974872.8b0a28"],["523ce9c0.840db8"]]},{"id":"523ce9c0.840db8","type":"change","z":"59cb08a.8905ff8","name":"arming","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alarm Arming in 45 Seconds","tot":"str"},{"t":"set","p":"armingStatus","pt":"flow","to":"arming","tot":"str"},{"t":"set","p":"message","pt":"msg","to":"arming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":680,"wires":[["2e23248a.9fec5c","8f4619e4.7cfbb8","390450db.95b2e"]]},{"id":"c535e46.0a07e18","type":"change","z":"59cb08a.8905ff8","name":"\"alarm disarmed\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alarm Disarmed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":420,"wires":[["da3d1125.3876"]]},{"id":"66974872.8b0a28","type":"api-call-service","z":"59cb08a.8905ff8","name":"Disarm Alarm","server":"d42c7e99.0018","service_domain":"input_boolean","service":"turn_off","data":"{ \"entity_id\":\"input_boolean.notify_gates\"}","x":1080,"y":480,"wires":[[]]},{"id":"2e23248a.9fec5c","type":"delay","z":"59cb08a.8905ff8","name":"Delay 45 Seconds","pauseType":"delayv","timeout":"45","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1150,"y":640,"wires":[["ff365e0f.4c236"]]},{"id":"da3d1125.3876","type":"ui_audio","z":"59cb08a.8905ff8","name":"Alarm Disarmed","group":"b33c9b3c.0231a8","voice":"en-US","always":"","x":1280,"y":420,"wires":[]},{"id":"a77d16a7.1f3548","type":"api-call-service","z":"59cb08a.8905ff8","name":"Arm Alarm","server":"d42c7e99.0018","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\":\"input_boolean.notify_gates\"}","x":1490,"y":700,"wires":[[]]},{"id":"8f4619e4.7cfbb8","type":"ui_text","z":"59cb08a.8905ff8","group":"b33c9b3c.0231a8","order":14,"width":"6","height":"1","name":"Alarm Status","label":"Alarm Status:","format":"{{msg.message}}","layout":"row-spread","x":1090,"y":860,"wires":[]},{"id":"f6f75e67.5c5ae","type":"server-state-changed","z":"59cb08a.8905ff8","name":"Exterior Alarm","server":"d42c7e99.0018","entityidfilter":"input_boolean.notify_gates","haltifstate":"","outputs":1,"x":690,"y":860,"wires":[["a1443965.770a08"]]},{"id":"e64d0c5.68663f","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"armingStatus","pt":"flow","to":"notArming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":580,"wires":[[]]},{"id":"ff365e0f.4c236","type":"switch","z":"59cb08a.8905ff8","name":"arming","property":"armingStatus","propertyType":"flow","rules":[{"t":"eq","v":"arming","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1330,"y":640,"wires":[["a77d16a7.1f3548","e64d0c5.68663f"]]},{"id":"3b066395.6e252c","type":"switch","z":"59cb08a.8905ff8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1457","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":480,"wires":[["e6ef0fa0.260e9"]]},{"id":"def0994.b0bd268","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"armingStatus","pt":"flow","to":"notArming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":640,"wires":[[]]},{"id":"e6ef0fa0.260e9","type":"switch","z":"59cb08a.8905ff8","name":"","property":"armingStatus","propertyType":"flow","rules":[{"t":"eq","v":"arming","vt":"str"},{"t":"eq","v":"notArming","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":560,"wires":[["def0994.b0bd268","f527183c.59b048"],["f1330738.2b14a8"]]},{"id":"f527183c.59b048","type":"trigger","z":"59cb08a.8905ff8","op1":"cancelled","op2":"off","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":680,"y":720,"wires":[["a1443965.770a08"]]},{"id":"a1443965.770a08","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":860,"wires":[["8f4619e4.7cfbb8"]]},{"id":"390450db.95b2e","type":"ui_audio","z":"59cb08a.8905ff8","name":"Arming 45 Seconds","group":"b33c9b3c.0231a8","voice":"en-US","always":"","x":1190,"y":740,"wires":[]},{"id":"30a2f752.950288","type":"inject","z":"59cb08a.8905ff8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":260,"wires":[["f5c561f8.d1bff"]]},{"id":"f5c561f8.d1bff","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"armingStatus","pt":"flow","to":"notArming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":260,"wires":[[]]},{"id":"e78c197.2ff29e8","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":1,"width":"2","height":"2","passthru":false,"label":"1","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"","x":90,"y":340,"wires":[["34375a28.2d3dd6"]]},{"id":"c4bb1e7e.48cc7","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"Front Door","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":920,"wires":[]},{"id":"5754413b.d8a2c","type":"server-state-changed","z":"59cb08a.8905ff8","name":"Front Door","server":"d42c7e99.0018","entityidfilter":"binary_sensor.front_door","haltifstate":"","outputs":1,"x":100,"y":920,"wires":[["341dc8bc.6c6f28"]]},{"id":"1b500f12.62e351","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"Back Door","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":960,"wires":[]},{"id":"66878055.a1497","type":"server-state-changed","z":"59cb08a.8905ff8","name":"Back Door","server":"d42c7e99.0018","version":"1","entityidfilter":"binary_sensor.sliding_glass_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":100,"y":960,"wires":[["53bd19c1.9fa508"]]},{"id":"85469df1.9d11e","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"North Gate","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":1000,"wires":[]},{"id":"a83ba298.4d624","type":"server-state-changed","z":"59cb08a.8905ff8","name":"North Gate","server":"d42c7e99.0018","entityidfilter":"binary_sensor.hittel_gate","haltifstate":"","outputs":1,"x":100,"y":1000,"wires":[["ead6d91b.01a068"]]},{"id":"ee148386.e5406","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"Front Door","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":1040,"wires":[]},{"id":"87d93984.649e38","type":"server-state-changed","z":"59cb08a.8905ff8","name":"South Gate","server":"d42c7e99.0018","entityidfilter":"binary_sensor.zeier_gate","haltifstate":"","outputs":1,"x":100,"y":1040,"wires":[["f780989d.de88f8"]]},{"id":"341dc8bc.6c6f28","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":920,"wires":[["c4bb1e7e.48cc7"]]},{"id":"53bd19c1.9fa508","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":960,"wires":[["1b500f12.62e351"]]},{"id":"ead6d91b.01a068","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1000,"wires":[["85469df1.9d11e"]]},{"id":"f780989d.de88f8","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1040,"wires":[["ee148386.e5406"]]},{"id":"3fed1d43.24a552","type":"light-scheduler","z":"cbfb483a.9b43f8","settings":"36f19b4a.9303c4","events":"[]","topic":"","name":"","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":true,"outputfreq":"output.statechange.startup","x":300,"y":580,"wires":[["f3ab9584.c81768"]]},{"id":"f3ab9584.c81768","type":"debug","z":"cbfb483a.9b43f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":580,"wires":[]},{"id":"308c5290.f9a56e","type":"inject","z":"cbfb483a.9b43f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":480,"wires":[["3fed1d43.24a552"]]},{"id":"6d154411.67849c","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Rob Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.rob_home","haltifstate":"on","outputs":1,"x":160,"y":160,"wires":[["fdfc6125.3ad5e"]]},{"id":"2757ba3.b61eb46","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Lindsay Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.lindsay_home","haltifstate":"on","outputs":1,"x":170,"y":220,"wires":[["447c1578.a663fc"]]},{"id":"fdfc6125.3ad5e","type":"api-current-state","z":"767d6cf4.74a3f4","name":"Lindsay Home","server":"84ee05c2.2bb708","outputs":1,"halt_if":"on","entity_id":"input_boolean.lindsay_home","x":400,"y":160,"wires":[["657a032c.ddb0bc"]]},{"id":"447c1578.a663fc","type":"api-current-state","z":"767d6cf4.74a3f4","name":"Rob Home","server":"84ee05c2.2bb708","outputs":1,"halt_if":"on","entity_id":"input_boolean.rob_home","x":390,"y":220,"wires":[["657a032c.ddb0bc"]]},{"id":"420993f7.d16d4c","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Rob Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.rob_home","haltifstate":"off","outputs":1,"x":160,"y":300,"wires":[["a4be8fef.7e62"]]},{"id":"4ca5606.7adcfa","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Lindsay Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.lindsay_home","haltifstate":"off","outputs":1,"x":170,"y":360,"wires":[["a4be8fef.7e62"]]},{"id":"57e56022.f528","type":"api-call-service","z":"767d6cf4.74a3f4","name":"Away","server":"84ee05c2.2bb708","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.home_occupied\" }","x":790,"y":160,"wires":[[]]},{"id":"a4be8fef.7e62","type":"api-call-service","z":"767d6cf4.74a3f4","name":"Home","server":"84ee05c2.2bb708","service_domain":"input_boolean","service":"turn_on","data":"{   \"entity_id\": \"input_boolean.home_occupied\" }","x":370,"y":300,"wires":[[]]},{"id":"657a032c.ddb0bc","type":"api-current-state","z":"767d6cf4.74a3f4","name":"House Guests","server":"84ee05c2.2bb708","outputs":1,"halt_if":"on","entity_id":"input_boolean.house_guests","x":620,"y":160,"wires":[["57e56022.f528"]]},{"id":"b9a3d8c7.d04d78","type":"change","z":"44dd03cf.d563cc","name":"Family Room Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Family Room Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.sliding_door?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":140,"wires":[["fc7d18b.5c520e8"]]},{"id":"815ddfec.c2a12","type":"change","z":"44dd03cf.d563cc","name":"Family Room Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Family Room Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.hittel_gate?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":260,"wires":[["fc7d18b.5c520e8"]]},{"id":"7a657a85.bc5e64","type":"change","z":"44dd03cf.d563cc","name":"Playroom Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Playroom Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.hittel_gate?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":320,"wires":[["fc7d18b.5c520e8"]]},{"id":"6d19532c.d5fe2c","type":"change","z":"44dd03cf.d563cc","name":"Kitchen Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Kitchen Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.sliding_door?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":380,"wires":[["fc7d18b.5c520e8"]]},{"id":"bccb2157.b13b9","type":"change","z":"44dd03cf.d563cc","name":"Dining Room Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Dining Room Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.front_door?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":440,"wires":[["fc7d18b.5c520e8"]]},{"id":"763a9950.5acd48","type":"api-call-service","z":"44dd03cf.d563cc","name":"Notify Rob","server":"d934dccd.6ebae","service_domain":"notify","service":"ios_robs_iphone","data":"{}","x":1210,"y":220,"wires":[[]]},{"id":"fc7d18b.5c520e8","type":"function","z":"44dd03cf.d563cc","name":"Data","func":"msg.payload = \n{\n  \"data\": \n  {\n    \"message\": msg.windowName,\n    \"data\": \n    {\n      \"push\": \n      {\n        \"badge\": 5,\n        \"category\": \"siren\"\n      },\n      \"attachment\": \n      {\n        \"url\": msg.image,\n        \"content-type\": \"jpeg\",\n        \"hide-thumbnail\": false\n      }\n    }\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":280,"wires":[["763a9950.5acd48","e1464f31.952fc","460152f4.74a11c"]]},{"id":"e1464f31.952fc","type":"api-call-service","z":"44dd03cf.d563cc","name":"Notify Lindsay","server":"d934dccd.6ebae","service_domain":"notify","service":"ios_lindsays_iphone","data":"{}","x":1220,"y":320,"wires":[[]]},{"id":"74b36734.f06a78","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Family Room Window 1","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_1","haltifstate":"closed","outputs":1,"x":140,"y":140,"wires":[["7b31f08.6c8d31"]]},{"id":"3901435a.af422c","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Family Room Window 2","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_2","haltifstate":"closed","outputs":1,"x":140,"y":180,"wires":[["7b31f08.6c8d31"]]},{"id":"da9eab2e.7eb478","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Family Room Window 3","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_3","haltifstate":"closed","outputs":1,"x":140,"y":260,"wires":[["a35233c0.8bd38"]]},{"id":"5aa16773.235c88","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Playroom Window","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_1","haltifstate":"closed","outputs":1,"x":130,"y":320,"wires":[["4af7eddc.e22e94"]]},{"id":"c0ffe281.bfddc","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Kitchen Window","server":"d934dccd.6ebae","entityidfilter":"sensor.kitchen_window","haltifstate":"closed","outputs":1,"x":120,"y":380,"wires":[["1a15e1e8.46808e"]]},{"id":"44f69fbe.0bb8","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Dining Room Window","server":"d934dccd.6ebae","entityidfilter":"sensor.dining_room_window","haltifstate":"closed","outputs":1,"x":140,"y":440,"wires":[["cfaf533e.cb3f9"]]},{"id":"7b31f08.6c8d31","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":140,"wires":[["b9a3d8c7.d04d78"],["9225fe1.dd451"]]},{"id":"a35233c0.8bd38","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":260,"wires":[["815ddfec.c2a12"],["9225fe1.dd451"]]},{"id":"4af7eddc.e22e94","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":320,"wires":[["7a657a85.bc5e64"],["9225fe1.dd451"]]},{"id":"1a15e1e8.46808e","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":380,"wires":[["6d19532c.d5fe2c"],["9225fe1.dd451"]]},{"id":"cfaf533e.cb3f9","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":440,"wires":[["bccb2157.b13b9"],["9225fe1.dd451"]]},{"id":"36fe43c7.52399c","type":"api-call-service","z":"44dd03cf.d563cc","name":"Notify Rob","server":"d934dccd.6ebae","service_domain":"notify","service":"ios_robs_iphone","data":"{}","x":810,"y":540,"wires":[[]]},{"id":"9225fe1.dd451","type":"function","z":"44dd03cf.d563cc","name":"Data","func":"msg.payload = \n{\n  \"data\": \n  {\n    \"message\": msg.payload\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":540,"wires":[["36fe43c7.52399c"]]},{"id":"460152f4.74a11c","type":"api-current-state","z":"44dd03cf.d563cc","name":"Exterior Alarms","server":"d934dccd.6ebae","outputs":1,"halt_if":"off","entity_id":"input_boolean.alarm_exterior","x":1020,"y":480,"wires":[["6b28cad0.683e54","c03d581d.2bffa8","ccfc2710.c7a618","2b7069c.25a1096","47eea46.092165c"]]},{"id":"2b7069c.25a1096","type":"api-call-service","z":"44dd03cf.d563cc","name":"Alarm Notify Lindsay","server":"d934dccd.6ebae","service_domain":"automation","service":"trigger","data":"{   \"entity_id\": \"automation.active_alarm_2\" }","x":1240,"y":540,"wires":[[]]},{"id":"ccfc2710.c7a618","type":"api-call-service","z":"44dd03cf.d563cc","name":"Alarm Notify Rob","server":"d934dccd.6ebae","service_domain":"automation","service":"trigger","data":"{   \"entity_id\": \"automation.active_alarm\" }","x":1230,"y":500,"wires":[[]]},{"id":"c03d581d.2bffa8","type":"api-call-service","z":"44dd03cf.d563cc","name":"Alarm Switch On","server":"d934dccd.6ebae","service_domain":"input_boolean","service":"turn_on","data":"{   \"entity_id\": \"input_boolean.alarm_siren\" }","x":1230,"y":460,"wires":[[]]},{"id":"6b28cad0.683e54","type":"change","z":"44dd03cf.d563cc","name":"Alarm Lights","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alarm Lights","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":420,"wires":[["4dd0e3ce.3c782c"]]},{"id":"4dd0e3ce.3c782c","type":"mqtt out","z":"44dd03cf.d563cc","name":"Alarm Lights","topic":"Commands","qos":"0","retain":"false","broker":"7a64aeda.d1efb","x":1370,"y":420,"wires":[]},{"id":"47eea46.092165c","type":"mqtt out","z":"44dd03cf.d563cc","name":"Send Alarm","topic":"Alarms","qos":"0","retain":"false","broker":"7a64aeda.d1efb","x":1210,"y":580,"wires":[]},{"id":"c9f347db.4d8bb8","type":"function","z":"213f77cb.cd9998","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":820,"wires":[["74a72ef8.e3ab9"]]},{"id":"c1784432.8d7a38","type":"function","z":"213f77cb.cd9998","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":952,"y":917,"wires":[["405a0beb.ca1d94"]]},{"id":"74a72ef8.e3ab9","type":"api-call-service","z":"213f77cb.cd9998","name":"Buffet On","server":"35d4fcd5.04deb4","version":0,"service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.buffet_light\" }","x":1160,"y":820,"wires":[[]]},{"id":"405a0beb.ca1d94","type":"api-call-service","z":"213f77cb.cd9998","name":"Buffet Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.buffet_light\" }","x":1161.8333282470703,"y":917.5555572509766,"wires":[[]]},{"id":"d47bb3c1.389dc","type":"light-scheduler","z":"213f77cb.cd9998","settings":"36f19b4a.9303c4","events":"[{\"start\":{\"dow\":1,\"mod\":1020},\"end\":{\"dow\":1,\"mod\":1380}},{\"start\":{\"dow\":2,\"mod\":1020},\"end\":{\"dow\":2,\"mod\":1380}},{\"start\":{\"dow\":3,\"mod\":1020},\"end\":{\"dow\":3,\"mod\":1380}},{\"start\":{\"dow\":4,\"mod\":1020},\"end\":{\"dow\":4,\"mod\":1380}},{\"start\":{\"dow\":5,\"mod\":1020},\"end\":{\"dow\":5,\"mod\":1380}},{\"start\":{\"dow\":6,\"mod\":1020},\"end\":{\"dow\":6,\"mod\":1380}},{\"start\":{\"dow\":0,\"mod\":1020},\"end\":{\"dow\":0,\"mod\":1380}}]","topic":"Buffet","name":"Buffet Light","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":770,"y":860,"wires":[["c9f347db.4d8bb8","c1784432.8d7a38"]]},{"id":"e46c70e0.b6996","type":"light-scheduler","z":"213f77cb.cd9998","settings":"11ac16b6.0ab969","events":"[{\"start\":{\"dow\":1,\"mod\":360},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":360},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":360},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":360},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":360},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":360},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":360},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Cabinet Lights","name":"Cabinet Lights","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":780,"y":660,"wires":[["f269df85.099f4","18aeb9db.d86126"]]},{"id":"f269df85.099f4","type":"function","z":"213f77cb.cd9998","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":600,"wires":[["efc61c32.9a69"]]},{"id":"18aeb9db.d86126","type":"function","z":"213f77cb.cd9998","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":953,"y":705,"wires":[["c864947e.502f98"]]},{"id":"efc61c32.9a69","type":"api-call-service","z":"213f77cb.cd9998","name":"Cabinet Lights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.cabinet_lights\" }","x":1184.0000076293945,"y":599.2222032546997,"wires":[[]]},{"id":"c864947e.502f98","type":"api-call-service","z":"213f77cb.cd9998","name":"Cabinet Lights Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.cabinet_lights\" }","x":1183.8333435058594,"y":705.4446439743042,"wires":[[]]},{"id":"8b25ff59.83a3e","type":"api-call-service","z":"213f77cb.cd9998","name":"Exterior Notifications On","server":"35d4fcd5.04deb4","service_domain":"input_boolean","service":"turn_on","data":"{   \"entity_id\": \"input_boolean.notify_exterior\" }","x":630,"y":280,"wires":[[]]},{"id":"3cb87300.b5b83e","type":"server-state-changed","z":"213f77cb.cd9998","name":"Away","server":"35d4fcd5.04deb4","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":560,"wires":[[],["f31f2e04.e0048","1ef5280e.e3e398","c56d5651.48dff8","754865e4.490d4c","41fa5b35.8296c4","61ddaeab.7d36c","7f3392d7.cd73fc"]]},{"id":"1aec9d5b.c7a9d3","type":"api-call-service","z":"213f77cb.cd9998","name":"Garage Entry Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.garage_entry_light\" }","x":610,"y":80,"wires":[[]]},{"id":"3e093e31.7d7c32","type":"api-call-service","z":"213f77cb.cd9998","name":"Uplights Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.uplights\" }","x":590,"y":120,"wires":[[]]},{"id":"6e4f9a95.e60764","type":"api-call-service","z":"213f77cb.cd9998","name":"Ben Light Off","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_off","data":"{   \"entity_id\": \"light.ben_light\" }","x":590,"y":160,"wires":[[]]},{"id":"8d5d71ba.aa9cd","type":"api-call-service","z":"213f77cb.cd9998","name":"Other Ben Light Off","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_off","data":"{   \"entity_id\": \"light.other_ben_light\" }","x":610,"y":200,"wires":[[]]},{"id":"47964349.c21d4c","type":"api-call-service","z":"213f77cb.cd9998","name":"Kitchen Lights Off","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_off","data":"{   \"entity_id\": \"light.kitchen_lights\" }","x":610,"y":240,"wires":[[]]},{"id":"a65e5ad9.83bc58","type":"server-state-changed","z":"213f77cb.cd9998","name":"Home","server":"35d4fcd5.04deb4","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":880,"wires":[[],["1b9da1f5.8ff3ae","eaeb66ae.669b58","adba54f4.3cee38","89afd836.c65858","5928cefb.21775","4e53153e.5a842c","9c2f1317.0d57e"]]},{"id":"1b9da1f5.8ff3ae","type":"api-call-service","z":"213f77cb.cd9998","name":"Exterior Notifications Off","server":"35d4fcd5.04deb4","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.notify_exterior\" }","x":470,"y":1180,"wires":[[]]},{"id":"eaeb66ae.669b58","type":"change","z":"213f77cb.cd9998","name":"auto","rules":[{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":860,"wires":[["d47bb3c1.389dc","e46c70e0.b6996"]]},{"id":"f31f2e04.e0048","type":"change","z":"213f77cb.cd9998","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":780,"wires":[["d47bb3c1.389dc","e46c70e0.b6996"]]},{"id":"1ef5280e.e3e398","type":"delay","z":"213f77cb.cd9998","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":220,"wires":[["1aec9d5b.c7a9d3","3e093e31.7d7c32","6e4f9a95.e60764","8d5d71ba.aa9cd","47964349.c21d4c","8b25ff59.83a3e"]]},{"id":"c56d5651.48dff8","type":"api-current-state","z":"213f77cb.cd9998","name":"Garage Entry State","server":"35d4fcd5.04deb4","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.garage_entry_light","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410,"y":400,"wires":[["eb4dddeb.5c901"]]},{"id":"41fa5b35.8296c4","type":"api-current-state","z":"213f77cb.cd9998","name":"Ben Light State","server":"35d4fcd5.04deb4","outputs":1,"halt_if":"","entity_id":"light.ben_light","x":400,"y":480,"wires":[["f068921.b826b7"]]},{"id":"754865e4.490d4c","type":"api-current-state","z":"213f77cb.cd9998","name":"Uplights State","server":"35d4fcd5.04deb4","outputs":1,"halt_if":"","entity_id":"switch.uplights","x":400,"y":440,"wires":[["74288dc1.38e964"]]},{"id":"61ddaeab.7d36c","type":"api-current-state","z":"213f77cb.cd9998","name":"Other Ben Light","server":"35d4fcd5.04deb4","outputs":1,"halt_if":"","entity_id":"light.other_ben_light","x":400,"y":520,"wires":[["eb72ab20.cdb1f8"]]},{"id":"7f3392d7.cd73fc","type":"api-current-state","z":"213f77cb.cd9998","name":"Kitchen Light State","server":"35d4fcd5.04deb4","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.kitchen_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410,"y":560,"wires":[["3f3dc1b7.53e59e"]]},{"id":"eb4dddeb.5c901","type":"change","z":"213f77cb.cd9998","name":"Garage Flow","rules":[{"t":"set","p":"garageEntry","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":400,"wires":[[]]},{"id":"74288dc1.38e964","type":"change","z":"213f77cb.cd9998","name":"Uplights Flow","rules":[{"t":"set","p":"uplights","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":440,"wires":[[]]},{"id":"f068921.b826b7","type":"change","z":"213f77cb.cd9998","name":"Ben Light Flow","rules":[{"t":"set","p":"benLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":480,"wires":[[]]},{"id":"eb72ab20.cdb1f8","type":"change","z":"213f77cb.cd9998","name":"Other Ben Light Flow","rules":[{"t":"set","p":"otherBenLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":520,"wires":[[]]},{"id":"3f3dc1b7.53e59e","type":"change","z":"213f77cb.cd9998","name":"Kitchen Light Flow","rules":[{"t":"set","p":"kichenLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":560,"wires":[[]]},{"id":"adba54f4.3cee38","type":"switch","z":"213f77cb.cd9998","name":"Garage Flow","property":"garageEntry","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":960,"wires":[["5011e905.8afa78"]]},{"id":"89afd836.c65858","type":"switch","z":"213f77cb.cd9998","name":"Uplights Flow","property":"uplights","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":1000,"wires":[["d300623e.aafbe"]]},{"id":"5928cefb.21775","type":"switch","z":"213f77cb.cd9998","name":"Ben Light Flow","property":"benLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":1040,"wires":[["3b131f70.ca98c"]]},{"id":"4e53153e.5a842c","type":"switch","z":"213f77cb.cd9998","name":"Other Ben Light Flow","property":"otherBenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":1080,"wires":[["74685339.824c8c"]]},{"id":"9c2f1317.0d57e","type":"switch","z":"213f77cb.cd9998","name":"Kitchen Light Flow","property":"kitchenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":1120,"wires":[["40e1d41f.f49e0c"]]},{"id":"5011e905.8afa78","type":"api-call-service","z":"213f77cb.cd9998","name":"Garage Entry On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.garage_entry_light\" }","x":750,"y":960,"wires":[[]]},{"id":"d300623e.aafbe","type":"api-call-service","z":"213f77cb.cd9998","name":"Uplights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.uplights\" }","x":730,"y":1000,"wires":[[]]},{"id":"3b131f70.ca98c","type":"api-call-service","z":"213f77cb.cd9998","name":"Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.ben_light\" }","x":730,"y":1040,"wires":[[]]},{"id":"74685339.824c8c","type":"api-call-service","z":"213f77cb.cd9998","name":"Other Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.other_ben_light\" }","x":750,"y":1080,"wires":[[]]},{"id":"40e1d41f.f49e0c","type":"api-call-service","z":"213f77cb.cd9998","name":"Kitchen Lights On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.kitchen_lights\" }","x":750,"y":1120,"wires":[[]]},{"id":"6b087471.e715bc","type":"function","z":"e7a4486b.b864c8","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":780,"wires":[["aae7bcd3.6e66b"]]},{"id":"a8630e06.ef84d","type":"function","z":"e7a4486b.b864c8","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":952,"y":877,"wires":[["dbcd7fb2.b7ca9"]]},{"id":"aae7bcd3.6e66b","type":"api-call-service","z":"e7a4486b.b864c8","name":"Bedroom Lamps ON","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.bedroom_lamps","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1200,"y":780,"wires":[[]]},{"id":"dbcd7fb2.b7ca9","type":"api-call-service","z":"e7a4486b.b864c8","name":"Bedroom Lamps Of","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.bedroom_lamps","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1191.8333282470703,"y":877.5555572509766,"wires":[[]]},{"id":"b1d68f82.4711f","type":"light-scheduler","z":"e7a4486b.b864c8","settings":"36f19b4a.9303c4","events":"[{\"start\":{\"dow\":1,\"mod\":1020},\"end\":{\"dow\":1,\"mod\":1305}},{\"start\":{\"dow\":2,\"mod\":1020},\"end\":{\"dow\":2,\"mod\":1305}},{\"start\":{\"dow\":3,\"mod\":1020},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1020},\"end\":{\"dow\":4,\"mod\":1305}},{\"start\":{\"dow\":5,\"mod\":1020},\"end\":{\"dow\":5,\"mod\":1305}},{\"start\":{\"dow\":6,\"mod\":1020},\"end\":{\"dow\":6,\"mod\":1305}},{\"start\":{\"dow\":0,\"mod\":1020},\"end\":{\"dow\":0,\"mod\":1305}}]","topic":"Buffet","name":"Sunset","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":"","sunElevationThreshold":"0","sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":750,"y":820,"wires":[["6b087471.e715bc","a8630e06.ef84d","5bae0ac2.9b8ff4"]]},{"id":"62f1e812.716818","type":"light-scheduler","z":"e7a4486b.b864c8","settings":"36f19b4a.9303c4","events":"[{\"start\":{\"dow\":1,\"mod\":360},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":360},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":360},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":360},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":360},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":360},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":360},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Cabinet Lights","name":"Cabinet Lights","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":780,"y":620,"wires":[["9d236c9c.6ba19","28c189ae.fe2446"]]},{"id":"9d236c9c.6ba19","type":"function","z":"e7a4486b.b864c8","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":560,"wires":[["d6fcecc6.65a92"]]},{"id":"28c189ae.fe2446","type":"function","z":"e7a4486b.b864c8","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":953,"y":665,"wires":[["8798f6f3.c44068"]]},{"id":"d6fcecc6.65a92","type":"api-call-service","z":"e7a4486b.b864c8","name":"Cabinet Lights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.cabinet_lights\" }","x":1184.0000076293945,"y":559.2222032546997,"wires":[[]]},{"id":"8798f6f3.c44068","type":"api-call-service","z":"e7a4486b.b864c8","name":"Cabinet Lights Off","server":"35d4fcd5.04deb4","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.cabinet_lights","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1183.8333435058594,"y":665.4446439743042,"wires":[[]]},{"id":"e18c460b.38e4b8","type":"server-state-changed","z":"e7a4486b.b864c8","name":"Away","server":"a3722ee8.c88ce","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":520,"wires":[[],["c252a380.bf37e","d1e34fbc.cc4e1","d75a415.33181c"]]},{"id":"ddb5bf4b.f87","type":"api-call-service","z":"e7a4486b.b864c8","name":"Bedroom Lamps Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.bedroom_lamps","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":640,"y":340,"wires":[[]]},{"id":"302a5797.1322c8","type":"server-state-changed","z":"e7a4486b.b864c8","name":"Home","server":"a3722ee8.c88ce","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":840,"wires":[[],["cfec9497.77d428","cdfef369.7b95c","2d89b15a.5e138e","3370e229.43e90e","21e3627f.12998e","1337228.40c2ede","9a936774.ec3b18"]]},{"id":"cfec9497.77d428","type":"api-call-service","z":"e7a4486b.b864c8","name":"Exterior Notifications Off","server":"35d4fcd5.04deb4","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.notify_exterior\" }","x":470,"y":1140,"wires":[[]]},{"id":"cdfef369.7b95c","type":"change","z":"e7a4486b.b864c8","name":"auto","rules":[{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":820,"wires":[["b1d68f82.4711f","62f1e812.716818"]]},{"id":"c252a380.bf37e","type":"change","z":"e7a4486b.b864c8","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":740,"wires":[["b1d68f82.4711f","62f1e812.716818"]]},{"id":"d1e34fbc.cc4e1","type":"delay","z":"e7a4486b.b864c8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":380,"y":340,"wires":[["ddb5bf4b.f87"]]},{"id":"d75a415.33181c","type":"api-current-state","z":"e7a4486b.b864c8","name":"Bedroom Lamps State","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_lamps","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":400,"wires":[["ac2ec21.1c0064"]]},{"id":"ac2ec21.1c0064","type":"change","z":"e7a4486b.b864c8","name":"Kitchen Light Flow","rules":[{"t":"set","p":"bedroomLamps","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":400,"wires":[[]]},{"id":"2d89b15a.5e138e","type":"switch","z":"e7a4486b.b864c8","name":"Garage Flow","property":"garageEntry","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":920,"wires":[["2d39016e.057a8e"]]},{"id":"3370e229.43e90e","type":"switch","z":"e7a4486b.b864c8","name":"Uplights Flow","property":"uplights","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":960,"wires":[["f8f1d29e.beece"]]},{"id":"21e3627f.12998e","type":"switch","z":"e7a4486b.b864c8","name":"Ben Light Flow","property":"benLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":1000,"wires":[["1cf7bf93.6115b"]]},{"id":"1337228.40c2ede","type":"switch","z":"e7a4486b.b864c8","name":"Other Ben Light Flow","property":"otherBenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":1040,"wires":[["774f4327.1b690c"]]},{"id":"9a936774.ec3b18","type":"switch","z":"e7a4486b.b864c8","name":"Bedroom Lamps Flow","property":"bedroomLamps","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":1080,"wires":[["2fea6d3.89e0992"]]},{"id":"2d39016e.057a8e","type":"api-call-service","z":"e7a4486b.b864c8","name":"Garage Entry On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.garage_entry_light\" }","x":750,"y":920,"wires":[[]]},{"id":"f8f1d29e.beece","type":"api-call-service","z":"e7a4486b.b864c8","name":"Uplights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.uplights\" }","x":730,"y":960,"wires":[[]]},{"id":"1cf7bf93.6115b","type":"api-call-service","z":"e7a4486b.b864c8","name":"Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.ben_light\" }","x":730,"y":1000,"wires":[[]]},{"id":"774f4327.1b690c","type":"api-call-service","z":"e7a4486b.b864c8","name":"Other Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.other_ben_light\" }","x":750,"y":1040,"wires":[[]]},{"id":"2fea6d3.89e0992","type":"api-call-service","z":"e7a4486b.b864c8","name":"Kitchen Lights On","server":"35d4fcd5.04deb4","version":"1","service_domain":"light","service":"turn_on","entityId":"light.kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":750,"y":1080,"wires":[[]]},{"id":"5bae0ac2.9b8ff4","type":"debug","z":"e7a4486b.b864c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1040,"y":1020,"wires":[]},{"id":"402ccb44.7492c4","type":"inject","z":"e7a4486b.b864c8","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":740,"wires":[["b1d68f82.4711f"]]},{"id":"5ec5c890.bae208","type":"bigtimer","z":"8b9a916e.ca4ec","outtopic":"","outpayload1":"","outpayload2":"","name":"Sunset","comment":"","lat":"-26.0188","lon":"28.0194","starttime":"5004","endtime":1425,"starttime2":0,"endtime2":0,"startoff":"+120","endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":390,"y":200,"wires":[["7d000b22.d4aea4"],["d6eeb3b0.c06b2"],["e0dcea29.49e458"]]},{"id":"9d8f92b5.38af7","type":"bigtimer","z":"8b9a916e.ca4ec","outtopic":"","outpayload1":"","outpayload2":"","name":"Dusk","comment":"","lat":"","lon":"","starttime":"5001","endtime":1425,"starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":390,"y":280,"wires":[[],[],[]]},{"id":"1c22069e.0fc999","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":180,"wires":[["5ec5c890.bae208"]]},{"id":"46f60626.f66378","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"toggle","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":360,"wires":[["5ec5c890.bae208"]]},{"id":"4771443c.0362ac","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":300,"wires":[["5ec5c890.bae208"]]},{"id":"5b54dcb6.4be814","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":240,"wires":[["5ec5c890.bae208"]]},{"id":"7d000b22.d4aea4","type":"debug","z":"8b9a916e.ca4ec","name":"one-off","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":640,"y":180,"wires":[]},{"id":"d6eeb3b0.c06b2","type":"debug","z":"8b9a916e.ca4ec","name":"every minute","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":660,"y":240,"wires":[]},{"id":"e0dcea29.49e458","type":"debug","z":"8b9a916e.ca4ec","name":"output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":640,"y":300,"wires":[]},{"id":"49ebce23.e0be","type":"server-state-changed","z":"fb4a9edc.82ff2","name":"Sleep Mode Enabled","server":"a3342807.115888","version":0,"entityidfilter":"input_boolean.sleep_mode","entityidfiltertype":"substring","haltifstate":"off","outputs":1,"x":210,"y":220,"wires":[["fa6c6e21.6d8e8"]]},{"id":"fa6c6e21.6d8e8","type":"switch","z":"fb4a9edc.82ff2","name":"Halt If Routine Already Executed","property":"sleep_routine_fired","propertyType":"global","rules":[{"t":"false"}],"checkall":"false","repair":false,"outputs":1,"x":470,"y":220,"wires":[["80c76267.006fd","fc65f70d.a12678"]]},{"id":"80c76267.006fd","type":"api-render-template","z":"fb4a9edc.82ff2","name":"Door Lock Status Message","server":"a3342807.115888","template":"{% if is_state(\"lock.front_door\", \"locked\") and\n      is_state(\"lock.back_door\", \"locked\") and\n      is_state(\"lock.side_entry\", \"locked\") and\n      is_state(\"lock.garage_entry\", \"locked\") -%}\nAll doors are locked.  Good night.\n  \n{%- else -%} \n    {% set unlockedCount = 0 %}\n  \n  {%- if is_state(\"lock.front_door\", \"unlocked\") -%}\nThe front door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n\n  {%- if is_state(\"lock.back_door\", \"unlocked\") -%}\nThe back door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n\n  {%- endif %}\n\n  {%- if is_state(\"lock.garage_entry\", \"unlocked\") -%}\nThe garage door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n\n  {%- endif %}\n\n  {%- if is_state(\"lock.side_entry\", \"unlocked\") -%}\nThe side entry door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n\n  {%- endif %}\n  \n  {% if unlockedCount > 1 -%}\nAttempting to secure all doors now.\n  {%- else -%}\nAttempting to secure it now.\n  {%- endif %}\n  \n{%- endif %}","x":760,"y":220,"wires":[["f7e70916.935d18","8d78870e.678148"]]},{"id":"fc65f70d.a12678","type":"function","z":"fb4a9edc.82ff2","name":"Set Sleep Routine Fired","func":"global.set('sleep_routine_fired', true);\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":260,"wires":[[]]},{"id":"f7e70916.935d18","type":"switch","z":"fb4a9edc.82ff2","name":"Unlocked Doors Found","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"All doors are locked.  Good night.","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":260,"wires":[["3266a092.bfc12","cb89c4e9.63f018"]]},{"id":"3266a092.bfc12","type":"api-call-service","z":"fb4a9edc.82ff2","name":"Lock All Doors","server":"a3342807.115888","service_domain":"lock","service":"lock","data":"{\"entity_id\": \"lock.front_door, lock.back_door, lock.garage_entry, lock.side_entry\"}","mergecontext":"","x":800,"y":300,"wires":[["41b1599e.298858"]]},{"id":"cb89c4e9.63f018","type":"function","z":"fb4a9edc.82ff2","name":"Reset Sleep Routine","func":"global.set('sleep_routine_fired', false);\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":420,"wires":[[]]},{"id":"588de289.c2022c","type":"function","z":"fb4a9edc.82ff2","name":"Build Notification","func":"// switch (msg.topic) {\n//     case ''\n// }\n\nreturn {\n    payload: {\n        data: {\n            message: msg.payload,\n        }\n    }\n};","outputs":1,"noerr":0,"x":1090,"y":300,"wires":[["ec4841c9.ecbea"]]},{"id":"41b1599e.298858","type":"delay","z":"fb4a9edc.82ff2","name":"Delay","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":830,"y":340,"wires":[["18f5c45e.29e1dc"]]},{"id":"6fd62eee.655cb","type":"server-state-changed","z":"fb4a9edc.82ff2","name":"Exterior Door Unlocked","server":"a3342807.115888","entityidfilter":"group.exterior_locks","entityidfiltertype":"exact","haltifstate":"locked","outputs":1,"x":220,"y":420,"wires":[["cb89c4e9.63f018"]]},{"id":"2605b611.9fa6da","type":"inject","z":"fb4a9edc.82ff2","name":"Reset Sleep Routine","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":380,"wires":[["cb89c4e9.63f018"]]},{"id":"105102b3.f52c4d","type":"server-state-changed","z":"fb4a9edc.82ff2","name":"Both Get Out of Bed","server":"a3342807.115888","entityidfilter":"sensor.bed_either","entityidfiltertype":"exact","haltifstate":"Occupied","outputs":1,"x":230,"y":460,"wires":[["cb89c4e9.63f018"]]},{"id":"18f5c45e.29e1dc","type":"function","z":"fb4a9edc.82ff2","name":"Clear Template","func":"\nreturn {};","outputs":1,"noerr":0,"x":1080,"y":180,"wires":[["d789605c.f5686"]]},{"id":"ec4841c9.ecbea","type":"link out","z":"fb4a9edc.82ff2","name":"Door Lock Status @ Sleep Mode Enabled","links":["58dfbc1f.ec9674","d88ae7ad.72c5b8"],"x":1295,"y":300,"wires":[]},{"id":"8d78870e.678148","type":"string","z":"fb4a9edc.82ff2","name":"Strip Newlines","methods":[{"name":"strip","params":[{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":1080,"y":260,"wires":[["588de289.c2022c"]]},{"id":"d789605c.f5686","type":"api-render-template","z":"fb4a9edc.82ff2","name":"Door Lock Status Message","server":"a3342807.115888","template":"{% if is_state(\"lock.front_door\", \"locked\") and\n      is_state(\"lock.back_door\", \"locked\") and\n      is_state(\"lock.side_entry\", \"locked\") and\n      is_state(\"lock.garage_entry\", \"locked\") -%}\n  I was able to secure all doors. Good night.\n{%- else -%} \n\n  {%- if is_state(\"lock.front_door\", \"unlocked\") -%}\n    I was unable to lock the front door.\n  {%- endif %}\n\n  {%- if is_state(\"lock.back_door\", \"unlocked\") -%}\n    I was unable to lock the back door.\n  {%- endif %}\n\n  {%- if is_state(\"lock.garage_entry\", \"unlocked\") -%}\n    I was unable to lock the garage door.\n  {%- endif %}\n\n  {%- if is_state(\"lock.side_entry\", \"unlocked\") -%}\n    I was unable to lock the side entry door.\n  {%- endif %}\n  \n  Please double check the door to make sure it is secure.\n  \n{%- endif %}","x":1120,"y":220,"wires":[["8d78870e.678148"]]},{"id":"a52e3fb3.b9545","type":"ui_text_input","z":"9b2a9527.03a138","name":"","label":"","group":"a0afaa39.4de1a8","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"1","topic":"","x":100,"y":320,"wires":[["d26c2db3.f6def"]]},{"id":"d26c2db3.f6def","type":"change","z":"9b2a9527.03a138","name":"","rules":[{"t":"set","p":"textToSpeak","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":320,"wires":[[]]},{"id":"a1cee148.f0a66","type":"ui_button","z":"9b2a9527.03a138","name":"","group":"a0afaa39.4de1a8","order":4,"width":0,"height":0,"passthru":false,"label":"Speak","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":130,"y":420,"wires":[["65e3518d.e5cf7"]]},{"id":"3777368a.740fda","type":"change","z":"9b2a9527.03a138","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":160,"wires":[[]]},{"id":"2479e766.5c7df8","type":"change","z":"9b2a9527.03a138","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.accountName[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":120,"y":160,"wires":[["2074c467.d3c33c"]]},{"id":"2074c467.d3c33c","type":"ui_dropdown","z":"9b2a9527.03a138","name":"","label":"Device","tooltip":"","place":"","group":"a0afaa39.4de1a8","order":1,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":290,"y":160,"wires":[["3777368a.740fda"]]},{"id":"83321d0e.fb45e","type":"ui_button","z":"9b2a9527.03a138","name":"","group":"a0afaa39.4de1a8","order":2,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":110,"y":60,"wires":[["efd70c12.1c90b"]]},{"id":"65e3518d.e5cf7","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"","account":"5d0de7fb.a20278","routineNode":{"type":"speak","payload":{"type":"regular","text":{"type":"flow","value":"textToSpeak"},"devices":{"type":"flow","value":"device"}}},"x":340,"y":420,"wires":[[]]},{"id":"efd70c12.1c90b","type":"alexa-remote-echo","z":"9b2a9527.03a138","name":"","account":"5d0de7fb.a20278","config":{"option":"get","value":{"what":"device","device":{"type":"str","value":"ALEXA_ALL_DSN"}}},"x":270,"y":60,"wires":[["2479e766.5c7df8"]]},{"id":"2c3352be.830a6e","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"speak","payload":{"type":"regular","text":{"type":"msg","value":"payload"},"devices":["G090U50784240Q4D"]}},"x":507,"y":577,"wires":[[]]},{"id":"b402ecb2.8f245","type":"inject","z":"9b2a9527.03a138","name":"","topic":"","payload":"Hello World!","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":600,"wires":[["15315b96.97d624","d510ea6f.241098"]]},{"id":"bc1d5497.5fdfc8","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"msg","value":"payload"},"volume":{"type":"num","value":"50"},"mode":"set","devices":["G090U50784240Q4D"]}},"x":800,"y":680,"wires":[[]]},{"id":"dfbe9343.ead9b","type":"delay","z":"9b2a9527.03a138","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":680,"wires":[["bc1d5497.5fdfc8"]]},{"id":"cfa0dec9.1ff0f","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"music","payload":{"device":{"type":"str","value":"G090U50784240Q4D"},"provider":{"type":"str","value":"SPOTIFY"},"search":{"type":"str","value":"Wanted Dead or Alive"},"duration":{"type":"num","value":""}}},"x":800,"y":760,"wires":[["eb5bdfe8.d62a4"]]},{"id":"d510ea6f.241098","type":"delay","z":"9b2a9527.03a138","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":760,"wires":[["cfa0dec9.1ff0f"]]},{"id":"8be65514.d10d58","type":"ui_dropdown","z":"590246e0.d58c08","name":"","label":"Provider","tooltip":"","place":" ","group":"2631de14.3000c2","order":5,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":280,"y":340,"wires":[["a5d36233.e660c"]]},{"id":"a5d36233.e660c","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"provider","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":380,"wires":[[]]},{"id":"6656aa91.60be54","type":"ui_button","z":"590246e0.d58c08","name":"","group":"2631de14.3000c2","order":9,"width":"0","height":"0","passthru":false,"label":"Play","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":70,"y":480,"wires":[["3b836cdc.e22a24"]]},{"id":"9d69f2be.3b4d9","type":"ui_text_input","z":"590246e0.d58c08","name":"","label":"Query","tooltip":"","group":"2631de14.3000c2","order":8,"width":"0","height":"0","passthru":true,"mode":"text","delay":300,"topic":"","x":70,"y":440,"wires":[["7b6ff7.88195008"]]},{"id":"7b6ff7.88195008","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"query","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":440,"wires":[[]]},{"id":"14cc5f14.a84d41","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":180,"wires":[[]]},{"id":"925b190e.45ec48","type":"ui_button","z":"590246e0.d58c08","name":"Pause","group":"8ed891bd.550a7","order":1,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-pause","payload":"","payloadType":"str","topic":"","x":70,"y":540,"wires":[["e5a94e24.b219"]]},{"id":"333ad56c.28655a","type":"ui_button","z":"590246e0.d58c08","name":"Resume","group":"8ed891bd.550a7","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-play","payload":"","payloadType":"str","topic":"","x":80,"y":580,"wires":[["b024dedd.042c2"]]},{"id":"1cc6c37c.31f87d","type":"ui_slider","z":"590246e0.d58c08","name":"Volume Slider","label":"","tooltip":"","group":"8ed891bd.550a7","order":6,"width":"4","height":"1","passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":240,"y":720,"wires":[["384d1368.9d7c5c"]]},{"id":"15a22c75.a6b904","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.accountName[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":100,"wires":[["11847232.afae9e"]]},{"id":"11847232.afae9e","type":"ui_dropdown","z":"590246e0.d58c08","name":"","label":"Device","tooltip":"","place":" ","group":"2631de14.3000c2","order":2,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":270,"y":140,"wires":[["14cc5f14.a84d41"]]},{"id":"4233b28c.e9a9fc","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.id[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":260,"wires":[["b9f0b5d4.d4c888"]]},{"id":"b9f0b5d4.d4c888","type":"function","z":"590246e0.d58c08","name":"pretty label","func":"let prettify = s => {\n\ts = s.replace('_', ' ');\n\ts = s.toLowerCase();\n\ts = s.split(' ').map(w => w[0].toUpperCase() + w.slice(1)).join(' ');\n\treturn s;\n};\n\nmsg.options = msg.options.map(o => {\n    let obj = {};\n    obj[prettify(o)] = o;\n    return obj;\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":300,"wires":[["8be65514.d10d58"]]},{"id":"3fbb3b89.b0c6f4","type":"ui_template","z":"590246e0.d58c08","group":"8ed891bd.550a7","name":"Repeat","order":7,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Repeat</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":80,"y":780,"wires":[[]]},{"id":"95f26a27.dd5c38","type":"ui_button","z":"590246e0.d58c08","name":"Repeat On","group":"8ed891bd.550a7","order":8,"width":"2","height":"1","passthru":false,"label":"On","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":780,"wires":[["7a06baf4.178284"]]},{"id":"b7e8443b.8a98d8","type":"ui_button","z":"590246e0.d58c08","name":"Repeat Off","group":"8ed891bd.550a7","order":9,"width":"2","height":"1","passthru":false,"label":"Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":820,"wires":[["574c142a.b7ecec"]]},{"id":"87515f4b.0f6f8","type":"ui_template","z":"590246e0.d58c08","group":"8ed891bd.550a7","name":"Shuffle","order":10,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Shuffle</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":70,"y":860,"wires":[[]]},{"id":"a3dc0b27.263448","type":"ui_button","z":"590246e0.d58c08","name":"Shuffle On","group":"8ed891bd.550a7","order":11,"width":"2","height":"1","passthru":false,"label":"On","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":860,"wires":[["6b6f388c.df9288"]]},{"id":"f8fb6fb8.f358","type":"ui_button","z":"590246e0.d58c08","name":"Shuffle Off","group":"8ed891bd.550a7","order":12,"width":"2","height":"1","passthru":false,"label":"Off","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":900,"wires":[["128da965.443027"]]},{"id":"86a009bb.87e108","type":"ui_button","z":"590246e0.d58c08","name":"Refresh Device","group":"2631de14.3000c2","order":3,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":120,"y":60,"wires":[["cc35038d.c4aa"]]},{"id":"7f972f4.3c5e7d","type":"ui_button","z":"590246e0.d58c08","name":"Refresh Provider","group":"2631de14.3000c2","order":6,"width":"1","height":"1","passthru":false,"label":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":110,"y":220,"wires":[["3bd7d77e.529778"]]},{"id":"43de8785.cb9a38","type":"alexa-remote-event","z":"590246e0.d58c08","name":"","account":"","event":"ws-audio-player-state-change","x":150,"y":1000,"wires":[["55ca7ecb.90ca6"]]},{"id":"e2780d4c.dd3c6","type":"ui_template","z":"590246e0.d58c08","group":"363b5f3e.6e4e2","name":"Image","order":2,"width":"6","height":"7","format":"<a href=\"{{msg.payload}}\">\n    <img src=\"{{msg.payload}}\" alt=\"oh no\" width=\"310\">\n</a>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":570,"y":1040,"wires":[[]]},{"id":"d07543.ec8e4ac","type":"ui_template","z":"590246e0.d58c08","group":"363b5f3e.6e4e2","name":"Title","order":1,"width":"6","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"margin:auto; margin-top:0;\">\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":570,"y":1000,"wires":[[]]},{"id":"fb5fa433.f3fb28","type":"ui_slider","z":"590246e0.d58c08","name":"","label":"","tooltip":"","group":"363b5f3e.6e4e2","order":3,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":"100","step":"1","x":570,"y":1080,"wires":[[]]},{"id":"f8547807.bf5498","type":"function","z":"590246e0.d58c08","name":"progress","func":"let interval = context.get('interval');\nif(interval) clearInterval(interval);\ncontext.set('interval', undefined);\n\nif(!msg.payload.progress) return;\n\nconst updateTime = Date.now();\nconst updateProgress = msg.payload.progress.mediaProgress;\nconst mediaLength = msg.payload.progress.mediaLength;\nconst fraction = updateProgress / mediaLength;\nnode.send({ payload: fraction * 100 });\n\nif(msg.payload.state !== 'PLAYING') return;\n\ncontext.set('interval', setInterval(() => {\n    const elapsed = Date.now() - updateTime;\n    const progress = updateProgress + elapsed / 1000;\n    const fraction = progress / mediaLength;\n    node.send({ payload: fraction * 100 });\n}, 1000));\n\n\n\n","outputs":1,"noerr":0,"x":440,"y":1080,"wires":[["fb5fa433.f3fb28"]]},{"id":"43d8c882.625148","type":"change","z":"590246e0.d58c08","name":"infoText","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.infoText.title","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1000,"wires":[["d07543.ec8e4ac"]]},{"id":"4925a1e6.0973c","type":"change","z":"590246e0.d58c08","name":"mainArt","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.mainArt.url","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1040,"wires":[["e2780d4c.dd3c6"]]},{"id":"cc35038d.c4aa","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"get","value":{"what":"device","device":{"type":"str","value":"ALEXA_ALL_DSN"}}},"x":310,"y":60,"wires":[["15a22c75.a6b904"]]},{"id":"3bd7d77e.529778","type":"alexa-remote-other","z":"590246e0.d58c08","name":"","account":"","config":{"option":"get","value":{"what":"musicProviders"}},"x":320,"y":220,"wires":[["4233b28c.e9a9fc"]]},{"id":"e5a94e24.b219","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"pause"}},"x":230,"y":540,"wires":[[]]},{"id":"b024dedd.042c2","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"play"}},"x":220,"y":580,"wires":[[]]},{"id":"3b836cdc.e22a24","type":"alexa-remote-routine","z":"590246e0.d58c08","name":"","account":"","routineNode":{"type":"music","payload":{"device":{"type":"flow","value":"device"},"provider":{"type":"flow","value":"provider"},"search":{"type":"flow","value":"query"},"duration":{"type":"num","value":""}}},"x":240,"y":480,"wires":[[]]},{"id":"384d1368.9d7c5c","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"volume","value":{"type":"msg","value":"payload"}}},"x":410,"y":720,"wires":[[]]},{"id":"7a06baf4.178284","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"repeat","value":{"type":"bool","value":"true"}}},"x":410,"y":780,"wires":[[]]},{"id":"574c142a.b7ecec","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"repeat","value":{"type":"bool","value":"true"}}},"x":410,"y":820,"wires":[[]]},{"id":"6b6f388c.df9288","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"shuffle","value":{"type":"bool","value":"true"}}},"x":400,"y":860,"wires":[[]]},{"id":"128da965.443027","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"shuffle","value":{"type":"bool","value":"false"}}},"x":400,"y":900,"wires":[[]]},{"id":"55ca7ecb.90ca6","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"get","value":{"what":"playerInfo","device":{"type":"flow","value":"device"}}},"x":240,"y":1040,"wires":[["43d8c882.625148","4925a1e6.0973c","f8547807.bf5498"]]},{"id":"efe02951.5fda68","type":"ui_button","z":"590246e0.d58c08","name":"Previous","group":"8ed891bd.550a7","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"","payloadType":"str","topic":"","x":80,"y":620,"wires":[["468847d5.7f11d8"]]},{"id":"430af5f2.fef38c","type":"ui_button","z":"590246e0.d58c08","name":"Next","group":"8ed891bd.550a7","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"","payloadType":"str","topic":"","x":70,"y":660,"wires":[["e69cf7c6.55f168"]]},{"id":"468847d5.7f11d8","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"previous"}},"x":240,"y":620,"wires":[[]]},{"id":"e69cf7c6.55f168","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"next"}},"x":230,"y":660,"wires":[[]]},{"id":"f8207cb0.7118a","type":"ui_template","z":"590246e0.d58c08","group":"8ed891bd.550a7","name":"Volume","order":5,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Volume</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":80,"y":720,"wires":[[]]},{"id":"eb5bdfe8.d62a4","type":"debug","z":"9b2a9527.03a138","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":880,"y":880,"wires":[]},{"id":"15315b96.97d624","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"skill","payload":{"skill":{"type":"str","value":"amzn1.ask.skill.da0bbfcb-a814-4c18-9293-77e78ceb3061"},"device":{"type":"str","value":"G090U50784240Q4D"}}},"x":520,"y":940,"wires":[[]]},{"id":"337be2c9.73710e","type":"inject","z":"4d548667.7a6948","name":"","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":true,"onceDelay":0.1,"x":310,"y":220,"wires":[["78c54847.c3f4e8","4ea36ac2.74f6b4"]]},{"id":"78c54847.c3f4e8","type":"api-current-state","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.yr_symbol","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":750,"y":260,"wires":[["6f09e9b.9533018"]]},{"id":"6f09e9b.9533018","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1000,"y":260,"wires":[]},{"id":"39eb405b.5a4ce","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":980,"y":380,"wires":[]},{"id":"4ea36ac2.74f6b4","type":"api-current-state","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"weather.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":740,"y":400,"wires":[["39eb405b.5a4ce"]]},{"id":"dc780bfc.79b9f8","type":"comment","z":"4d548667.7a6948","name":"Weather API Documentation","info":"https://api.met.no/weatherapi/weathericon/1.1/documentation","x":740,"y":360,"wires":[]},{"id":"802d75d5.8faba8","type":"server-state-changed","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":380,"y":540,"wires":[["612e41f8.c951d"]]},{"id":"612e41f8.c951d","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":760,"y":540,"wires":[]},{"id":"8d38e416.ebaa48","type":"server-state-changed","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":410,"y":640,"wires":[["96ecb7fa.66f658"]]},{"id":"96ecb7fa.66f658","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":640,"wires":[]},{"id":"2a12ae3f.ba49a2","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Entry Door South","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_entry_door_south_access_control","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":300,"wires":[["4f7201ed.606dd"]]},{"id":"4f7201ed.606dd","type":"switch","z":"153e4bbb.7f4624","name":"Door Open","property":"payload","propertyType":"msg","rules":[{"v":"22","vt":"str","t":"eq"},{"v":"23","t":"eq","vt":"str"}],"checkall":"true","outputs":2,"x":350,"y":340,"wires":[["6baa7f6.a053b8","1be780fd.f2538f","75627800.8de3c8","2c5f3558.3b2d0a","f07c9671.cb3bc8"],[]],"outputLabels":["Open","Closed"]},{"id":"1be780fd.f2538f","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Garage Stairs Motion not Detected","server":"5a92f1da.a8503","outputs":1,"halt_if":"255","entity_id":"sensor.garage_stairs_motion_sensor_alarm_level","x":690,"y":280,"wires":[["84b818ab.bb65b8"]]},{"id":"77f6be47.4e337","type":"api-call-service","z":"153e4bbb.7f4624","name":"Main Level Lights on","server":"5a92f1da.a8503","service_domain":"scene","service":"turn_on","data":"{ \"entity_id\": \"scene.main_level_lights\" }","x":1060,"y":440,"wires":[[]]},{"id":"42d6bc5e.4c9324","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on heat","server":"5a92f1da.a8503","service_domain":"climate","service":"set_temperature","data":"{ \"entity_id\": \"climate.hallway_nest\", \"temperature\": 72 }","x":1030,"y":320,"wires":[[]]},{"id":"372e0804.e4f328","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Entry Door North","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_entry_door_north_access_control","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":360,"wires":[["4f7201ed.606dd"]]},{"id":"942c41c4.15729","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Door South","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_door_south_tilt_alarm_level","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":440,"wires":[["1895c11d.34a3bf"]]},{"id":"29f5744.37fee8c","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Door North","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_door_north_tilt_alarm_level","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":500,"wires":[["1895c11d.34a3bf"]]},{"id":"1895c11d.34a3bf","type":"switch","z":"153e4bbb.7f4624","name":"Motion or Open ","property":"payload","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"255"},{"vt":"str","t":"eq","v":"0"}],"checkall":"true","outputs":2,"x":340,"y":520,"wires":[["2bffe3d0.aa46fc","33f647a2.a14c48","75627800.8de3c8"],["33f647a2.a14c48"]],"outputLabels":["Open / Motion","Closed / No Motion"]},{"id":"d481679d.437818","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Motion ","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_motion_sensor_alarm_level","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":100,"y":560,"wires":[["1895c11d.34a3bf"]]},{"id":"2bffe3d0.aa46fc","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on garage lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.garage\"}","x":1060,"y":640,"wires":[[]]},{"id":"6baa7f6.a053b8","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Garage Stairs Motion Detected","server":"5a92f1da.a8503","outputs":1,"halt_if":"0","entity_id":"sensor.garage_stairs_motion_sensor_alarm_level","x":540,"y":480,"wires":[["2bffe3d0.aa46fc","33f647a2.a14c48","fe1f386b.2cb6d8"]]},{"id":"33f647a2.a14c48","type":"stoptimer","z":"153e4bbb.7f4624","duration":"10","units":"Minute","payloadtype":"num","payloadval":"0","name":"10min","x":770,"y":680,"wires":[["d3666bcc.81bbf8"],[]]},{"id":"d3666bcc.81bbf8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off garage lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{ \"entity_id\":\"light.garage\"}","x":1060,"y":680,"wires":[[]]},{"id":"45cb654b.70a74c","type":"inject","z":"153e4bbb.7f4624","name":"","topic":"","payload":"7:15 on weekdays","payloadType":"str","repeat":"","crontab":"15 07 * * 1,2,3,4,5","once":false,"x":130,"y":1100,"wires":[["ca52dfe4.c1b13","a89eccc9.3eb1f","6880bc2e.c3c5b4"]]},{"id":"3041b14e.a9a75e","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on Coffee Grinder","server":"5a92f1da.a8503","service_domain":"switch","service":"turn_on","data":"{ \"entity_id\":\"switch.coffee_grinder_switch\" }","x":760,"y":1100,"wires":[[]]},{"id":"2cd4a6b3.8fbc4a","type":"stoptimer","z":"153e4bbb.7f4624","duration":"65","units":"Second","payloadtype":"num","payloadval":"0","name":"65 seconds","x":550,"y":1140,"wires":[["b6e1e30.eaa102","ee49790d.f889b8"],[]]},{"id":"b6e1e30.eaa102","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off Coffee Grinder","server":"5a92f1da.a8503","service_domain":"switch","service":"turn_off","data":"{ \"entity_id\":\"switch.coffee_grinder_switch\" }","x":760,"y":1140,"wires":[[]]},{"id":"ca7ff7db.c03938","type":"api-call-service","z":"153e4bbb.7f4624","name":"Main Level Lights on","server":"5a92f1da.a8503","service_domain":"scene","service":"turn_on","data":"{ \"entity_id\": \"scene.main_level_lights\" }","mergecontext":"","x":1620,"y":1100,"wires":[[]]},{"id":"5b753f35.6df7b","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Coffee Grinder on","server":"5a92f1da.a8503","entityidfilter":"switch.coffee_grinder_switch","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":110,"y":1180,"wires":[["ca52dfe4.c1b13"]]},{"id":"b62d924e.97f6d","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Stairs Motion ","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_stairs_motion_sensor_alarm_level","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":120,"y":780,"wires":[["7c09f323.2647bc"]]},{"id":"7c09f323.2647bc","type":"switch","z":"153e4bbb.7f4624","name":"Motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"255"},{"v":"0","vt":"str","t":"eq"}],"checkall":"true","outputs":2,"x":340,"y":780,"wires":[["80d69896.646348","801e4cfa.0293b","c33a37cf.2ecac8"],["80d69896.646348"]],"outputLabels":["Open / Motion","Closed / No Motion"]},{"id":"80d69896.646348","type":"stoptimer","z":"153e4bbb.7f4624","duration":"10","units":"Minute","payloadtype":"num","payloadval":"0","name":"10min","x":590,"y":860,"wires":[["20ad9241.a9df3e","52517fae.7db3"],[]]},{"id":"801e4cfa.0293b","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on stairs lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.stairs\"}","mergecontext":"","x":970,"y":820,"wires":[[]]},{"id":"20ad9241.a9df3e","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off stairs lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{ \"entity_id\":\"light.stairs\"}","x":970,"y":860,"wires":[[]]},{"id":"50b5d9e0.bbf838","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on basement lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.basement\"}","x":990,"y":780,"wires":[[]]},{"id":"9814f7d0.80f3d8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off basement lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{ \"entity_id\":\"light.basement\"}","x":990,"y":900,"wires":[[]]},{"id":"f07c9671.cb3bc8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on basement lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.basement\"}","x":1070,"y":520,"wires":[[]]},{"id":"c6b2b55d.ef0f28","type":"api-current-state","z":"153e4bbb.7f4624","name":"Internet Connection Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"binary_sensor.wan","x":130,"y":2220,"wires":[["87f9de8d.95d4d"]]},{"id":"68014cbe.36e834","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off network gear","server":"5a92f1da.a8503","service_domain":"switch","service":"turn_off","data":"{ \"entity_id\":\"switch.network_gear_switch\" }","x":860,"y":2220,"wires":[[]]},{"id":"52907bf8.f51a34","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on network gear","server":"5a92f1da.a8503","service_domain":"switch","service":"turn_on","data":"{ \"entity_id\":\"switch.network_gear_switch\" }","x":1040,"y":2300,"wires":[[]]},{"id":"7aa68280.f4aaac","type":"stoptimer","z":"153e4bbb.7f4624","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"5 minutes","x":620,"y":2220,"wires":[["68014cbe.36e834","5b71a657.9a3638","a21f8190.47a23"],[]]},{"id":"e1291f92.5ebcb","type":"api-current-state","z":"153e4bbb.7f4624","name":"Internet Connection On","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"binary_sensor.wan","x":130,"y":2260,"wires":[["91225215.c9e3a"]]},{"id":"91225215.c9e3a","type":"change","z":"153e4bbb.7f4624","name":"Stop timer","rules":[{"t":"set","tot":"str","pt":"msg","to":"STOP","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":2260,"wires":[["7aa68280.f4aaac"]]},{"id":"5b71a657.9a3638","type":"trigger","z":"153e4bbb.7f4624","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1","extend":false,"units":"min","reset":"","name":"Wait one minute","x":840,"y":2300,"wires":[["52907bf8.f51a34"]]},{"id":"24a2b91.312ba46","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Family Home","server":"5a92f1da.a8503","entityidfilter":"group.family","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":90,"y":100,"wires":[["93361bdd.746f38"]]},{"id":"b3115bd4.a2e3b8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on humidifiers","server":"5a92f1da.a8503","service_domain":"switch","service":"turn_on","data":"{ \"entity_id\":\"group.humidifiers\"}","x":1050,"y":240,"wires":[[]]},{"id":"f9ffb291.4f34f","type":"comment","z":"153e4bbb.7f4624","name":"Reboot network gear if the internet goes down","info":"","x":190,"y":2180,"wires":[]},{"id":"888ad985.3fa038","type":"comment","z":"153e4bbb.7f4624","name":"Turn on the main level lights and grind coffee on work days","info":"","x":230,"y":960,"wires":[]},{"id":"60a86424.59c6ec","type":"comment","z":"153e4bbb.7f4624","name":"Setup the house when we come through the garage or get marked as home","info":"","x":290,"y":40,"wires":[]},{"id":"a9a8cc83.6a618","type":"comment","z":"153e4bbb.7f4624","name":"Turn on garage stair lights and basement when motion is detected","info":"","x":260,"y":740,"wires":[]},{"id":"11e6a5b2.baecca","type":"server-state-changed","z":"6991cee1.63833","name":"Wifes Location Changed","server":"5a92f1da.a8503","version":1,"entityidfilter":"device_tracker.wifes_iphone","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":130,"y":80,"wires":[["20d6d2f9.4cb6ae","2dc531ff.76120e"]]},{"id":"17d30960.22a587","type":"api-call-service","z":"6991cee1.63833","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"msg\"}","x":1510,"y":220,"wires":[[]]},{"id":"ab69675b.0e27e8","type":"comment","z":"153e4bbb.7f4624","name":"Turn down heat and lights off when we are away","info":"","x":200,"y":2380,"wires":[]},{"id":"caf6b4ec.ce1278","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Family Status","server":"5a92f1da.a8503","entityidfilter":"group.family","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":90,"y":2420,"wires":[["27d04336.59274c"]]},{"id":"fda86b38.716878","type":"api-call-service","z":"153e4bbb.7f4624","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\": \"Nobody home, turning down heat and lights off\" }","x":1210,"y":2460,"wires":[[]]},{"id":"4f8e94f2.5112cc","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn down heat","server":"5a92f1da.a8503","service_domain":"climate","service":"set_temperature","data":"{ \"entity_id\": \"climate.hallway_nest\", \"temperature\": 67 }","x":1220,"y":2500,"wires":[[]]},{"id":"d5439ece.f52c6","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off all lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{ \"entity_id\":\"group.all_lights\"}","x":1220,"y":2540,"wires":[[]]},{"id":"a28c722.c0d7c9","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off humidifiers","server":"5a92f1da.a8503","service_domain":"switch","service":"turn_off","data":"{ \"entity_id\":\"group.humidifiers\"}","x":1230,"y":2580,"wires":[[]]},{"id":"a601c0f3.2feb9","type":"server-state-changed","z":"6991cee1.63833","name":"Walts Location Changed","server":"5a92f1da.a8503","entityidfilter":"device_tracker.walts_iphone","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":160,"wires":[["55b5337f.0ce11c","2dc531ff.76120e"]]},{"id":"e119e49a.8050f8","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Stairs Door","server":"5a92f1da.a8503","entityidfilter":"sensor.stairs_door_access_control","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":820,"wires":[["91adcfad.d9e31"]]},{"id":"91adcfad.d9e31","type":"switch","z":"153e4bbb.7f4624","name":"Door Open Or Closed","property":"payload","propertyType":"msg","rules":[{"v":"22","vt":"str","t":"eq"},{"vt":"str","t":"eq","v":"23"}],"checkall":"true","outputs":2,"x":340,"y":840,"wires":[["801e4cfa.0293b","80d69896.646348","c33a37cf.2ecac8"],["80d69896.646348"]],"outputLabels":["Open","Closed"]},{"id":"8135c5e3.827788","type":"comment","z":"153e4bbb.7f4624","name":"Fade on the lights on work days","info":"","x":150,"y":1240,"wires":[]},{"id":"76c92ccd.2b94a4","type":"inject","z":"153e4bbb.7f4624","name":"","topic":"","payload":"6:50 on weekdays","payloadType":"str","repeat":"","crontab":"50 06 * * 1,2,3,4,5","once":false,"x":130,"y":1280,"wires":[["ee811157.9e206"]]},{"id":"f436bc07.a026d","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on Son1s lamp at 1%","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"brightness\":\"1\", \"color_temp\":\"236\"}","mergecontext":"","x":1380,"y":1320,"wires":[["cc432578.0d1e98"]]},{"id":"aea62459.054578","type":"trigger","z":"153e4bbb.7f4624","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"30","extend":false,"units":"s","reset":"","bytopic":"all","name":"Wait thirty seconds","x":1350,"y":1360,"wires":[["96b2e598.adee58"]]},{"id":"96b2e598.adee58","type":"api-call-service","z":"153e4bbb.7f4624","name":"Start 10 minute fade in for Son1's lamp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"transition\":\"600\",\"brightness\":\"255\", \"color_temp\":\"236\"}","mergecontext":"","x":1540,"y":1360,"wires":[[]]},{"id":"ca52dfe4.c1b13","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":380,"y":1140,"wires":[["2cd4a6b3.8fbc4a"]]},{"id":"20d6d2f9.4cb6ae","type":"api-call-service","z":"6991cee1.63833","name":"Update Walts location","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"request_location_update\"}","x":380,"y":80,"wires":[[]]},{"id":"55b5337f.0ce11c","type":"api-call-service","z":"6991cee1.63833","name":"Update Wifes location","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_wifes_iphone","data":"{ \"message\":\"request_location_update\"}","x":410,"y":160,"wires":[[]]},{"id":"75627800.8de3c8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on stairs lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.stairs\"}","x":1050,"y":560,"wires":[[]]},{"id":"33077e28.6d42d2","type":"comment","z":"6991cee1.63833","name":"Location tracking","info":"","x":100,"y":40,"wires":[]},{"id":"1030caad.9bae95","type":"server-state-changed","z":"f89ee080.71ad2","name":"Guests on WiFi Network","server":"5a92f1da.a8503","entityidfilter":"group.guests","entityidfiltertype":"substring","haltifstate":"not_home","outputs":1,"x":130,"y":80,"wires":[["4d655f07.0ef55"]]},{"id":"d405b3ee.90284","type":"api-call-service","z":"f89ee080.71ad2","name":"Turn on guest mode","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\": \"input_boolean.guest_mode\"}","x":980,"y":80,"wires":[[]]},{"id":"43e28f10.6b463","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\": \"Guest Home while family is away\" }","x":950,"y":120,"wires":[[]]},{"id":"fb73e4d9.2db3c8","type":"inject","z":"f89ee080.71ad2","name":"","topic":"","payload":"10:00PM","payloadType":"str","repeat":"","crontab":"00 22 * * *","once":false,"x":110,"y":160,"wires":[["e1e164b2.fec4b8"]]},{"id":"e1e164b2.fec4b8","type":"api-current-state","z":"f89ee080.71ad2","name":"If Guest Mode On","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"input_boolean.guest_mode","x":350,"y":160,"wires":[["e6ede7f9.17e7d8"]]},{"id":"e6ede7f9.17e7d8","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\": \"Guest mode will remain enabled until manually turned off\" }","x":950,"y":160,"wires":[[]]},{"id":"46cbf884.4824e8","type":"comment","z":"f89ee080.71ad2","name":"Guest mode management","info":"","x":130,"y":40,"wires":[]},{"id":"e271fc84.ccf5f","type":"api-current-state","z":"f89ee080.71ad2","name":"If Family Not Home","server":"5a92f1da.a8503","outputs":1,"halt_if":"home","entity_id":"group.family","x":730,"y":120,"wires":[["43e28f10.6b463"]]},{"id":"caf03adc.c9e938","type":"comment","z":"f89ee080.71ad2","name":"Battery checks for sensors","info":"","x":130,"y":220,"wires":[]},{"id":"7c0f40a9.a115c","type":"server-state-changed","z":"f89ee080.71ad2","name":"Battery Status of all sensors","server":"5a92f1da.a8503","entityidfilter":"sensor.battery_status","haltifstate":"","outputs":1,"x":140,"y":260,"wires":[["912de2cc.c9a99"]]},{"id":"8b0fb27c.56172","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\": \"Guest Home while family is away\" }","x":950,"y":260,"wires":[[]]},{"id":"912de2cc.c9a99","type":"function","z":"f89ee080.71ad2","name":"Format battery message","func":"msg.payload = { data: {'message': 'Check battery ' + msg.payload } };\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":260,"wires":[["8b0fb27c.56172"]]},{"id":"c52cf9be.581b78","type":"inject","z":"f89ee080.71ad2","name":"On the hour","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"0 0-23 * * *","once":false,"x":110,"y":360,"wires":[["6a484f05.dcd5e"]]},{"id":"6a484f05.dcd5e","type":"api-call-service","z":"f89ee080.71ad2","name":"Query CableONE data usage","server":"5a92f1da.a8503","service_domain":"shell_command","service":"query_cableone_data_usage","data":"{ }","mergecontext":"","x":1000,"y":360,"wires":[[]]},{"id":"4bc207c4.7429a8","type":"comment","z":"f89ee080.71ad2","name":"Query CableONE Data Cap Usage","info":"","x":160,"y":320,"wires":[]},{"id":"12552668.aca7ba","type":"mqtt in","z":"f89ee080.71ad2","name":"All MQTT Messages","topic":"#","qos":"1","broker":"aea3d1f8.3aa12","x":110,"y":580,"wires":[["3ff538cd.847608"]]},{"id":"3ff538cd.847608","type":"function","z":"f89ee080.71ad2","name":"Reformat telemetry to state","func":"tele_check = /^tele/;\npower_check = /POWER/g;\n\nif (tele_check.test(msg.topic) && power_check.test(msg.payload)) {\n    new_payload     = msg.payload.replace(/.*POWER..\\\"([A-Z]+)\\\".*/, '$1');\n    msg.payload     = new_payload;\n\n    new_topic       = msg.topic.replace(/(\\w+).(\\w+).(\\w+)/, 'stat/$2/POWER');\n    msg.topic       = new_topic;\n    \n    msg.altered     = 1;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":580,"wires":[["e3f7f99c.cbebd8"]]},{"id":"e3f7f99c.cbebd8","type":"switch","z":"f89ee080.71ad2","name":"If message reformatted","property":"altered","propertyType":"msg","rules":[{"v":"1","t":"eq","vt":"num"}],"checkall":"true","outputs":1,"x":690,"y":580,"wires":[["f7b4954a.61cba8"]]},{"id":"eeed8e65.ef548","type":"server-state-changed","z":"a8777efe.89265","name":"Front Door","server":"5a92f1da.a8503","entityidfilter":"sensor.front_door_access_control","haltifstate":"","outputs":1,"x":80,"y":200,"wires":[["630a8b95.9d8ff4"]]},{"id":"c0ebc39c.2279e","type":"server-state-changed","z":"a8777efe.89265","name":"Basement Back Door","server":"5a92f1da.a8503","entityidfilter":"sensor.basement_back_door_access_control","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":120,"y":260,"wires":[["630a8b95.9d8ff4"]]},{"id":"387c422d.bbb57e","type":"server-state-changed","z":"a8777efe.89265","name":"Screened Porch Door","server":"5a92f1da.a8503","entityidfilter":"sensor.screened_porch_door_access_control","haltifstate":"","outputs":1,"x":120,"y":320,"wires":[["630a8b95.9d8ff4"]]},{"id":"6713a33f.a1a9ec","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Entry Door South","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_entry_door_south_access_control","haltifstate":"","outputs":1,"x":130,"y":380,"wires":[["630a8b95.9d8ff4"]]},{"id":"9f87d382.30b2a","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Entry Door North","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_entry_door_north_access_control","haltifstate":"","outputs":1,"x":130,"y":440,"wires":[["630a8b95.9d8ff4"]]},{"id":"360d419d.fc8d4e","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Stairs Door","server":"5a92f1da.a8503","entityidfilter":"sensor.stairs_door_access_control","haltifstate":"","outputs":1,"x":110,"y":500,"wires":[["630a8b95.9d8ff4"]]},{"id":"630a8b95.9d8ff4","type":"switch","z":"a8777efe.89265","name":"Doors Open or Closed","property":"payload","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"22"},{"t":"eq","vt":"str","v":"23"}],"checkall":"true","outputs":2,"x":480,"y":280,"wires":[["3f5dfb7d.a49b94"],["3f5dfb7d.a49b94"]],"outputLabels":["Open","Closed"]},{"id":"c24d152e.d39e58","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Motion ","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_motion_sensor_alarm_level","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":100,"y":140,"wires":[["fdb2a6dd.396718"]]},{"id":"85b19e4a.66ef2","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Stairs Motion ","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_stairs_motion_sensor_alarm_level","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":120,"y":80,"wires":[["192090be.9f4f6f"]]},{"id":"192090be.9f4f6f","type":"switch","z":"a8777efe.89265","name":"Motion","property":"payload","propertyType":"msg","rules":[{"v":"255","t":"eq","vt":"str"},{"t":"eq","vt":"str","v":"0"}],"checkall":"true","outputs":2,"x":480,"y":80,"wires":[["3f5dfb7d.a49b94"],[]],"outputLabels":["Open / Motion","Closed / No Motion"]},{"id":"affbd467.252dd8","type":"comment","z":"a8777efe.89265","name":"Alerts if motion or doors move when we are not home","info":"","x":220,"y":40,"wires":[]},{"id":"f17c6e8f.5d65b","type":"comment","z":"a8777efe.89265","name":"Alert if doors are open too long","info":"","x":150,"y":560,"wires":[]},{"id":"5baa980a.fe7098","type":"stoptimer","z":"a8777efe.89265","duration":"15","units":"Minute","payloadtype":"num","payloadval":"0","name":"15 minutes","x":1030,"y":680,"wires":[["65f53dc0.e36f14"],[]]},{"id":"84d3f25c.85cf5","type":"change","z":"a8777efe.89265","name":"Stop timer","rules":[{"pt":"msg","to":"STOP","p":"payload","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":800,"wires":[["5baa980a.fe7098"]]},{"id":"7fe65541.bebabc","type":"api-call-service","z":"a8777efe.89265","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1030,"y":760,"wires":[[]]},{"id":"7013b716.dcc758","type":"server-state-changed","z":"a8777efe.89265","name":"Front Door","server":"5a92f1da.a8503","entityidfilter":"sensor.front_door_access_control","haltifstate":"","outputs":1,"x":80,"y":600,"wires":[["7f203835.5a6ce8"]]},{"id":"1480c237.d5ce3e","type":"server-state-changed","z":"a8777efe.89265","name":"Basement Back Door","server":"5a92f1da.a8503","entityidfilter":"sensor.basement_back_door_access_control","haltifstate":"","outputs":1,"x":120,"y":660,"wires":[["7f203835.5a6ce8"]]},{"id":"71cc0e2b.4cc67","type":"server-state-changed","z":"a8777efe.89265","name":"Screened Porch Door","server":"5a92f1da.a8503","entityidfilter":"sensor.screened_porch_door_access_control","haltifstate":"","outputs":1,"x":120,"y":720,"wires":[["7f203835.5a6ce8"]]},{"id":"7f203835.5a6ce8","type":"switch","z":"a8777efe.89265","name":"Door Open Or Closed","property":"payload","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"22"},{"v":"23","t":"eq","vt":"str"}],"checkall":"true","outputs":2,"x":380,"y":640,"wires":[["821bccd2.a5c21","d7c03078.4b92e"],["84d3f25c.85cf5"]],"outputLabels":["Open","Closed"]},{"id":"2a826449.b2280c","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Door South","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_door_south_tilt_alarm_level","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":110,"y":780,"wires":[["e2198d5e.c506"]]},{"id":"67c84065.6ca54","type":"server-state-changed","z":"a8777efe.89265","name":"Garage Door North","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_door_north_tilt_alarm_level","haltifstate":"","outputs":1,"x":110,"y":840,"wires":[["e2198d5e.c506"]]},{"id":"e2198d5e.c506","type":"switch","z":"a8777efe.89265","name":"Garage Door Open Or Closed","property":"payload","propertyType":"msg","rules":[{"v":"255","t":"eq","vt":"str"},{"v":"0","vt":"str","t":"eq"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":800,"wires":[["821bccd2.a5c21"],["84d3f25c.85cf5"]],"outputLabels":["Open / Motion","Closed / No Motion"]},{"id":"65f53dc0.e36f14","type":"function","z":"a8777efe.89265","name":"Format message","func":"door        = msg.topic.replace(/^.*\\.(.*)_(access|alarm).*/, '$1');\ndoor        = door.replace(/_/g, ' ');\nmsg.payload = { data: {'message': door + ' has been open over 15 minutes' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":720,"wires":[["7fe65541.bebabc","16b8ed9c.15a192"]]},{"id":"2c5f3558.3b2d0a","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Garage Motion Detected","server":"5a92f1da.a8503","outputs":1,"halt_if":"0","entity_id":"sensor.garage_motion_sensor_alarm_level","x":640,"y":100,"wires":[["1bd0aca5.d93123"]]},{"id":"1bd0aca5.d93123","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Family Not Home","server":"5a92f1da.a8503","outputs":1,"halt_if":"home","entity_id":"group.family","x":610,"y":140,"wires":[["e449d623.67c7c8"]]},{"id":"d5cf5dc4.abf08","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on master bedroom","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.master_bedroom\"}","x":1070,"y":120,"wires":[[]]},{"id":"eb47344a.c5fce8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on upstairs landing","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.sengled_e11g13_030b05a4_1\"}","x":1070,"y":80,"wires":[[]]},{"id":"ea2a11a9.5aa4a","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on Son1's Lamp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\"}","x":1070,"y":160,"wires":[[]]},{"id":"f54979e8.536f88","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on Son2's Lamp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.colins_lamp\"}","x":1060,"y":200,"wires":[[]]},{"id":"35b50056.771a3","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":600,"y":220,"wires":[["b2842785.189e18"]]},{"id":"7dac317b.22a53","type":"comment","z":"153e4bbb.7f4624","name":"Upstairs","info":"","x":1020,"y":40,"wires":[]},{"id":"ca565304.d4362","type":"comment","z":"153e4bbb.7f4624","name":"Main Level","info":"","x":1020,"y":360,"wires":[]},{"id":"2fb13131.665fce","type":"comment","z":"153e4bbb.7f4624","name":"Basement and garage","info":"","x":1060,"y":480,"wires":[]},{"id":"41e7cb48.bfcf34","type":"api-call-service","z":"a8777efe.89265","name":"Update Walts location","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"request_location_update\"}","x":1260,"y":80,"wires":[[]]},{"id":"88aa77ce.70ca98","type":"api-call-service","z":"a8777efe.89265","name":"Update Wifes location","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_wifes_iphone","data":"{ \"message\":\"request_location_update\"}","x":1270,"y":120,"wires":[[]]},{"id":"17c8f7bd.f29678","type":"delay","z":"a8777efe.89265","name":"3 minute delay for location update","pauseType":"delay","timeout":"3","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":800,"y":140,"wires":[["cca2d060.501a5"]]},{"id":"137d7519.2bf83b","type":"function","z":"a8777efe.89265","name":"Format message","func":"door        = msg.topic.replace(/^.*\\.(.*)_(access|alarm).*/, '$1');\ndoor        = door.replace(/_/g, ' ');\nmsg.payload = { data: {'message': door + ' opened three minutes ago while family was out' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":280,"wires":[["73b02c67.f90714"]]},{"id":"fdd4c5f2.c4b548","type":"e-mail in","z":"f89ee080.71ad2","name":"","protocol":"IMAP","server":"imap.email.com","useSSL":true,"port":"993","box":"OptionC","disposition":"None","repeat":"300","inputs":0,"x":70,"y":680,"wires":[["b68900b0.8b056"]]},{"id":"b68900b0.8b056","type":"switch","z":"f89ee080.71ad2","name":"From Mary Immaculate","property":"from","propertyType":"msg","rules":[{"vt":"str","t":"cont","v":"optioncalerts.com"}],"checkall":"true","outputs":1,"x":260,"y":680,"wires":[["6f4f29c.4b2fbd8"]]},{"id":"6f4f29c.4b2fbd8","type":"switch","z":"f89ee080.71ad2","name":"No school?","property":"payload","propertyType":"msg","rules":[{"t":"cont","vt":"str","v":"no school"}],"checkall":"true","outputs":1,"x":480,"y":680,"wires":[["a9522432.b5ca18","79ff0dad.391ae4","56b8f900.aa0868"]]},{"id":"a9522432.b5ca18","type":"api-call-service","z":"f89ee080.71ad2","name":"Turn on \"no school mode\"","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\":\"no_school_mode\"} ","x":920,"y":680,"wires":[[]]},{"id":"79ff0dad.391ae4","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"No School tomorrow\" }","x":870,"y":720,"wires":[[]]},{"id":"4a5d1736.9650a8","type":"api-current-state","z":"f89ee080.71ad2","name":"If No School Mode On","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"input_boolean.no_school_mode","x":270,"y":820,"wires":[["2f7c1fc0.21bf9","af05f3f.00de61"]]},{"id":"ba89ed12.9d52a","type":"inject","z":"f89ee080.71ad2","name":"","topic":"","payload":"9:00am","payloadType":"str","repeat":"","crontab":"00 09 * * *","once":false,"x":90,"y":820,"wires":[["4a5d1736.9650a8"]]},{"id":"2f7c1fc0.21bf9","type":"api-call-service","z":"f89ee080.71ad2","name":"Turn on \"no school mode\"","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\":\"no_school_mode\"} ","x":710,"y":820,"wires":[[]]},{"id":"af05f3f.00de61","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"Turning off no school mode - Alarm clocks will go off normally tomorrow morning\" }","x":660,"y":860,"wires":[[]]},{"id":"1276b270.e3499e","type":"comment","z":"f89ee080.71ad2","name":"Monitor for no school days","info":"","x":130,"y":640,"wires":[]},{"id":"d30f3597.4099c8","type":"comment","z":"f89ee080.71ad2","name":"Turn off no school mode","info":"","x":130,"y":780,"wires":[]},{"id":"6f3d295d.1a5f28","type":"api-current-state","z":"153e4bbb.7f4624","name":"If No School mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.no_school_mode","x":670,"y":1280,"wires":[["a4e1c195.838c1","9a147f2d.3cd44"]]},{"id":"356c0f13.872fa","type":"server-state-changed","z":"f89ee080.71ad2","name":"Family Calendar - No school event","server":"5a92f1da.a8503","entityidfilter":"calendar.family_sleepin","haltifstate":"off","outputs":1,"x":420,"y":720,"wires":[["a9522432.b5ca18","79ff0dad.391ae4","56b8f900.aa0868"]]},{"id":"98329385.2eff4","type":"delay","z":"6991cee1.63833","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":180,"wires":[["11b996d7.33abd9","353f83f6.2e0d8c"]]},{"id":"e2a98aa0.0bd778","type":"function","z":"6991cee1.63833","name":"Still in triggered zone or just passing through?","func":"walt_updated_loc = global.get('walt_location')||null;\nwife_updated_loc = global.get('wife_location')||null;\n\nmsg.wife_updated_loc = wife_updated_loc;\nmsg.walt_updated_loc = walt_updated_loc;\n\nif (msg.person == 'walt' && (walt_updated_loc == msg.loc)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"Still in triggered geozone, sending message\"});\n    msg.passing_through = 0;\n    return[ msg,null ];\n} else if (msg.person == 'wife' && (wife_updated_loc == msg.loc)) {\n    node.status({fill:\"green\",shape:\"dot\",text:\"Still in triggered geozone, sending message\"});\n    msg.passing_through = 0;\n    return[ msg,null ];\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"Just passing through geozone, stopping flow\"});\n    msg.passing_through = 1;\n    return [ null,msg ];\n}","outputs":"2","noerr":0,"x":1040,"y":180,"wires":[["b736c000.6e726","5bc4b8a4.4e6148","9aa23412.dc96f8"],[]],"outputLabels":["Still in triggered zone","Passing through"]},{"id":"11b996d7.33abd9","type":"delay","z":"6991cee1.63833","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":180,"wires":[["e2a98aa0.0bd778"]]},{"id":"de37d45a.712b58","type":"switch","z":"a685a6b4.db4368","name":"Leaving or entering a zone?","property":"verb","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"left"},{"vt":"str","t":"eq","v":"is at"},{"vt":"str","t":"eq","v":"unknown"}],"checkall":"true","outputs":3,"x":540,"y":40,"wires":[["ef753f2e.038d6"],["b917b3f3.71048","8b37b181.aaf15"],["f2bb3319.bd3e9"]]},{"id":"353f83f6.2e0d8c","type":"function","z":"6991cee1.63833","name":"Clear msg and switch","func":"// Clear our msg object as the service call to\n// update our location doesn't seem to like it\nnewmsg = {};\nnewmsg.payload = \"Update\";\n\nif(msg.person == \"walt\") {\n    return[ newmsg, null ];\n} else if(msg.person == \"wife\") {\n    return[ null, newmsg ];\n}","outputs":"2","noerr":0,"x":160,"y":200,"wires":[["20d6d2f9.4cb6ae"],["55b5337f.0ce11c"]],"outputLabels":["walt","wife"]},{"id":"821bccd2.a5c21","type":"time-range-switch","z":"a8777efe.89265","name":"Night","lat":"40.18937","lon":"-92.5825","startTime":"sunsetStart","endTime":"wife","startOffset":0,"endOffset":0,"x":630,"y":620,"wires":[["59037f0e.5fdde"],[]]},{"id":"b736c000.6e726","type":"debug","z":"6991cee1.63833","name":"FinalNotify","active":true,"console":"false","complete":"true","x":1350,"y":100,"wires":[]},{"id":"19cf6e5a.ab20f2","type":"api-current-state","z":"f89ee080.71ad2","name":"Family Mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"group.family","x":490,"y":980,"wires":[["df2b9e02.ce81c"]]},{"id":"e5a63096.d9ed3","type":"api-current-state","z":"f89ee080.71ad2","name":"Guest mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.guest_mode","x":490,"y":940,"wires":[["b9f443f9.11c8d"]]},{"id":"2218dbfd.6ced74","type":"inject","z":"f89ee080.71ad2","name":"","topic":"Every 10sec","payload":"","payloadType":"date","repeat":"10","crontab":"","once":false,"x":150,"y":940,"wires":[["e5a63096.d9ed3","19cf6e5a.ab20f2","ed22a312.d31ca","5ade00c6.a83a1","83e0023c.afd5a","182a438d.a798fc"]]},{"id":"6789645c.58cffc","type":"comment","z":"f89ee080.71ad2","name":"Turn our input booleans to global variables","info":"","x":180,"y":900,"wires":[]},{"id":"b9f443f9.11c8d","type":"function","z":"f89ee080.71ad2","name":"Set global variables","func":"global.set('guest_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":940,"wires":[[]]},{"id":"df2b9e02.ce81c","type":"function","z":"f89ee080.71ad2","name":"Set global variables","func":"global.set('family_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":980,"wires":[[]]},{"id":"8347bdcb.ad5f1","type":"function","z":"5217c125.f919f","name":"Is family home or guest mode on?","func":"family_mode         = global.get('family_mode')||null;\nguest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\nmsg.guest_mode      = guest_mode;\n\nif( family_mode == 'home' || guest_mode == 'on' || ha_uptime_sec < 600) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n     msg.abort_alert = 0;\n    return [ null, msg ];   \n}","outputs":2,"noerr":0,"x":520,"y":560,"wires":[[],[]],"outputLabels":["abort","continue"]},{"id":"6a31486d.505a18","type":"api-current-state","z":"5217c125.f919f","name":"Family Mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"group.family","x":470,"y":440,"wires":[["42dd4cc4.8d43d4"]]},{"id":"490c3f41.ac704","type":"api-current-state","z":"5217c125.f919f","name":"Guest mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.guest_mode","x":470,"y":400,"wires":[["6a397292.9deeec"]]},{"id":"6a397292.9deeec","type":"function","z":"5217c125.f919f","name":"Set global variables","func":"global.set('guest_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":400,"wires":[[]]},{"id":"42dd4cc4.8d43d4","type":"function","z":"5217c125.f919f","name":"Set global variables","func":"global.set('family_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":440,"wires":[[]]},{"id":"c3f10bd6.6652b8","type":"delay","z":"5217c125.f919f","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":560,"wires":[["8347bdcb.ad5f1"]]},{"id":"3f5dfb7d.a49b94","type":"subflow:5217c125.f919f","z":"a8777efe.89265","name":"","x":750,"y":60,"wires":[["41e7cb48.bfcf34","88aa77ce.70ca98","17c8f7bd.f29678"]]},{"id":"cca2d060.501a5","type":"subflow:5217c125.f919f","z":"a8777efe.89265","name":"Family still not home","x":760,"y":220,"wires":[["137d7519.2bf83b"]]},{"id":"bc435e9f.bbd53","type":"time-range-switch","z":"153e4bbb.7f4624","name":"","lat":"40.18944","lon":"-92.58257","startTime":"07:30","endTime":"21:00","startOffset":0,"endOffset":0,"x":930,"y":2420,"wires":[["fda86b38.716878","4f8e94f2.5112cc","d5439ece.f52c6","a28c722.c0d7c9","2b6b26fb.fa37ca"],["b91f11c3.fe8aa"]]},{"id":"b2842785.189e18","type":"time-range-switch","z":"153e4bbb.7f4624","name":"7AM to 9PM","lat":"","lon":"","startTime":"07:00","endTime":"21:00","startOffset":0,"endOffset":0,"x":770,"y":220,"wires":[["eb47344a.c5fce8","d5cf5dc4.abf08","ea2a11a9.5aa4a","f54979e8.536f88","b3115bd4.a2e3b8","f3d9fcf7.3a811","42d6bc5e.4c9324"],[]]},{"id":"7ccf32e4.93ca2c","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":700,"y":80,"wires":[["d405b3ee.90284"]]},{"id":"4d655f07.0ef55","type":"api-current-state","z":"f89ee080.71ad2","name":"If Guest Mode Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.guest_mode","x":350,"y":80,"wires":[["e271fc84.ccf5f","7ccf32e4.93ca2c"]]},{"id":"2060b624.75254a","type":"comment","z":"f89ee080.71ad2","name":"Relogin to Home Assistant Cloud every hour or after internet outage","info":"","x":260,"y":1180,"wires":[]},{"id":"12bc8d00.5fea13","type":"inject","z":"f89ee080.71ad2","name":"Every hour","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"x":110,"y":1220,"wires":[["4c592930.f7a728"]]},{"id":"c6c7cfe8.7110e","type":"http request","z":"f89ee080.71ad2","name":"","method":"POST","ret":"txt","url":"","tls":"cf49b477.229318","x":670,"y":1220,"wires":[["3e66242b.e3401c"]]},{"id":"4c592930.f7a728","type":"function","z":"f89ee080.71ad2","name":"Set Logout URL and headers","func":"msg.url = 'https://127.0.0.1:8123/api/cloud/logout';\nmsg.headers = {};\nmsg.headers['x-ha-access'] = 'your-api-password';\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;\n","outputs":1,"noerr":0,"x":360,"y":1220,"wires":[["c6c7cfe8.7110e"]]},{"id":"67afcbda.fb20e4","type":"function","z":"f89ee080.71ad2","name":"Set Login URL, headers and payload","func":"msg.url = 'https://127.0.0.1:8123/api/cloud/login';\nmsg.payload = '{\"email\": \"your-email-address@email.com\", \"password\": \"your-cloud-password\"}';\nmsg.headers = {};\nmsg.headers['x-ha-access'] = 'your-api-password';\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;\n","outputs":1,"noerr":0,"x":390,"y":1280,"wires":[["6fe8fa6c.d289e4"]]},{"id":"3e66242b.e3401c","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":1220,"wires":[["67afcbda.fb20e4"]]},{"id":"6fe8fa6c.d289e4","type":"http request","z":"f89ee080.71ad2","name":"","method":"POST","ret":"txt","url":"","tls":"cf49b477.229318","x":670,"y":1280,"wires":[["75de8dec.e6c7e4"]]},{"id":"ec18657b.410f58","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\": \"Problem logging back into Home Assistant Cloud\" }","x":1090,"y":1280,"wires":[[]]},{"id":"75de8dec.e6c7e4","type":"switch","z":"f89ee080.71ad2","name":"Not HTTP 200","property":"statusCode","propertyType":"msg","rules":[{"t":"neq","vt":"num","v":"200"}],"checkall":"true","outputs":1,"x":880,"y":1280,"wires":[["ec18657b.410f58"]]},{"id":"35612f5a.19b53","type":"api-current-state","z":"f89ee080.71ad2","name":"Internet Connection Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"binary_sensor.wan","x":130,"y":1380,"wires":[["339fc6e7.0ce83a"]]},{"id":"339fc6e7.0ce83a","type":"looptimer","z":"f89ee080.71ad2","duration":"30","units":"Second","maxloops":"1440","maxtimeout":"12","maxtimeoutunits":"Hour","name":"","x":450,"y":1380,"wires":[["59dee07.c06ba2"],[]]},{"id":"59dee07.c06ba2","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":1380,"wires":[["5cdbb6d6.562ea8"]]},{"id":"5cdbb6d6.562ea8","type":"api-current-state","z":"f89ee080.71ad2","name":"Internet back online","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"binary_sensor.wan","x":920,"y":1380,"wires":[["17121a9d.91cbd5","5d42483f.c18a78"]]},{"id":"17121a9d.91cbd5","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1140,"y":1380,"wires":[["aaa434df.5f6b68"]]},{"id":"d2334b34.2351e8","type":"comment","z":"f89ee080.71ad2","name":"Kick off actions when internet comes back online","info":"","x":200,"y":1340,"wires":[]},{"id":"aaa434df.5f6b68","type":"link out","z":"f89ee080.71ad2","name":"Internet back online","links":["eaa26324.7f9ef"],"x":1275,"y":1380,"wires":[]},{"id":"eaa26324.7f9ef","type":"link in","z":"f89ee080.71ad2","name":"Internet back online","links":["aaa434df.5f6b68"],"x":55,"y":1280,"wires":[["4c592930.f7a728"]],"outputLabels":["Internet back online"]},{"id":"73b02c67.f90714","type":"api-call-service","z":"a8777efe.89265","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1230,"y":280,"wires":[[]]},{"id":"ef72c8ec.d223a8","type":"comment","z":"153e4bbb.7f4624","name":"Setup house for Brenda cleaning","info":"","x":150,"y":2640,"wires":[]},{"id":"11d9171b.25a279","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on all lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"group.all_lights\"}","x":1000,"y":2720,"wires":[[]]},{"id":"4e235d61.c3d824","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off all lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{ \"entity_id\":\"group.all_lights\"}","x":1140,"y":2880,"wires":[[]]},{"id":"f61feb53.d4fd98","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Front Door Open","server":"5a92f1da.a8503","entityidfilter":"sensor.front_door_access_control","entityidfiltertype":"exact","haltifstate":"23","outputs":1,"x":100,"y":2680,"wires":[["ee3b3b55.feebc8","e19610e1.b5f4f"]]},{"id":"a09da031.a1f6a","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Door South","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_door_south_tilt_alarm_level","entityidfiltertype":"exact","haltifstate":"0","outputs":1,"x":110,"y":2720,"wires":[["ee3b3b55.feebc8","e19610e1.b5f4f"]]},{"id":"509b120c.e248ec","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Brenda scheduled to clean","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"calendar.family_brendacleaning","x":740,"y":2680,"wires":[["11d9171b.25a279","904b5ac1.0ad678","4ce15aa8.4f8ae4","ff9c8bf4.cfbac8"]]},{"id":"904b5ac1.0ad678","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":2760,"wires":[["8c3a5ad2.c8f6d8"]]},{"id":"4fe6011f.1c6d3","type":"traffic","z":"153e4bbb.7f4624","name":"","property_allow":"traffic","filter_allow":"green","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"traffic","filter_stop":"red","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":690,"y":2840,"wires":[["b2b8baa.0253d48","3cd13b9.6e710c4","931539e2.95bd48"]]},{"id":"b2b8baa.0253d48","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":2880,"wires":[["c8f98041.f981e","f652082f.460718"]]},{"id":"ee3b3b55.feebc8","type":"delay","z":"153e4bbb.7f4624","name":"Only let one message through 30s","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":440,"y":2760,"wires":[["4fe6011f.1c6d3"]]},{"id":"8c3a5ad2.c8f6d8","type":"change","z":"153e4bbb.7f4624","name":"Turn on traffic light","rules":[{"p":"traffic","pt":"msg","to":"green","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":1190,"y":2760,"wires":[["4fe6011f.1c6d3","f617436a.e99d6"]]},{"id":"931539e2.95bd48","type":"change","z":"153e4bbb.7f4624","name":"Turn off traffic light","rules":[{"p":"traffic","pt":"msg","to":"red","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":2900,"wires":[["4fe6011f.1c6d3"]]},{"id":"4ce15aa8.4f8ae4","type":"api-call-service","z":"153e4bbb.7f4624","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"Brenda started cleaning\" }","x":990,"y":2680,"wires":[[]]},{"id":"3cd13b9.6e710c4","type":"api-call-service","z":"153e4bbb.7f4624","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"Brenda finished cleaning\" }","x":910,"y":2840,"wires":[[]]},{"id":"8d410785.4d9108","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on guest mode","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\": \"input_boolean.guest_mode\"}","x":400,"y":2800,"wires":[[]]},{"id":"6c8d53c4.9573dc","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Brenda scheduled to clean","server":"5a92f1da.a8503","entityidfilter":"calendar.family_brendacleaning","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":130,"y":2800,"wires":[["8d410785.4d9108","bce43350.0c792","19418e9e.a51a31"]]},{"id":"f652082f.460718","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Family Not Home","server":"5a92f1da.a8503","outputs":1,"halt_if":"home","entity_id":"group.family","x":1110,"y":2840,"wires":[["4e235d61.c3d824","6c27e49f.3a390c"]]},{"id":"670f95fc.39f6ec","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Garage Entry Door South","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_entry_door_south_access_control","entityidfiltertype":"exact","haltifstate":"23","outputs":1,"x":130,"y":2760,"wires":[["ee3b3b55.feebc8","e19610e1.b5f4f"]]},{"id":"e19610e1.b5f4f","type":"delay","z":"153e4bbb.7f4624","name":"Only let one message through 3h","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":440,"y":2680,"wires":[["509b120c.e248ec"]]},{"id":"98ed91f.24b007","type":"comment","z":"153e4bbb.7f4624","name":"Leaving","info":"","x":350,"y":2720,"wires":[]},{"id":"c8f98041.f981e","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off guest mode","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_off","data":"{ \"entity_id\": \"input_boolean.guest_mode\"}","x":1120,"y":2920,"wires":[[]]},{"id":"87f9de8d.95d4d","type":"api-current-state","z":"153e4bbb.7f4624","name":"If no network maintenance","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"input_boolean.network_maintenance","x":400,"y":2220,"wires":[["7aa68280.f4aaac"]]},{"id":"c77b4311.2ef9b","type":"function","z":"a685a6b4.db4368","name":"Format device_tracker data","func":"newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\nwife_lat        = parseFloat(global.get('wife_latitude'))||null;\nwife_lon        = parseFloat(global.get('wife_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - wife_lat);\nlon_diff        = Math.abs(walt_lon - wife_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.wife_lat = wife_lat;\nnewmsg.wife_lon = wife_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}","outputs":1,"noerr":0,"x":240,"y":40,"wires":[["de37d45a.712b58"]]},{"id":"b917b3f3.71048","type":"switch","z":"a685a6b4.db4368","name":"Stop if in same zone as before","property":"samezone","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"0"}],"checkall":"true","outputs":1,"x":850,"y":40,"wires":[["b49ccc24.44d33"]]},{"id":"f2bb3319.bd3e9","type":"debug","z":"a685a6b4.db4368","name":"unknown events","active":true,"console":"false","complete":"true","x":840,"y":320,"wires":[]},{"id":"8b37b181.aaf15","type":"debug","z":"a685a6b4.db4368","name":"is at events","active":true,"console":"false","complete":"true","x":830,"y":280,"wires":[]},{"id":"ef753f2e.038d6","type":"debug","z":"a685a6b4.db4368","name":"left events","active":true,"console":"false","complete":"true","x":830,"y":240,"wires":[]},{"id":"ed22a312.d31ca","type":"api-render-template","z":"f89ee080.71ad2","name":"Current GPS coordinates","server":"5a92f1da.a8503","template":"person,latitude,longitude,location\nwife,{{ states.device_tracker.wifes_iphone.attributes.latitude}},{{ states.device_tracker.wifes_iphone.attributes.longitude}},{{states.device_tracker.wifes_iphone.state}}\nwalt,{{ states.device_tracker.walts_iphone.attributes.latitude}},{{ states.device_tracker.walts_iphone.attributes.longitude}},{{states.device_tracker.walts_iphone.state}}","x":530,"y":1100,"wires":[["28be5c56.aac494"]]},{"id":"28be5c56.aac494","type":"csv","z":"f89ee080.71ad2","name":"","sep":",","hdrin":true,"hdrout":"","multi":"one","ret":"\\n","temp":"","x":710,"y":1100,"wires":[["c055e80b.d29528"]]},{"id":"c055e80b.d29528","type":"function","z":"f89ee080.71ad2","name":"Set global variables","func":"// Set this the first time NodeRed runs, so\n// location tracking logic will work\nprevious_loc    = global.get(msg.payload.person + '_previous_loc')||null;\nif (previous_loc === null){\n    global.set(msg.payload.person + '_previous_loc',msg.payload.location);\n}\n\n// Set our global variables\nglobal.set(msg.payload.person + '_latitude',msg.payload.latitude);\nglobal.set(msg.payload.person + '_longitude',msg.payload.longitude);\nglobal.set(msg.payload.person + '_location',msg.payload.location);\n\nmsg.lat_string = msg.payload.person + '_location';\nmsg.lon_string = msg.payload.person + '_longitude';\nmsg.per_string = msg.payload.person + '_location';\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":1100,"wires":[[]]},{"id":"b49ccc24.44d33","type":"switch","z":"a685a6b4.db4368","name":"Stop if together","property":"apart","propertyType":"msg","rules":[{"v":"1","vt":"num","t":"eq"}],"checkall":"true","outputs":1,"x":1080,"y":40,"wires":[[]]},{"id":"e97082ab.8951f","type":"subflow:a685a6b4.db4368","z":"6991cee1.63833","name":"","x":600,"y":120,"wires":[["b736c000.6e726","5bc4b8a4.4e6148","9aa23412.dc96f8"],["98329385.2eff4"]]},{"id":"567a3817.d63668","type":"comment","z":"6991cee1.63833","name":"Build notification message, check if apart, in same zone and coming or going","info":"","x":770,"y":80,"wires":[]},{"id":"8983906d.8966f","type":"server-state-changed","z":"f89ee080.71ad2","name":"Nest thermostat offline","server":"5a92f1da.a8503","entityidfilter":"binary_sensor.hallway_thermostat_nest_online","haltifstate":"on","outputs":1,"x":120,"y":1540,"wires":[["7ee54fcc.11f24"]]},{"id":"15ee3195.19fe2e","type":"comment","z":"f89ee080.71ad2","name":"Notify me if Nest thermostat is offline","info":"","x":170,"y":1500,"wires":[]},{"id":"8ec35825.ceac78","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"Nest thermostat is offline\" }","x":1090,"y":1540,"wires":[[]]},{"id":"7ee54fcc.11f24","type":"api-current-state","z":"f89ee080.71ad2","name":"Stop if internet connection is down","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"binary_sensor.wan","x":380,"y":1540,"wires":[["de1d2ab7.7308e8"]]},{"id":"a5cbe2ac.354eb","type":"api-call-service","z":"2c797f21.c25cb","name":"Speak","server":"5a92f1da.a8503","service_domain":"tts","service":"google_say","data":"{ \"entity_id\":\"group.speakers\",\"message\":\"Hello there, this is the default message. Walt didn't program me correctly.\" }","x":330,"y":340,"wires":[[]]},{"id":"16b8ed9c.15a192","type":"subflow:2c797f21.c25cb","z":"a8777efe.89265","name":"","x":1030,"y":800,"wires":[[],[]]},{"id":"b4898810.413378","type":"subflow:2c797f21.c25cb","z":"6991cee1.63833","name":"","x":1690,"y":140,"wires":[[],[]]},{"id":"bd7d5e3e.db57d","type":"server-state-changed","z":"6991cee1.63833","name":"Wifes Location Changed","server":"5a92f1da.a8503","entityidfilter":"group.wife_tracking","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":380,"wires":[["92f34e72.e0eb"]]},{"id":"1d26342a.88a75c","type":"server-state-changed","z":"6991cee1.63833","name":"Walts Location Changed","server":"5a92f1da.a8503","entityidfilter":"group.walt_tracking","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":440,"wires":[["3743a16e.4ddc2e"]]},{"id":"68073f91.50041","type":"switch","z":"76bb0065.30dc2","name":"Home?","property":"payload","propertyType":"msg","rules":[{"v":"home","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":140,"y":60,"wires":[["6afedaa5.aaa954"]]},{"id":"d52d7940.436368","type":"looptimer","z":"76bb0065.30dc2","duration":"5","units":"Second","maxloops":"120","maxtimeout":"10","maxtimeoutunits":"Minute","name":"","x":660,"y":320,"wires":[["e2c126bf.f3bc68"],[]]},{"id":"e2c126bf.f3bc68","type":"api-current-state","z":"76bb0065.30dc2","name":"Garage Stairs Motion","server":"5a92f1da.a8503","outputs":1,"halt_if":"0","entity_id":"sensor.garage_stairs_motion_sensor_alarm_level","x":880,"y":320,"wires":[["317e1a0d.f33e56","9ab4ee92.7cc2f"]]},{"id":"317e1a0d.f33e56","type":"change","z":"76bb0065.30dc2","name":"Stop loop","rules":[{"p":"payload","to":"stop","pt":"msg","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":420,"wires":[["d52d7940.436368"]]},{"id":"9ab4ee92.7cc2f","type":"delay","z":"76bb0065.30dc2","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1120,"y":320,"wires":[["366971a8.da52ce"]]},{"id":"92f34e72.e0eb","type":"subflow:76bb0065.30dc2","z":"6991cee1.63833","name":"If home and came up garage stairs within 10 minutes","x":460,"y":380,"wires":[["3ce65eb7.f0b622"]]},{"id":"13722037.57978","type":"comment","z":"6991cee1.63833","name":"Theme song","info":"","x":90,"y":340,"wires":[]},{"id":"3743a16e.4ddc2e","type":"subflow:76bb0065.30dc2","z":"6991cee1.63833","name":"If home and came up garage stairs within 10 minutes","x":460.000015258789,"y":438.888899803162,"wires":[["7a58c03f.30fcb"]]},{"id":"d522ffe2.51b65","type":"api-call-service","z":"6991cee1.63833","name":"Play where rainbows never die","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/whererainbowsneverdie.mp3\" }","x":1530,"y":480,"wires":[[]]},{"id":"366971a8.da52ce","type":"api-current-state","z":"76bb0065.30dc2","name":"Kitchen media already playing?","server":"5a92f1da.a8503","outputs":1,"halt_if":"playing","entity_id":"media_player.kitchen_speaker","x":1330,"y":320,"wires":[["5c4dbce.1883744"]]},{"id":"5c4dbce.1883744","type":"api-call-service","z":"76bb0065.30dc2","name":"Set volume on Kitchen","server":"5a92f1da.a8503","service_domain":"media_player","service":"volume_set","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"volume_level\":0.5 }","mergecontext":"","x":1320,"y":420,"wires":[[]]},{"id":"47cfe70.9e1eb18","type":"switch","z":"6991cee1.63833","name":"","property":"payload","propertyType":"msg","rules":[{"v":"1","t":"eq","vt":"num"},{"v":"2","vt":"num","t":"eq"},{"v":"3","vt":"num","t":"eq"}],"checkall":"true","repair":false,"outputs":3,"x":1289.99993896484,"y":381.249982833862,"wires":[["be927d5c.de60b"],["452bbe2e.411e5"],["94fff30c.eb119"]]},{"id":"57944cad.013f54","type":"random","z":"6991cee1.63833","name":"","low":"1","high":"3","inte":"true","property":"payload","x":1139.99993896484,"y":381.249982833862,"wires":[["47cfe70.9e1eb18"]]},{"id":"452bbe2e.411e5","type":"api-call-service","z":"6991cee1.63833","name":"Play take it easy","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/takeiteasy.mp3\" }","x":1479.99993896484,"y":381.249982833862,"wires":[[]]},{"id":"94fff30c.eb119","type":"api-call-service","z":"6991cee1.63833","name":"Play here comes the sun","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/herecomesthesun.mp3\" }","x":1509.99993896484,"y":421.249982833862,"wires":[[]]},{"id":"357d0dca.1cd332","type":"random","z":"6991cee1.63833","name":"","low":"1","high":"8","inte":"true","x":1139.99993896484,"y":441.249982833862,"wires":[["30f22d23.b01422"]]},{"id":"30f22d23.b01422","type":"switch","z":"6991cee1.63833","name":"","property":"payload","propertyType":"msg","rules":[{"vt":"num","t":"eq","v":"1"},{"v":"2","t":"eq","vt":"num"},{"v":"3","t":"eq","vt":"num"},{"v":"4","vt":"num","t":"eq"},{"v":"5","t":"eq","vt":"num"},{"v":"6","t":"eq","vt":"num"},{"t":"eq","vt":"num","v":"7"},{"v":"8","vt":"num","t":"eq"}],"checkall":"true","outputs":8,"x":1289.99993896484,"y":481.249982833862,"wires":[["d522ffe2.51b65"],["4256c490.71768c"],["7a22d611.91eb18"],["747fc4dc.58b54c"],["5c835610.be7858"],["e46be399.4a5e9"],["9a3abc46.0a704"],["d8f7b34d.74af8"]]},{"id":"4256c490.71768c","type":"api-call-service","z":"6991cee1.63833","name":"Play fortunate son","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/fortunateson.mp3\" }","x":1490,"y":518.750000953674,"wires":[[]]},{"id":"7a22d611.91eb18","type":"api-call-service","z":"6991cee1.63833","name":"Play imperial march","server":"5a92f1da.a8503","version":0,"service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/imperial_march.mp3\" }","x":1490,"y":562.500000953674,"wires":[[]]},{"id":"6afedaa5.aaa954","type":"time-range-switch","z":"76bb0065.30dc2","name":"Not too early or late","lat":"40.17341","lon":"-92.58913","startTime":"07:30","endTime":"20:00","startOffset":0,"endOffset":0,"x":320,"y":60,"wires":[["396897da.cf4bd8"],[]]},{"id":"be927d5c.de60b","type":"api-call-service","z":"6991cee1.63833","name":"Play walking on sunshine","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/walkingonsunshine.mp3\" }","x":1509.99993896484,"y":341.249982833862,"wires":[[]]},{"id":"396897da.cf4bd8","type":"delay","z":"76bb0065.30dc2","name":"One message per three hours","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":590,"y":60,"wires":[["d52d7940.436368"]]},{"id":"20f1c54e.f5e6aa","type":"comment","z":"76bb0065.30dc2","name":"Loop and wait for movement on the stairs","info":"","x":740,"y":280,"wires":[]},{"id":"747fc4dc.58b54c","type":"api-call-service","z":"6991cee1.63833","name":"Play September","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/september.mp3\" }","x":1479.99995422363,"y":603.749992370605,"wires":[[]]},{"id":"5c835610.be7858","type":"api-call-service","z":"6991cee1.63833","name":"Play Let it Be","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/letitbe.mp3\" }","x":1469.99995422363,"y":643.749992370605,"wires":[[]]},{"id":"e46be399.4a5e9","type":"api-call-service","z":"6991cee1.63833","name":"Play With a Little Help from my Friends","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/withalittlehelp.mp3\" }","x":1549.99995422363,"y":683.749992370605,"wires":[[]]},{"id":"9a3abc46.0a704","type":"api-call-service","z":"6991cee1.63833","name":"Play Seasons of Love","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/seaonsoflove.mp3\" }","x":1499.99995422363,"y":723.749992370605,"wires":[[]]},{"id":"d8f7b34d.74af8","type":"api-call-service","z":"6991cee1.63833","name":"Play Man of Constant Sorrow","server":"5a92f1da.a8503","service_domain":"media_player","service":"play_media","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"media_content_type\":\"music\",\"media_content_id\":\"https://your-hostname.duckdns.org:65443/local/audio/constantsorrow.mp3\" }","x":1529.99995422363,"y":763.749992370605,"wires":[[]]},{"id":"5d42483f.c18a78","type":"change","z":"f89ee080.71ad2","name":"Stop loop","rules":[{"tot":"str","t":"set","p":"payload","pt":"msg","to":"stop"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":1440,"wires":[["339fc6e7.0ce83a"]]},{"id":"de1d2ab7.7308e8","type":"looptimer","z":"f89ee080.71ad2","duration":"1","units":"Minute","maxloops":"15","maxtimeout":"15","maxtimeoutunits":"Minute","name":"15 minute loop, checking every minute","x":730,"y":1540,"wires":[["1cca3740.0d5e19"],["8ec35825.ceac78"]]},{"id":"1cca3740.0d5e19","type":"api-current-state","z":"f89ee080.71ad2","name":"Nest back online?","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"binary_sensor.hallway_thermostat_nest_online","x":1030,"y":1600,"wires":[["ce5e8419.459368"]]},{"id":"ce5e8419.459368","type":"change","z":"f89ee080.71ad2","name":"Stop loop","rules":[{"t":"set","tot":"str","p":"payload","pt":"msg","to":"stop"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":1620,"wires":[["de1d2ab7.7308e8"]]},{"id":"2dc531ff.76120e","type":"delay","z":"6991cee1.63833","name":"","pauseType":"delay","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":120,"wires":[["e97082ab.8951f"]]},{"id":"66cd790b.46acd8","type":"function","z":"2c797f21.c25cb","name":"Is guest mode on?","func":"guest_mode      = global.get('guest_mode')||null;\nquiet_mode      = global.get('quiet_mode')||null;\n\nmsg.guest_mode  = guest_mode;\nmsg.quiet_mode  = quiet_mode;\n\nif(guest_mode == 'on' || quiet_mode == 'on') {\n    msg.abort_alert = 1;\n    return[null,msg];    \n} else {\n    msg.abort_alert = 0;\n    return[msg,null];\n}","outputs":"2","noerr":0,"x":198.75,"y":156.071426391602,"wires":[["613a2049.aacb2","fac5a46f.30ca58","7229ae8d.401d7"],[]],"outputLabels":["No guests","Guests"]},{"id":"1b788ea1.c64f01","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":720,"y":2420,"wires":[["bc435e9f.bbd53"]]},{"id":"93361bdd.746f38","type":"switch","z":"153e4bbb.7f4624","name":"Home?","property":"payload","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"home"}],"checkall":"true","outputs":1,"x":295,"y":101,"wires":[["e449d623.67c7c8","4783084d.3577f8"]]},{"id":"f3d9fcf7.3a811","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Setup the house automation - Upstairs\" }","x":1040,"y":280,"wires":[[]]},{"id":"a88f4f91.18a29","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Setup the house automation - Main level and basement\" }","x":1040,"y":400,"wires":[[]]},{"id":"bd2e3bcd.341c18","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Family Awake","server":"5a92f1da.a8503","entityidfilter":"binary_sensor.family_sleeping","entityidfiltertype":"exact","haltifstate":"on","outputs":1,"x":90,"y":1000,"wires":[["a89eccc9.3eb1f"]]},{"id":"6ddb6cf1.864934","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Family Awake in Bed","server":"5a92f1da.a8503","entityidfilter":"binary_sensor.family_in_bed","entityidfiltertype":"exact","haltifstate":"on","outputs":1,"x":110,"y":1040,"wires":[["a89eccc9.3eb1f"]]},{"id":"b02e32c2.05ed","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":540,"y":1020,"wires":[["9f8bd085.5e34f"]]},{"id":"9f8bd085.5e34f","type":"api-current-state","z":"153e4bbb.7f4624","name":"Main Level lights already on?","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"group.main_level","x":760,"y":1020,"wires":[["c46d36cc.78be48"]]},{"id":"a060e4c.3df1e18","type":"comment","z":"153e4bbb.7f4624","name":"Turn off coffee grinder","info":"","x":120,"y":1140,"wires":[]},{"id":"c6eb0ca7.06464","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Turn on the main level lights, upstairs landing and Son2s lamp\" }","x":1600,"y":1140,"wires":[[]]},{"id":"a89eccc9.3eb1f","type":"time-range-switch","z":"153e4bbb.7f4624","name":"6AM to 10AM","lat":"","lon":"","startTime":"06:00","endTime":"10:00","startOffset":0,"endOffset":0,"x":360,"y":1020,"wires":[["b02e32c2.05ed"],[]]},{"id":"a4e1c195.838c1","type":"api-current-state","z":"153e4bbb.7f4624","name":"Son1s light already on?","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"light.philips_lct014_0288ce3f_11","x":950,"y":1280,"wires":[["7f4a4a70.8e0d04"]]},{"id":"9a147f2d.3cd44","type":"api-current-state","z":"153e4bbb.7f4624","name":"Master bedroom light already on?","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"light.master_bedroom","x":920,"y":1320,"wires":[["8e5e438.07a0fc"]]},{"id":"cdbd55e6.c42aa8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on Master bedroom lamp at 1%","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.master_bedroom\", \"brightness\":\"1\", \"color_temp\":\"236\"}","mergecontext":"","x":1410,"y":1400,"wires":[["40a1ecaa.18ddb4"]]},{"id":"184360a0.bc7fff","type":"trigger","z":"153e4bbb.7f4624","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"30","extend":false,"units":"s","reset":"","bytopic":"all","name":"Wait thirty seconds","x":1350,"y":1440,"wires":[["cbdb063c.7ed868"]]},{"id":"cbdb063c.7ed868","type":"api-call-service","z":"153e4bbb.7f4624","name":"Start 10 minute fade in for Master bedroom lamps","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.master_bedroom\", \"transition\":\"600\",\"brightness\":\"255\", \"color_temp\":\"236\"}","mergecontext":"","x":1570,"y":1440,"wires":[[]]},{"id":"b42e80cf.b8f0a","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Fade on the light on work days - Son1s Lamp\" }","x":1340,"y":1280,"wires":[[]]},{"id":"6871b62f.9fac58","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Fade on the light on work days - Master bedroom Lamp\" }","x":1340,"y":1480,"wires":[[]]},{"id":"a21f8190.47a23","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Rebooting network gear \" }","x":840,"y":2260,"wires":[[]]},{"id":"b91f11c3.fe8aa","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Turn down heat and lights off when we are away\" }","x":1220,"y":2420,"wires":[[]]},{"id":"bce43350.0c792","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - guest mode turned on\" }","x":380,"y":2840,"wires":[[]]},{"id":"ff9c8bf4.cfbac8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - Brenda in the house\" }","mergecontext":"","x":1240,"y":2680,"wires":[[]]},{"id":"f617436a.e99d6","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Setup house for Brenda cleaning - Traffic light turned on, waiting for exit door event\" }","x":1400,"y":2760,"wires":[[]]},{"id":"3e4acc70.43b544","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on upstairs landing","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.sengled_e11g13_030b05a4_1\"}","x":1630,"y":1020,"wires":[[]]},{"id":"362ba1fd.b66a0e","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on Son2's Lamp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.colins_lamp\"}","x":1620,"y":1060,"wires":[[]]},{"id":"62013cd5.5ea9b4","type":"tail","z":"f89ee080.71ad2","name":"","filetype":"text","split":true,"filename":"/Users/hass/.homeassistant/home-assistant.log","x":200,"y":1860,"wires":[["2a6a7e59.282522","b69eeff1.b6c2b","8cd5c8f2.02f048","744e6c70.f93174","8de2aa57.472bd8"]]},{"id":"64420661.6d2078","type":"comment","z":"f89ee080.71ad2","name":"Watch the Home Assistant Log file","info":"","x":160,"y":1820,"wires":[]},{"id":"2a6a7e59.282522","type":"switch","z":"f89ee080.71ad2","name":"Walt's phone rate limit","property":"payload","propertyType":"msg","rules":[{"v":"iOS push notification rate limits for walts_iphone","case":false,"vt":"str","t":"regex"}],"checkall":"true","outputs":1,"x":540,"y":1980,"wires":[["c3a6cabe.e083b8"]]},{"id":"b69eeff1.b6c2b","type":"switch","z":"f89ee080.71ad2","name":"Wife's phone rate limit","property":"payload","propertyType":"msg","rules":[{"case":false,"vt":"str","t":"regex","v":"iOS push notification rate limits for wifes_iphone"}],"checkall":"true","outputs":1,"x":550,"y":2020,"wires":[["fbf0b772.f11dc8"]]},{"id":"c3a6cabe.e083b8","type":"function","z":"f89ee080.71ad2","name":"Pull out number of sent messages","func":"sent        = msg.payload.replace(/.*phone: ([0-9]+) sent.*/, '$1');\nmsg.sent    = sent;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":1980,"wires":[["8120dbe8.b06738"]]},{"id":"8120dbe8.b06738","type":"debug","z":"f89ee080.71ad2","name":"number of push to walts phone","active":true,"console":"false","complete":"true","x":1190,"y":1980,"wires":[]},{"id":"fbf0b772.f11dc8","type":"function","z":"f89ee080.71ad2","name":"Pull out number of sent messages","func":"sent        = msg.payload.replace(/.*phone: ([0-9]+) sent.*/, '$1');\nmsg.sent    = sent;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":2020,"wires":[["cce8376c.a3e508"]]},{"id":"cce8376c.a3e508","type":"debug","z":"f89ee080.71ad2","name":"number of push to wifes phone","active":true,"console":"false","complete":"true","x":1190,"y":2020,"wires":[]},{"id":"5fc154d2.53dd8c","type":"comment","z":"f89ee080.71ad2","name":"TODO: Set these as variables in Home Assistant","info":"","x":1200,"y":2060,"wires":[]},{"id":"fdb2a6dd.396718","type":"time-range-switch","z":"a8777efe.89265","name":"Off while sun shines into garage","lat":"40.17349","lon":"-92.58936","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":"-90","endOffset":0,"x":330,"y":140,"wires":[["192090be.9f4f6f"],[]]},{"id":"c46d36cc.78be48","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Family Home","server":"5a92f1da.a8503","outputs":1,"halt_if":"not_home","entity_id":"group.family","x":980,"y":1020,"wires":[["2dc7df7a.2bf79"]]},{"id":"5ade00c6.a83a1","type":"api-current-state","z":"f89ee080.71ad2","name":"HA Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":490,"y":900,"wires":[["7103b1df.f08d8"]]},{"id":"7103b1df.f08d8","type":"function","z":"f89ee080.71ad2","name":"Set global variables","func":"global.set('ha_uptime_sec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":900,"wires":[[]]},{"id":"7411ecc0.247eb4","type":"api-current-state","z":"5217c125.f919f","name":"HA Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":470,"y":360,"wires":[["c9cc9f99.f3b43"]]},{"id":"c9cc9f99.f3b43","type":"function","z":"5217c125.f919f","name":"Set global variables","func":"global.set('ha_uptime_sec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":360,"wires":[[]]},{"id":"fdbc0880.c48ee8","type":"comment","z":"5217c125.f919f","name":"Checks if family mode or guest mode is on, and that HA has not restarted in last ten min","info":"","x":680,"y":520,"wires":[]},{"id":"7229ae8d.401d7","type":"delay","z":"2c797f21.c25cb","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":160,"wires":[["bf79a462.1911c8"]]},{"id":"bf79a462.1911c8","type":"traffic","z":"2c797f21.c25cb","name":"","property_allow":"payload","filter_allow":"off|idle|paused","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"playing","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":true,"differ":false,"x":750,"y":220,"wires":[["eff5e826.0c7868","3cf3f949.45d396","c1f858f5.e6c348"]]},{"id":"fac5a46f.30ca58","type":"api-current-state","z":"2c797f21.c25cb","name":"Kitchen media already playing?","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"media_player.kitchen_speaker","x":515,"y":108.571451187134,"wires":[["87dfa1f3.89b39"]]},{"id":"613a2049.aacb2","type":"api-current-state","z":"2c797f21.c25cb","name":"Family room media already playing?","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"media_player.family_room_speaker","x":535,"y":67.3214302062988,"wires":[["87dfa1f3.89b39"]]},{"id":"1f6d770a.061019","type":"delay","z":"2c797f21.c25cb","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1100,"y":140,"wires":[["bf79a462.1911c8"]]},{"id":"87dfa1f3.89b39","type":"switch","z":"2c797f21.c25cb","name":"Playing or not playing","property":"payload","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"playing"},{"vt":"str","t":"neq","v":"playing"}],"checkall":"true","outputs":2,"x":840,"y":100,"wires":[["bf79a462.1911c8"],["1f6d770a.061019"]],"outputLabels":["playing","not playing"]},{"id":"3cf3f949.45d396","type":"api-call-service","z":"2c797f21.c25cb","name":"Set volume on Family Room","server":"5a92f1da.a8503","service_domain":"media_player","service":"volume_set","data":"{ \"entity_id\":\"media_player.family_room_speaker\",\"volume_level\":0.5 }","x":1000,"y":200,"wires":[[]]},{"id":"c1f858f5.e6c348","type":"api-call-service","z":"2c797f21.c25cb","name":"Set volume on Kitchen","server":"5a92f1da.a8503","service_domain":"media_player","service":"volume_set","data":"{ \"entity_id\":\"media_player.kitchen_speaker\",\"volume_level\":0.9 }","x":980,"y":240,"wires":[[]]},{"id":"eff5e826.0c7868","type":"delay","z":"2c797f21.c25cb","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":140.357196807861,"y":339.28572845459,"wires":[["a5cbe2ac.354eb","3b5b0142.f2074e"]]},{"id":"88854b4d.8953f8","type":"comment","z":"2c797f21.c25cb","name":"If we are playing on either speaker, block the voice message","info":"","x":980.714285714286,"y":58.5714285714286,"wires":[]},{"id":"3ce65eb7.f0b622","type":"function","z":"6991cee1.63833","name":"Format message","func":"greetings = [\n            \"Hooray! Mom is here!\",\n            \"Oh yeah, Mom is back!\",\n            \"Hey, better clean up, your Mom is back!\",\n            \"Woohoo! Mommy is home!\",\n            \"The queen of the castle has returned!\",\n            \"Mom's back!\",\n            \"Mommy is home!\",\n            \"Hey, Mom just got home!\"\n            ];\n\ngreeting = greetings[Math.floor(Math.random()*greetings.length)];\nmsg.payload = { data: {'message': greeting } };\n\nreturn msg;","outputs":1,"noerr":0,"x":794.571380615234,"y":382.678510665894,"wires":[["5be7d7df.ad4858"]]},{"id":"5be7d7df.ad4858","type":"subflow:2c797f21.c25cb","z":"6991cee1.63833","name":"","x":973.428527832031,"y":383.249982833862,"wires":[["57944cad.013f54"],[]]},{"id":"8af4e9dc.5fb158","type":"looptimer","z":"2c797f21.c25cb","duration":"5","units":"Second","maxloops":"100","maxtimeout":"1","maxtimeoutunits":"Hour","name":"","x":425,"y":430,"wires":[["7ac8ab58.3d3344","f3ac2207.2c84f"],[]]},{"id":"7ac8ab58.3d3344","type":"api-current-state","z":"2c797f21.c25cb","name":"Family room media already playing?","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"media_player.family_room_speaker","x":696.071361541748,"y":406.428586006165,"wires":[["c41ba416.7f5a28"]]},{"id":"f3ac2207.2c84f","type":"api-current-state","z":"2c797f21.c25cb","name":"Kitchen media already playing?","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"media_player.kitchen_speaker","x":676.071361541748,"y":449.285733222961,"wires":[["c41ba416.7f5a28"]]},{"id":"3c965b6c.a89704","type":"delay","z":"2c797f21.c25cb","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"15","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1106.07155227661,"y":442.14287853241,"wires":[["5e56594e.595e28"]]},{"id":"c41ba416.7f5a28","type":"switch","z":"2c797f21.c25cb","name":"Idle?","property":"payload","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"idle"},{"v":"idle","vt":"str","t":"neq"}],"checkall":"true","outputs":2,"x":928.928607940674,"y":440.714297294617,"wires":[["3c965b6c.a89704"],[]],"outputLabels":["playing","not playing"]},{"id":"5e56594e.595e28","type":"change","z":"2c797f21.c25cb","name":"Stop loop","rules":[{"p":"payload","pt":"msg","to":"stop","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":799.642807551792,"y":560.714291572571,"wires":[["8af4e9dc.5fb158"]]},{"id":"3b5b0142.f2074e","type":"delay","z":"2c797f21.c25cb","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":196.07133102417,"y":460.999995231628,"wires":[["8af4e9dc.5fb158"]]},{"id":"7a58c03f.30fcb","type":"function","z":"6991cee1.63833","name":"Format message","func":"greetings = [\n            \"Hooray! Dad is here!\",\n            \"Oh yeah, Dad is back!\",\n            \"Hey, better get ready to rumble, your Dad is back!\",\n            \"Woohoo! Daddy is home!\",\n            \"The king of the castle has returned!\",\n            \"Dad's back!\",\n            \"Daddy is home!\",\n            \"Hey, Dad just got home!\"\n            ];\n\ngreeting = greetings[Math.floor(Math.random()*greetings.length)];\nmsg.payload = { data: {'message': greeting } };\n\nreturn msg;","outputs":1,"noerr":0,"x":796.857116699219,"y":434.392835617065,"wires":[["7e4da8e.c691f58"]]},{"id":"7e4da8e.c691f58","type":"subflow:2c797f21.c25cb","z":"6991cee1.63833","name":"","x":975.714263916016,"y":434.964307785034,"wires":[["357d0dca.1cd332"],[]]},{"id":"995df5ca.2a4548","type":"comment","z":"2c797f21.c25cb","name":"Continue on to the output after the speakers are idle","info":"","x":220.357128143311,"y":396.428586006165,"wires":[]},{"id":"65b77bf6.b68014","type":"function","z":"ccf6acb1.0f2c9","name":"Is guest mode on?","func":"guest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.guest_mode      = guest_mode;\n\nif( guest_mode == 'on' || ha_uptime_sec < 180) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n    msg.abort_alert = 0;\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":610,"y":200,"wires":[[],[]],"outputLabels":["abort","continue"]},{"id":"25ffc1b3.0463fe","type":"api-current-state","z":"ccf6acb1.0f2c9","name":"Guest mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.guest_mode","x":590,"y":120,"wires":[["5bf11238.171f9c"]]},{"id":"5bf11238.171f9c","type":"function","z":"ccf6acb1.0f2c9","name":"Set global variables","func":"global.set('guest_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":120,"wires":[[]]},{"id":"52b4125a.23497c","type":"delay","z":"ccf6acb1.0f2c9","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":200,"wires":[["65b77bf6.b68014"]]},{"id":"c1e860b.aae71a","type":"api-current-state","z":"ccf6acb1.0f2c9","name":"HA Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":590,"y":80,"wires":[["4ad6be.c0909944"]]},{"id":"4ad6be.c0909944","type":"function","z":"ccf6acb1.0f2c9","name":"Set global variables","func":"global.set('ha_uptime_sec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":80,"wires":[[]]},{"id":"35888474.841d4c","type":"comment","z":"ccf6acb1.0f2c9","name":"Checks if guest mode is on, and that HA has not restarted in last three min","info":"","x":770,"y":160,"wires":[]},{"id":"8f586f75.a4f63","type":"comment","z":"2c797f21.c25cb","name":"Continue flow without speaking","info":"","x":370,"y":220,"wires":[]},{"id":"17e71d5b.576f03","type":"comment","z":"2c797f21.c25cb","name":"Continue flow after speaking is complete","info":"","x":1360,"y":400,"wires":[]},{"id":"f009ccd1.7ddb7","type":"function","z":"6b84347a.0dfbcc","name":"Is family away?","func":"family_mode         = global.get('family_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\n\nif( family_mode == 'not_home' && ha_uptime_sec > 600) {\n    msg.abort_alert = 1;\n    return[msg,null];\n} else {\n    msg.abort_alert = 0;\n    return[null,msg];    \n}","outputs":2,"noerr":0,"x":460,"y":300,"wires":[[],[]],"outputLabels":["abort","continue"]},{"id":"d973527d.626d2","type":"api-current-state","z":"6b84347a.0dfbcc","name":"Family Mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"group.family","x":470,"y":220,"wires":[["b86bab22.69d658"]]},{"id":"b86bab22.69d658","type":"function","z":"6b84347a.0dfbcc","name":"Set global variables","func":"global.set('family_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":220,"wires":[[]]},{"id":"1d7c12f9.ac39ed","type":"delay","z":"6b84347a.0dfbcc","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":300,"wires":[["f009ccd1.7ddb7"]]},{"id":"e9f14699.e36a48","type":"api-current-state","z":"6b84347a.0dfbcc","name":"HA Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":470,"y":180,"wires":[["4b01777f.cdb148"]]},{"id":"4b01777f.cdb148","type":"function","z":"6b84347a.0dfbcc","name":"Set global variables","func":"global.set('ha_uptime_sec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":180,"wires":[[]]},{"id":"4110d9c8.8061b8","type":"comment","z":"6b84347a.0dfbcc","name":"Checks if family is home and that HA has not restarted in last ten min","info":"","x":620,"y":260,"wires":[]},{"id":"5bc4b8a4.4e6148","type":"subflow:6b84347a.0dfbcc","z":"6991cee1.63833","name":"","x":1350,"y":140,"wires":[["ddf24530.d1ea88"]]},{"id":"ad355770.154188","type":"comment","z":"f89ee080.71ad2","name":"Refresh the Z-Wave Graph","info":"","x":130,"y":2080,"wires":[]},{"id":"85571fe.41754e","type":"inject","z":"f89ee080.71ad2","name":"","topic":"Once an hour","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"x":150,"y":2120,"wires":[["bea6f40a.d472e8"]]},{"id":"bea6f40a.d472e8","type":"api-call-service","z":"f89ee080.71ad2","name":"Call Z-Wave Graph script","server":"5a92f1da.a8503","service_domain":"shell_command","service":"z_wave_graph","data":"{ }","x":493.333333333333,"y":2120,"wires":[[]]},{"id":"aad02787.e518e8","type":"function","z":"6991cee1.63833","name":"Clear msg and switch","func":"// Clear our msg object as the service call to\n// update our location doesn't seem to like it\nnewmsg = {};\nnewmsg.payload = \"Update\";\n\nif(msg.person == \"walt\") {\n    return[ newmsg, null ];\n} else if(msg.person == \"wife\") {\n    return[ null, newmsg ];\n}","outputs":"2","noerr":0,"x":1380,"y":60,"wires":[["681c226.e7b5adc"],["b336063f.1c3558"]],"outputLabels":["walt","wife"]},{"id":"681c226.e7b5adc","type":"api-call-service","z":"6991cee1.63833","name":"Set tracking interval to 1min for Walt's iPhone","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"icloud_set_interval","data":"{\"device_name\":\"your-email-addresssiphone\",\"interval\":\"1\"}","x":1760,"y":40,"wires":[[]]},{"id":"b336063f.1c3558","type":"api-call-service","z":"6991cee1.63833","name":"Set tracking interval to 1min for Wife's iPhone","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"icloud_set_interval","data":"{\"device_name\":\"wifesiphone\",\"interval\":\"1\"}","x":1760,"y":100,"wires":[[]]},{"id":"22414b30.cb6a34","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Toggle stairs","server":"5a92f1da.a8503","service_domain":"light","service":"toggle","data":"{\"entity_id\":\"light.stairs\"}","mergecontext":"","x":690,"y":80,"wires":[["57f4dff4.e9d77"]]},{"id":"8f95243e.34ae08","type":"inject","z":"bfbb9b56.a1ffa8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":80,"wires":[["9478a8df.fe90e8"]]},{"id":"57f4dff4.e9d77","type":"debug","z":"bfbb9b56.a1ffa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","x":910,"y":80,"wires":[]},{"id":"9f27308e.ee279","type":"debug","z":"bfbb9b56.a1ffa8","name":"Entry","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","x":590,"y":240,"wires":[]},{"id":"64966159.273e7","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Toggle entry","server":"5a92f1da.a8503","version":0,"service_domain":"light","service":"toggle","data":"{\"entity_id\":\"light.entry\"}","mergecontext":"","x":350,"y":80,"wires":[["22414b30.cb6a34","9f27308e.ee279"]]},{"id":"9478a8df.fe90e8","type":"api-get-history","z":"bfbb9b56.a1ffa8","name":"History test","server":"5a92f1da.a8503","startdate":"2018-02-19T10:00+00:00","x":230,"y":160,"wires":[["6e4dbf3d.d7d01"]]},{"id":"6e4dbf3d.d7d01","type":"debug","z":"bfbb9b56.a1ffa8","name":"History","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","x":400,"y":240,"wires":[]},{"id":"1666efd9.90a38","type":"switch","z":"736c12c5.92637c","name":"Offline for 4 hours","property":"payload.timeSinceChangedMs","propertyType":"msg","rules":[{"v":"14400000","t":"gt","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":720,"wires":[["6df3de45.989dd"]]},{"id":"af3a87ae.749c28","type":"switch","z":"736c12c5.92637c","name":"Offline","property":"payload.data.state","propertyType":"msg","rules":[{"v":"not_home","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":720,"wires":[["1666efd9.90a38"]]},{"id":"e04a36b2.4bba48","type":"function","z":"736c12c5.92637c","name":"Format message","func":"device      = msg.topic.replace(/^.*\\.(.*)/, '$1');\nmsg.payload = { data: {'message': device + ' has been offline for four hours','name':'Node-Red' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":740,"wires":[["c3a85d07.d4381"]]},{"id":"6df3de45.989dd","type":"delay","z":"736c12c5.92637c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":770,"y":720,"wires":[["e04a36b2.4bba48","641406d9.54c868"]]},{"id":"2d905341.266a8c","type":"api-call-service","z":"736c12c5.92637c","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ }","mergecontext":"","x":1210,"y":700,"wires":[[]]},{"id":"c3a85d07.d4381","type":"api-call-service","z":"736c12c5.92637c","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"","mergecontext":"","x":1220,"y":740,"wires":[[]]},{"id":"4dce2548.9eea2c","type":"poll-state","z":"f89ee080.71ad2","name":"Family Room Mini","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.familyroommini","outputs":1,"x":110,"y":2240,"wires":[["bebd9723.d91698"]]},{"id":"62b84fda.5a292","type":"poll-state","z":"f89ee080.71ad2","name":"Kitchen Mini","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.kitchenmini","outputs":1,"x":90,"y":2280,"wires":[["7d8a6b43.a230b4"]]},{"id":"bebd9723.d91698","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2240,"wires":[]},{"id":"7d8a6b43.a230b4","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2280,"wires":[]},{"id":"c49f5e0f.8ce87","type":"poll-state","z":"f89ee080.71ad2","name":"Son1 Humidifier","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.haydenhumidifier","outputs":1,"x":110,"y":2320,"wires":[["3e5eef5f.cdbd1"]]},{"id":"663661be.dfda3","type":"poll-state","z":"f89ee080.71ad2","name":"Master Humidifier","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.masterhumidifier","outputs":1,"x":110,"y":2360,"wires":[["f7e706c7.4e6458"]]},{"id":"9382d662.c3ee58","type":"poll-state","z":"f89ee080.71ad2","name":"Orbi Satellite","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.howdorbisat1","outputs":1,"x":90,"y":2400,"wires":[["efbfd84c.1cea88"]]},{"id":"3bc22f9d.b2034","type":"poll-state","z":"f89ee080.71ad2","name":"Nest Thermostat","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.nestthermostat","outputs":1,"x":100,"y":2440,"wires":[["975fe23.50e372"]]},{"id":"aa1a8605.0a3d18","type":"poll-state","z":"f89ee080.71ad2","name":"Garage Opener","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.garageopener","outputs":1,"x":100,"y":2480,"wires":[["61a9910f.65de7"]]},{"id":"3e5eef5f.cdbd1","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2320,"wires":[]},{"id":"f7e706c7.4e6458","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2360,"wires":[]},{"id":"efbfd84c.1cea88","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2400,"wires":[]},{"id":"975fe23.50e372","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2440,"wires":[]},{"id":"61a9910f.65de7","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2480,"wires":[]},{"id":"d2a65775.2171f8","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2520,"wires":[]},{"id":"1eb26f5c.5d2eb1","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2560,"wires":[]},{"id":"372ba7f7.48c7f8","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2600,"wires":[]},{"id":"47d93add.39f424","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2640,"wires":[]},{"id":"85248dec.272cc","type":"subflow:736c12c5.92637c","z":"f89ee080.71ad2","name":"","x":600,"y":2680,"wires":[]},{"id":"355a53f0.19b0ac","type":"poll-state","z":"f89ee080.71ad2","name":"Son2s Lamp","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.colinslamp","outputs":1,"x":90,"y":2520,"wires":[["d2a65775.2171f8"]]},{"id":"dc30acd8.c0252","type":"poll-state","z":"f89ee080.71ad2","name":"Family Room Floor Lamp","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.familyroomfloorlamp","outputs":1,"x":130,"y":2560,"wires":[["1eb26f5c.5d2eb1"]]},{"id":"f9aedc21.8f004","type":"poll-state","z":"f89ee080.71ad2","name":"Family Room Lamp","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.familyroomlamp","outputs":1,"x":110,"y":2600,"wires":[["372ba7f7.48c7f8"]]},{"id":"575486e6.3e7548","type":"poll-state","z":"f89ee080.71ad2","name":"Living Room Lamp","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.livingroomlamps","outputs":1,"x":110,"y":2640,"wires":[["47d93add.39f424"]]},{"id":"33f2c53a.dd9e5a","type":"poll-state","z":"f89ee080.71ad2","name":"Office Lamps","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"device_tracker.officelamps","outputs":1,"x":90,"y":2680,"wires":[["85248dec.272cc"]]},{"id":"c2a0254c.4a0968","type":"comment","z":"f89ee080.71ad2","name":"Report if any network devices are offline","info":"","x":170,"y":2200,"wires":[]},{"id":"ffbe3.bab6141d8","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Current house temperature","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"climate.hallway_nest","x":360,"y":120,"wires":[["8331e59e.073128"]]},{"id":"4dfb091f.5b72b8","type":"inject","z":"a3edbf89.1b4e7","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":660,"wires":[["ffbe3.bab6141d8","2971377a.bb41e8","caa3350.7e4b0c8","d3a80f5.89136f","5de24ad8.918a14","6935bb0c.171d14","3576250c.d2523a","9f303b42.cc0598","da0affc8.1a417","8d284cd7.e7ba5","5879318b.c045f","97b610a0.42098","9599bd47.5950a","10dba9ba.6f43c6","4b93e51b.f9f56c","14537f69.303101","6394508f.9a37a","ac9af9d5.0876d8","93dff740.797d68","686c43b1.34cf0c","6175ce24.9bd1a","9605a5b7.15eb48","d69a712e.b3bb7","e4225b0e.877948"]]},{"id":"8331e59e.073128","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"p":"payload","to":"data.attributes.current_temperature","pt":"msg","t":"set","tot":"msg"},{"p":"topic","pt":"msg","to":"Inside Temp (F)","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":120,"wires":[["16b2c1b1.d9e21e"]]},{"id":"16b2c1b1.d9e21e","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"fd6b3884.0b6fb8","order":1,"width":"0","height":"0","label":"Temperature","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":930,"y":280,"wires":[[],[]]},{"id":"2971377a.bb41e8","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Outside temperature","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.dark_sky_temperature","x":380,"y":160,"wires":[["7df35484.e387ec"]]},{"id":"7df35484.e387ec","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"tot":"str","t":"set","p":"topic","to":"Outside Temp (F)","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":160,"wires":[["16b2c1b1.d9e21e"]]},{"id":"adbf2ff2.cd0d7","type":"inject","z":"a3edbf89.1b4e7","name":"Clear chart","topic":"","payload":"[ ]","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":2420,"wires":[["6d033ae.31716c4"]]},{"id":"6d033ae.31716c4","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"jsonata","pt":"msg","to":"[ ]","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":2420,"wires":[[]]},{"id":"caa3350.7e4b0c8","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Garage temperature","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.garage_motion_sensor_temperature","x":380,"y":200,"wires":[["7bdbaee3.c77ac"]]},{"id":"7bdbaee3.c77ac","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"to":"Garage Temp (F)","pt":"msg","p":"topic","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":200,"wires":[["16b2c1b1.d9e21e"]]},{"id":"d3a80f5.89136f","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Stairs temperature","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.garage_stairs_motion_sensor_temperature","x":390,"y":240,"wires":[["a95011bf.b8b9a"]]},{"id":"a95011bf.b8b9a","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"p":"topic","to":"Stairs Temp (F)","pt":"msg","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":240,"wires":[["16b2c1b1.d9e21e"]]},{"id":"9f45f676.bf2448","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":1,"width":"2","height":"2","gtype":"gage","title":"Fletcher's Phone Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":970,"y":360,"wires":[]},{"id":"5de24ad8.918a14","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Fletcher's phone battery","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.fletchers_iphone_battery_level_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":390,"y":360,"wires":[["b117aee7.afce5"]]},{"id":"b117aee7.afce5","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Fletcher's iPhone 8 Battery","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":360,"wires":[["9f45f676.bf2448"]]},{"id":"6935bb0c.171d14","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Wife's phone battery","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.battery_kk_s8","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":380,"y":400,"wires":[["5e95ad0e.111424"]]},{"id":"5e95ad0e.111424","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"Karien's Samsung S8 Battery","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":400,"wires":[["ede035b4.9290a8"]]},{"id":"ede035b4.9290a8","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":3,"width":"2","height":"2","gtype":"gage","title":"Karien's Phone Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":960,"y":400,"wires":[]},{"id":"3576250c.d2523a","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Stairs Door Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.stairs_door","x":390,"y":440,"wires":[["d6c66b33.4425a8"]]},{"id":"b739ba8.c05b148","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":6,"width":"1","height":"1","gtype":"gage","title":"Stairs Door Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":950,"y":440,"wires":[]},{"id":"9f303b42.cc0598","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Screened Porch Door Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.screened_porch_door","x":360,"y":480,"wires":[["ef36ae0d.e83ea"]]},{"id":"fadb68dd.362908","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":7,"width":"1","height":"1","gtype":"gage","title":"Screened Porch Door Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":980,"y":480,"wires":[]},{"id":"d6c66b33.4425a8","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"pt":"msg","to":"data.attributes.battery_level","p":"payload","tot":"msg","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":440,"wires":[["b739ba8.c05b148"]]},{"id":"ef36ae0d.e83ea","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"tot":"msg","t":"set","pt":"msg","to":"data.attributes.battery_level","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":480,"wires":[["fadb68dd.362908"]]},{"id":"da0affc8.1a417","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Network Gear Switch","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.network_gear","x":380,"y":1200,"wires":[["fef84cc8.e5603"]]},{"id":"63dfd0ae.6357c","type":"change","z":"3289c817.6b0be8","name":"sentCnt","rules":[{"t":"set","tot":"msg","p":"payload","pt":"msg","to":"data.attributes.sentCnt"},{"p":"topic","to":"Sent Count","pt":"msg","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":560,"wires":[["aa4f4875.585f78"]]},{"id":"8a721267.c451e","type":"change","z":"3289c817.6b0be8","name":"sentFailed","rules":[{"t":"set","tot":"msg","p":"payload","to":"data.attributes.sentFailed","pt":"msg"},{"p":"topic","pt":"msg","to":"Sent Failed","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":600,"wires":[["aa4f4875.585f78"]]},{"id":"114bc1f2.bba3ce","type":"change","z":"3289c817.6b0be8","name":"retries","rules":[{"tot":"msg","t":"set","p":"payload","pt":"msg","to":"data.attributes.retries"},{"t":"set","tot":"str","pt":"msg","to":"Retries","p":"topic"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":640,"wires":[["aa4f4875.585f78"]]},{"id":"58c97388.89119c","type":"change","z":"3289c817.6b0be8","name":"receivedCnt","rules":[{"t":"set","tot":"msg","p":"payload","pt":"msg","to":"data.attributes.receivedCnt"},{"t":"set","tot":"str","p":"topic","to":"Received Count","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":680,"wires":[["aa4f4875.585f78"]]},{"id":"28afcac3.3208f6","type":"change","z":"3289c817.6b0be8","name":"receivedDups","rules":[{"pt":"msg","to":"data.attributes.receivedDups","p":"payload","tot":"msg","t":"set"},{"p":"topic","to":"Received Duplicates","pt":"msg","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":720,"wires":[["aa4f4875.585f78"]]},{"id":"d5696fb.52d869","type":"change","z":"3289c817.6b0be8","name":"receivedUnsolicited","rules":[{"t":"set","tot":"msg","p":"payload","pt":"msg","to":"data.attributes.receivedUnsolicited"},{"tot":"str","t":"set","p":"topic","to":"Received Unsolicited","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":760,"wires":[["aa4f4875.585f78"]]},{"id":"226e2610.0c636a","type":"change","z":"3289c817.6b0be8","name":"lastRequestRTT","rules":[{"tot":"msg","t":"set","pt":"msg","to":"data.attributes.lastRequestRTT","p":"payload"},{"p":"topic","to":"Last Request RTT","pt":"msg","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":800,"wires":[["aa4f4875.585f78"]]},{"id":"68fa8490.1b4d4c","type":"change","z":"3289c817.6b0be8","name":"averageRequestRTT","rules":[{"p":"payload","to":"data.attributes.averageRequestRTT","pt":"msg","tot":"msg","t":"set"},{"tot":"str","t":"set","pt":"msg","to":"Average Request RTT","p":"topic"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":840,"wires":[["aa4f4875.585f78"]]},{"id":"638ee852.d15018","type":"change","z":"3289c817.6b0be8","name":"lastResponseRTT","rules":[{"tot":"msg","t":"set","p":"payload","pt":"msg","to":"data.attributes.lastResponseRTT"},{"p":"topic","pt":"msg","to":"Last Response RTT","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":880,"wires":[["aa4f4875.585f78"]]},{"id":"eb67a7c0.3c35c8","type":"change","z":"3289c817.6b0be8","name":"averageResponseRTT","rules":[{"t":"set","tot":"msg","pt":"msg","to":"data.attributes.averageResponseRTT","p":"payload"},{"tot":"str","t":"set","p":"topic","to":"Average Response RTT","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":920,"wires":[["aa4f4875.585f78"]]},{"id":"df5e90b.2bcfb7","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Network Gear Switch","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":1200,"wires":[[],[]]},{"id":"8d284cd7.e7ba5","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Stairs Motion Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.garage_stairs_motion_sensor","x":380,"y":520,"wires":[["5bd01bb6.c02c24","c0150ac6.5a65f8"]]},{"id":"5bd01bb6.c02c24","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"msg","p":"payload","to":"data.attributes.battery_level","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":520,"wires":[["a00b32ee.46129"]]},{"id":"a00b32ee.46129","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":8,"width":"1","height":"1","gtype":"gage","title":"Stairs Motion Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":960,"y":520,"wires":[]},{"id":"30c56597.0b9caa","type":"function","z":"3289c817.6b0be8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":720,"wires":[["63dfd0ae.6357c","8a721267.c451e","114bc1f2.bba3ce","58c97388.89119c","28afcac3.3208f6","d5696fb.52d869","226e2610.0c636a","68fa8490.1b4d4c","638ee852.d15018","eb67a7c0.3c35c8"]]},{"id":"aa4f4875.585f78","type":"function","z":"3289c817.6b0be8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":740,"wires":[[]]},{"id":"fef84cc8.e5603","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":1200,"wires":[["df5e90b.2bcfb7"]]},{"id":"5de02a13.502964","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":"6","height":"6","label":"Stairs Motion Sensor","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":560,"wires":[[],[]]},{"id":"c0150ac6.5a65f8","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":560,"wires":[["5de02a13.502964"]]},{"id":"5879318b.c045f","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Garage Motion Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.garage_motion_sensor","x":380,"y":600,"wires":[["9bbf2808.0affa8","fac068a8.146fe8"]]},{"id":"9bbf2808.0affa8","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"pt":"msg","to":"data.attributes.battery_level","p":"payload","t":"set","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":600,"wires":[["35788fee.4876b"]]},{"id":"35788fee.4876b","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":9,"width":"1","height":"1","gtype":"gage","title":"Garage Motion Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":960,"y":600,"wires":[]},{"id":"fac068a8.146fe8","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":640,"wires":[["229acbdb.21fc24"]]},{"id":"229acbdb.21fc24","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":"6","height":"6","label":"Garage Motion Sensor","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":640,"wires":[[],[]]},{"id":"97b610a0.42098","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Garage Entry Door South Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.garage_entry_door_south","x":340,"y":680,"wires":[["db096adc.70cce8","662a5ed0.88cd6"]]},{"id":"db096adc.70cce8","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"p":"payload","to":"data.attributes.battery_level","pt":"msg","t":"set","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":680,"wires":[["dad44f2c.fb51b"]]},{"id":"dad44f2c.fb51b","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":10,"width":"1","height":"1","gtype":"gage","title":"Garage Entry Door South","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":970,"y":680,"wires":[]},{"id":"662a5ed0.88cd6","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":720,"wires":[["50c48dd9.24c024"]]},{"id":"50c48dd9.24c024","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":"6","height":"6","label":"Garage Entry Door South","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":970,"y":720,"wires":[[],[]]},{"id":"9599bd47.5950a","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Garage Entry Door North Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.garage_entry_door_north","x":350,"y":760,"wires":[["6f89788.4492888","16009d0b.adfc53"]]},{"id":"6f89788.4492888","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"msg","p":"payload","to":"data.attributes.battery_level","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":760,"wires":[["cf4e97bf.9ddbf8"]]},{"id":"16009d0b.adfc53","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":800,"wires":[["35557b5.330dc84"]]},{"id":"cf4e97bf.9ddbf8","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":11,"width":"1","height":"1","gtype":"gage","title":"Garage Entry Door North","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":970,"y":760,"wires":[]},{"id":"35557b5.330dc84","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Garage Entry Door North","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":970,"y":800,"wires":[[],[]]},{"id":"10dba9ba.6f43c6","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Garage Door South TIlt Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.garage_door_south_tilt","x":350,"y":840,"wires":[["a557cf6e.0d197","bf91fc14.7bee5"]]},{"id":"a557cf6e.0d197","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"to":"data.attributes.battery_level","pt":"msg","p":"payload","t":"set","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":840,"wires":[["296bf468.3228ac"]]},{"id":"bf91fc14.7bee5","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":880,"wires":[["ef5ab6f3.529128"]]},{"id":"296bf468.3228ac","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":12,"width":"1","height":"1","gtype":"gage","title":"Garage Door South Tilt","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":960,"y":840,"wires":[]},{"id":"ef5ab6f3.529128","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Garage Door South Tilt","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":880,"wires":[[],[]]},{"id":"4b93e51b.f9f56c","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Garage Door South TIlt Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.garage_door_north_tilt","x":350,"y":920,"wires":[["5be66bff.02ee54","89275733.1c7c98"]]},{"id":"5be66bff.02ee54","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"to":"data.attributes.battery_level","pt":"msg","p":"payload","tot":"msg","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":920,"wires":[["6836e776.872f08"]]},{"id":"89275733.1c7c98","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":960,"wires":[["c8478a52.e44d78"]]},{"id":"6836e776.872f08","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":13,"width":"1","height":"1","gtype":"gage","title":"Garage Door North Tilt","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":960,"y":920,"wires":[]},{"id":"c8478a52.e44d78","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Garage Door North Tilt","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":960,"wires":[[],[]]},{"id":"14537f69.303101","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Front Porch Switch","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.front_door_switch","x":390,"y":1160,"wires":[["67233177.08315"]]},{"id":"67233177.08315","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":1160,"wires":[["43c99662.2ffa18"]]},{"id":"43c99662.2ffa18","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Front Porch Switch","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":950,"y":1160,"wires":[[],[]]},{"id":"6394508f.9a37a","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Front Door Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.front_door","x":390,"y":1000,"wires":[["650d6e8b.3c633","a16ed950.4e5958"]]},{"id":"650d6e8b.3c633","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"pt":"msg","to":"data.attributes.battery_level","p":"payload","tot":"msg","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1000,"wires":[["7b92588.ae278a8"]]},{"id":"a16ed950.4e5958","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":1040,"wires":[["417977d0.1c3758"]]},{"id":"7b92588.ae278a8","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":14,"width":"1","height":"1","gtype":"gage","title":"Front Door","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":930,"y":1000,"wires":[]},{"id":"417977d0.1c3758","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Front Door","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":930,"y":1040,"wires":[[],[]]},{"id":"ac9af9d5.0876d8","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Coffee Grinder Switch","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.coffee_grinder","x":380,"y":1240,"wires":[["76fc8736.c80358"]]},{"id":"76fc8736.c80358","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":1240,"wires":[["4525c73f.428418"]]},{"id":"4525c73f.428418","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Coffee Grinder Switch","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":1240,"wires":[[],[]]},{"id":"93dff740.797d68","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Basement Dehumidifier Switch","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.basement_dehumidifier","x":350,"y":1280,"wires":[["f8b4165c.a3e6d8"]]},{"id":"f8b4165c.a3e6d8","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":1280,"wires":[["48969048.b1f31"]]},{"id":"48969048.b1f31","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Basement Dehumidifier Switch","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":990,"y":1280,"wires":[[],[]]},{"id":"686c43b1.34cf0c","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Basement Back Door Sensor","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"zwave.basement_back_door","x":360,"y":1080,"wires":[["6c5e3699.dd8bd8","d7b113a7.2f18"]]},{"id":"6c5e3699.dd8bd8","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"msg","p":"payload","pt":"msg","to":"data.attributes.battery_level"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1080,"wires":[["5caee08e.d598c"]]},{"id":"d7b113a7.2f18","type":"subflow:3289c817.6b0be8","z":"a3edbf89.1b4e7","name":"","x":590,"y":1120,"wires":[["2c25b55b.c67afa"]]},{"id":"5caee08e.d598c","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":15,"width":"1","height":"1","gtype":"gage","title":"Basement Back Door","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":960,"y":1080,"wires":[]},{"id":"2c25b55b.c67afa","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"a6578627.d6e238","order":0,"width":0,"height":0,"label":"Basement Back Door","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":960,"y":1120,"wires":[[],[]]},{"id":"6175ce24.9bd1a","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Network Gear Switch Power","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.network_gear_voltage","x":360,"y":1320,"wires":[["50a4fd50.593584","c7f2b995.154938"]]},{"id":"9605a5b7.15eb48","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Coffee Grinder Switch Power","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"switch.coffee_grinder_switch","x":360,"y":1400,"wires":[["e6095e41.6ac29"]]},{"id":"50a4fd50.593584","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"p":"payload","to":"data.attributes.power_consumption","pt":"msg","t":"set","tot":"msg"},{"tot":"str","t":"set","p":"topic","pt":"msg","to":"Network Gear Power Consumption"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1320,"wires":[["f5d8374.d1989c8"]]},{"id":"e6095e41.6ac29","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"p":"payload","to":"data.attributes.power_consumption","pt":"msg","tot":"msg","t":"set"},{"p":"topic","pt":"msg","to":"Coffee Grinder Power Consumption","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1400,"wires":[["2c1a1d8.274eee2"]]},{"id":"f5d8374.d1989c8","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"fd6b3884.0b6fb8","order":3,"width":"6","height":"6","label":"Network Gear Power Consumption","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":1000,"y":1320,"wires":[[],[]]},{"id":"2c1a1d8.274eee2","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"fd6b3884.0b6fb8","order":5,"width":"6","height":"6","label":"Coffee Grinder Power Consumption","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":1000,"y":1400,"wires":[[],[]]},{"id":"c7f2b995.154938","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"str","p":"topic","to":"Network Gear Input Voltage","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1360,"wires":[["862dc286.b7431"]]},{"id":"862dc286.b7431","type":"ui_chart","z":"a3edbf89.1b4e7","name":"","group":"fd6b3884.0b6fb8","order":4,"width":"6","height":"6","label":"Home Input Voltage","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":950,"y":1360,"wires":[[],[]]},{"id":"d69a712e.b3bb7","type":"api-current-state","z":"a3edbf89.1b4e7","name":"iPad battery","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.howd_ipad_air_battery_level","x":350,"y":320,"wires":[["3559f6cc.a7801a"]]},{"id":"3559f6cc.a7801a","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"str","pt":"msg","to":"iPad Air Battery","p":"topic"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":320,"wires":[["4b5b0d51.e69ba4"]]},{"id":"4b5b0d51.e69ba4","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"65d76e91.9f04f","order":5,"width":"2","height":"2","gtype":"gage","title":"iPad Battery","label":"pct","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#80ff00"],"seg1":"","seg2":"","x":930,"y":320,"wires":[]},{"id":"ee6d1120.f13e4","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Temperature Set point","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.hallway_thermostat_nest_target","x":380,"y":280,"wires":[["8d7ab651.0c7648"]]},{"id":"8d7ab651.0c7648","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"tot":"str","t":"set","p":"topic","pt":"msg","to":"HVAC Set point (F)"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":280,"wires":[["16b2c1b1.d9e21e"]]},{"id":"e4225b0e.877948","type":"api-current-state","z":"a3edbf89.1b4e7","name":"Current house humidity","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.hallway_thermostat_nest_humidity","x":370,"y":80,"wires":[["e50f9518.c98a08"]]},{"id":"e50f9518.c98a08","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"t":"set","tot":"str","pt":"msg","to":"Inside Humidity (%)","p":"topic"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":80,"wires":[["a2e0d347.f75b2"]]},{"id":"a2e0d347.f75b2","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"","group":"fd6b3884.0b6fb8","order":2,"width":0,"height":0,"gtype":"gage","title":"Inside Humidity","label":"percent","format":"{{value}}","min":0,"max":"100","colors":["#ffff00","#80ff00","#ffff00"],"seg1":"20","seg2":"80","x":940,"y":240,"wires":[]},{"id":"22a28ecb.793402","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Set Walt Home","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"see","data":"{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"home\"}","mergecontext":"","x":1040,"y":240,"wires":[[]]},{"id":"7064d3e0.dd37ac","type":"inject","z":"bfbb9b56.a1ffa8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":240,"wires":[["22a28ecb.793402"]]},{"id":"7fb55e5b.669eb","type":"inject","z":"bfbb9b56.a1ffa8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":820,"y":300,"wires":[["593596ae.6f0428","e2f4e766.122428"]]},{"id":"593596ae.6f0428","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Set Walt Not Home","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"see","data":"{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"not_home\"}","mergecontext":"","x":1050,"y":280,"wires":[[]]},{"id":"caac77d8.8eac78","type":"comment","z":"6991cee1.63833","name":"Disabled iCloud2 tracking","info":"Underyling library tracks all devies, hoping they fix it:\n\nhttps://github.com/picklepete/pyicloud/issues/142\n","x":1210,"y":20,"wires":[]},{"id":"9aa23412.dc96f8","type":"function","z":"6991cee1.63833","name":"Switch user","func":"if(msg.person == \"walt\") {\n    return[ msg, null ];\n} else if(msg.person == \"wife\") {\n    return[ null, msg ];\n}","outputs":"2","noerr":0,"x":1350,"y":220,"wires":[[],["17d30960.22a587"]],"outputLabels":["walt","wife"]},{"id":"e2f4e766.122428","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Set Walt Wifi Not Home","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"see","data":"{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}","mergecontext":"","x":1070,"y":320,"wires":[[]]},{"id":"3ed73a8d.c4d496","type":"delay","z":"5217c125.f919f","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":140,"y":520,"wires":[["490c3f41.ac704","6a31486d.505a18","7411ecc0.247eb4","c3f10bd6.6652b8"]]},{"id":"ef68b066.a69e7","type":"delay","z":"ccf6acb1.0f2c9","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":100,"wires":[["25ffc1b3.0463fe","c1e860b.aae71a","52b4125a.23497c"]]},{"id":"1b7ae196.6e8c4e","type":"delay","z":"6b84347a.0dfbcc","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":180,"y":180,"wires":[["e9f14699.e36a48","d973527d.626d2","1d7c12f9.ac39ed"]]},{"id":"8cd5c8f2.02f048","type":"switch","z":"f89ee080.71ad2","name":"Zigbee light failure","property":"payload","propertyType":"msg","rules":[{"t":"regex","case":false,"vt":"str","v":"^\\d{4}-\\d{2}-\\d{2}.\\d{2}:\\d{2}:\\d{2}.ERROR..MainThread...homeassistant.core..Error executing service..ServiceCall light.turn.*entity_id...light."}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":1940,"wires":[["b7e1f3a.977d31","ce868e92.8bae8"]]},{"id":"b7e1f3a.977d31","type":"debug","z":"f89ee080.71ad2","name":"Zigbee failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":680,"y":1860,"wires":[]},{"id":"ce868e92.8bae8","type":"function","z":"f89ee080.71ad2","name":"Split","func":"var outputMsgs      = [];\ndomain              = 'light';\nservice             = msg.payload.replace(/.*ServiceCall.light.(.*?):.*/, '$1');\nlights              = msg.payload.split(',');\nlight_check         = /^light\\./;\n\n\nfor (var w in lights) {\n    light           = lights[w].replace(/.*(light.*)\\'.*/, '$1');\n    \n    if(light_check.test(light)) {\n        ha_service_call = {payload: {'domain':domain,'service':service, data: {'entity_id':light} } };\n        \n        brightness_check    = /brightness/g;\n        transition_check    = /transition/g;\n        color_temp_check    = /color_temp/g;\n        number_check        = /^\\d+$/;\n        number_with_dec     = /^\\d+\\.\\d+$/;\n\n        if (brightness_check.test(msg.payload)) {\n            brightness      = msg.payload.replace(/.*brightness.(.*?)[,|>].*/, '$1');\n            \n            if (number_check.test(brightness)) {\n                ha_service_call.payload.data.brightness = brightness;\n            }\n        }\n\n        if (transition_check.test(msg.payload)) {\n            transition      = msg.payload.replace(/.*transition.(.*?)[,|>].*/, '$1');\n            \n            if(number_with_dec.test(transition)) {\n                ha_service_call.payload.data.transition = transition;\n            }\n        }\n        \n        if (color_temp_check.test(msg.payload)) {\n            color_temp      = msg.payload.replace(/.*color_temp.(.*?)[,|>].*/, '$1');\n            \n            if (number_check.test(color_temp)) {\n                ha_service_call.payload.data.color_temp = color_temp;\n            }\n        }        \n        \n        outputMsgs.push(ha_service_call);\n    }\n}\nreturn [ outputMsgs ];","outputs":1,"noerr":0,"x":770,"y":1940,"wires":[["1bffa89e.fa39f7"]]},{"id":"88f61c9a.94e9d","type":"api-call-service","z":"f89ee080.71ad2","name":"Retry Zigbee Errors","server":"5a92f1da.a8503","service_domain":"","service":"","data":"","mergecontext":"","x":1990,"y":1900,"wires":[[]]},{"id":"fb33437a.8cb19","type":"debug","z":"f89ee080.71ad2","name":"Retry Zigbee errors","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1990,"y":1860,"wires":[]},{"id":"ded5cfd.428823","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1770,"y":1900,"wires":[["fb33437a.8cb19","88f61c9a.94e9d"]]},{"id":"4b8a3d7b.5d28e4","type":"function","z":"f89ee080.71ad2","name":"Format message","func":"msg.payload = { data: {'message': 'Hey guys, no school tomorrow!' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":760,"wires":[["9d32cfb7.0de75"]]},{"id":"9d32cfb7.0de75","type":"subflow:2c797f21.c25cb","z":"f89ee080.71ad2","x":1290,"y":760,"wires":[[],[]]},{"id":"56b8f900.aa0868","type":"api-current-state","z":"f89ee080.71ad2","name":"If family not sleeping","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"binary_sensor.family_sleeping","x":900,"y":760,"wires":[["4b8a3d7b.5d28e4"]]},{"id":"fe1f386b.2cb6d8","type":"time-range-switch","z":"153e4bbb.7f4624","name":"7AM to 9AM","lat":"","lon":"","startTime":"07:00","endTime":"9:00","startOffset":0,"endOffset":0,"x":1030,"y":600,"wires":[["9b19790.11a0a88"],[]]},{"id":"9c4f386a.350b98","type":"api-call-service","z":"153e4bbb.7f4624","name":"Open Garage Door South","server":"5a92f1da.a8503","service_domain":"cover","service":"open_cover","data":"{ \"entity_id\":\"cover.garage_door_south\"}","mergecontext":"","x":1330,"y":660,"wires":[[]]},{"id":"edf5931f.5d4e9","type":"api-current-state","z":"153e4bbb.7f4624","name":"Garage door south already open?","server":"5a92f1da.a8503","outputs":1,"halt_if":"255","entity_id":"sensor.garage_door_south_tilt_alarm_level","x":1360,"y":580,"wires":[["23c9caa5.c2e896"]]},{"id":"23c9caa5.c2e896","type":"api-current-state","z":"153e4bbb.7f4624","name":"Garage motion active?","server":"5a92f1da.a8503","outputs":1,"halt_if":"255","entity_id":"sensor.garage_motion_sensor_alarm_level","x":1320,"y":620,"wires":[["9c4f386a.350b98","ad4d5067.3fd13"]]},{"id":"9b19790.11a0a88","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1300,"y":540,"wires":[["edf5931f.5d4e9"]]},{"id":"e5eb0f9f.40a4","type":"poll-state","z":"bfbb9b56.a1ffa8","name":"Garage Door South","server":"5a92f1da.a8503","updateinterval":"60","outputinitially":false,"outputonchanged":false,"entity_id":"cover.garage_door_south","outputs":1,"x":130,"y":380,"wires":[["c5d76053.55454"]]},{"id":"c5d76053.55454","type":"switch","z":"bfbb9b56.a1ffa8","name":"","property":"payload","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"unavailable"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":380,"wires":[["549d62e9.ed9cac"]]},{"id":"549d62e9.ed9cac","type":"delay","z":"bfbb9b56.a1ffa8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"6","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":380,"wires":[["5f13f79d.546728"]]},{"id":"5f13f79d.546728","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"Garage door opener unavailable\"}","mergecontext":"","x":670,"y":380,"wires":[[]]},{"id":"c1286795.8cc5f8","type":"comment","z":"bfbb9b56.a1ffa8","name":"Troubleshooting Garage door opener going unavailable","info":"","x":220,"y":340,"wires":[]},{"id":"ad4d5067.3fd13","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Opening garage door south\" }","mergecontext":"","x":1300,"y":700,"wires":[[]]},{"id":"e81b6909.14b658","type":"comment","z":"bfbb9b56.a1ffa8","name":"Update Walt's location when Homekit switch is flipped","info":"","x":220,"y":460,"wires":[]},{"id":"19152eb9.6d5551","type":"server-state-changed","z":"bfbb9b56.a1ffa8","name":"Walt's Homekit Location","server":"5a92f1da.a8503","entityidfilter":"input_boolean.walt_homekit","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":150,"y":500,"wires":[["7492cb0b.c555a4"]]},{"id":"7492cb0b.c555a4","type":"switch","z":"bfbb9b56.a1ffa8","name":"","property":"payload","propertyType":"msg","rules":[{"v":"on","vt":"str","t":"eq"},{"v":"off","vt":"str","t":"eq"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":500,"wires":[["7b1f502d.b5e73","5ba5a97c.89a4f8"],["f5bbe02.9cea32","e90cc13a.a71da","f752b48b.ffb858"]],"outputLabels":["home","away"]},{"id":"7b1f502d.b5e73","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Set Walt Home","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"see","data":"{\"entity_id\":\"walts_iphone\",\"dev_id\":\"walts_iphone\",\"location_name\":\"home\"}","mergecontext":"","x":600,"y":480,"wires":[[]]},{"id":"f5bbe02.9cea32","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Set Walt Not Home","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"see","data":"{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}","mergecontext":"","x":610,"y":520,"wires":[[]]},{"id":"e90cc13a.a71da","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Set Walt Wifi Not Home","server":"5a92f1da.a8503","service_domain":"device_tracker","service":"see","data":"{\"entity_id\":\"walt_phone_home_wifi\",\"dev_id\":\"walt_phone_home_wifi\",\"location_name\":\"not_home\"}","mergecontext":"","x":630,"y":560,"wires":[[]]},{"id":"5ba5a97c.89a4f8","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"Homekit marked you as home\"}","mergecontext":"","x":590,"y":440,"wires":[[]]},{"id":"f752b48b.ffb858","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"Homekit marked you as away\"}","mergecontext":"","x":590,"y":600,"wires":[[]]},{"id":"9fe89066.9fcf1","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Turn on coffee grinder\" }","mergecontext":"","x":740,"y":1060,"wires":[[]]},{"id":"ee49790d.f889b8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Turn off coffee grinder\" }","mergecontext":"","x":740,"y":1180,"wires":[[]]},{"id":"10116cc4.516913","type":"server-state-changed","z":"bfbb9b56.a1ffa8","name":"Master Bath Motion Sensor","server":"5a92f1da.a8503","entityidfilter":"sensor.master_bathroom_motion_sensor","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":140,"y":660,"wires":[["fb6a6a0a.689768"]]},{"id":"fb6a6a0a.689768","type":"switch","z":"bfbb9b56.a1ffa8","name":"","property":"payload","propertyType":"msg","rules":[{"v":"motion detected","t":"eq","vt":"str"},{"v":"standby","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":660,"wires":[["75ae913e.36165","9fc778d1.965828"],["75ae913e.36165"]],"outputLabels":["motion","standby"]},{"id":"75ae913e.36165","type":"stoptimer","z":"bfbb9b56.a1ffa8","duration":"10","units":"Minute","payloadtype":"num","payloadval":"0","name":"10min","x":570,"y":720,"wires":[["64da38c.513a0c8"],[]]},{"id":"eba41eca.d5a0e","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Turn on living room lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.living_room\"}","mergecontext":"","x":1050,"y":660,"wires":[[]]},{"id":"705031dd.4591f","type":"api-call-service","z":"bfbb9b56.a1ffa8","name":"Turn off living room lights","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.living_room\"}","mergecontext":"","x":1050,"y":700,"wires":[[]]},{"id":"3f1b0b4a.9fb864","type":"server-state-changed","z":"bfbb9b56.a1ffa8","name":"Living room lights on","server":"5a92f1da.a8503","entityidfilter":"light.living_room","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":110,"y":720,"wires":[["75ae913e.36165"]]},{"id":"74039d5.c5aac64","type":"comment","z":"bfbb9b56.a1ffa8","name":"Testing Bruh multisensor","info":"","x":130,"y":620,"wires":[]},{"id":"1bffa89e.fa39f7","type":"counter","z":"f89ee080.71ad2","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":960,"y":1940,"wires":[["ca7147ad.d34028","a95181aa.3472f"]]},{"id":"ca7147ad.d34028","type":"stoptimer","z":"f89ee080.71ad2","duration":"30","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1130,"y":1860,"wires":[["b7ce1acc.c96bf8"],[]]},{"id":"b7ce1acc.c96bf8","type":"change","z":"f89ee080.71ad2","name":"Reset counter and stop timer","rules":[{"tot":"str","t":"set","p":"reset","pt":"msg","to":"true"},{"p":"payload","pt":"msg","to":"stop","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":1780,"wires":[["1bffa89e.fa39f7","ca7147ad.d34028"]]},{"id":"a95181aa.3472f","type":"switch","z":"f89ee080.71ad2","name":"Stop after 50","property":"count","propertyType":"msg","rules":[{"vt":"num","t":"lt","v":"50"},{"v2t":"num","v2":"59","v":"51","t":"btwn","vt":"num"},{"t":"gte","vt":"num","v":"60"}],"checkall":"true","repair":false,"outputs":3,"x":1150,"y":1920,"wires":[["fba44186.c129c"],["311e5f8e.d3127","fba44186.c129c"],["841bdb35.848288"]]},{"id":"841bdb35.848288","type":"function","z":"f89ee080.71ad2","name":"Format template","func":"entity_id       = msg.payload.data.entity_id;\nmsg.template    = '{{ states.' + entity_id + '.attributes.friendly_name }}';\nreturn msg;","outputs":1,"noerr":0,"x":1360,"y":1940,"wires":[["b709c4d.6a30038"]]},{"id":"b709c4d.6a30038","type":"api-render-template","z":"f89ee080.71ad2","name":"Get friendly name","server":"5a92f1da.a8503","template":"","x":1550,"y":1940,"wires":[["58363faf.62488"]]},{"id":"58363faf.62488","type":"function","z":"f89ee080.71ad2","name":"Format message","func":"light        = msg.payload;\nmsg.payload = { data: {'message': light + ' has been failing to respond' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":1940,"wires":[["781d3391.d6291c"]]},{"id":"e88c7777.ad6dc8","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\": \"msg\" }","mergecontext":"","x":2050,"y":1940,"wires":[[]]},{"id":"781d3391.d6291c","type":"rbe","z":"f89ee080.71ad2","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1910,"y":1940,"wires":[["e88c7777.ad6dc8","3eb79978.b829a6"]]},{"id":"fd5198db.83d738","type":"subflow:2c797f21.c25cb","z":"f89ee080.71ad2","name":"","x":2450,"y":1980,"wires":[[],[]]},{"id":"3eb79978.b829a6","type":"api-current-state","z":"f89ee080.71ad2","name":"If Guest Mode Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.guest_mode","x":2070,"y":1980,"wires":[["5238d254.8ce21c"]]},{"id":"64da38c.513a0c8","type":"api-current-state","z":"bfbb9b56.a1ffa8","name":"If Guest Mode Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.guest_mode","x":810,"y":700,"wires":[["705031dd.4591f"]]},{"id":"fba44186.c129c","type":"change","z":"f89ee080.71ad2","name":"","rules":[{"p":"reset","pt":"msg","t":"delete"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":1900,"wires":[["117301da.23c72e"]]},{"id":"117301da.23c72e","type":"switch","z":"f89ee080.71ad2","name":"Don't forward stops","property":"payload","propertyType":"msg","rules":[{"t":"neq","vt":"str","v":"stop"}],"checkall":"true","repair":false,"outputs":1,"x":1580,"y":1900,"wires":[["ded5cfd.428823"]]},{"id":"6aa46301.7c07fc","type":"api-current-state","z":"bfbb9b56.a1ffa8","name":"If Guest Mode Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.guest_mode","x":810,"y":660,"wires":[["eba41eca.d5a0e"]]},{"id":"5238d254.8ce21c","type":"api-current-state","z":"f89ee080.71ad2","name":"If Family Not in Bed","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"binary_sensor.family_in_bed","x":2270,"y":1980,"wires":[["fd5198db.83d738"]]},{"id":"a0ae71.7766419","type":"comment","z":"f89ee080.71ad2","name":"Convert MQTT Telemetry Messages to State","info":"","x":190,"y":540,"wires":[]},{"id":"f7b4954a.61cba8","type":"mqtt out","z":"f89ee080.71ad2","name":"Inject MQTT message","topic":"","qos":"","retain":"","broker":"aea3d1f8.3aa12","x":960,"y":480,"wires":[]},{"id":"f6e9b204.04fb6","type":"poll-state","z":"f89ee080.71ad2","name":"Garage Door North Tilt Sensor","server":"5a92f1da.a8503","updateinterval":"600","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.garage_door_north_tilt_alarm_level","outputs":1,"x":140,"y":460,"wires":[["7d7b5286.fbd8ac"]]},{"id":"c8ae5594.1e3638","type":"change","z":"f89ee080.71ad2","name":"Set to open","rules":[{"p":"topic","to":"garage/door/north/status","pt":"msg","t":"set","tot":"str"},{"t":"set","tot":"str","p":"payload","to":"open","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":420,"wires":[["f7b4954a.61cba8"]]},{"id":"7d7b5286.fbd8ac","type":"switch","z":"f89ee080.71ad2","name":"Open or closed","property":"payload.data.state","propertyType":"msg","rules":[{"t":"eq","vt":"num","v":"255"},{"v":"0","vt":"num","t":"eq"}],"checkall":"true","repair":false,"outputs":2,"x":400,"y":460,"wires":[["c8ae5594.1e3638"],["4718d7e6.53fb28"]],"outputLabels":["open","closed"]},{"id":"4718d7e6.53fb28","type":"change","z":"f89ee080.71ad2","name":"Set to closed","rules":[{"tot":"str","t":"set","p":"topic","to":"garage/door/north/status","pt":"msg"},{"t":"set","tot":"str","to":"closed","pt":"msg","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":460,"wires":[["f7b4954a.61cba8"]]},{"id":"19e73247.ef6cce","type":"poll-state","z":"f89ee080.71ad2","name":"Garage Door South Tilt Sensor","server":"5a92f1da.a8503","updateinterval":"600","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.garage_door_south_tilt_alarm_level","outputs":1,"x":150,"y":500,"wires":[["765efa51.cc0214"]]},{"id":"765efa51.cc0214","type":"switch","z":"f89ee080.71ad2","name":"Open or closed","property":"payload.data.state","propertyType":"msg","rules":[{"v":"255","vt":"num","t":"eq"},{"vt":"num","t":"eq","v":"0"}],"checkall":"true","repair":false,"outputs":2,"x":400,"y":500,"wires":[["82068fdb.fcd98"],["5ee63f56.1d7b6"]],"outputLabels":["open","closed"]},{"id":"82068fdb.fcd98","type":"change","z":"f89ee080.71ad2","name":"Set to open","rules":[{"to":"garage/door/south/status","pt":"msg","p":"topic","t":"set","tot":"str"},{"tot":"str","t":"set","p":"payload","pt":"msg","to":"open"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":500,"wires":[["f7b4954a.61cba8"]]},{"id":"5ee63f56.1d7b6","type":"change","z":"f89ee080.71ad2","name":"Set to closed","rules":[{"tot":"str","t":"set","to":"garage/door/south/status","pt":"msg","p":"topic"},{"p":"payload","pt":"msg","to":"closed","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":540,"wires":[["f7b4954a.61cba8"]]},{"id":"81fe3aa.f65a9c8","type":"comment","z":"f89ee080.71ad2","name":"Keep garage door opener state in sync with tilt sensors","info":"","x":220,"y":420,"wires":[]},{"id":"2b6b26fb.fa37ca","type":"api-call-service","z":"153e4bbb.7f4624","name":"Lock front door","server":"5a92f1da.a8503","service_domain":"lock","service":"lock","data":"{ \"entity_id\":\"lock.front_door\" }","mergecontext":"","x":1220,"y":2620,"wires":[[]]},{"id":"6c27e49f.3a390c","type":"api-call-service","z":"153e4bbb.7f4624","name":"Lock front door","server":"5a92f1da.a8503","service_domain":"lock","service":"lock","data":"{ \"entity_id\":\"lock.front_door\" }","mergecontext":"","x":1340,"y":2880,"wires":[[]]},{"id":"7f4a4a70.8e0d04","type":"function","z":"153e4bbb.7f4624","name":"Clear msg","func":"// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;","outputs":1,"noerr":0,"x":1160,"y":1320,"wires":[["f436bc07.a026d","aea62459.054578","b42e80cf.b8f0a"]]},{"id":"8e5e438.07a0fc","type":"function","z":"153e4bbb.7f4624","name":"Clear msg","func":"// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;","outputs":1,"noerr":0,"x":1160,"y":1440,"wires":[["cdbd55e6.c42aa8","184360a0.bc7fff","6871b62f.9fac58"]]},{"id":"cc432578.0d1e98","type":"trigger","z":"153e4bbb.7f4624","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","name":"Wait three seconds","x":1510,"y":1320,"wires":[["d84e7c39.f96fb"]]},{"id":"d84e7c39.f96fb","type":"api-call-service","z":"153e4bbb.7f4624","name":"Set color temperature","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"brightness\":\"1\", \"color_temp\":\"236\"}","mergecontext":"","x":1720,"y":1320,"wires":[[]]},{"id":"40a1ecaa.18ddb4","type":"trigger","z":"153e4bbb.7f4624","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","name":"Wait three seconds","x":1570,"y":1400,"wires":[["a75c7c7f.bfe49"]]},{"id":"a75c7c7f.bfe49","type":"api-call-service","z":"153e4bbb.7f4624","name":"Set color temperature","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.master_bedroom\", \"brightness\":\"1\", \"color_temp\":\"236\"}","mergecontext":"","x":1780,"y":1400,"wires":[[]]},{"id":"2c72f397.f1ae2c","type":"stoptimer","z":"f89ee080.71ad2","duration":"1","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":1500,"y":2180,"wires":[["dbb4642.9714f98"],[]]},{"id":"7543919.ee9297","type":"e-mail","z":"f89ee080.71ad2","server":"smtp.email.com","port":"465","secure":true,"name":"your-email-address@email.com","dname":"","x":2460,"y":2180,"wires":[]},{"id":"63503c91.8a76d4","type":"rbe","z":"f89ee080.71ad2","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1870,"y":2160,"wires":[["4e390455.2c2e7c"]]},{"id":"4e390455.2c2e7c","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2020,"y":2160,"wires":[["a10e9ff8.27665"]]},{"id":"dbb4642.9714f98","type":"change","z":"f89ee080.71ad2","name":"Format message","rules":[{"pt":"msg","to":"Nothing written to Home Assistant log file in the last minute. Is Home Assistant still working? Restarting Home Assistant. ","p":"payload","t":"set","tot":"str"},{"tot":"str","t":"set","p":"topic","to":"Home Assistant Log file not updating","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1690,"y":2180,"wires":[["63503c91.8a76d4"]]},{"id":"ce2aa51b.8362e8","type":"exec","z":"f89ee080.71ad2","command":"/Users/hass/.homeassistant/start.sh restart","addpay":false,"append":"","useSpawn":"false","timer":"60","oldrc":false,"name":"Restart Home Assistant","x":2670,"y":2120,"wires":[[],[],[]]},{"id":"82525084.0551f","type":"traffic","z":"f89ee080.71ad2","name":"","property_allow":"topic","filter_allow":"go","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"topic","filter_stop":"stop","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":1490,"y":2120,"wires":[["bde6f42b.f4c148","1b6e8a80.3820b6"]]},{"id":"744e6c70.f93174","type":"switch","z":"f89ee080.71ad2","name":"AssertionError","property":"payload","propertyType":"msg","rules":[{"case":false,"vt":"str","t":"regex","v":"^AssertionError"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":2060,"wires":[["82525084.0551f"]]},{"id":"311e5f8e.d3127","type":"change","z":"f89ee080.71ad2","name":"","rules":[{"tot":"str","t":"set","p":"topic","to":"go","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":2040,"wires":[["82525084.0551f","9921abb9.4a5418"]]},{"id":"9921abb9.4a5418","type":"stoptimer","z":"f89ee080.71ad2","duration":"1","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":1700,"y":2040,"wires":[["bde6f42b.f4c148"],[]]},{"id":"bde6f42b.f4c148","type":"change","z":"f89ee080.71ad2","name":"","rules":[{"tot":"str","t":"set","pt":"msg","to":"stop","p":"topic"}],"action":"","property":"","from":"","to":"","reg":false,"x":1920,"y":2040,"wires":[["82525084.0551f"]]},{"id":"1b6e8a80.3820b6","type":"change","z":"f89ee080.71ad2","name":"Format message","rules":[{"tot":"str","t":"set","pt":"msg","to":"50+ Zigbee errors and AssertionErrors logged. Restarting Home Assistant. ","p":"payload"},{"tot":"str","t":"set","pt":"msg","to":"Home Assistant Zigbee and AssertionErrors","p":"topic"}],"action":"","property":"","from":"","to":"","reg":false,"x":1690,"y":2140,"wires":[["63503c91.8a76d4"]]},{"id":"8de2aa57.472bd8","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1290,"y":2180,"wires":[["2c72f397.f1ae2c"]]},{"id":"7ce76dd5.5925c4","type":"inject","z":"f89ee080.71ad2","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":true,"onceDelay":"60","x":830,"y":2220,"wires":[["b362d485.1b7458"]]},{"id":"b362d485.1b7458","type":"http request","z":"f89ee080.71ad2","name":"","method":"GET","ret":"txt","url":"https://127.0.0.1:8123","tls":"cf49b477.229318","x":990,"y":2220,"wires":[["9ca386a6.b00ca8"]]},{"id":"9ca386a6.b00ca8","type":"switch","z":"f89ee080.71ad2","name":"","property":"payload","propertyType":"msg","rules":[{"v":"ECONNREFUSED","vt":"str","t":"cont"}],"checkall":"true","repair":false,"outputs":1,"x":1130,"y":2220,"wires":[["8aee371d.e2f648","144e8a1b.0eacc6"]]},{"id":"d78b3ff0.bd68e","type":"change","z":"f89ee080.71ad2","name":"Format message","rules":[{"pt":"msg","to":"Can't reach port 8123 on local host for Home Assistant. Restarting Home Assistant. ","p":"payload","t":"set","tot":"str"},{"tot":"str","t":"set","p":"topic","pt":"msg","to":"Home Assistant Port not reachable"}],"action":"","property":"","from":"","to":"","reg":false,"x":1690,"y":2220,"wires":[["63503c91.8a76d4"]]},{"id":"27fa24da.7d762c","type":"exec","z":"f89ee080.71ad2","command":"cp /Users/hass/.homeassistant/home-assistant.log home-assistant.log.crash","addpay":false,"append":"","useSpawn":"false","timer":"60","oldrc":false,"name":"Copy Home Assistant Log file","x":2490,"y":2060,"wires":[[],[],[]]},{"id":"23a2e3a8.835e8c","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2420,"y":2120,"wires":[["ce2aa51b.8362e8"]]},{"id":"8aee371d.e2f648","type":"debug","z":"f89ee080.71ad2","name":"HTTP Error","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","x":1360,"y":2340,"wires":[]},{"id":"7db23baa.7fc4e4","type":"comment","z":"f89ee080.71ad2","name":"Monitor the Home Assistant port","info":"","x":870,"y":2180,"wires":[]},{"id":"9fc778d1.965828","type":"api-current-state","z":"bfbb9b56.a1ffa8","name":"If Main Level off","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"group.main_level","x":600,"y":660,"wires":[["6aa46301.7c07fc"]]},{"id":"c859f054.912a7","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on porch light","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}","mergecontext":"","x":1610,"y":980,"wires":[[]]},{"id":"19418e9e.a51a31","type":"api-call-service","z":"153e4bbb.7f4624","name":"Unlock front door","server":"5a92f1da.a8503","service_domain":"lock","service":"unlock","data":"{ \"entity_id\":\"lock.front_door\" }","mergecontext":"","x":390,"y":2880,"wires":[[]]},{"id":"84b818ab.bb65b8","type":"api-current-state","z":"153e4bbb.7f4624","name":"If Main Level off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"group.main_level","x":700,"y":320,"wires":[["4783084d.3577f8"]]},{"id":"83e0023c.afd5a","type":"api-current-state","z":"f89ee080.71ad2","name":"Quiet mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.quiet_mode","x":490,"y":1020,"wires":[["c6458b82.74dfa8"]]},{"id":"c6458b82.74dfa8","type":"function","z":"f89ee080.71ad2","name":"Set global variables","func":"global.set('quiet_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1020,"wires":[[]]},{"id":"ddf24530.d1ea88","type":"time-range-switch","z":"6991cee1.63833","name":"7AM to 8PM","lat":"40.18942","lon":"-92.58252","startTime":"07:00","endTime":"20:00","startOffset":0,"endOffset":0,"x":1530,"y":140,"wires":[["b4898810.413378"],[]]},{"id":"be61735.74a4f9","type":"function","z":"7224a2bd.67bcdc","name":"Is family home?","func":"family_mode         = global.get('family_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.family_mode     = family_mode;\n\nif( family_mode == 'not_home' && ha_uptime_sec > 600) {\n    msg.abort_alert = 1;\n    return[msg,null];\n} else {\n    msg.abort_alert = 0;\n    return[null,msg];    \n}","outputs":2,"noerr":0,"x":500,"y":280,"wires":[[],[]],"outputLabels":["abort","continue"]},{"id":"97a6864.8fb6578","type":"api-current-state","z":"7224a2bd.67bcdc","name":"Family Mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"group.family","x":510,"y":200,"wires":[["13146823.fd1808"]]},{"id":"13146823.fd1808","type":"function","z":"7224a2bd.67bcdc","name":"Set global variables","func":"global.set('family_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":200,"wires":[[]]},{"id":"64add2fe.23113c","type":"delay","z":"7224a2bd.67bcdc","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":280,"wires":[["be61735.74a4f9"]]},{"id":"6100342e.126a2c","type":"api-current-state","z":"7224a2bd.67bcdc","name":"HA Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":510,"y":160,"wires":[["dce24fb2.c275"]]},{"id":"dce24fb2.c275","type":"function","z":"7224a2bd.67bcdc","name":"Set global variables","func":"global.set('ha_uptime_sec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":160,"wires":[[]]},{"id":"9f83e445.23fe48","type":"comment","z":"7224a2bd.67bcdc","name":"Checks if family is home and that HA has not restarted in last ten min","info":"","x":660,"y":240,"wires":[]},{"id":"405c8407.39c03c","type":"delay","z":"7224a2bd.67bcdc","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":220,"y":160,"wires":[["6100342e.126a2c","97a6864.8fb6578","64add2fe.23113c"]]},{"id":"59037f0e.5fdde","type":"rbe","z":"a8777efe.89265","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":970,"y":620,"wires":[["5baa980a.fe7098"]]},{"id":"144e8a1b.0eacc6","type":"counter","z":"f89ee080.71ad2","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":1300,"y":2220,"wires":[["36b6e2f8.bfab9e"]]},{"id":"36b6e2f8.bfab9e","type":"switch","z":"f89ee080.71ad2","name":"Continue after 5 errors","property":"count","propertyType":"msg","rules":[{"t":"lte","vt":"num","v":"5"},{"v":"5","vt":"num","t":"gt"}],"checkall":"true","repair":false,"outputs":2,"x":1480,"y":2220,"wires":[[],["d78b3ff0.bd68e","3efe8e38.cef0b2"]]},{"id":"3efe8e38.cef0b2","type":"change","z":"f89ee080.71ad2","name":"Reset counter","rules":[{"pt":"msg","to":"true","p":"reset","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":2300,"wires":[["144e8a1b.0eacc6"]]},{"id":"641406d9.54c868","type":"function","z":"736c12c5.92637c","name":"Format message","func":"device      = msg.topic.replace(/^.*\\.(.*)/, '$1');\nmsg.payload = { data: {'message': device + ' has been offline for four hours' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":700,"wires":[["2d905341.266a8c"]]},{"id":"95695ea1.51e0f","type":"api-render-template","z":"f89ee080.71ad2","name":"Wife's phone last talked","server":"5a92f1da.a8503","template":"timestamp,device\n{{ as_timestamp(states.device_tracker.wifes_iphone.last_updated) }},wifes_iphone","x":330,"y":2800,"wires":[["ead10337.a3a0b"]]},{"id":"e57d7fa2.4fcc4","type":"inject","z":"f89ee080.71ad2","name":"","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":true,"onceDelay":"600","x":110,"y":2800,"wires":[["95695ea1.51e0f","c64d3b6c.ebf778","1b277e84.35c851"]]},{"id":"c64d3b6c.ebf778","type":"api-render-template","z":"f89ee080.71ad2","name":"Walts's phone last talked","server":"5a92f1da.a8503","template":"timestamp,device\n{{ as_timestamp(states.device_tracker.walts_iphone.last_updated) }},walts_iphone","x":330,"y":2840,"wires":[["ead10337.a3a0b"]]},{"id":"9ef52d7b.ebfb","type":"function","z":"f89ee080.71ad2","name":"Time difference","func":"current_timestamp       = Math.round(+new Date());\n\ndiff                    = current_timestamp - (msg.payload.timestamp * 1000);\ndiff_min                = ((diff / 1000) / 60);\ndiff_hours              = diff_min / 60;\n\nmsg.current_timestamp   = current_timestamp;\nmsg.diff                = diff;\nmsg.diff_min            = diff_min;\nmsg.diff_hours          = diff_hours;\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":2840,"wires":[["7b801de0.4b4844"]]},{"id":"a961ea5.51b3718","type":"comment","z":"f89ee080.71ad2","name":"IOS Clients Still Checking in?","info":"","x":140,"y":2760,"wires":[]},{"id":"7b801de0.4b4844","type":"switch","z":"f89ee080.71ad2","name":"","property":"diff_hours","propertyType":"msg","rules":[{"t":"gt","vt":"num","v":"12"}],"checkall":"true","repair":false,"outputs":1,"x":910,"y":2840,"wires":[["eb25fa5f.8ddc98","e112e378.71326"]]},{"id":"ead10337.a3a0b","type":"csv","z":"f89ee080.71ad2","name":"","sep":",","hdrin":true,"hdrout":"","multi":"one","ret":"\\n","temp":"","skip":"0","x":550,"y":2840,"wires":[["9ef52d7b.ebfb"]]},{"id":"a08af464.16b938","type":"api-call-service","z":"f89ee080.71ad2","name":"Notify Walt","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ }","mergecontext":"","x":1710,"y":2880,"wires":[[]]},{"id":"7ac90261.aad75c","type":"rbe","z":"f89ee080.71ad2","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1330,"y":2840,"wires":[["cb9bc623.e51e68"]]},{"id":"cb9bc623.e51e68","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1520,"y":2840,"wires":[["f02df7d.9184608"]]},{"id":"f02df7d.9184608","type":"e-mail","z":"f89ee080.71ad2","server":"smtp.email.com","port":"465","secure":true,"name":"your-email-address@email.com","dname":"","x":1740,"y":2840,"wires":[]},{"id":"eb25fa5f.8ddc98","type":"function","z":"f89ee080.71ad2","name":"Format message","func":"msg.payload = { data: {'message': msg.payload.device + ' has not talked to Home Assistant in ' + msg.diff_hours } };\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":2880,"wires":[["e6a62805.1c57e8"]]},{"id":"e6a62805.1c57e8","type":"rbe","z":"f89ee080.71ad2","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1330,"y":2880,"wires":[["bb9dc76c.8089c8"]]},{"id":"bb9dc76c.8089c8","type":"delay","z":"f89ee080.71ad2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1520,"y":2880,"wires":[["a08af464.16b938"]]},{"id":"e112e378.71326","type":"change","z":"f89ee080.71ad2","name":"Format message","rules":[{"t":"set","tot":"str","to":"A IOS device has not talked to Home Assistant in over 12 hours","pt":"msg","p":"payload"},{"to":"IOS Device not talking to Home Assistant","pt":"msg","p":"topic","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":2840,"wires":[["7ac90261.aad75c"]]},{"id":"1b277e84.35c851","type":"api-render-template","z":"f89ee080.71ad2","name":"iPad last talked","server":"5a92f1da.a8503","template":"timestamp,device\n{{ as_timestamp(states.device_tracker.howd_ipad_air.last_updated) }},ipad","x":300,"y":2880,"wires":[["ead10337.a3a0b"]]},{"id":"23b763b3.e14f3c","type":"comment","z":"f89ee080.71ad2","name":"Start HomeKit after Home Assistant is up for 10 minutes","info":"","x":220,"y":2940,"wires":[]},{"id":"f28d4594.47fc78","type":"api-current-state","z":"f89ee080.71ad2","name":"Home Assistant Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":330,"y":2980,"wires":[["d097d7cc.557a28"]]},{"id":"c409802a.a393d","type":"inject","z":"f89ee080.71ad2","name":"","topic":"","payload":"","payloadType":"date","repeat":"600","crontab":"","once":true,"onceDelay":"601","x":110,"y":2980,"wires":[["f28d4594.47fc78"]]},{"id":"d097d7cc.557a28","type":"switch","z":"f89ee080.71ad2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","vt":"num","v2t":"num","v2":"1300","v":"500"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":2980,"wires":[["d94ac79b.cfe938"]]},{"id":"d94ac79b.cfe938","type":"api-call-service","z":"f89ee080.71ad2","name":"Start HomeKit","server":"5a92f1da.a8503","service_domain":"homekit","service":"start","data":"{ }","mergecontext":"","x":720,"y":2980,"wires":[[]]},{"id":"5eccbcae.c48384","type":"comment","z":"7955d68b.f231b8","name":"Trash alerts","info":"","x":110,"y":140,"wires":[]},{"id":"a9a651b.2e218b","type":"change","z":"7955d68b.f231b8","name":"Set calendar message","rules":[{"t":"set","tot":"msg","p":"data.new_state.attributes.message","pt":"msg","to":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":180,"wires":[["17eeb2b.a05434d"]]},{"id":"9eb42d96.2707e","type":"traffic","z":"7955d68b.f231b8","name":"Store message then release","property_allow":"topic","filter_allow":"release","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"topic","filter_stop":"stop","ignore_case_stop":false,"negate_stop":false,"send_stop":false,"default_start":false,"differ":true,"x":800,"y":180,"wires":[["bbaee649.f35438","deda471.c401cb8"]]},{"id":"17eeb2b.a05434d","type":"rbe","z":"7955d68b.f231b8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":530,"y":180,"wires":[["9eb42d96.2707e"]]},{"id":"148f53e.03afcac","type":"inject","z":"7955d68b.f231b8","name":"7:00PM on Tuesdays","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 19 * * 2","once":false,"onceDelay":"","x":160,"y":240,"wires":[["33ddd668.a3b2fa"]]},{"id":"33ddd668.a3b2fa","type":"looptimer","z":"7955d68b.f231b8","duration":"1","units":"Minute","maxloops":"300","maxtimeout":"5","maxtimeoutunits":"Hour","name":"Loop until midnight","x":410,"y":240,"wires":[["cbbcb3f2.87572"],[]]},{"id":"cbbcb3f2.87572","type":"api-current-state","z":"7955d68b.f231b8","name":"If Family Home","server":"5a92f1da.a8503","outputs":1,"halt_if":"not_home","entity_id":"group.family","x":640,"y":240,"wires":[["32b9eb96.7f2a14"]]},{"id":"32b9eb96.7f2a14","type":"api-current-state","z":"7955d68b.f231b8","name":"If Guest Mode Off","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.guest_mode","x":650,"y":280,"wires":[["e245c053.b666b"]]},{"id":"f9301800.7149b8","type":"change","z":"7955d68b.f231b8","name":"Stop loop","rules":[{"to":"stop","pt":"msg","p":"payload","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":320,"wires":[["33ddd668.a3b2fa"]]},{"id":"e245c053.b666b","type":"api-current-state","z":"7955d68b.f231b8","name":"If Family not in bed","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"binary_sensor.family_in_bed","x":650,"y":320,"wires":[["f9301800.7149b8","8e2baf6d.e705d","19f69d60.5111e3"]]},{"id":"ad19336d.2cb44","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"calendar_check      = /calendar/g;\nrecycling_week      = msg.week % 2;\nmsg.recycling_week  = recycling_week;\n\nif(calendar_check.test(msg.topic)) {\n    reminder = msg.payload;\n} else if (recycling_week == 1) {\n    reminder = 'Hey everyone, it is recycling and a trash day tomorrow, so don\\'t forget to set out both bins!';\n} else  {\n    reminder = 'Hey guys, just letting you know that it is a trash day tomorrow!';\n}\n\nmsg.payload = { data: {'message': reminder } };\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":180,"wires":[["29c3acce.152d34","1152872b.ff6349"]]},{"id":"29c3acce.152d34","type":"api-call-service","z":"7955d68b.f231b8","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1670,"y":180,"wires":[[]]},{"id":"1152872b.ff6349","type":"subflow:2c797f21.c25cb","z":"7955d68b.f231b8","name":"","x":1670,"y":220,"wires":[[],[]]},{"id":"8e2baf6d.e705d","type":"change","z":"7955d68b.f231b8","name":"Release messages","rules":[{"p":"topic","pt":"msg","to":"release","t":"set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":320,"wires":[["9eb42d96.2707e"]]},{"id":"bbaee649.f35438","type":"delay","z":"7955d68b.f231b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1060,"y":180,"wires":[["9b3a2549.68c118"]]},{"id":"deda471.c401cb8","type":"change","z":"7955d68b.f231b8","name":"Hold messages and reset","rules":[{"to":"stop","pt":"msg","p":"topic","t":"set","tot":"str"},{"pt":"msg","to":"true","p":"reset","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":260,"wires":[["9eb42d96.2707e","19f69d60.5111e3"]]},{"id":"19f69d60.5111e3","type":"delay","z":"7955d68b.f231b8","name":"Send default trash msg through after traffic light is green","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1290,"y":280,"wires":[["9eb42d96.2707e"]]},{"id":"264d5a65.868526","type":"server-state-changed","z":"7955d68b.f231b8","name":"Trash calendar event","server":"5a92f1da.a8503","entityidfilter":"calendar.family_trash","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":130,"y":180,"wires":[["a9a651b.2e218b"]]},{"id":"9b3a2549.68c118","type":"moment","z":"7955d68b.f231b8","name":"Week of the year","topic":"","input":"","inputType":"date","inTz":"America/Chicago","adjAmount":0,"adjType":"days","adjDir":"add","format":"w","locale":"en_US","output":"week","outputType":"msg","outTz":"America/Chicago","x":1250,"y":180,"wires":[["ad19336d.2cb44"]]},{"id":"5c941dc4.69e4c4","type":"server-state-changed","z":"7955d68b.f231b8","name":"Mailbox opened","server":"5a92f1da.a8503","entityidfilter":"sensor.mailbox","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":120,"y":500,"wires":[["d968b95.640b248"]]},{"id":"d968b95.640b248","type":"switch","z":"7955d68b.f231b8","name":"Opened","property":"payload","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"open"},{"v":"closed","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":300,"y":500,"wires":[["65e4f66a.66ac78"],[]],"outputLabels":["Open / Motion","Closed / No Motion"]},{"id":"65e4f66a.66ac78","type":"subflow:5217c125.f919f","z":"7955d68b.f231b8","name":"","x":550,"y":500,"wires":[["6d7c380a.af6768","bade3964.d30868","68d6cb7f.806d04"]]},{"id":"6d7c380a.af6768","type":"api-call-service","z":"7955d68b.f231b8","name":"Update Walts location","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_walts_iphone","data":"{ \"message\":\"request_location_update\"}","x":1040,"y":540,"wires":[[]]},{"id":"bade3964.d30868","type":"api-call-service","z":"7955d68b.f231b8","name":"Update Wifes location","server":"5a92f1da.a8503","service_domain":"notify","service":"ios_wifes_iphone","data":"{ \"message\":\"request_location_update\"}","x":1050,"y":500,"wires":[[]]},{"id":"68d6cb7f.806d04","type":"delay","z":"7955d68b.f231b8","name":"3 minute delay for location update","pauseType":"delay","timeout":"3","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":560,"wires":[["3bb451d4.3de14e"]]},{"id":"3bb451d4.3de14e","type":"subflow:5217c125.f919f","z":"7955d68b.f231b8","name":"Family still not home","x":740,"y":620,"wires":[["b79750ea.4eebe"]]},{"id":"1f81969a.a6c979","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened!' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":660,"wires":[["be929d35.8ffe2"]]},{"id":"be929d35.8ffe2","type":"api-call-service","z":"7955d68b.f231b8","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1850,"y":660,"wires":[[]]},{"id":"53b4a7e5.fc4528","type":"comment","z":"7955d68b.f231b8","name":"Mail and package notifications","info":"","x":160,"y":400,"wires":[]},{"id":"618d6e2.756d79","type":"switch","z":"7955d68b.f231b8","name":"Getting mail today?","property":"payload","propertyType":"msg","rules":[{"vt":"num","t":"gt","v":"0"},{"v":"0","t":"eq","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1210,"y":620,"wires":[["f871c0a7.508bc"],["e7b3f435.c01518"]],"outputLabels":["mail today",""]},{"id":"f871c0a7.508bc","type":"delay","z":"7955d68b.f231b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":600,"wires":[["36d43f92.43d97","a09eac07.dd29a"]]},{"id":"36d43f92.43d97","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened! Here is a preview of what is inside', data: { attachment: {'url': 'https://your-hostname.duckdns.org:65443/local/todays_mails.gif' } } } };\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":580,"wires":[["e556d5a4.84c8a8","12e2ac04.5d0d14","25816dd7.246a02"]]},{"id":"25816dd7.246a02","type":"api-call-service","z":"7955d68b.f231b8","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Sent today's mail notification to family iphones\" }","mergecontext":"","x":1860,"y":580,"wires":[[]]},{"id":"12e2ac04.5d0d14","type":"api-call-service","z":"7955d68b.f231b8","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","mergecontext":"","x":1850,"y":540,"wires":[[]]},{"id":"e556d5a4.84c8a8","type":"debug","z":"7955d68b.f231b8","name":"ios attachment","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1860,"y":500,"wires":[]},{"id":"1432b1c7.f9344e","type":"server-state-changed","z":"7955d68b.f231b8","name":"UPS Package Count","server":"5a92f1da.a8503","version":0,"entityidfilter":"sensor.ups_packages","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":680,"wires":[["283303b3.860bbc"]]},{"id":"283303b3.860bbc","type":"switch","z":"7955d68b.f231b8","name":"Getting packages today?","property":"payload","propertyType":"msg","rules":[{"t":"gt","vt":"num","v":"0"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":680,"wires":[["a568bf33.2cbdd"]],"outputLabels":["packages today"]},{"id":"a568bf33.2cbdd","type":"delay","z":"7955d68b.f231b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":600,"y":680,"wires":[["f2cde0ff.39681"]]},{"id":"f2cde0ff.39681","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"packages    = msg.payload;\n\nif ( packages == 1 ) {\n   msg.payload = { data: {'message': 'There is one UPS package scheduled for delivery today' } }; \n   return msg;\n} else if ( packages > 1) {\n     msg.payload = { data: {'message': 'There are ' + packages + 'UPS packages scheduled for delivery today' } }; \n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":810,"y":680,"wires":[["204a9933.66dde6","ec6d0977.a48d98","55645898.341888"]]},{"id":"ec6d0977.a48d98","type":"api-call-service","z":"7955d68b.f231b8","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","mergecontext":"","x":1030,"y":720,"wires":[[]]},{"id":"55645898.341888","type":"api-call-service","z":"7955d68b.f231b8","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Sent today's UPS notification to family iphones\" }","mergecontext":"","x":1040,"y":680,"wires":[[]]},{"id":"204a9933.66dde6","type":"debug","z":"7955d68b.f231b8","name":"UPS","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1010,"y":760,"wires":[]},{"id":"2c958cb4.4a5984","type":"server-state-changed","z":"7955d68b.f231b8","name":"FedEx Package Count","server":"5a92f1da.a8503","entityidfilter":"sensor.fedex_packages","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":140,"y":800,"wires":[["7bc778ee.b50e98"]]},{"id":"7bc778ee.b50e98","type":"switch","z":"7955d68b.f231b8","name":"Getting packages today?","property":"payload","propertyType":"msg","rules":[{"vt":"num","t":"gt","v":"0"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":800,"wires":[["36e296c4.29afba"]],"outputLabels":["packages today"]},{"id":"36e296c4.29afba","type":"delay","z":"7955d68b.f231b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":600,"y":800,"wires":[["28e814cc.72d0dc"]]},{"id":"28e814cc.72d0dc","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"packages    = msg.payload;\n\nif ( packages == 1 ) {\n   msg.payload = { data: {'message': 'There is one FedEx package scheduled for delivery today' } }; \n   return msg;\n} else if ( packages > 1) {\n     msg.payload = { data: {'message': 'There are ' + packages + 'FedEx packages scheduled for delivery today' } }; \n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":810,"y":800,"wires":[["304c6896.dd6098","89929b2f.a699b8","f2d818a7.52b798"]]},{"id":"89929b2f.a699b8","type":"api-call-service","z":"7955d68b.f231b8","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","mergecontext":"","x":1030,"y":840,"wires":[[]]},{"id":"f2d818a7.52b798","type":"api-call-service","z":"7955d68b.f231b8","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Sent today's FedEx notification to family iphones\" }","mergecontext":"","x":1040,"y":800,"wires":[[]]},{"id":"304c6896.dd6098","type":"debug","z":"7955d68b.f231b8","name":"FedEx","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1010,"y":880,"wires":[]},{"id":"b79750ea.4eebe","type":"api-current-state","z":"7955d68b.f231b8","name":"USPS Mail Count","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.usps_mail","x":1010,"y":620,"wires":[["618d6e2.756d79"]]},{"id":"505429af.ce4ff8","type":"inject","z":"7955d68b.f231b8","name":"Every five minutes in the morning","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/5 7-9 * * *","once":false,"onceDelay":"","x":200,"y":440,"wires":[["f3743029.7b01"]]},{"id":"f3743029.7b01","type":"api-call-service","z":"7955d68b.f231b8","name":"Check USPS for mail","server":"5a92f1da.a8503","service_domain":"shell_command","service":"usps_mail_check","data":"{ }","mergecontext":"","x":1000,"y":440,"wires":[[]]},{"id":"a09eac07.dd29a","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"msg.payload = { data: {'message': 'Mail is here, the mailbox was just opened!' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":620,"wires":[["5dfec21c.caf10c"]]},{"id":"5dfec21c.caf10c","type":"subflow:2c797f21.c25cb","z":"7955d68b.f231b8","name":"","x":1850,"y":620,"wires":[[],[]]},{"id":"e7b3f435.c01518","type":"delay","z":"7955d68b.f231b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":640,"wires":[["1f81969a.a6c979","a09eac07.dd29a"]]},{"id":"bd58b64.25eb148","type":"stoptimer","z":"7955d68b.f231b8","duration":"10","units":"Minute","payloadtype":"num","payloadval":"0","name":"10 minutes","x":630,"y":940,"wires":[["f67defe9.c64a3"],[]]},{"id":"6b2ca50f.2a2c2c","type":"switch","z":"7955d68b.f231b8","name":"Door Open Or Closed","property":"payload","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"open"},{"v":"closed","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":300,"y":940,"wires":[["bd58b64.25eb148"],["555f8ed3.c904"]],"outputLabels":["Open","Closed"]},{"id":"57fc046e.b238bc","type":"server-state-changed","z":"7955d68b.f231b8","name":"Fridge Door","server":"5a92f1da.a8503","entityidfilter":"sensor.fridge","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":940,"wires":[["6b2ca50f.2a2c2c"]]},{"id":"555f8ed3.c904","type":"change","z":"7955d68b.f231b8","name":"Stop timer","rules":[{"tot":"str","t":"set","pt":"msg","to":"STOP","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":980,"wires":[["bd58b64.25eb148"]]},{"id":"f67defe9.c64a3","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"msg.payload = { data: {'message': 'Fridge door has been open over 10 minutes' } };\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":940,"wires":[["3d15fd3d.328552","a7737ad8.8ea7e8","7161869a.660fb8"]]},{"id":"3d15fd3d.328552","type":"api-call-service","z":"7955d68b.f231b8","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1070,"y":980,"wires":[[]]},{"id":"a7737ad8.8ea7e8","type":"subflow:2c797f21.c25cb","z":"7955d68b.f231b8","name":"","x":1070,"y":1020,"wires":[[],[]]},{"id":"9af95a01.a42898","type":"comment","z":"7955d68b.f231b8","name":"Fridge left open","info":"","x":120,"y":900,"wires":[]},{"id":"7161869a.660fb8","type":"api-call-service","z":"7955d68b.f231b8","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Fridge left open\" }","x":1080,"y":940,"wires":[[]]},{"id":"14b523ff.46603c","type":"comment","z":"153e4bbb.7f4624","name":"Fade the family room overhead lights","info":"","x":170,"y":1360,"wires":[]},{"id":"89f923d8.d16f8","type":"api-current-state","z":"153e4bbb.7f4624","name":"Family Room Overhead lights on?","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"light.family_room_overhead_lights","x":540,"y":1400,"wires":[["c9cefca9.3b951"]]},{"id":"c9cefca9.3b951","type":"api-call-service","z":"153e4bbb.7f4624","name":"Fade off for next half hour","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.family_room_overhead_lights\", \"brightness\":\"0\",\"transition\":\"1800\"}","mergecontext":"","x":850,"y":1400,"wires":[[]]},{"id":"117bb0a3.87243f","type":"bigtimer","z":"153e4bbb.7f4624","outtopic":"","outpayload1":"","outpayload2":"","name":"Hour before sunset","lat":"40.173508","lon":"-92.58988","starttime":"5004","endtime":"1425","startoff":"-60","endoff":"0","offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":true,"atstart":false,"odd":false,"even":false,"x":110,"y":1420,"wires":[[],[],["aad9fee5.2ee36"]]},{"id":"aad9fee5.2ee36","type":"switch","z":"153e4bbb.7f4624","name":"","property":"payload","propertyType":"msg","rules":[{"v":"on","t":"eq","vt":"str"},{"v":"off","vt":"str","t":"eq"}],"checkall":"true","outputs":2,"x":330,"y":1400,"wires":[["89f923d8.d16f8"],[]]},{"id":"91209255.73e34","type":"comment","z":"7955d68b.f231b8","name":"Speak calendar alerts","info":"","x":140,"y":40,"wires":[]},{"id":"23026632.d32c4a","type":"server-state-changed","z":"7955d68b.f231b8","name":"Family Calendar Events","server":"5a92f1da.a8503","entityidfilter":"calendar.family","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":140,"y":80,"wires":[["49720d28.fb0e64"]]},{"id":"9b3ee852.9d4b68","type":"function","z":"7955d68b.f231b8","name":"Format message","func":"msg.payload = { data: {'message': 'You have an event on the family calendar. Here it is..... ' + msg.payload } };\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":80,"wires":[["a0b81e90.549eb"]]},{"id":"466ecbfd.5dc474","type":"subflow:2c797f21.c25cb","z":"7955d68b.f231b8","name":"","x":1150,"y":80,"wires":[[],[]]},{"id":"49720d28.fb0e64","type":"change","z":"7955d68b.f231b8","name":"Set calendar message","rules":[{"p":"data.new_state.attributes.message","to":"payload","pt":"msg","tot":"msg","t":"move"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":80,"wires":[["ae30cb42.a9e348"]]},{"id":"ae30cb42.a9e348","type":"switch","z":"7955d68b.f231b8","name":"Filter","property":"payload","propertyType":"msg","rules":[{"v":"trash","vt":"str","t":"cont"},{"v":"Brenda","t":"cont","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":false,"outputs":3,"x":530,"y":100,"wires":[[],[],["9b3ee852.9d4b68"]],"outputLabels":["Trash","Cleaning","Everything else"]},{"id":"a0b81e90.549eb","type":"subflow:6b84347a.0dfbcc","z":"7955d68b.f231b8","name":"","x":940,"y":80,"wires":[["466ecbfd.5dc474"]]},{"id":"391dd86f.f0f7b8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Set Son1's Lamp dusk color temp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"color_temp\":\"400\"}","mergecontext":"","x":1070,"y":1520,"wires":[[]]},{"id":"5a235f87.b3881","type":"api-call-service","z":"153e4bbb.7f4624","name":"Set Master Bedroom dusk Color temp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.master_bedroom\", \"color_temp\":\"400\"}","mergecontext":"","x":1070,"y":1600,"wires":[[]]},{"id":"2ff71a9a.6362d6","type":"api-call-service","z":"153e4bbb.7f4624","name":"Set Son1's Lamp night color temp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.philips_lct014_0288ce3f_11\", \"color_temp\":\"442\"}","mergecontext":"","x":1070,"y":1560,"wires":[[]]},{"id":"69e19a39.01e9e4","type":"api-call-service","z":"153e4bbb.7f4624","name":"Set Master Bedroom night Color temp","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\":\"light.master_bedroom\", \"color_temp\":\"442\"}","mergecontext":"","x":1070,"y":1640,"wires":[[]]},{"id":"b87535fd.0eb758","type":"comment","z":"153e4bbb.7f4624","name":"Set evening color temperatures","info":"","x":150,"y":1500,"wires":[]},{"id":"c1e65a21.2353a8","type":"time-range-switch","z":"153e4bbb.7f4624","name":"Golden Hour","lat":"40.17349","lon":"-92.58936","startTime":"sunsetStart","endTime":"sunset","startOffset":"-15","endOffset":0,"x":410,"y":1520,"wires":[["5136da51.f9dc04"],[]]},{"id":"5136da51.f9dc04","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":640,"y":1520,"wires":[["1cdb79f2.7c78c6"]]},{"id":"b9b38453.0ce528","type":"poll-state","z":"153e4bbb.7f4624","name":"Son1s Lamp","server":"5a92f1da.a8503","updateinterval":"600","outputinitially":false,"outputonchanged":true,"entity_id":"light.philips_lct014_0288ce3f_11","outputs":1,"x":100,"y":1540,"wires":[["e164c413.e27828"]]},{"id":"e164c413.e27828","type":"switch","z":"153e4bbb.7f4624","name":"","property":"payload.data.state","propertyType":"msg","rules":[{"v":"on","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":1540,"wires":[["c1e65a21.2353a8","5c2a920a.9fd19c"]]},{"id":"5c2a920a.9fd19c","type":"time-range-switch","z":"153e4bbb.7f4624","name":"Sunset","lat":"40.17349","lon":"-92.58936","startTime":"sunset","endTime":"dusk","startOffset":"0","endOffset":0,"x":390,"y":1560,"wires":[["bdc3e001.5e0d7"],[]]},{"id":"bdc3e001.5e0d7","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":640,"y":1560,"wires":[["93b1efa.a71b71"]]},{"id":"b2599ca7.aee34","type":"time-range-switch","z":"153e4bbb.7f4624","name":"Golden Hour","lat":"40.17349","lon":"-92.58936","startTime":"sunsetStart","endTime":"sunset","startOffset":"-15","endOffset":0,"x":410,"y":1600,"wires":[["f38f2ff8.371a4"],[]]},{"id":"f38f2ff8.371a4","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":640,"y":1600,"wires":[["fa9db1df.011a9"]]},{"id":"3d21e85.0547f18","type":"poll-state","z":"153e4bbb.7f4624","name":"Master Bedroom","server":"5a92f1da.a8503","updateinterval":"600","outputinitially":false,"outputonchanged":true,"entity_id":"light.master_bedroom","outputs":1,"x":100,"y":1620,"wires":[["26de07ad.dfbfe8"]]},{"id":"26de07ad.dfbfe8","type":"switch","z":"153e4bbb.7f4624","name":"","property":"payload.data.state","propertyType":"msg","rules":[{"v":"on","t":"eq","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":1620,"wires":[["b2599ca7.aee34","a2f6e110.52de7"]]},{"id":"a2f6e110.52de7","type":"time-range-switch","z":"153e4bbb.7f4624","name":"Sunset","lat":"40.17349","lon":"-92.58936","startTime":"sunset","endTime":"dusk","startOffset":"0","endOffset":0,"x":390,"y":1640,"wires":[["3350fb6f.bd6ee4"],[]]},{"id":"3350fb6f.bd6ee4","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"12","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":640,"y":1640,"wires":[["6cafe53e.a5b7fc"]]},{"id":"1cdb79f2.7c78c6","type":"function","z":"153e4bbb.7f4624","name":"Clear msg","func":"// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;","outputs":1,"noerr":0,"x":820,"y":1520,"wires":[["391dd86f.f0f7b8"]]},{"id":"93b1efa.a71b71","type":"function","z":"153e4bbb.7f4624","name":"Clear msg","func":"// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;","outputs":1,"noerr":0,"x":820,"y":1560,"wires":[["2ff71a9a.6362d6"]]},{"id":"fa9db1df.011a9","type":"function","z":"153e4bbb.7f4624","name":"Clear msg","func":"// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;","outputs":1,"noerr":0,"x":820,"y":1600,"wires":[["5a235f87.b3881"]]},{"id":"6cafe53e.a5b7fc","type":"function","z":"153e4bbb.7f4624","name":"Clear msg","func":"// Clear our msg object as the service call to\n// change the light will use it's data\nnewmsg = {};\nnewmsg.payload = \"Update\";\nreturn newmsg;","outputs":1,"noerr":0,"x":820,"y":1640,"wires":[["69e19a39.01e9e4"]]},{"id":"8510b426.c046c8","type":"comment","z":"153e4bbb.7f4624","name":"Turn on/off front porch light","info":"","x":130,"y":1720,"wires":[]},{"id":"90a8d2f2.9f455","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn on porch light","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}","x":1040,"y":1820,"wires":[[]]},{"id":"ca61e1bf.e8b94","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off porch light","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.front_door_switch_level\"}","x":1040,"y":1860,"wires":[[]]},{"id":"7e321e4a.77ce8","type":"bigtimer","z":"153e4bbb.7f4624","outtopic":"","outpayload1":"","outpayload2":"","name":"Sunset","lat":"40.173508","lon":"-92.58988","starttime":"5004","endtime":"1425","startoff":"-30","endoff":"0","offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":true,"atstart":false,"odd":false,"even":false,"x":70,"y":1780,"wires":[[],[],["5372dbce.ef8934"]]},{"id":"5372dbce.ef8934","type":"switch","z":"153e4bbb.7f4624","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","vt":"str","v":"on"},{"v":"off","vt":"str","t":"eq"}],"checkall":"true","outputs":2,"x":470,"y":1800,"wires":[["2d03af56.d77e7"],["7111c965.b51b88"]]},{"id":"460c7ad7.534744","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Family Asleep","server":"5a92f1da.a8503","entityidfilter":"binary_sensor.family_sleeping","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":90,"y":1840,"wires":[["6c98030.2c8fffc"]]},{"id":"575c5e84.ee8e","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Family in Bed","server":"5a92f1da.a8503","entityidfilter":"binary_sensor.family_in_bed","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":90,"y":1900,"wires":[["6c98030.2c8fffc"]]},{"id":"6c98030.2c8fffc","type":"time-range-switch","z":"153e4bbb.7f4624","name":"8PM to midnight","lat":"","lon":"","startTime":"20:00","endTime":"24:00","startOffset":0,"endOffset":0,"x":260,"y":1860,"wires":[["9db64798.a9ada8"],[]]},{"id":"9db64798.a9ada8","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":440,"y":1860,"wires":[["7111c965.b51b88"]]},{"id":"92a91414.1a9358","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Turning on front porch light\" }","x":1030,"y":1780,"wires":[[]]},{"id":"a115515c.72f5a","type":"api-call-service","z":"153e4bbb.7f4624","name":"Logbook entry","server":"5a92f1da.a8503","service_domain":"logbook","service":"log","data":"{ \"name\":\"Node-Red\",\"message\":\"Turning off front porch light\" }","x":1030,"y":1900,"wires":[[]]},{"id":"e09403a6.702a3","type":"comment","z":"153e4bbb.7f4624","name":"Turn off Son2's Lamp and Upstairs Light after main level is off","info":"","x":240,"y":2060,"wires":[]},{"id":"1020e8a4.331457","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Main level off","server":"5a92f1da.a8503","entityidfilter":"group.main_level","entityidfiltertype":"exact","haltifstate":"on","outputs":1,"x":90,"y":2100,"wires":[["62669d26.41b654"]]},{"id":"62669d26.41b654","type":"time-range-switch","z":"153e4bbb.7f4624","name":"8PM to 1AM","lat":"40.18937","lon":"-92.58249","startTime":"20:00","endTime":"1:00","startOffset":0,"endOffset":0,"x":270,"y":2100,"wires":[["cc01af20.5bcc5"],[]]},{"id":"3a1ca491.7bb3ac","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":800,"y":2100,"wires":[["283606e1.6ff0ba"]]},{"id":"283606e1.6ff0ba","type":"delay","z":"153e4bbb.7f4624","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":990,"y":2100,"wires":[["80d54b26.7eeb48"]]},{"id":"80d54b26.7eeb48","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off Son2's Lamp and Upstairs","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.upstairs_hallway_and_colins_lamp\"}","mergecontext":"","x":1240,"y":2100,"wires":[[]]},{"id":"dd5b26eb.9323c8","type":"api-call-service","z":"153e4bbb.7f4624","name":"Lock front door","server":"5a92f1da.a8503","service_domain":"lock","service":"lock","data":"{ \"entity_id\":\"lock.front_door\" }","mergecontext":"","x":1040,"y":1940,"wires":[[]]},{"id":"e9ca3768.9f1e68","type":"api-call-service","z":"153e4bbb.7f4624","name":"Turn off porch light","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.front_door_switch_level\"}","x":1050,"y":1980,"wires":[[]]},{"id":"f8d3a77.28d5c58","type":"bigtimer","z":"153e4bbb.7f4624","outtopic":"","outpayload1":"","outpayload2":"","name":"90 minutes after sunrise","lat":"40.173508","lon":"-92.58988","starttime":"5000","endtime":"5003","startoff":"0","endoff":"90","offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":true,"atstart":false,"odd":false,"even":false,"x":130,"y":1960,"wires":[[],[],["6b6a131a.ef702c"]]},{"id":"6b6a131a.ef702c","type":"switch","z":"153e4bbb.7f4624","name":"","property":"payload","propertyType":"msg","rules":[{"vt":"str","t":"eq","v":"on"},{"v":"off","vt":"str","t":"eq"}],"checkall":"true","outputs":2,"x":490,"y":1960,"wires":[[],["e9ca3768.9f1e68"]]},{"id":"20af4489.700fcc","type":"ui_button","z":"a3edbf89.1b4e7","name":"button heat","group":"93371ca1.dbf4d","order":2,"width":"2","height":"1","passthru":false,"label":"heat","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":110,"y":1560,"wires":[["b5982737.467ff8"]]},{"id":"60f8b657.1a8f98","type":"ui_button","z":"a3edbf89.1b4e7","name":"button cool","group":"93371ca1.dbf4d","order":3,"width":"2","height":"1","passthru":false,"label":"cool","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":110,"y":1600,"wires":[["fd67b287.f4bce"]]},{"id":"25e0e4cc.488b5c","type":"ui_button","z":"a3edbf89.1b4e7","name":"button off","group":"93371ca1.dbf4d","order":4,"width":"2","height":"1","passthru":false,"label":"off","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":100,"y":1640,"wires":[["861d259e.3f0ba8"]]},{"id":"b06d89d.324a278","type":"api-current-state","z":"a3edbf89.1b4e7","name":"target temp cool","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_number.target_temp_cool","x":620,"y":1780,"wires":[["284ce4ee.854ccc"]],"outputLabels":["data.attributes.temperature"]},{"id":"b5982737.467ff8","type":"api-call-service","z":"a3edbf89.1b4e7","name":"set heat","server":"5a92f1da.a8503","service_domain":"climate","service":"set_operation_mode","data":"{   \"entity_id\": \"climate.hallway_nest\", \"operation_mode\": \"Heat\" }","mergecontext":"","x":260,"y":1560,"wires":[[]]},{"id":"fd67b287.f4bce","type":"api-call-service","z":"a3edbf89.1b4e7","name":"set cool","server":"5a92f1da.a8503","service_domain":"climate","service":"set_operation_mode","data":"{   \"entity_id\": \"climate.hallway_nest\", \"operation_mode\": \"Cool\" }","mergecontext":"","x":260,"y":1600,"wires":[[]]},{"id":"861d259e.3f0ba8","type":"api-call-service","z":"a3edbf89.1b4e7","name":"set off","server":"5a92f1da.a8503","service_domain":"climate","service":"set_operation_mode","data":"{   \"entity_id\": \"climate.hallway_nest\", \"operation_mode\": \"Off\" }","mergecontext":"","x":250,"y":1640,"wires":[[]]},{"id":"acd329af.a63328","type":"server-state-changed","z":"a3edbf89.1b4e7","name":"mode","server":"5a92f1da.a8503","entityidfilter":"climate.hallway_nest","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":110,"y":1760,"wires":[["32306d99.b75322"]]},{"id":"785974a5.b6823c","type":"inject","z":"a3edbf89.1b4e7","name":"init","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"1","x":110,"y":1720,"wires":[["32306d99.b75322"]]},{"id":"617ea36c.87a9cc","type":"ui_text","z":"a3edbf89.1b4e7","group":"93371ca1.dbf4d","order":1,"width":"6","height":"2","name":"currentMode","label":"current mode","format":"{{msg.payload}}","layout":"col-center","x":450,"y":1720,"wires":[]},{"id":"d3106794.9c6938","type":"ui_text","z":"a3edbf89.1b4e7","group":"93371ca1.dbf4d","order":11,"width":"3","height":"1","name":"","label":"stairs","format":"{{msg.payload}}","layout":"col-center","x":390,"y":2040,"wires":[]},{"id":"c17906e6.6dbd28","type":"inject","z":"a3edbf89.1b4e7","name":"init","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.5","x":110,"y":2020,"wires":[["32d96b09.162f14"]]},{"id":"7784b2cc.6430bc","type":"server-state-changed","z":"a3edbf89.1b4e7","name":"state","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_stairs_motion_sensor_temperature","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":2060,"wires":[["32d96b09.162f14"]]},{"id":"32d96b09.162f14","type":"api-current-state","z":"a3edbf89.1b4e7","name":"temp","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.garage_stairs_motion_sensor_temperature","x":250,"y":2040,"wires":[["d3106794.9c6938"]]},{"id":"3f2508e.5b657f8","type":"ui_text","z":"a3edbf89.1b4e7","group":"93371ca1.dbf4d","order":10,"width":"3","height":"1","name":"","label":"garage","format":"{{msg.payload}}","layout":"col-center","x":390,"y":2140,"wires":[]},{"id":"6bbd82b5.c185bc","type":"inject","z":"a3edbf89.1b4e7","name":"init","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.5","x":110,"y":2120,"wires":[["e9145894.619938"]]},{"id":"c88cdd41.bde9a","type":"server-state-changed","z":"a3edbf89.1b4e7","name":"state","server":"5a92f1da.a8503","entityidfilter":"sensor.garage_motion_sensor_temperature","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":2160,"wires":[["e9145894.619938"]]},{"id":"e9145894.619938","type":"api-current-state","z":"a3edbf89.1b4e7","name":"temp","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.garage_motion_sensor_temperature","x":250,"y":2140,"wires":[["3f2508e.5b657f8"]]},{"id":"8600fb4f.aadbd8","type":"ui_text","z":"a3edbf89.1b4e7","group":"93371ca1.dbf4d","order":12,"width":"3","height":"1","name":"","label":"thermostat","format":"{{msg.payload}}","layout":"col-center","x":410,"y":2240,"wires":[]},{"id":"a6ea6f94.570d5","type":"inject","z":"a3edbf89.1b4e7","name":"init","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.5","x":110,"y":2220,"wires":[["153fec27.cd4c74"]]},{"id":"58aebcf1.2fc224","type":"server-state-changed","z":"a3edbf89.1b4e7","name":"state","server":"5a92f1da.a8503","entityidfilter":"climate.hallway_nest","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":110,"y":2260,"wires":[["153fec27.cd4c74"]]},{"id":"32306d99.b75322","type":"api-current-state","z":"a3edbf89.1b4e7","name":"thermostatMode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"climate.hallway_nest","x":260,"y":1740,"wires":[["a8e1ac1.176fb5","617ea36c.87a9cc"]]},{"id":"a8e1ac1.176fb5","type":"switch","z":"a3edbf89.1b4e7","name":"","property":"payload","propertyType":"msg","rules":[{"v":"heat","vt":"str","t":"eq"},{"t":"eq","vt":"str","v":"cool"},{"vt":"str","t":"eq","v":"off"}],"checkall":"true","repair":false,"outputs":3,"x":430,"y":1760,"wires":[["2ff3d62f.6b867a"],["b06d89d.324a278"],["db6813da.2feb7"]]},{"id":"2ff3d62f.6b867a","type":"api-current-state","z":"a3edbf89.1b4e7","name":"target temp heat","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_number.target_temp_heat","x":620,"y":1740,"wires":[["284ce4ee.854ccc"]],"outputLabels":["data.attributes.temperature"]},{"id":"ff56b1b4.57892","type":"ui_button","z":"a3edbf89.1b4e7","name":"raise temp","group":"93371ca1.dbf4d","order":6,"width":"2","height":"1","passthru":false,"label":"raise","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":450,"y":1560,"wires":[["d6594ecc.574af"]]},{"id":"a1ccb6e3.31a568","type":"ui_button","z":"a3edbf89.1b4e7","name":"lower temp","group":"93371ca1.dbf4d","order":7,"width":"2","height":"1","passthru":false,"label":"lower","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":450,"y":1640,"wires":[["f776bcc5.0fbd6"]]},{"id":"284ce4ee.854ccc","type":"ui_text","z":"a3edbf89.1b4e7","group":"93371ca1.dbf4d","order":5,"width":"4","height":"2","name":"targetTempLabel","label":"","format":"{{msg.payload}}","layout":"col-center","x":870,"y":1740,"wires":[]},{"id":"ecbe4eca.8ff1c","type":"api-call-service","z":"a3edbf89.1b4e7","name":"coolRaiseTemp","server":"5a92f1da.a8503","service_domain":"input_number","service":"increment","data":"{\"entity_id\":\"input_number.target_temp_cool\"}","mergecontext":"","x":1000,"y":1580,"wires":[[]]},{"id":"c163cc0b.60a5","type":"server-state-changed","z":"a3edbf89.1b4e7","name":"coolTargetTemp","server":"5a92f1da.a8503","entityidfilter":"input_number.target_temp_cool","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":620,"y":1900,"wires":[["284ce4ee.854ccc","10c7ad7f.1fc513"]]},{"id":"2bd0760c.eff3aa","type":"server-state-changed","z":"a3edbf89.1b4e7","name":"heatTargetTemp","server":"5a92f1da.a8503","entityidfilter":"input_number.target_temp_heat","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":620,"y":1860,"wires":[["284ce4ee.854ccc","5087c70b.770dd8"]]},{"id":"9b9fb2e2.bd5bb","type":"api-call-service","z":"a3edbf89.1b4e7","name":"heatRaiseTemp","server":"5a92f1da.a8503","service_domain":"input_number","service":"increment","data":"{\"entity_id\":\"input_number.target_temp_heat\"}","mergecontext":"","x":1000,"y":1540,"wires":[[]]},{"id":"d6594ecc.574af","type":"api-current-state","z":"a3edbf89.1b4e7","name":"thermostatModeHeat","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"climate.hallway_nest","x":640,"y":1560,"wires":[["617e298.9c58ed8","26d107b5.5b5858"]]},{"id":"617e298.9c58ed8","type":"switch","z":"a3edbf89.1b4e7","name":"","property":"payload","propertyType":"msg","rules":[{"v":"heat","t":"eq","vt":"str"},{"v":"cool","vt":"str","t":"eq"},{"v":"off","vt":"str","t":"eq"}],"checkall":"true","repair":false,"outputs":3,"x":810,"y":1560,"wires":[["9b9fb2e2.bd5bb","cb2a6208.dddc5"],["ecbe4eca.8ff1c"],[]]},{"id":"4cb70d3a.a6db74","type":"api-call-service","z":"a3edbf89.1b4e7","name":"coolLowerTemp","server":"5a92f1da.a8503","service_domain":"input_number","service":"decrement","data":"{\"entity_id\":\"input_number.target_temp_cool\"}","mergecontext":"","x":1000,"y":1660,"wires":[[]]},{"id":"d9426127.ec153","type":"api-call-service","z":"a3edbf89.1b4e7","name":"heatLowerTemp","server":"5a92f1da.a8503","service_domain":"input_number","service":"decrement","data":"{\"entity_id\":\"input_number.target_temp_heat\"}","mergecontext":"","x":1000,"y":1620,"wires":[[]]},{"id":"f776bcc5.0fbd6","type":"api-current-state","z":"a3edbf89.1b4e7","name":"thermostatModeHeat","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"climate.hallway_nest","x":640,"y":1640,"wires":[["c11b1dde.9e931"]]},{"id":"c11b1dde.9e931","type":"switch","z":"a3edbf89.1b4e7","name":"","property":"payload","propertyType":"msg","rules":[{"v":"Heat","t":"eq","vt":"str"},{"v":"Cool","t":"eq","vt":"str"},{"v":"Off","vt":"str","t":"eq"}],"checkall":"true","repair":false,"outputs":3,"x":810,"y":1640,"wires":[["d9426127.ec153"],["4cb70d3a.a6db74"],[]]},{"id":"db6813da.2feb7","type":"change","z":"a3edbf89.1b4e7","name":"","rules":[{"tot":"str","t":"set","pt":"msg","to":"Off","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1820,"wires":[["284ce4ee.854ccc"]]},{"id":"adcd3d6f.ceaf8","type":"api-call-service","z":"a3edbf89.1b4e7","name":"coolSetThermostat","server":"5a92f1da.a8503","service_domain":"climate","service":"set_temperature","data":"{ }","mergecontext":"","x":990,"y":1900,"wires":[[]]},{"id":"10c7ad7f.1fc513","type":"function","z":"a3edbf89.1b4e7","name":"Fn","func":"msg.payload = { data: { 'entity_id': 'climate.hallway_nest','temperature':msg.payload}};\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":1900,"wires":[["adcd3d6f.ceaf8"]]},{"id":"5087c70b.770dd8","type":"function","z":"a3edbf89.1b4e7","name":"Fn","func":"msg.payload = { data: { 'entity_id': 'climate.hallway_nest','temperature':msg.payload}};\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":1860,"wires":[["56c96e2d.bb7f6"]]},{"id":"56c96e2d.bb7f6","type":"api-call-service","z":"a3edbf89.1b4e7","name":"heatSetThermostat","server":"5a92f1da.a8503","service_domain":"climate","service":"set_temperature","data":"{ }","mergecontext":"","x":990,"y":1860,"wires":[[]]},{"id":"153fec27.cd4c74","type":"api-render-template","z":"a3edbf89.1b4e7","name":"temp","server":"5a92f1da.a8503","template":"{{ states.climate.hallway_nest.attributes.current_temperature }}","x":250,"y":2240,"wires":[["8600fb4f.aadbd8","e9af8154.c895c"]]},{"id":"e9af8154.c895c","type":"ui_gauge","z":"a3edbf89.1b4e7","name":"tempGauge","group":"93371ca1.dbf4d","order":8,"width":0,"height":0,"gtype":"gage","title":"temperature","label":"","format":"{{value}}","min":"65","max":"84","colors":["#0096ff","#7af970","#ca3838"],"seg1":"69","seg2":"75","x":430,"y":2200,"wires":[]},{"id":"26d107b5.5b5858","type":"debug","z":"a3edbf89.1b4e7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1150,"y":1760,"wires":[]},{"id":"cb2a6208.dddc5","type":"debug","z":"a3edbf89.1b4e7","name":"raise heat","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1198,"y":1652,"wires":[]},{"id":"ecb2d402.a6dc08","type":"comment","z":"a3edbf89.1b4e7","name":"Thermostat UI","info":"","x":110,"y":1500,"wires":[]},{"id":"26588404.59eb6c","type":"comment","z":"a8777efe.89265","name":"Vacation Mode - Geofence debugging","info":"","x":170,"y":920,"wires":[]},{"id":"c0685c15.446a7","type":"function","z":"c2be485b.36c738","name":"Is vacation mode or guest mode on?","func":"vacation_mode         = global.get('vacation_mode')||null;\nguest_mode          = global.get('guest_mode')||null;\nha_uptime_sec       = global.get('ha_uptime_sec')||1;\n\nmsg.ha_uptime_sec   = ha_uptime_sec;\nmsg.vacation_mode   = vacation_mode;\nmsg.guest_mode      = guest_mode;\n\nif( vacation_mode == 'on' || guest_mode == 'on' || ha_uptime_sec < 600) {\n    msg.abort_alert = 1;\n    return [ msg, null ];\n} else {\n     msg.abort_alert = 0;\n    return [ null, msg ];   \n}","outputs":2,"noerr":0,"x":670,"y":260,"wires":[[],[]],"outputLabels":["abort","continue"]},{"id":"2a49e799.c84f58","type":"api-current-state","z":"c2be485b.36c738","name":"Vacation Mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.vacation_mode","x":620,"y":140,"wires":[["ce7a4ffb.08121"]]},{"id":"cf51724b.12284","type":"api-current-state","z":"c2be485b.36c738","name":"Guest mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.guest_mode","x":610,"y":100,"wires":[["fc406232.b4ca5"]]},{"id":"fc406232.b4ca5","type":"function","z":"c2be485b.36c738","name":"Set global variables","func":"global.set('guest_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":100,"wires":[[]]},{"id":"ce7a4ffb.08121","type":"function","z":"c2be485b.36c738","name":"Set global variables","func":"global.set('vacation_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":140,"wires":[[]]},{"id":"d78187cb.9fe4c8","type":"delay","z":"c2be485b.36c738","name":"","pauseType":"delay","timeout":"250","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":430,"y":260,"wires":[["c0685c15.446a7"]]},{"id":"a1a0bf71.15565","type":"api-current-state","z":"c2be485b.36c738","name":"HA Uptime","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"sensor.ha_uptime_sec","x":610,"y":60,"wires":[["77f13c04.288dc4"]]},{"id":"77f13c04.288dc4","type":"function","z":"c2be485b.36c738","name":"Set global variables","func":"global.set('ha_uptime_sec',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":60,"wires":[[]]},{"id":"f2769a48.5c6d78","type":"comment","z":"c2be485b.36c738","name":"Checks if vacation mode or guest mode is on, and that HA has not restarted in last ten min","info":"","x":830,"y":220,"wires":[]},{"id":"2c035753.dd6468","type":"delay","z":"c2be485b.36c738","name":"","pauseType":"delay","timeout":"250","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":220,"wires":[["cf51724b.12284","2a49e799.c84f58","a1a0bf71.15565","d78187cb.9fe4c8"]]},{"id":"182a438d.a798fc","type":"api-current-state","z":"f89ee080.71ad2","name":"Vacation mode","server":"5a92f1da.a8503","outputs":1,"halt_if":"","entity_id":"input_boolean.vacation_mode","x":500,"y":1060,"wires":[["edc5e7b3.ec0d08"]]},{"id":"edc5e7b3.ec0d08","type":"function","z":"f89ee080.71ad2","name":"Set global variables","func":"global.set('vacation_mode',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1060,"wires":[[]]},{"id":"e449d623.67c7c8","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","name":"","x":660,"y":180,"wires":[["35b50056.771a3"]]},{"id":"f8fd35e2.e903d8","type":"subflow:c2be485b.36c738","z":"bfbb9b56.a1ffa8","x":580,"y":1040,"wires":[[]]},{"id":"27d6a3e.9091c5c","type":"inject","z":"bfbb9b56.a1ffa8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":1040,"wires":[["66ebc32e.90a4ec"]]},{"id":"63c02f33.1c5b2","type":"debug","z":"bfbb9b56.a1ffa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":830,"y":1040,"wires":[]},{"id":"4783084d.3577f8","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","name":"","x":740,"y":360,"wires":[["77f6be47.4e337","a88f4f91.18a29"]]},{"id":"c33a37cf.2ecac8","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":680,"y":780,"wires":[["50b5d9e0.bbf838"]]},{"id":"52517fae.7db3","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":680,"y":900,"wires":[["9814f7d0.80f3d8"]]},{"id":"2dc7df7a.2bf79","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":1280,"y":1020,"wires":[["ca7ff7db.c03938","c6eb0ca7.06464","3e4acc70.43b544","362ba1fd.b66a0e","c859f054.912a7"]]},{"id":"6880bc2e.c3c5b4","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":460,"y":1100,"wires":[["3041b14e.a9a75e","9fe89066.9fcf1"]]},{"id":"ee811157.9e206","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":400,"y":1280,"wires":[["6f3d295d.1a5f28"]]},{"id":"2d03af56.d77e7","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":760,"y":1800,"wires":[["90a8d2f2.9f455","92a91414.1a9358"]]},{"id":"7111c965.b51b88","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":740,"y":1900,"wires":[["ca61e1bf.e8b94","a115515c.72f5a","dd5b26eb.9323c8"]]},{"id":"cc01af20.5bcc5","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":540,"y":2100,"wires":[["3a1ca491.7bb3ac"]]},{"id":"27d04336.59274c","type":"subflow:c2be485b.36c738","z":"153e4bbb.7f4624","x":360,"y":2420,"wires":[["62350568.a39ddc"]]},{"id":"d7c03078.4b92e","type":"subflow:5217c125.f919f","z":"a8777efe.89265","x":740,"y":700,"wires":[["59037f0e.5fdde"]]},{"id":"66ebc32e.90a4ec","type":"subflow:5217c125.f919f","z":"bfbb9b56.a1ffa8","name":"","x":600,"y":1140,"wires":[["63c02f33.1c5b2"]]},{"id":"b0dc4404.3f0368","type":"subflow:7224a2bd.67bcdc","z":"bfbb9b56.a1ffa8","name":"","x":560,"y":1200,"wires":[[]]},{"id":"62350568.a39ddc","type":"subflow:7224a2bd.67bcdc","z":"153e4bbb.7f4624","x":420,"y":2460,"wires":[["1b788ea1.c64f01"]]},{"id":"2c3d4ffe.7c92a","type":"server-state-changed","z":"a8777efe.89265","name":"Wifes Location Changed","server":"5a92f1da.a8503","entityidfilter":"device_tracker.wifes_iphone","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":960,"wires":[["ead96f8f.37bd7"]]},{"id":"6bcb6c4c.1a3834","type":"server-state-changed","z":"a8777efe.89265","name":"Walts Location Changed","server":"5a92f1da.a8503","entityidfilter":"device_tracker.walts_iphone","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":1000,"wires":[["ead96f8f.37bd7"]]},{"id":"46835e03.a4394","type":"geofence","z":"a8777efe.89265","name":"Away","mode":"circle","inside":"false","rad":97521.8720487219,"points":[],"centre":{"longitude":-92.5927734375,"latitude":40.1956590933647},"x":650,"y":960,"wires":[["435c39de.c96048"]]},{"id":"ead96f8f.37bd7","type":"function","z":"a8777efe.89265","name":"Format device_tracker data","func":"newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\nwife_lat        = parseFloat(global.get('wife_latitude'))||null;\nwife_lon        = parseFloat(global.get('wife_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - wife_lat);\nlon_diff        = Math.abs(walt_lon - wife_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.wife_lat = wife_lat;\nnewmsg.wife_lon = wife_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}","outputs":1,"noerr":0,"x":420,"y":980,"wires":[["46835e03.a4394","810bb051.9c59f","eb44cc61.6140f"]]},{"id":"435c39de.c96048","type":"debug","z":"a8777efe.89265","name":"Away","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":850,"y":960,"wires":[]},{"id":"810bb051.9c59f","type":"geofence","z":"a8777efe.89265","name":"Back","mode":"circle","inside":"true","rad":97521.8720487219,"points":[],"centre":{"longitude":-92.5927734375,"latitude":40.1956590933647},"x":650,"y":1000,"wires":[["5ae95332.228e0c"]]},{"id":"5ae95332.228e0c","type":"debug","z":"a8777efe.89265","name":"Back","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":850,"y":1000,"wires":[]},{"id":"eb44cc61.6140f","type":"debug","z":"a8777efe.89265","name":"After format","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":650,"y":1040,"wires":[]},{"id":"805e8864.664128","type":"server-state-changed","z":"a8777efe.89265","name":"Wifes Location Changed","server":"5a92f1da.a8503","entityidfilter":"device_tracker.wifes_iphone","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":1160,"wires":[["5306270b.bffe58"]]},{"id":"56d1467c.3f9e58","type":"server-state-changed","z":"a8777efe.89265","name":"Walts Location Changed","server":"5a92f1da.a8503","entityidfilter":"device_tracker.walts_iphone","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":130,"y":1200,"wires":[["5306270b.bffe58"]]},{"id":"5306270b.bffe58","type":"function","z":"a8777efe.89265","name":"Format device_tracker data","func":"newmsg = {};\n\n// Get the person we for this event\n// and their previous location\nperson          = msg.data.old_state.attributes.friendly_name.toLowerCase();\nprevious_loc    = global.get(person + '_previous_loc')||null;\n\n\n// Get the last GPS coordinates for both of us. These get set in a \n// loop in the Utilities tab.\nwalt_lat        = parseFloat(global.get('walt_latitude'))||null;\nwalt_lon        = parseFloat(global.get('walt_longitude'))||null;\nwife_lat        = parseFloat(global.get('wife_latitude'))||null;\nwife_lon        = parseFloat(global.get('wife_longitude'))||null;\n\n// What direction are we headed?\n//\n// Still in the same zone as before\nif (msg.data.new_state.state == msg.data.old_state.state) {\n    verb        = 'unknown';\n    location    = msg.data.new_state.state;\n// Leaving a zone\n} else if (msg.data.new_state.state == 'not_home') {\n    verb        = 'left';\n    location    = msg.data.old_state.state;\n// Entering a new zone\n} else {    \n    verb        = 'is at';\n    location    = msg.data.new_state.state;\n}\n\n// Do the math to see how far apart we are\nlat_diff        = Math.abs(walt_lat - wife_lat);\nlon_diff        = Math.abs(walt_lon - wife_lon);\n\nif ( lat_diff > 0.003 || lon_diff > 0.003 ) {\n    newmsg.apart   = 1;\n} else {\n    newmsg.apart   = 0;\n}\n\n// Does this event have us\n// in the same zone as we were last?\nif (location == previous_loc) {\n    newmsg.samezone = 1;\n    newmsg.previous_loc = previous_loc;\n// If not, update our global variables\n} else {\n    newmsg.samezone = 0;\n    newmsg.previous_loc = previous_loc;\n    global.set(person + '_previous_loc', location);\n}\n\n// Build our message object\nnewmsg.walt_lat = walt_lat;\nnewmsg.walt_lon = walt_lon;\nnewmsg.wife_lat = wife_lat;\nnewmsg.wife_lon = wife_lon;\nnewmsg.lat_diff = lat_diff;\nnewmsg.lon_diff = lon_diff;\nnewmsg.person   = person;\nnewmsg.loc      = location;\nnewmsg.verb     = verb;\nnewmsg.lat      = msg.data.new_state.attributes.latitude;\nnewmsg.lon      = msg.data.new_state.attributes.longitude;\nnewmsg.payload  = { data: {'message': capitalizeFirstLetter(person) + ' ' + verb + ' ' + location } };\n\nreturn newmsg;\n\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}","outputs":1,"noerr":0,"x":420,"y":1180,"wires":[["cb63e694.d76d68","a026c851.30aa08","4f485dc9.cdd944"]]},{"id":"86b37107.4171a","type":"geofence","z":"a8777efe.89265","name":"Away","mode":"circle","inside":"false","rad":97521.8720487219,"points":[],"centre":{"latitude":40.1956590933647,"longitude":-92.5927734375},"x":790,"y":1160,"wires":[["83aeb49f.156918"]]},{"id":"781bfa5.6184e04","type":"geofence","z":"a8777efe.89265","name":"Back","mode":"circle","inside":"true","rad":97521.8720487219,"points":[],"centre":{"latitude":40.1956590933647,"longitude":-92.5927734375},"x":790,"y":1220,"wires":[["d3624592.c2fa18"]]},{"id":"cb63e694.d76d68","type":"change","z":"a8777efe.89265","name":"Check Walt","rules":[{"tot":"msg","t":"set","pt":"msg","to":"lat","p":"walt_lat"},{"tot":"msg","t":"set","p":"walt_lon","pt":"msg","to":"lon"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":1160,"wires":[["86b37107.4171a"]]},{"id":"83aeb49f.156918","type":"change","z":"a8777efe.89265","name":"Check Wife","rules":[{"t":"set","tot":"msg","p":"wife_lat","pt":"msg","to":"lat"},{"tot":"msg","t":"set","pt":"msg","to":"lon","p":"wife_lon"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":1160,"wires":[["be05087.4e6d3f8"]]},{"id":"be05087.4e6d3f8","type":"geofence","z":"a8777efe.89265","name":"Away","mode":"circle","inside":"false","rad":97521.8720487219,"points":[],"centre":{"longitude":-92.5927734375,"latitude":40.1956590933647},"x":1070,"y":1160,"wires":[["8bc2a429.a8dc58"]]},{"id":"a026c851.30aa08","type":"change","z":"a8777efe.89265","name":"Check Walt","rules":[{"tot":"msg","t":"set","pt":"msg","to":"lat","p":"walt_lat"},{"pt":"msg","to":"lon","p":"walt_lon","t":"set","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":1200,"wires":[["781bfa5.6184e04"]]},{"id":"4f485dc9.cdd944","type":"change","z":"a8777efe.89265","name":"Check Wife","rules":[{"tot":"msg","t":"set","p":"wife_lat","pt":"msg","to":"lat"},{"p":"wife_lon","pt":"msg","to":"lon","t":"set","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":1240,"wires":[["781bfa5.6184e04"]]},{"id":"dc36de66.d441d","type":"api-call-service","z":"a8777efe.89265","name":"Turn off vacation mode","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_off","data":"{ \"entity_id\":\"input_boolean.vacation_mode\" }","mergecontext":"","x":1420,"y":1220,"wires":[[]]},{"id":"d9dbb495.7121a8","type":"api-call-service","z":"a8777efe.89265","name":"Turn on vacation mode","server":"5a92f1da.a8503","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\":\"input_boolean.vacation_mode\" }","mergecontext":"","x":1660,"y":1160,"wires":[[]]},{"id":"46831087.966e5","type":"comment","z":"a8777efe.89265","name":"Automatically turn on Vacation Mode","info":"","x":160,"y":1120,"wires":[]},{"id":"8bc2a429.a8dc58","type":"api-current-state","z":"a8777efe.89265","name":"Stop if vacation mode on","server":"5a92f1da.a8503","outputs":1,"halt_if":"on","entity_id":"input_boolean.vacation_mode","x":1250,"y":1160,"wires":[["fa983489.29f568"]]},{"id":"be59fae6.71f798","type":"api-call-service","z":"a8777efe.89265","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1810,"y":1200,"wires":[[]]},{"id":"8d2fd771.dbf6d8","type":"function","z":"a8777efe.89265","name":"Format message","func":"msg.payload = { data: {'message': 'Turning on vacation mode for the house. Lighting will randomly simulate occupancy' } };\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":1200,"wires":[["be59fae6.71f798"]]},{"id":"693876b5.334cf8","type":"function","z":"a8777efe.89265","name":"Format message","func":"msg.payload = { data: {'message': 'Turning off vacation mode for the house' } };\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":1260,"wires":[["90e4b1f5.26655"]]},{"id":"90e4b1f5.26655","type":"api-call-service","z":"a8777efe.89265","name":"Notify Family","server":"5a92f1da.a8503","service_domain":"notify","service":"family_iphones","data":"{ \"message\": \"msg\" }","x":1590,"y":1260,"wires":[[]]},{"id":"1bc9eaf.4497415","type":"comment","z":"a8777efe.89265","name":"Vacation Mode","info":"","x":100,"y":1440,"wires":[]},{"id":"2f79c57d.13cb4a","type":"server-state-changed","z":"a8777efe.89265","name":"Vacation mode on","server":"5a92f1da.a8503","entityidfilter":"input_boolean.vacation_mode","entityidfiltertype":"exact","haltifstate":"off","outputs":1,"x":110,"y":1480,"wires":[["fa385647.90a438"]]},{"id":"f68491b0.8d358","type":"vacation-timer","z":"a8777efe.89265","name":"Outside Lights (Morning)","lat":"40.1894","lon":"-92.58254","turnOffOnDaysOff":true,"midnightSchedule":true,"onTime":"06:45","randMinutes":"30","offTime":"14:00","randOffMinutes":"0","minOnHours":"1","minOnMinutes":"0","maxOnHours":"2","maxOnMinutes":"5","stopTab":"tab-1","onPayloadType":"str","onPayloadVal":"on","onTopicVal":"","offPayloadType":"str","offPayloadVal":"off","offTopicVal":"","suspended":true,"disableMax":false,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"x":750,"y":1400,"wires":[["2f62e3b2.b2963c"]]},{"id":"fa385647.90a438","type":"change","z":"a8777efe.89265","name":"Turn on vacation timer","rules":[{"tot":"str","t":"set","to":"start","pt":"msg","p":"payload"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":1480,"wires":[["f2a454fc.ff3ad8"]]},{"id":"fe045de5.73348","type":"server-state-changed","z":"a8777efe.89265","name":"Vacation mode off","server":"5a92f1da.a8503","entityidfilter":"input_boolean.vacation_mode","entityidfiltertype":"exact","haltifstate":"on","outputs":1,"x":110,"y":1520,"wires":[["696290db.53d02"]]},{"id":"696290db.53d02","type":"change","z":"a8777efe.89265","name":"Turn off vacation timer","rules":[{"p":"payload","pt":"msg","to":"stop","tot":"str","t":"set"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":1520,"wires":[["f2a454fc.ff3ad8"]]},{"id":"9ef0f413.8df408","type":"api-call-service","z":"a8777efe.89265","name":"Turn on porch light","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}","mergecontext":"","x":1150,"y":1400,"wires":[[]]},{"id":"2f62e3b2.b2963c","type":"switch","z":"a8777efe.89265","name":"","property":"payload","propertyType":"msg","rules":[{"v":"on","vt":"str","t":"eq"},{"vt":"str","t":"eq","v":"off"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":1420,"wires":[["9ef0f413.8df408"],["354b850a.7e494a"]]},{"id":"354b850a.7e494a","type":"api-call-service","z":"a8777efe.89265","name":"Turn off porch light","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.front_door_switch_level\",\"brightness\":\"15\"}","mergecontext":"","x":1150,"y":1440,"wires":[[]]},{"id":"d3624592.c2fa18","type":"api-current-state","z":"a8777efe.89265","name":"Stop if vacation mode off","server":"5a92f1da.a8503","outputs":1,"halt_if":"off","entity_id":"input_boolean.vacation_mode","x":990,"y":1220,"wires":[["ca5dea13.aa97c8"]]},{"id":"2b53719b.ca30ce","type":"vacation-timer","z":"a8777efe.89265","name":"Main Level Lights (Weekdays)","lat":"40.1894","lon":"-92.58254","turnOffOnDaysOff":true,"midnightSchedule":true,"onTime":"dusk","randMinutes":"55","offTime":"14:00","randOffMinutes":"0","minOnHours":"1","minOnMinutes":"0","maxOnHours":"4","maxOnMinutes":"5","stopTab":"tab-1","onPayloadType":"str","onPayloadVal":"on","onTopicVal":"","offPayloadType":"str","offPayloadVal":"off","offTopicVal":"","suspended":true,"disableMax":false,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":770,"y":1480,"wires":[["ebb9d561.9e5208"]]},{"id":"a78f8cbf.d5f9b","type":"vacation-timer","z":"a8777efe.89265","name":"Main Level Lights (Weekends)","lat":"40.1894","lon":"-92.58254","turnOffOnDaysOff":true,"midnightSchedule":true,"onTime":"18:00","randMinutes":"55","offTime":"14:00","randOffMinutes":"0","minOnHours":"1","minOnMinutes":"0","maxOnHours":"4","maxOnMinutes":"5","stopTab":"tab-1","onPayloadType":"str","onPayloadVal":"on","onTopicVal":"","offPayloadType":"str","offPayloadVal":"off","offTopicVal":"","suspended":true,"disableMax":false,"sun":true,"mon":false,"tue":false,"wed":false,"thu":false,"fri":false,"sat":true,"x":770,"y":1520,"wires":[["ebb9d561.9e5208"]]},{"id":"f2a454fc.ff3ad8","type":"switch","z":"a8777efe.89265","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":1500,"wires":[["f68491b0.8d358","a9d8a9fa.3cdd78","2b53719b.ca30ce","a78f8cbf.d5f9b","e9331d56.bb4e6","e93b3dd7.7aadf"]]},{"id":"a9d8a9fa.3cdd78","type":"vacation-timer","z":"a8777efe.89265","name":"Outside Lights (Evening)","lat":"40.1894","lon":"-92.58254","turnOffOnDaysOff":true,"midnightSchedule":true,"onTime":"dusk","randMinutes":"30","offTime":"14:00","randOffMinutes":"0","minOnHours":"3","minOnMinutes":"0","maxOnHours":"5","maxOnMinutes":"5","stopTab":"tab-1","onPayloadType":"str","onPayloadVal":"on","onTopicVal":"","offPayloadType":"str","offPayloadVal":"off","offTopicVal":"","suspended":true,"disableMax":false,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"x":750,"y":1440,"wires":[["2f62e3b2.b2963c"]]},{"id":"ebb9d561.9e5208","type":"switch","z":"a8777efe.89265","name":"","property":"payload","propertyType":"msg","rules":[{"v":"on","t":"eq","vt":"str"},{"vt":"str","t":"eq","v":"off"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":1500,"wires":[["ca4766fe.43f2d8"],["9022260c.ac0c98"]]},{"id":"e9331d56.bb4e6","type":"vacation-timer","z":"a8777efe.89265","name":"Upstairs (Weekdays)","lat":"40.1894","lon":"-92.58254","turnOffOnDaysOff":true,"midnightSchedule":true,"onTime":"dusk","randMinutes":"55","offTime":"14:00","randOffMinutes":"0","minOnHours":"2","minOnMinutes":"0","maxOnHours":"4","maxOnMinutes":"5","stopTab":"tab-1","onPayloadType":"str","onPayloadVal":"on","onTopicVal":"","offPayloadType":"str","offPayloadVal":"off","offTopicVal":"","suspended":true,"disableMax":false,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"x":740,"y":1560,"wires":[["5c7b1cb9.89fce4"]]},{"id":"e93b3dd7.7aadf","type":"vacation-timer","z":"a8777efe.89265","name":"Upstairs (Weekends)","lat":"40.1894","lon":"-92.58254","turnOffOnDaysOff":true,"midnightSchedule":true,"onTime":"18:00","randMinutes":"55","offTime":"14:00","randOffMinutes":"0","minOnHours":"1","minOnMinutes":"0","maxOnHours":"4","maxOnMinutes":"5","stopTab":"tab-1","onPayloadType":"str","onPayloadVal":"on","onTopicVal":"","offPayloadType":"str","offPayloadVal":"off","offTopicVal":"","suspended":true,"disableMax":false,"sun":true,"mon":false,"tue":false,"wed":false,"thu":false,"fri":false,"sat":true,"x":740,"y":1600,"wires":[["5c7b1cb9.89fce4"]]},{"id":"5c7b1cb9.89fce4","type":"switch","z":"a8777efe.89265","name":"","property":"payload","propertyType":"msg","rules":[{"v":"on","t":"eq","vt":"str"},{"vt":"str","t":"eq","v":"off"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":1580,"wires":[["79179a47.6cd7a4"],["8775e8dc.f8ca38"]]},{"id":"ca4766fe.43f2d8","type":"api-call-service","z":"a8777efe.89265","name":"Main Level Lights on","server":"5a92f1da.a8503","service_domain":"scene","service":"turn_on","data":"{ \"entity_id\": \"scene.main_level_lights\" }","x":1160,"y":1480,"wires":[[]]},{"id":"9022260c.ac0c98","type":"api-call-service","z":"a8777efe.89265","name":"Main Level Lights off","server":"5a92f1da.a8503","service_domain":"scene","service":"turn_off","data":"{ \"entity_id\": \"scene.main_level_lights\" }","mergecontext":"","x":1160,"y":1520,"wires":[[]]},{"id":"79179a47.6cd7a4","type":"api-call-service","z":"a8777efe.89265","name":"Upstairs Lights on","server":"5a92f1da.a8503","service_domain":"light","service":"turn_on","data":"{ \"entity_id\": \"group.upstairs\" }","mergecontext":"","x":1150,"y":1560,"wires":[[]]},{"id":"8775e8dc.f8ca38","type":"api-call-service","z":"a8777efe.89265","name":"Upstairs Lights off","server":"5a92f1da.a8503","service_domain":"light","service":"turn_off","data":"{ \"entity_id\": \"group.upstairs\" }","mergecontext":"","x":1150,"y":1600,"wires":[[]]},{"id":"397fc58f.02103a","type":"server-state-changed","z":"153e4bbb.7f4624","name":"Basement Back Door","server":"5a92f1da.a8503","version":0,"entityidfilter":"sensor.basement_back_door_access_control","entityidfiltertype":"exact","haltifstate":"","outputs":1,"x":120,"y":240,"wires":[["4f7201ed.606dd"]]},{"id":"fa983489.29f568","type":"delay","z":"a8777efe.89265","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1460,"y":1160,"wires":[["d9dbb495.7121a8","8d2fd771.dbf6d8"]]},{"id":"ca5dea13.aa97c8","type":"delay","z":"a8777efe.89265","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1200,"y":1220,"wires":[["dc36de66.d441d","693876b5.334cf8"]]},{"id":"a10e9ff8.27665","type":"fs-ops-access","z":"f89ee080.71ad2","name":"Stopped manually?","path":"/Users/hass/.homeassistant","pathType":"str","filename":"hass.stopped","filenameType":"str","read":true,"write":false,"throwerror":false,"x":2210,"y":2160,"wires":[["3efe8e38.cef0b2"],["7543919.ee9297","23a2e3a8.835e8c","27fa24da.7d762c"]]},{"id":"a02798ac.a377f8","type":"tuya-smart","z":"9ed92167.b9b4c","deviceName":"Fletcher Lamp","deviceIp":"192.168.1.163","deviceId":"41450046cc50e314707a","deviceKey":"896da5d502f04d5c","request":"{\"schema\": true}","pollingInterval":10,"x":560,"y":300,"wires":[["e9226d51.f1f62"]]},{"id":"6b02cc12.05b904","type":"api-current-state","z":"d597f158.7ca1b","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.workday_sensor","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":230,"y":160,"wires":[["e9ca123.59ae8f"]]},{"id":"5ee2aee3.b8843","type":"switch","z":"d597f158.7ca1b","name":"turn on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":480,"y":300,"wires":[["786776de.e06e88"],["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"3d471aec.93fac6","type":"api-call-service","z":"404de206.015e2c","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":" light.karien_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1260,"y":860,"wires":[[]]},{"id":"d1f382d8.fa782","type":"inject","z":"404de206.015e2c","name":"21:40 (19:40 in UTC)","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"40 19 * * 1,2,3,4,5","once":false,"onceDelay":"","x":160,"y":840,"wires":[["c911ea62.762698","86b4474b.f2eb38","5b0dc51c.a7196c"]]},{"id":"c911ea62.762698","type":"api-current-state","z":"404de206.015e2c","name":"Karien Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.karien_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":930,"y":860,"wires":[[],["3d471aec.93fac6"]]},{"id":"346f73c6.c90d6c","type":"bigtimer","z":"404de206.015e2c","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Sunset","comment":"","lat":"-26.0188","lon":"28.0194","starttime":"5004","endtime":"1185","starttime2":0,"endtime2":0,"startoff":"-20","endoff":"-10","startoff2":0,"endoff2":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":120,"y":560,"wires":[["191686b4.f01db9"],[],[]]},{"id":"624354bb.5cc43c","type":"inject","z":"404de206.015e2c","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":700,"wires":[["346f73c6.c90d6c"]]},{"id":"c8d05dc6.c2216","type":"inject","z":"404de206.015e2c","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":740,"wires":[["346f73c6.c90d6c"]]},{"id":"df3078bc.8cd298","type":"inject","z":"404de206.015e2c","name":"off","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":780,"wires":[["346f73c6.c90d6c"]]},{"id":"d691f6cd.18ffc8","type":"inject","z":"62b25e5c.7bcc","name":"Red","topic":"","payload":"{\"entity_id\":\"light.bedroom_lamps\",\"color_name\":\"red\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":140,"wires":[["20f707df.63e388"]]},{"id":"20f707df.63e388","type":"api-call-service","z":"62b25e5c.7bcc","name":"","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":480,"y":140,"wires":[["b59ff7d8.b3e458"]]},{"id":"608a18b9.5e8fb8","type":"inject","z":"62b25e5c.7bcc","name":"Blue","topic":"","payload":"{\"entity_id\":\"light.bedroom_lamps\",\"rgb_color\":[0,0,255]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":200,"wires":[["20f707df.63e388"]]},{"id":"b59ff7d8.b3e458","type":"debug","z":"62b25e5c.7bcc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":820,"y":160,"wires":[]},{"id":"8a25d293.e0fab","type":"mqtt in","z":"30ed7e94.3c6102","name":"","topic":"cmnd/loungergbw/#","qos":"2","datatype":"auto","broker":"6eb36010.171f5","x":100,"y":220,"wires":[["71691329.35540c"]]},{"id":"71691329.35540c","type":"debug","z":"30ed7e94.3c6102","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":220,"wires":[]},{"id":"2b490197.dc24de","type":"udp out","z":"9507aa40.718448","name":"MiLight UDP send","addr":"255.255.255.255","iface":"","port":"8899","outport":"","base64":false,"multicast":"false","x":859.6111450195312,"y":273.2778015136719,"wires":[]},{"id":"c4b86c1.eea7c9","type":"mqtt in","z":"9507aa40.718448","name":"Lights MQTT","topic":"lights/+/+","broker":"477fc8ec.536878","x":127.75,"y":274,"wires":[["39d39e3e.684232"]]},{"id":"39d39e3e.684232","type":"function","z":"9507aa40.718448","name":"parse light commands","func":"var newMsg = [];\nvar topics = msg.topic.split(\"/\");\nvar group = parseInt(topics[1]);\nvar command = topics[2];\nswitch (command) {\n\tcase \"power\":\n\t\t//\"on\" or \"off\"\n\t\tnewMsg={payload:{command:msg.payload,value:group}};\n\t\tbreak;\n\tcase \"whitemode\":\n\t\t//should be \"yes\"\n\t\tif ( msg.payload == \"yes\" ) {\n\t\t\tnewMsg=[{payload:{command:\"on\",value:group}},{payload:{command:\"whiteMode\",value:group}}];\n\t\t}\n\t\tbreak;\n\tcase \"hue\":\n\t\t//should be 0-255, not checking it\n\t\tnewMsg=[{payload:{command:\"on\",value:group}},{payload:{command:\"hue\",value:parseInt(msg.payload)}}];\n\t\tbreak;\n\tcase \"brightness\":\n\t\t//should be 1-100, not checking it\n\t\tnewMsg=[{payload:{command:\"on\",value:group}},{payload:{command:\"brightness\",value:parseInt(msg.payload)}}];\n\t\tbreak;\n\tcase \"disco\":\n\t\tswitch (msg.payload) {\n\t\t\t//check if I have to turn them on first\n\t\t\tcase \"yes\":\n\t\t\t\tnewMsg=[{payload:{command:\"on\",value:group}},{payload:{command:\"discoMode\",value:\"\"}}];\n\t\t\t\tbreak;\n\t\t\tcase \"up\":\n\t\t\t\tnewMsg=[{payload:{command:\"on\",value:group}},{payload:{command:\"discoMode\",value:\"\"}},{payload:{command:\"discoSpeedUp\",value:\"\"}}];\n\t\t\t\tbreak;\n\t\t\tcase \"down\":\n\t\t\t\tnewMsg=[{payload:{command:\"on\",value:group}},{payload:{command:\"discoMode\",value:\"\"}},{payload:{command:\"discoSpeedDown\",value:\"\"}}];\n\t\t\t\tbreak;\n\t\t}\n\t\tbreak;\n}\nreturn [newMsg]; ","outputs":1,"noerr":0,"x":312.99999618530273,"y":273.88889598846436,"wires":[["f206ce8a.9705b"]]},{"id":"8e918d76.848d","type":"delay","z":"9507aa40.718448","name":"","pauseType":"rate","timeout":"100","timeoutUnits":"milliseconds","rate":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":686.5277709960938,"y":274.0278015136719,"wires":[["2b490197.dc24de"]]},{"id":"f206ce8a.9705b","type":"function","z":"9507aa40.718448","name":"Translate to Miligt","func":"//wifibox 4 should handle 2 byte data (on limitlessled they mentrion only wifi box 3)\nvar commandCode = [];\nswitch ( msg.payload.command ) {\n\tcase \"on\":\n\t\tcommandCode = [[0x42,0x45,0x47,0x49,0x4B][msg.payload.value],0x00]; \n\t\tbreak;\n\tcase \"off\":\n\t\tcommandCode = [[0x41,0x46,0x48,0x4A,0x4C][msg.payload.value],0x00];\n\t\tbreak;\n\tcase \"hue\": //0-255\n\t\tvar hex = msg.payload.value.toString(16);\n\t\thex = (hex.length < 2) ? '0x0'+hex : '0x'+hex;\n\t\tcommandCode = [0x40,hex];\n\t\tbreak;\n\tcase \"whiteMode\":\n\t\tcommandCode = [[0xC2,0xC5,0xC7,0xC9,0xCB][msg.payload.value],0x00];\n\t\tbreak;\n\tcase \"brightness\": //1-100 => 2 to 27\n\t\tvar hex = Math.max(2,(Math.ceil((msg.payload.value-1)/99*25))+2).toString(16);\n\t\thex = (hex.length < 2) ? '0x0'+hex : '0x'+hex;\n\t\tcommandCode= [0x4E,hex];\n\t\tbreak;\n\tcase \"discoMode\":\n\t\tcommandCode = [0x4D,0x00];\n\t\tbreak;\n\tcase \"discoSpeedUp\":\n\t\tcommandCode = [0x44,0x00];\n\t\tbreak;\n\tcase \"discoSpeedDown\":\n\t\tcommandCode = [0x43,0x00];\n\t\tbreak;\n};\n//commandCode[2]=0x55;\nmsg.payload = new Buffer(commandCode);\nreturn msg;;","outputs":1,"x":512.8611145019531,"y":274.1111145019531,"wires":[["8e918d76.848d"]]},{"id":"588d4390.c74a9c","type":"inject","z":"30ed7e94.3c6102","name":"red","topic":"cmnd/loungergbw/Color2","payload":"255,0,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":400,"wires":[["cd48cc83.dbbab"]]},{"id":"cd48cc83.dbbab","type":"mqtt out","z":"30ed7e94.3c6102","name":"","topic":"","qos":"","retain":"","broker":"6eb36010.171f5","x":450,"y":400,"wires":[]},{"id":"9623e98a.b0eab8","type":"inject","z":"30ed7e94.3c6102","name":"off","topic":"cmnd/loungergbw/POWER","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":480,"wires":[["cd48cc83.dbbab"]]},{"id":"11c60be7.c01cf4","type":"inject","z":"30ed7e94.3c6102","name":"off","topic":"cmnd/loungergbw/POWER","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":540,"wires":[["cd48cc83.dbbab"]]},{"id":"81c4f18.c5a641","type":"api-current-state","z":"404de206.015e2c","name":"Is someone at home?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_occupied","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":560,"wires":[["5ee18028.53931"],["86b4474b.f2eb38","c911ea62.762698"]]},{"id":"191686b4.f01db9","type":"change","z":"404de206.015e2c","name":"set desired state to a flow variable","rules":[{"t":"set","p":"light.sunset.desiredstate","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":680,"wires":[["81c4f18.c5a641"]]},{"id":"5ee18028.53931","type":"switch","z":"404de206.015e2c","name":"turn on or off?","property":"light.sunset.desiredstate","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"ON","vt":"str"},{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"OFF","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":760,"y":521,"wires":[["a4457a8.d4a1a88","c7c6335b.e9c39"],["c7c6335b.e9c39","a4457a8.d4a1a88"],["c911ea62.762698","86b4474b.f2eb38"],["c911ea62.762698","86b4474b.f2eb38"]]},{"id":"ec882cf3.28bc2","type":"api-call-service","z":"404de206.015e2c","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.karien_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1300,"y":660,"wires":[[]]},{"id":"c7c6335b.e9c39","type":"api-current-state","z":"404de206.015e2c","name":"Karien Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.karien_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1050,"y":640,"wires":[[],["ec882cf3.28bc2"]]},{"id":"101e72d0.bd78fd","type":"delay","z":"404de206.015e2c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":500,"wires":[[]]},{"id":"d66b35d2.53f308","type":"mqtt out","z":"2301760b.f35afa","name":"","topic":"","qos":"","retain":"","broker":"ff74e238.fe90b","x":630,"y":360,"wires":[]},{"id":"3f825c2d.fbbc94","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/POWER","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":260,"wires":[["d66b35d2.53f308"]]},{"id":"a3867c8.98bd18","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/POWER","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":300,"wires":[["d66b35d2.53f308"]]},{"id":"ac8e4532.bc39b8","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Color2","payload":"255,0,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":380,"wires":[["d66b35d2.53f308"]]},{"id":"ef0c8693.86e198","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Color2","payload":"0,0,255","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":420,"wires":[["d66b35d2.53f308"]]},{"id":"fa62f773.c5c758","type":"mqtt in","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/#","qos":"2","datatype":"auto","broker":"ff74e238.fe90b","x":170,"y":180,"wires":[["eba65dfd.a4a6c"]]},{"id":"eba65dfd.a4a6c","type":"debug","z":"2301760b.f35afa","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":180,"wires":[]},{"id":"e6054fef.9dd62","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"100","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":820,"wires":[["d66b35d2.53f308"]]},{"id":"5bb588ac.d18318","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"75","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":780,"wires":[["d66b35d2.53f308"]]},{"id":"a7b27a34.5e14f8","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"50","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":740,"wires":[["d66b35d2.53f308"]]},{"id":"b19e509b.821a","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Color2","payload":"0,255,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":460,"wires":[["d66b35d2.53f308"]]},{"id":"b5063146.9f1b7","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Color2","payload":"255,255,255","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":500,"wires":[["d66b35d2.53f308"]]},{"id":"311dc66b.da2dda","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Scheme","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":700,"y":480,"wires":[["d66b35d2.53f308"]]},{"id":"6e9f33d5.9a6ebc","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Scheme","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":700,"y":520,"wires":[["d66b35d2.53f308"]]},{"id":"5eca8603.31ee38","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Scheme","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":700,"y":560,"wires":[["d66b35d2.53f308"]]},{"id":"b5779d0a.8eea2","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Scheme","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":700,"y":600,"wires":[["d66b35d2.53f308"]]},{"id":"623e8f13.a5854","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Scheme","payload":"4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":700,"y":640,"wires":[["d66b35d2.53f308"]]},{"id":"de9b1013.c6385","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Color","payload":"8","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":660,"wires":[["d66b35d2.53f308"]]},{"id":"9cb73240.892f1","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/CT","payload":"200","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":580,"wires":[["d66b35d2.53f308"]]},{"id":"cb5ba713.23ed38","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/CT","payload":"153","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":540,"wires":[["d66b35d2.53f308"]]},{"id":"f4338b2.4fc9078","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":860,"wires":[["316693eb.cb75ec","b6efdf11.dde6c","3c1ff577.f1d4ca"]]},{"id":"316693eb.cb75ec","type":"function","z":"2301760b.f35afa","name":"","func":"msg.topic = \"cmnd/loungergbw/Color2\"\nmsg.payload = \"255,0,0\"\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":800,"wires":[["fc8a44ec.f7cda8"]]},{"id":"b6efdf11.dde6c","type":"function","z":"2301760b.f35afa","name":"","func":"msg.topic = \"cmnd/loungergbw/Dimmer\"\nmsg.payload = \"75\"\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":840,"wires":[["fc8a44ec.f7cda8"]]},{"id":"3c1ff577.f1d4ca","type":"function","z":"2301760b.f35afa","name":"","func":"msg.topic = \"cmnd/loungergbw/POWER\"\nmsg.payload = \"on\"\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":880,"wires":[["fc8a44ec.f7cda8"]]},{"id":"fc8a44ec.f7cda8","type":"mqtt out","z":"2301760b.f35afa","name":"","topic":"","qos":"","retain":"","broker":"ff74e238.fe90b","x":890,"y":840,"wires":[]},{"id":"d17f874b.9e1ce8","type":"mqtt out","z":"1febc63c.43c2fa","name":"","topic":"","qos":"","retain":"","broker":"54b210d6.f2a3e","x":890,"y":340,"wires":[]},{"id":"c5e7d280.8e27c","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/POWER","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":240,"wires":[["d17f874b.9e1ce8"]]},{"id":"d3b3018e.83097","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/POWER","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":280,"wires":[["d17f874b.9e1ce8"]]},{"id":"ed46a5f6.37b518","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Color2","payload":"255,0,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":360,"wires":[["d17f874b.9e1ce8"]]},{"id":"2de84227.0e09ee","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Color2","payload":"0,0,255","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":400,"wires":[["d17f874b.9e1ce8"]]},{"id":"dcb42838.58ab38","type":"mqtt in","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/#","qos":"2","datatype":"auto","broker":"54b210d6.f2a3e","x":430,"y":160,"wires":[["81fda0e1.c1672"]]},{"id":"81fda0e1.c1672","type":"debug","z":"1febc63c.43c2fa","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":160,"wires":[]},{"id":"2fc218e5.e7bb58","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Dimmer","payload":"100","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":490,"y":800,"wires":[["d17f874b.9e1ce8"]]},{"id":"cd77a4c6.c31ff8","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Dimmer","payload":"75","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":760,"wires":[["d17f874b.9e1ce8"]]},{"id":"fb511e33.ce55d","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Dimmer","payload":"50","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":480,"y":720,"wires":[["d17f874b.9e1ce8"]]},{"id":"755cec87.7f3dc4","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Color2","payload":"0,255,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":440,"wires":[["d17f874b.9e1ce8"]]},{"id":"54ce9db6.318194","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Color2","payload":"255,255,255","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":430,"y":480,"wires":[["d17f874b.9e1ce8"]]},{"id":"41ce6cc1.764be4","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Scheme","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":460,"wires":[["d17f874b.9e1ce8"]]},{"id":"17e8aa06.b8bb16","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Scheme","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":500,"wires":[["d17f874b.9e1ce8"]]},{"id":"49210a6.6568cf4","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Scheme","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":540,"wires":[["d17f874b.9e1ce8"]]},{"id":"44f2daaf.cbe084","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Scheme","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":580,"wires":[["d17f874b.9e1ce8"]]},{"id":"fbb46f77.ad564","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Scheme","payload":"4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":620,"wires":[["d17f874b.9e1ce8"]]},{"id":"b9361a0d.28aa78","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/Color","payload":"8","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":640,"wires":[["d17f874b.9e1ce8"]]},{"id":"e71be74b.4c4ac8","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/CT","payload":"200","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":560,"wires":[["d17f874b.9e1ce8"]]},{"id":"8a2737a8.8ba448","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/fletchlamp/CT","payload":"153","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":520,"wires":[["d17f874b.9e1ce8"]]},{"id":"8c2001c2.adaf3","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":760,"y":840,"wires":[["c6296580.967828","ebd90743.b4b358","59425c.52136da4"]]},{"id":"c6296580.967828","type":"function","z":"1febc63c.43c2fa","name":"","func":"msg.topic = \"cmnd/fletchlamp/Color2\"\nmsg.payload = \"255,0,0\"\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":780,"wires":[["8a965ec2.a245d"]]},{"id":"ebd90743.b4b358","type":"function","z":"1febc63c.43c2fa","name":"","func":"msg.topic = \"cmnd/fletchlamp/Dimmer\"\nmsg.payload = \"75\"\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":820,"wires":[["8a965ec2.a245d"]]},{"id":"59425c.52136da4","type":"function","z":"1febc63c.43c2fa","name":"","func":"msg.topic = \"cmnd/fletchlamp/POWER\"\nmsg.payload = \"on\"\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":860,"wires":[["8a965ec2.a245d"]]},{"id":"8a965ec2.a245d","type":"mqtt out","z":"1febc63c.43c2fa","name":"","topic":"","qos":"","retain":"","broker":"54b210d6.f2a3e","x":1150,"y":820,"wires":[]},{"id":"26767d5a.4bd282","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1260,"y":600,"wires":[["98de0868.e41d08","fbfba28a.ab15f","906809e7.0abd48"]]},{"id":"98de0868.e41d08","type":"function","z":"1febc63c.43c2fa","name":"","func":"msg.topic = \"cmnd/fletchlamp/CT\"\nmsg.payload = \"200\"\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":540,"wires":[["b8dc25a6.e69a18"]]},{"id":"fbfba28a.ab15f","type":"function","z":"1febc63c.43c2fa","name":"","func":"msg.topic = \"cmnd/fletchlamp/Dimmer\"\nmsg.payload = \"50\"\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":580,"wires":[["b8dc25a6.e69a18"]]},{"id":"906809e7.0abd48","type":"function","z":"1febc63c.43c2fa","name":"","func":"msg.topic = \"cmnd/fletchlamp/POWER\"\nmsg.payload = \"on\"\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":620,"wires":[["b8dc25a6.e69a18"]]},{"id":"b8dc25a6.e69a18","type":"mqtt out","z":"1febc63c.43c2fa","name":"","topic":"","qos":"","retain":"","broker":"54b210d6.f2a3e","x":1650,"y":580,"wires":[]},{"id":"490e0c96.edfb64","type":"api-current-state","z":"1febc63c.43c2fa","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1590,"y":220,"wires":[["506b7d9b.274ba4"]]},{"id":"506b7d9b.274ba4","type":"debug","z":"1febc63c.43c2fa","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1890,"y":220,"wires":[]},{"id":"349a98e5.f68e88","type":"inject","z":"1febc63c.43c2fa","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":220,"wires":[["490e0c96.edfb64"]]},{"id":"86b4474b.f2eb38","type":"api-current-state","z":"404de206.015e2c","name":"Fletcher Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":960,"y":760,"wires":[[],["13617223.2e7d9e"]]},{"id":"13617223.2e7d9e","type":"api-call-service","z":"404de206.015e2c","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.fletch_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1270,"y":740,"wires":[[]]},{"id":"e8a5d16.1dc2a3","type":"api-call-service","z":"404de206.015e2c","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.fletch_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1310,"y":580,"wires":[[]]},{"id":"a4457a8.d4a1a88","type":"api-current-state","z":"404de206.015e2c","name":"Fletcher Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1080,"y":540,"wires":[[],["e8a5d16.1dc2a3"]]},{"id":"2654f879.d34fe8","type":"bigtimer","z":"404de206.015e2c","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Morning lights","comment":"","lat":"-26.0188","lon":"28.0194","starttime":"180","endtime":"225","starttime2":0,"endtime2":0,"startoff":"+5","endoff":"-5","startoff2":0,"endoff2":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":160,"y":260,"wires":[["d176833f.40e3a"],[],[]]},{"id":"c6dfb2eb.f9e62","type":"api-call-service","z":"404de206.015e2c","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":" light.karien_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":360,"wires":[[]]},{"id":"14a6c093.9a668f","type":"api-current-state","z":"404de206.015e2c","name":"Karien Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.karien_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":990,"y":360,"wires":[[],["c6dfb2eb.f9e62"]]},{"id":"8673c15b.9c6ee","type":"inject","z":"404de206.015e2c","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":40,"wires":[["2654f879.d34fe8"]]},{"id":"40afa9f3.eff338","type":"inject","z":"404de206.015e2c","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":80,"wires":[["2654f879.d34fe8"]]},{"id":"67c22b42.d47ef4","type":"inject","z":"404de206.015e2c","name":"off","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":120,"wires":[["2654f879.d34fe8"]]},{"id":"293da21d.77285e","type":"api-current-state","z":"404de206.015e2c","name":"Is someone at home?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_occupied","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":700,"y":60,"wires":[["42c73f0.7e91cc","d6341f13.e9b45"],["9b5cf1fe.6b5e1","14a6c093.9a668f"]]},{"id":"d176833f.40e3a","type":"change","z":"404de206.015e2c","name":"set desired state to a flow variable","rules":[{"t":"set","p":"light.morning.desiredstate","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":260,"wires":[["51eb81d1.7b1a1"]]},{"id":"11fb1fd4.4e8aa","type":"switch","z":"404de206.015e2c","name":"turn on or off?","property":"light.morning.desiredstate","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"ON","vt":"str"},{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":560,"y":160,"wires":[["293da21d.77285e"],["293da21d.77285e"],["14a6c093.9a668f","9b5cf1fe.6b5e1"],["14a6c093.9a668f","9b5cf1fe.6b5e1"]]},{"id":"4e10db1d.ec3e84","type":"api-call-service","z":"404de206.015e2c","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":" light.karien_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1340,"y":160,"wires":[[]]},{"id":"d6341f13.e9b45","type":"api-current-state","z":"404de206.015e2c","name":"Karien Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.karien_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1030,"y":160,"wires":[[],["4e10db1d.ec3e84"]]},{"id":"522265.2b4b1d9c","type":"delay","z":"404de206.015e2c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":20,"wires":[[]]},{"id":"9b5cf1fe.6b5e1","type":"api-current-state","z":"404de206.015e2c","name":"Fletcher Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1020,"y":260,"wires":[[],["7dd69dce.323144"]]},{"id":"7dd69dce.323144","type":"api-call-service","z":"404de206.015e2c","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.fletch_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":240,"wires":[[]]},{"id":"8e3bc8d1.d573a8","type":"api-call-service","z":"404de206.015e2c","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.fletch_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1370,"y":80,"wires":[[]]},{"id":"42c73f0.7e91cc","type":"api-current-state","z":"404de206.015e2c","name":"Fletcher Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1060,"y":80,"wires":[[],["8e3bc8d1.d573a8"]]},{"id":"a8266211.a0209","type":"api-call-service","z":"bd389fb.6c2456","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1300,"y":540,"wires":[[]]},{"id":"cd7d7b9c.478448","type":"inject","z":"bd389fb.6c2456","name":"21:40 (19:40 in UTC)","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"40 21 * * 1,2,3,4,5","once":false,"onceDelay":"","x":200,"y":520,"wires":[["e992a319.a97d7","2ae40f55.b8e3e"]]},{"id":"e992a319.a97d7","type":"api-current-state","z":"bd389fb.6c2456","name":"Karien Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e3147121","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":970,"y":540,"wires":[[],["a8266211.a0209"]]},{"id":"767c3b35.1f98a4","type":"inject","z":"bd389fb.6c2456","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":260,"wires":[["ef334ce6.40b8a"]]},{"id":"111ea4c6.7d65db","type":"inject","z":"bd389fb.6c2456","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":300,"wires":[["ef334ce6.40b8a"]]},{"id":"93dda1e9.ea3db","type":"inject","z":"bd389fb.6c2456","name":"off","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":340,"wires":[["ef334ce6.40b8a"]]},{"id":"6bf5e5d3.014d8c","type":"api-current-state","z":"bd389fb.6c2456","name":"Is someone at home?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_occupied","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":240,"wires":[["f71a3205.6dd39"],["2ae40f55.b8e3e","e992a319.a97d7"]]},{"id":"aef65e6.83cc3a","type":"change","z":"bd389fb.6c2456","name":"set desired state to a flow variable","rules":[{"t":"set","p":"light.morning.desiredstate","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":420,"wires":[["9da62d9b.86666","6bf5e5d3.014d8c"]]},{"id":"5697ce6f.c465d","type":"switch","z":"bd389fb.6c2456","name":"turn on or off?","property":"light.morning.desiredstate","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"ON","vt":"str"},{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":800,"y":200,"wires":[["d788bd49.23a02","778f9edc.2a62a"],["778f9edc.2a62a","d788bd49.23a02"],["e992a319.a97d7","2ae40f55.b8e3e"],["e992a319.a97d7","2ae40f55.b8e3e"]]},{"id":"86ef37b5.a874e8","type":"api-call-service","z":"bd389fb.6c2456","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":340,"wires":[[]]},{"id":"778f9edc.2a62a","type":"api-current-state","z":"bd389fb.6c2456","name":"Karien Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e3147121","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1010,"y":340,"wires":[[],["86ef37b5.a874e8"]]},{"id":"f71a3205.6dd39","type":"delay","z":"bd389fb.6c2456","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":620,"y":180,"wires":[["5697ce6f.c465d"]]},{"id":"2ae40f55.b8e3e","type":"api-current-state","z":"bd389fb.6c2456","name":"Fletcher Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1000,"y":440,"wires":[[],["f449ae53.7bb23"]]},{"id":"f449ae53.7bb23","type":"api-call-service","z":"bd389fb.6c2456","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.fletch_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1310,"y":420,"wires":[[]]},{"id":"87bcbeb2.9b24f","type":"api-call-service","z":"bd389fb.6c2456","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.fletch_rbgw_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1350,"y":260,"wires":[[]]},{"id":"d788bd49.23a02","type":"api-current-state","z":"bd389fb.6c2456","name":"Fletcher Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1040,"y":260,"wires":[[],["87bcbeb2.9b24f"]]},{"id":"9da62d9b.86666","type":"debug","z":"bd389fb.6c2456","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":440,"wires":[]},{"id":"ef334ce6.40b8a","type":"bigtimer","z":"bd389fb.6c2456","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Morning lights","comment":"","lat":"-26.0188","lon":"28.0194","starttime":"180","endtime":"225","starttime2":0,"endtime2":0,"startoff":"+5","endoff":"-5","startoff2":0,"endoff2":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":160,"y":420,"wires":[["aef65e6.83cc3a"],[],[]]},{"id":"5b0dc51c.a7196c","type":"api-current-state","z":"404de206.015e2c","name":"Lounge Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.lounge_rbgw","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":940,"y":980,"wires":[[],["d502af5f.70a79"]]},{"id":"d502af5f.70a79","type":"api-call-service","z":"404de206.015e2c","name":"Lounge Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.lounge_rbgw","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1250,"y":960,"wires":[[]]},{"id":"51eb81d1.7b1a1","type":"api-current-state","z":"404de206.015e2c","name":"is it a workday?","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.workday_sensor","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":60,"wires":[["11fb1fd4.4e8aa"]]},{"id":"753b8c99.07fc34","type":"mqtt out","z":"ecc500b.f2543","name":"","topic":"","qos":"","retain":"","broker":"54b210d6.f2a3e","x":550,"y":220,"wires":[]},{"id":"607e0637.b35078","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/POWER","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":120,"wires":[["753b8c99.07fc34"]]},{"id":"9881791b.f17098","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/POWER","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":160,"wires":[["753b8c99.07fc34"]]},{"id":"52d5ef55.03025","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Color2","payload":"255,0,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":240,"wires":[["753b8c99.07fc34"]]},{"id":"322f87f1.c4b978","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Color2","payload":"0,0,255","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":280,"wires":[["753b8c99.07fc34"]]},{"id":"85a405cb.371628","type":"mqtt in","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/#","qos":"2","datatype":"auto","broker":"54b210d6.f2a3e","x":90,"y":40,"wires":[["129f474b.169dd9"]]},{"id":"129f474b.169dd9","type":"debug","z":"ecc500b.f2543","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":40,"wires":[]},{"id":"9c36e416.7fa328","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Dimmer","payload":"100","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":680,"wires":[["753b8c99.07fc34"]]},{"id":"ec2200c5.2ba7d","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Dimmer","payload":"75","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":640,"wires":[["753b8c99.07fc34"]]},{"id":"b2976d85.54cb5","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Dimmer","payload":"50","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":600,"wires":[["753b8c99.07fc34"]]},{"id":"99b9f78e.7fb178","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Color2","payload":"0,255,0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":320,"wires":[["753b8c99.07fc34"]]},{"id":"a7919b19.d697a8","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Color2","payload":"255,255,255","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":360,"wires":[["753b8c99.07fc34"]]},{"id":"801e8b7c.edd318","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Scheme","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":340,"wires":[["753b8c99.07fc34"]]},{"id":"397b1e3e.aec052","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Scheme","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":380,"wires":[["753b8c99.07fc34"]]},{"id":"b70fb01d.1de41","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Scheme","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":420,"wires":[["753b8c99.07fc34"]]},{"id":"eac0f6c9.7d7ef8","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Scheme","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":460,"wires":[["753b8c99.07fc34"]]},{"id":"2d1f52e2.73567e","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Scheme","payload":"4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":500,"wires":[["753b8c99.07fc34"]]},{"id":"9017b9e.b477248","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/Color","payload":"8","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":520,"wires":[["753b8c99.07fc34"]]},{"id":"511c0eea.b34f2","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/CT","payload":"200","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":440,"wires":[["753b8c99.07fc34"]]},{"id":"4f0a4a2e.df1c34","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/karienlamp/CT","payload":"153","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":400,"wires":[["753b8c99.07fc34"]]},{"id":"a7281372.d5894","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":420,"y":720,"wires":[["a607dc5.7a40c2","71e33bb9.e42414","967aa7dc.5d3e48"]]},{"id":"a607dc5.7a40c2","type":"function","z":"ecc500b.f2543","name":"","func":"msg.topic = \"cmnd/karienlamp/Color2\"\nmsg.payload = \"255,0,0\"\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":660,"wires":[["cf3dc651.7915e8"]]},{"id":"71e33bb9.e42414","type":"function","z":"ecc500b.f2543","name":"","func":"msg.topic = \"cmnd/karienlamp/Dimmer\"\nmsg.payload = \"75\"\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":700,"wires":[["cf3dc651.7915e8"]]},{"id":"967aa7dc.5d3e48","type":"function","z":"ecc500b.f2543","name":"","func":"msg.topic = \"cmnd/karienlamp/POWER\"\nmsg.payload = \"on\"\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":740,"wires":[["cf3dc651.7915e8"]]},{"id":"cf3dc651.7915e8","type":"mqtt out","z":"ecc500b.f2543","name":"","topic":"","qos":"","retain":"","broker":"54b210d6.f2a3e","x":810,"y":700,"wires":[]},{"id":"3bc846c5.e24f6a","type":"inject","z":"ecc500b.f2543","name":"","topic":"cmnd/loungergbw/Dimmer","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":920,"y":480,"wires":[["e108682c.1a1d28","d9d5fa06.519d68","b3cb8716.784738"]]},{"id":"e108682c.1a1d28","type":"function","z":"ecc500b.f2543","name":"","func":"msg.topic = \"cmnd/karienlamp/CT\"\nmsg.payload = \"200\"\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":420,"wires":[["115684f7.8042fb"]]},{"id":"d9d5fa06.519d68","type":"function","z":"ecc500b.f2543","name":"","func":"karienlampmsg.topic = \"cmnd/karienlamp/Dimmer\"\nmsg.payload = \"50\"\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":460,"wires":[["115684f7.8042fb"]]},{"id":"b3cb8716.784738","type":"function","z":"ecc500b.f2543","name":"","func":"msg.topic = \"cmnd/karienlamp/POWER\"\nmsg.payload = \"on\"\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":500,"wires":[["115684f7.8042fb"]]},{"id":"115684f7.8042fb","type":"mqtt out","z":"ecc500b.f2543","name":"","topic":"","qos":"","retain":"","broker":"54b210d6.f2a3e","x":1310,"y":460,"wires":[]},{"id":"23fc2d03.9f0322","type":"api-current-state","z":"ecc500b.f2543","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.fletch_rbgw_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1250,"y":100,"wires":[["3e1a6c1a.239ef4"]]},{"id":"3e1a6c1a.239ef4","type":"debug","z":"ecc500b.f2543","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1550,"y":100,"wires":[]},{"id":"43bf98bd.6fef18","type":"inject","z":"ecc500b.f2543","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":100,"wires":[["23fc2d03.9f0322"]]},{"id":"d007d36f.5ca5c","type":"api-call-service","z":"90bcc8ae.363a88","name":"Node Red Presence not_home","server":"f72d7efe.eb28e","service_domain":"device_tracker","service":"see","data":"{\"dev_id\":\"you_nodered\",\"location_name\":\"not_home\"}","x":710,"y":380,"wires":[[]]},{"id":"e4733586.cea428","type":"api-call-service","z":"90bcc8ae.363a88","name":"Node Red Presence home","server":"f72d7efe.eb28e","service_domain":"device_tracker","service":"see","data":"{\"dev_id\":\"you_nodered\",\"location_name\":\"home\"}","x":699.999885559082,"y":309.33336353302,"wires":[["160ea368.ae95fd"]]},{"id":"f9507d9a.4fb26","type":"comment","z":"90bcc8ae.363a88","name":"Create Device Tracker","info":"","x":703.0000457763672,"y":270.0000319480896,"wires":[]},{"id":"9fe0af05.e7f2b","type":"comment","z":"90bcc8ae.363a88","name":"Home or Not?","info":"","x":273.5357437133789,"y":348.36904764175415,"wires":[]},{"id":"d15a4d8.3d74bb","type":"function","z":"90bcc8ae.363a88","name":"GPS","func":"newmsg = {};\nnewmsg.payload = { data: {'gps': [msg.payload.lat,msg.payload.lon] } };\nreturn newmsg;","outputs":1,"noerr":0,"x":500.8336982727051,"y":310.2380690574646,"wires":[["e4733586.cea428","160ea368.ae95fd"]]},{"id":"affaf07a.6f6ab","type":"function","z":"90bcc8ae.363a88","name":"GPS","func":"newmsg = {};\nnewmsg.payload = { data: {'gps': [msg.payload.lat,msg.payload.lon] } };\nreturn newmsg;","outputs":1,"noerr":0,"x":500.0001640319824,"y":379.9047808647156,"wires":[["d007d36f.5ca5c"]]},{"id":"8bf21052.ae393","type":"geofence","z":"90bcc8ae.363a88","name":"Inside Home Zone","mode":"circle","inside":"true","rad":0,"points":[],"centre":{"latitude":0,"longitude":0},"x":267.81546783447266,"y":298.5356755256653,"wires":[["d15a4d8.3d74bb","160ea368.ae95fd"]]},{"id":"4b7054df.a5dd4c","type":"geofence","z":"90bcc8ae.363a88","name":"Outside Home Zone","mode":"circle","inside":"false","rad":0,"points":[],"centre":{"latitude":0,"longitude":0},"x":277.1904487609863,"y":394.7856659889221,"wires":[["affaf07a.6f6ab"]]},{"id":"37f4f652.e3328a","type":"inject","z":"90bcc8ae.363a88","name":"","topic":"","payload":"{\"topic\":\"foo\",\"payload\":\"bar\",\"location\":{\"lat\":\"51.02477\",\"lon\":\"-1.39724\"}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":120,"wires":[["8bf21052.ae393","160ea368.ae95fd"]]},{"id":"160ea368.ae95fd","type":"debug","z":"90bcc8ae.363a88","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":140,"wires":[]},{"id":"c99b1350.b6a79","type":"mqtt in","z":"f5dbb3c3.e11ac","name":"KyleG Owntracks","topic":"owntracks/bagpuss/a0001","broker":"1b4c328e.81cadd","x":160,"y":180,"wires":[["8347b4bd.e11ad8"]]},{"id":"519b6107.46b7a","type":"mqtt out","z":"f5dbb3c3.e11ac","name":"domoticz/in","topic":"domoticz/in","qos":"","retain":"","broker":"1b4c328e.81cadd","x":996,"y":185,"wires":[]},{"id":"8c6e8a29.50fa48","type":"geofence","z":"f5dbb3c3.e11ac","name":"Home","mode":"circle","inside":"true","rad":88.99011032254676,"points":[],"centre":{"latitude":55.918150666279054,"longitude":-4.223449230194092},"x":570,"y":120,"wires":[["7aa9c2eb.874dcc","f6fff97b.829358"]]},{"id":"8347b4bd.e11ad8","type":"function","z":"f5dbb3c3.e11ac","name":"Lat/Long","func":"msg.location = JSON.parse(msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":348,"y":180,"wires":[["8c6e8a29.50fa48","31ead790.d7cf78","766b5b64.94f834","c7e322fc.65ca1","de7498d5.a9c718"]]},{"id":"7aa9c2eb.874dcc","type":"function","z":"f5dbb3c3.e11ac","name":"Location selector","func":"// Home == 10\n// Work == 20\n\nif ( msg.location.isat == \"Home\") {\n var home = { payload:'{\"idx\":181,\"nvalue\":1} };\n var work = { payload:'{\"idx\":180,\"nvalue\":0} };\n} else if ( msg.location.isat == \"Work\") {\n var home = { payload:'{\"idx\":181,\"nvalue\":0} };\n var work = { payload:'{\"idx\":180,\"nvalue\":1} };\n} else {\n var home = { payload:'{\"idx\":181,\"nvalue\":0} };\n var work = { payload:'{\"idx\":180,\"nvalue\":0} };\n}\n\n\nreturn [ [ work, home ] ];","outputs":"1","noerr":0,"x":747,"y":186,"wires":[["519b6107.46b7a","329171eb.d5e7ee"]]},{"id":"31ead790.d7cf78","type":"geofence","z":"f5dbb3c3.e11ac","name":"Work","mode":"circle","inside":"true","rad":691.5530147043348,"points":[],"centre":{"latitude":55.756722472194724,"longitude":-4.288358688354492},"x":515,"y":213,"wires":[["7aa9c2eb.874dcc","f6fff97b.829358"]]},{"id":"f6fff97b.829358","type":"debug","z":"f5dbb3c3.e11ac","name":"","active":true,"console":"false","complete":"location.isat","x":870,"y":100,"wires":[]},{"id":"329171eb.d5e7ee","type":"debug","z":"f5dbb3c3.e11ac","name":"Domotic payload toggles","active":true,"console":"false","complete":"payload","x":1190,"y":100,"wires":[]},{"id":"766b5b64.94f834","type":"geofence","z":"f5dbb3c3.e11ac","name":"Canteen","mode":"circle","inside":"true","rad":16.778117069341608,"points":[],"centre":{"latitude":55.756552675540114,"longitude":-4.287972450256348},"x":528.3333435058594,"y":276.33333587646484,"wires":[["caa6551c.ee1588"]]},{"id":"caa6551c.ee1588","type":"mqtt out","z":"f5dbb3c3.e11ac","name":"","topic":"testing/canteen","qos":"","retain":"","broker":"1b4c328e.81cadd","x":759.3333740234375,"y":279.3333435058594,"wires":[]},{"id":"7353fd9f.ca0764","type":"file","z":"f5dbb3c3.e11ac","name":"location","filename":"/tmp/location.csv","appendNewline":true,"createDir":false,"overwriteFile":"false","x":750.3333435058594,"y":367.33333587646484,"wires":[[]]},{"id":"c7e322fc.65ca1","type":"function","z":"f5dbb3c3.e11ac","name":"csvify","func":"//msg.timestamp = new Date().toISOString();\n\nvar now = new Date(); \nvar year = now.getFullYear();\nvar month = now.getMonth()+1; \nvar day = now.getDate();\nvar hour = now.getHours();\nvar minute = now.getMinutes();\nvar second = now.getSeconds(); \nif(month.toString().length == 1) {\nvar month = 0+month;\n}\nif(day.toString().length == 1) {\nvar day = 0+day;\n} \nif(hour.toString().length == 1) {\nvar hour = 0+hour;\n}\nif(minute.toString().length == 1) {\nvar minute = 0+minute;\n}\nif(second.toString().length == 1) {\nvar second = 0+second;\n} \nmsg.timestamp = year+-+month+-+day+ +hour+:+minute+:+second;\n\n\nmsg.parameters = JSON.parse(msg.payload);\n\nmsg.payload = msg.timestamp + , + msg.parameters.lat + , + msg.parameters.lon;\n\nreturn msg;","outputs":1,"noerr":0,"x":528.8333435058594,"y":348.33333587646484,"wires":[["7353fd9f.ca0764"]]},{"id":"de7498d5.a9c718","type":"debug","z":"f5dbb3c3.e11ac","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"location.lat","targetType":"msg","x":240,"y":360,"wires":[]},{"id":"4411b173.e59b1","type":"api-current-state","z":"f5dbb3c3.e11ac","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"device_tracker.life360_fletcher_kelly","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":270,"y":460,"wires":[["8347b4bd.e11ad8","7b81765d.d2e9f8","50d1c8a8.282cf8","5f233713.5960f8"]]},{"id":"971b1f84.59015","type":"debug","z":"f5dbb3c3.e11ac","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":850,"y":660,"wires":[]},{"id":"988b6c94.9a0da","type":"inject","z":"f5dbb3c3.e11ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":660,"wires":[["4411b173.e59b1"]]},{"id":"7b81765d.d2e9f8","type":"json","z":"f5dbb3c3.e11ac","name":"","property":"payload","action":"","pretty":true,"x":660,"y":460,"wires":[[]]},{"id":"50d1c8a8.282cf8","type":"change","z":"f5dbb3c3.e11ac","name":"","rules":[{"t":"set","p":"location.lat","pt":"msg","to":"data.attributes.latitude","tot":"msg"},{"t":"set","p":"location.lon","pt":"msg","to":"data.attributes.longitude","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":580,"wires":[["9aca6cf8.b2aec","971b1f84.59015"]]},{"id":"9aca6cf8.b2aec","type":"geofence","z":"f5dbb3c3.e11ac","name":"Home","mode":"circle","inside":"true","rad":88.99011032254676,"points":[],"centre":{"latitude":55.918150666279054,"longitude":-4.223449230194092},"x":670,"y":680,"wires":[["f2e600e.61353"]]},{"id":"95787a18.d61858","type":"function","z":"f5dbb3c3.e11ac","name":"Lat/Long","func":"msg.location = JSON.parse(msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":560,"wires":[[]]},{"id":"7d63c33c.d3329c","type":"mqtt in","z":"98fe7404.95a9b8","name":"owntracks geofence","topic":"owntracks/username/device/event","broker":"7bb58db8.1423e4","x":270,"y":220,"wires":[["fa6c6df9.79d39","f69494e3.405e98"]]},{"id":"fa6c6df9.79d39","type":"debug","z":"98fe7404.95a9b8","name":"","active":true,"complete":false,"x":699.9999847412109,"y":204.00000762939453,"wires":[]},{"id":"f69494e3.405e98","type":"function","z":"98fe7404.95a9b8","name":"Enter or Leave Location","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\nvar now = Date();\nvar message = \"\";\ndata = JSON.parse(msg.payload);\n\nif ( (data._type == \"transition\") && (data.event != undefined ) ) {\n\t\n\t\tif ( data.event == \"enter\" ) {\t\t\t\n\t\t\tmessage = \"Entering Location: \" + now;\n\t\t} else {\n\t\t\tmessage = \"Leaving Location: \" + now;\n\t\t}\n\t\t\n\t\tif ( data.desc != undefined ) {\n\t\t\t// Shared waypoint, comes with a description:\n\t\t\t\tmessage += data.desc;\n \t\t} else {\n \t\t\t// No description is set, non shared \"private\" waypoint\n \t\t\t\tmessage += data.lat + \",\" + data.lon;\n \t\t}\n }\n\nmsg.payload = message;\n//console.log(msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":540.9999847412109,"y":329.00000762939453,"wires":[["f91d6ebe.befa3","a82c5404.216d58","55a90c7e.e720a4"]]},{"id":"50d5a2b9.09e61c","type":"mqtt in","z":"98fe7404.95a9b8","name":"WayPoints Home Smartphone","topic":"owntracks/username/device/event","broker":"7bb58db8.1423e4","x":257,"y":141.08334350585938,"wires":[["fa6c6df9.79d39","f69494e3.405e98"]]},{"id":"f91d6ebe.befa3","type":"switch","z":"98fe7404.95a9b8","name":"","property":"payload","rules":[{"t":"cont","v":"Location"}],"checkall":"true","outputs":1,"x":753.9999847412109,"y":320,"wires":[["f8c66550.d33b68"]]},{"id":"a82c5404.216d58","type":"debug","z":"98fe7404.95a9b8","name":"","active":true,"complete":false,"x":700.9999847412109,"y":257.00000762939453,"wires":[]},{"id":"6fbe1c7d.ae5ec4","type":"inject","z":"98fe7404.95a9b8","name":"Test Shared Waypoint","topic":"","payload":"{\"_type\": \"transition\", \"lat\": \"xxxx\", \"lon\": \"yyyy\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"desc\": \"Shared Test Waypoint\", \"event\": \"enter\"}","payloadType":"string","repeat":"","crontab":"","once":false,"x":273,"y":321,"wires":[["f69494e3.405e98"]]},{"id":"5094186.31cb0e8","type":"inject","z":"98fe7404.95a9b8","name":"Test Private Waypoint","topic":"","payload":"{\"_type\": \"transition\", \"lat\": \"xxxx\", \"lon\": \"yyyy\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"event\": \"enter\"}","payloadType":"string","repeat":"","crontab":"","once":false,"x":276,"y":389.0000305175781,"wires":[["f69494e3.405e98"]]},{"id":"55a90c7e.e720a4","type":"twitter out","z":"98fe7404.95a9b8","twitter":"","name":"Tweet","x":711.9999847412109,"y":405.0833435058594,"wires":[]},{"id":"f8c66550.d33b68","type":"debug","z":"98fe7404.95a9b8","name":"","active":true,"console":"false","complete":"false","x":937.9999847412109,"y":318.08331298828125,"wires":[]},{"id":"f2e600e.61353","type":"debug","z":"f5dbb3c3.e11ac","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":740,"wires":[]},{"id":"b19c9508.776ed8","type":"geofence","z":"ca178713.ccfa58","name":"node-red","mode":"circle","inside":"both","rad":521.7866330247296,"points":[],"centre":{"latitude":51.02587584550688,"longitude":-1.3972806930541992},"x":700,"y":280,"wires":[["2ee2ecfe.596484"]]},{"id":"3fd3cc89.71f324","type":"inject","z":"ca178713.ccfa58","name":"inside area","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":223,"y":234,"wires":[["6ff52bc4.0475a4"]]},{"id":"6ff52bc4.0475a4","type":"function","z":"ca178713.ccfa58","name":"","func":"msg.lat=51.026751;\nmsg.lon=-1.397258;\nreturn msg;","outputs":1,"noerr":0,"x":368,"y":236,"wires":[["b19c9508.776ed8"]]},{"id":"2ee2ecfe.596484","type":"debug","z":"ca178713.ccfa58","name":"","active":true,"console":"false","complete":"true","x":868,"y":275,"wires":[]},{"id":"edddc359.a66c","type":"inject","z":"ca178713.ccfa58","name":"outside area","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":237.5,"y":323,"wires":[["43b5f101.d1c81"]]},{"id":"43b5f101.d1c81","type":"function","z":"ca178713.ccfa58","name":"","func":"msg.lat=0;\nmsg.lon=0;\nreturn msg;","outputs":1,"noerr":0,"x":367.5,"y":324,"wires":[["b19c9508.776ed8"]]},{"id":"7ca88102.8c48f","type":"geofence","z":"f5dbb3c3.e11ac","name":"Home","mode":"circle","inside":"both","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":650,"y":880,"wires":[["5834c55c.27faac"]]},{"id":"aad79f1e.42405","type":"inject","z":"f5dbb3c3.e11ac","name":"inside area","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":183,"y":834,"wires":[["5f233713.5960f8"]]},{"id":"5f233713.5960f8","type":"function","z":"f5dbb3c3.e11ac","name":"","func":"msg.lat=msg.data.attributes.latitude;\nmsg.lon=-msg.data.attributes.longitude;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":760,"wires":[["7ca88102.8c48f"]]},{"id":"5834c55c.27faac","type":"debug","z":"f5dbb3c3.e11ac","name":"","active":true,"console":"false","complete":"true","x":828,"y":875,"wires":[]},{"id":"f1f449ed.d57c28","type":"inject","z":"f5dbb3c3.e11ac","name":"outside area","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":197.5,"y":923,"wires":[["88c7a442.8630a8"]]},{"id":"88c7a442.8630a8","type":"function","z":"f5dbb3c3.e11ac","name":"","func":"msg.lat=0;\nmsg.lon=0;\nreturn msg;","outputs":1,"noerr":0,"x":327.5,"y":924,"wires":[["7ca88102.8c48f"]]},{"id":"a61d6ad.dad6e98","type":"inject","z":"54a63624.62e0c8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":360,"wires":[["f4de5154.3e5f2","8108a219.c9c4e","498bf4f2.4f996c"]]},{"id":"f4de5154.3e5f2","type":"api-current-state","z":"54a63624.62e0c8","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"device_tracker.life360_fletcher_kelly","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":470,"y":100,"wires":[["898b96ee.df5148"]]},{"id":"898b96ee.df5148","type":"function","z":"54a63624.62e0c8","name":"","func":"msg.lat=msg.data.attributes.latitude;\nmsg.lon=msg.data.attributes.longitude;\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":100,"wires":[["d3eec1bb.38fba","93986521.8f5048"]]},{"id":"b557b790.4f4588","type":"geofence","z":"54a63624.62e0c8","name":"Home - only points inside","mode":"circle","inside":"true","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":1010,"y":220,"wires":[["14d32651.095faa"]]},{"id":"14d32651.095faa","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"console":"false","complete":"true","x":1270,"y":220,"wires":[]},{"id":"6a31b6f9.66b878","type":"geofence","z":"54a63624.62e0c8","name":"Home - inarea","mode":"circle","inside":"both","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":980,"y":160,"wires":[["ae3c587.9c810a8"]]},{"id":"ae3c587.9c810a8","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"console":"false","complete":"true","x":1250,"y":160,"wires":[]},{"id":"b6b8b9ad.1f3cb8","type":"geofence","z":"54a63624.62e0c8","name":"Home - only points outside","mode":"circle","inside":"false","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":1020,"y":100,"wires":[["11d9375b.f251a9"]]},{"id":"11d9375b.f251a9","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"console":"false","complete":"true","x":1270,"y":100,"wires":[]},{"id":"8108a219.c9c4e","type":"api-current-state","z":"54a63624.62e0c8","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"device_tracker.life360_karien","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":640,"wires":[["80615cb0.7840b"]]},{"id":"80615cb0.7840b","type":"function","z":"54a63624.62e0c8","name":"","func":"msg.lat=msg.data.attributes.latitude;\nmsg.lon=msg.data.attributes.longitude;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":720,"wires":[["93986521.8f5048"]]},{"id":"5afe699b.517128","type":"geofence","z":"54a63624.62e0c8","name":"Home - only points inside","mode":"circle","inside":"true","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":1030,"y":720,"wires":[["9c1a688d.6e4758"]]},{"id":"9c1a688d.6e4758","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"console":"false","complete":"true","x":1250,"y":720,"wires":[]},{"id":"aa4ff8d9.ace538","type":"geofence","z":"54a63624.62e0c8","name":"Home - inarea","mode":"circle","inside":"both","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":1000,"y":640,"wires":[["ade08b37.bc2038"]]},{"id":"ade08b37.bc2038","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"console":"false","complete":"true","x":1250,"y":640,"wires":[]},{"id":"9e577f34.51c6c","type":"geofence","z":"54a63624.62e0c8","name":"Home - only points outside","mode":"circle","inside":"false","rad":108.55120825009602,"points":[],"centre":{"latitude":-26.018165304071747,"longitude":28.019556999206543},"x":1040,"y":560,"wires":[["82e5f363.21574"]]},{"id":"82e5f363.21574","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"console":"false","complete":"true","x":1270,"y":560,"wires":[]},{"id":"4fddb0ab.2f589","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":560,"y":560,"wires":[]},{"id":"498bf4f2.4f996c","type":"api-current-state","z":"54a63624.62e0c8","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"zone.kk_work","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":420,"wires":[["4fddb0ab.2f589"]]},{"id":"d3eec1bb.38fba","type":"geofence","z":"54a63624.62e0c8","name":"Home - inarea","mode":"polyline","inside":"both","rad":0,"points":[{"latitude":-26.018752531574233,"longitude":28.02074689418077},{"latitude":-26.0169688453084,"longitude":28.01975984126329},{"latitude":-26.017711247749794,"longitude":28.018247075378895},{"latitude":-26.018713965671385,"longitude":28.018601126968857},{"latitude":-26.019061058340824,"longitude":28.019695468246937}],"centre":{},"x":920,"y":360,"wires":[["4a986b5d.804734"]]},{"id":"4a986b5d.804734","type":"debug","z":"54a63624.62e0c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1180,"y":360,"wires":[]},{"id":"93986521.8f5048","type":"geofence","z":"54a63624.62e0c8","name":"KK Work - inarea","mode":"circle","inside":"both","rad":417.4663232386225,"points":[],"centre":{"latitude":-26.02352586808868,"longitude":28.123562335968018},"x":930,"y":420,"wires":[["4a986b5d.804734"]]},{"id":"1cc6101.c86b9f","type":"geofence","z":"54a63624.62e0c8","name":"","mode":"circle","inside":"true","rad":0,"points":[],"centre":{"latitude":0,"longitude":0},"x":1380,"y":420,"wires":[[]]},{"id":"12794d2b.9ba8d3","type":"server-state-changed","z":"404de206.015e2c","name":"Did someone come home?","server":"a3722ee8.c88ce","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":150,"y":420,"wires":[["87264cfb.7b39a","f5bde5be.4e8388"]]},{"id":"87264cfb.7b39a","type":"debug","z":"404de206.015e2c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":210,"y":360,"wires":[]},{"id":"f5bde5be.4e8388","type":"switch","z":"404de206.015e2c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":420,"wires":[["384397a2.2af9e8"]]},{"id":"384397a2.2af9e8","type":"function","z":"404de206.015e2c","name":"Set payload to auto","func":"msg.payload = \"auto\"\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":420,"wires":[["2654f879.d34fe8","346f73c6.c90d6c"]]},{"id":"9632b39f.6bdc2","type":"comment","z":"b9243eac.e962e","name":"iOS notifcation - Actionable","info":"","x":150,"y":160,"wires":[]},{"id":"df569aa5.215548","type":"comment","z":"b9243eac.e962e","name":"iOS notifcation - Responses","info":"","x":160,"y":520,"wires":[]},{"id":"9d7deba0.128a88","type":"switch","z":"83e9ea4f.1c5db8","name":"Which Action?","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"WORKING_FROM_HOME_YES","vt":"str"},{"t":"eq","v":"WORKING_FROM_HOME_NO","vt":"str"},{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":340,"y":180,"wires":[["e7fd7cde.d4e12"],["8c9dba52.99e138"],[]]},{"id":"43b1181f.be4148","type":"server-events","z":"83e9ea4f.1c5db8","name":"All","server":"a3722ee8.c88ce","event_type":"","x":90,"y":180,"wires":[["9d7deba0.128a88"]]},{"id":"e7fd7cde.d4e12","type":"debug","z":"83e9ea4f.1c5db8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":560,"y":120,"wires":[]},{"id":"8c9dba52.99e138","type":"debug","z":"83e9ea4f.1c5db8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":560,"y":200,"wires":[]},{"id":"b537971.04cd268","type":"api-call-service","z":"b9243eac.e962e","name":"Sonoff - Coputer Desk - On","server":"a3722ee8.c88ce","version":1,"service_domain":"switch","service":"turn_on","entityId":"switch.sonoff_computer_desk","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":460,"wires":[[]]},{"id":"421d3b40.8cc2f4","type":"api-call-service","z":"b9243eac.e962e","name":"Sonoff - Coputer Desk - Off","server":"a3722ee8.c88ce","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.sonoff_computer_desk","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":600,"y":640,"wires":[[]]},{"id":"a26cc626.8df8a8","type":"inject","z":"2301760b.f35afa","name":"","topic":"cmnd/loungergbw/Scheme","payload":"8","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":1000,"wires":[["d66b35d2.53f308"]]}]
[{"id":"6e4e7309.81165c","type":"tab","label":"Google API Testing","disabled":false,"info":""},{"id":"247a7db4.488d62","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"690339e0.145a08","type":"tab","label":"Owntracks Tracker","disabled":false,"info":""},{"id":"eddcae95.aa2d6","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"15c157a1.27c788","type":"tab","label":"Alexa Testing","disabled":false,"info":""},{"id":"95334549.408f08","type":"tab","label":"Presence Detection","disabled":true,"info":""},{"id":"d58c58f8.8219f8","type":"tab","label":"Telemetry","disabled":true,"info":""},{"id":"8c52d380.fec46","type":"tab","label":"Sample Playpen","disabled":false,"info":""},{"id":"a7fe27bd.2509f8","type":"tab","label":"Life360 Tracker","disabled":false,"info":""},{"id":"b9fe7189.3c263","type":"tab","label":"House Telemetry","disabled":false,"info":""},{"id":"d90740e8.853308","type":"tab","label":"DEV - Data Collection","disabled":false,"info":""},{"id":"4770c0d7.397b","type":"tab","label":"Home Assistant States","disabled":true,"info":""},{"id":"8a955ac7.209038","type":"tab","label":"Flow 6","disabled":false,"info":""},{"id":"67c3431e.c4b74c","type":"tab","label":"Are we home?","disabled":false,"info":""},{"id":"82378b51.cc8e28","type":"tab","label":"Flow 8","disabled":false,"info":""},{"id":"d597f158.7ca1b","type":"tab","label":"Prod Ready - Tuya Lights - Sunset","disabled":false,"info":""},{"id":"7481132e.5fea8c","type":"tab","label":"Presence Detection","disabled":false,"info":""},{"id":"d335ec1.d977a1","type":"tab","label":"Away from Home","disabled":true,"info":""},{"id":"edadc6b3.2cb078","type":"tab","label":"Come Home","disabled":true,"info":""},{"id":"9ed92167.b9b4c","type":"tab","label":"Flow 3","disabled":false,"info":""},{"id":"745da3b4.61597c","type":"tab","label":"Test - IOS Notify","disabled":false,"info":""},{"id":"48181911.c321a8","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"541a1cc7.93adc4","type":"tab","label":"Flow 7","disabled":false,"info":""},{"id":"b9243eac.e962e","type":"tab","label":"IOS Notify - Send","disabled":false,"info":""},{"id":"931c0c64.df3c6","type":"tab","label":"Dashboards","disabled":false,"info":""},{"id":"d74e98b0.1e98b8","type":"tab","label":"Flow 11","disabled":false,"info":""},{"id":"dac6431f.f0681","type":"tab","label":"Flow 12","disabled":false,"info":""},{"id":"8584cb39.51bb48","type":"tab","label":"Flow 9","disabled":false,"info":""},{"id":"cbfb483a.9b43f8","type":"tab","label":"Flow 10","disabled":false,"info":""},{"id":"59cb08a.8905ff8","type":"tab","label":"Alarm Panel","disabled":false,"info":""},{"id":"767d6cf4.74a3f4","type":"tab","label":"Flow 13","disabled":false,"info":""},{"id":"44dd03cf.d563cc","type":"tab","label":"Flow 14","disabled":false,"info":""},{"id":"213f77cb.cd9998","type":"tab","label":"Home Away","disabled":false,"info":""},{"id":"e7a4486b.b864c8","type":"tab","label":"Pre-prod - bedroom lights","disabled":false,"info":""},{"id":"8b9a916e.ca4ec","type":"tab","label":"Flow 16","disabled":false,"info":""},{"id":"fb4a9edc.82ff2","type":"tab","label":"Flow 15","disabled":false,"info":""},{"id":"9b2a9527.03a138","type":"tab","label":"Alexa Speak","disabled":false,"info":""},{"id":"590246e0.d58c08","type":"tab","label":"Alexa Play Music","disabled":false,"info":""},{"id":"4d548667.7a6948","type":"tab","label":"Flow 18","disabled":false,"info":""},{"id":"8c3854a8.1ec5c8","type":"subflow","name":"Startup Delay","info":"","category":"","in":[{"x":60,"y":120,"wires":[{"id":"9b33cb8d.70f6c8"}]}],"out":[{"x":480,"y":120,"wires":[{"id":"3b4abb08.ef19e4","port":0}]}]},{"id":"f27aa045.98e9d","type":"subflow","name":"Fletcher - Alexa Messages","info":"","category":"Notifications","in":[{"x":200,"y":140,"wires":[{"id":"aa993341.a2e07"}]}],"out":[],"env":[]},{"id":"63d82af5.88cf84","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"89877c86.8bf5d","type":"subflow","name":"Karien - Alexa Messages","info":"","category":"","in":[{"x":100,"y":200,"wires":[{"id":"cbcc5460.e82ce8"}]}],"out":[],"env":[]},{"id":"d270455.fae9bb8","type":"subflow","name":"Subflow 2","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"3e0f074.3fe70f8"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"3e0f074.3fe70f8","port":0}]}],"env":[]},{"id":"66726911.b76f98","type":"mqtt-broker","z":"","name":"Mosquitto - Whale","broker":"192.168.1.41","port":"1883","clientid":"Node-RED-Dev","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"abc5f2b.6bde21","type":"server","z":"","name":"Home Assistant - DeathStar","legacy":false,"hassio":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"6eb36010.171f5","type":"mqtt-broker","z":"","name":"unRaid-MQTT","broker":"192.168.1.4","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"beb2d5b5.e9a6f8","type":"influxdb","z":"","hostname":"192.168.1.4","port":"8086","protocol":"http","database":"telemetry","name":"","usetls":false,"tls":""},{"id":"60641eba.4e311","type":"mongodb","z":"d58c58f8.8219f8","hostname":"192.168.1.4","port":"27017","db":"node-red","name":""},{"id":"16ebb146.299d6f","type":"mqtt-broker","z":"","name":"orca-dev-mqtt","broker":"192.168.1.43","port":"21883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"39e7b6cc.400702","type":"mongodb","z":"","hostname":"192.168.1.43","port":"37017","db":"node-red","name":""},{"id":"87bc6ced.c12878","type":"influxdb","z":"","hostname":"192.168.1.4","port":"8086","protocol":"http","database":"telemetry","name":"","usetls":false,"tls":""},{"id":"e613cf86.3feb98","type":"influxdb","z":"","hostname":"192.168.1.4","port":"8086","protocol":"http","database":"dev_weather","name":"dev_weather","usetls":false,"tls":""},{"id":"b08dc7ea.aabfd","type":"influxdb","z":"","hostname":"192.168.1.43","port":"28086","protocol":"http","database":"sensortelemetry","name":"","usetls":false,"tls":""},{"id":"c6bdf57c.59baa8","type":"mqtt-broker","z":"","name":"192.168.1.159","broker":"192.168.1.159","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"a3722ee8.c88ce","type":"server","z":"","name":"Orca - 8124","legacy":false,"hassio":false,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"bdabb112.821d2","type":"server","z":"","name":"Home Assistant"},{"id":"d80b819d.21ee7","type":"server","z":"","name":"Home Assistant"},{"id":"faf6f8d3.47cb18","type":"server","z":"","name":"Home Assistant"},{"id":"c1cdb871.aa2988","type":"server","z":"","name":"Home Assistant"},{"id":"2aa1db5b.2cc8b4","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#17c42b","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#17c42b","edited":true},"page-titlebar-backgroundColor":{"value":"#17c42b","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#3fe853","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#17c42b","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"6cd20504.9b61cc","type":"ui_tab","z":"","name":"Bedroom","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"aa4f59ff.e959e8","type":"ui_group","z":"","name":"Lights","tab":"6cd20504.9b61cc","order":1,"disp":true,"width":"6","collapse":false},{"id":"394c9b3f.da6e44","type":"ui_group","z":"","name":"flowtest","tab":"8dbceec7.ef77c","disp":true,"width":"12","collapse":false},{"id":"8dbceec7.ef77c","type":"ui_tab","z":0,"name":"Test","icon":"dashboard","order":6},{"id":"228f61f1.0e31ce","type":"ui_group","z":"","name":"flowtest","tab":"20ecb5b2.2aea2a","disp":true,"width":"12","collapse":false},{"id":"20ecb5b2.2aea2a","type":"ui_tab","z":0,"name":"Test","icon":"dashboard","order":6},{"id":"36f19b4a.9303c4","type":"light-scheduler-settings","z":"","name":"Sunset","latitude":"-26.0188","longitude":"28.0194"},{"id":"cbae6ef5.500b8","type":"server","z":"","name":"Home Assistant"},{"id":"b33c9b3c.0231a8","type":"ui_group","z":"","name":"Keypad","tab":"56b206e1.e48ee8","order":1,"disp":true,"width":"6","collapse":false},{"id":"d42c7e99.0018","type":"server","z":"","name":"Home Assistant"},{"id":"f203cb2a.343698","type":"ui_group","z":"","name":"Door Status","tab":"6004c38a.0ab34c","order":3,"disp":true,"width":"6","collapse":false},{"id":"56b206e1.e48ee8","type":"ui_tab","z":"","name":"Alarm Panel","icon":"dashboard","order":1},{"id":"6004c38a.0ab34c","type":"ui_tab","z":"","name":"Pool Controls","icon":"dashboard","order":2},{"id":"84ee05c2.2bb708","type":"server","z":"","name":"Home Assistant"},{"id":"d934dccd.6ebae","type":"server","z":"","name":"Home Assistant"},{"id":"7a64aeda.d1efb","type":"mqtt-broker","z":"","broker":"192.168.86.168","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"35d4fcd5.04deb4","type":"server","z":"","name":"Home Assistant"},{"id":"11ac16b6.0ab969","type":"light-scheduler-settings","z":"","name":"my settings","latitude":"38.8977","longitude":"77.0365"},{"id":"a3342807.115888","type":"server","z":"","name":"Home Assistant"},{"id":"a0afaa39.4de1a8","type":"ui_group","z":"","name":"Alexa Speak","tab":"dc2eeab7.0a26c8","order":1,"disp":true,"width":"6","collapse":false},{"id":"dc2eeab7.0a26c8","type":"ui_tab","z":"","name":"Alexa Speak","icon":"speaker","order":2},{"id":"5d0de7fb.a20278","type":"alexa-remote-account","z":"","name":"Fletcher Alexa","authMethod":"cookie","proxyOwnIp":"192.168.1.43","proxyPort":"88","cookieFile":"","refreshInterval":"3","alexaServiceHost":"pitangui.amazon.com","amazonPage":"amazon.com","acceptLanguage":"en-US","userAgent":"","useWsMqtt":"on","autoInit":"on"},{"id":"2631de14.3000c2","type":"ui_group","z":"","name":"Choose","tab":"37f3731e.e9d04c","order":1,"disp":true,"width":"6","collapse":false},{"id":"8ed891bd.550a7","type":"ui_group","z":"","name":"Controls","tab":"37f3731e.e9d04c","order":2,"disp":true,"width":"6","collapse":false},{"id":"363b5f3e.6e4e2","type":"ui_group","z":"","name":"Music","tab":"37f3731e.e9d04c","order":3,"disp":true,"width":"6","collapse":false},{"id":"37f3731e.e9d04c","type":"ui_tab","z":"","name":"Alexa Play Music","icon":"speaker","order":12,"disabled":false,"hidden":false},{"id":"feb63a70.687138","type":"http request","z":"6e4e7309.81165c","name":"Karien Travel Time","method":"GET","ret":"obj","paytoqs":false,"url":"https://maps.googleapis.com/maps/api/distancematrix/json?origins=18+Forest+Drive+Lonehill&destinations=NetFlorist+Waterfall+Commercial+District+Midrand&key={{secret}}&mode=driving&traffic_model=pessimistic&departure_time=now","tls":"","proxy":"","authType":"","x":450,"y":140,"wires":[["8b6353a0.5542d"]]},{"id":"39bd73db.ff4c8c","type":"inject","z":"6e4e7309.81165c","name":"","topic":"1","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":400,"wires":[["253083b6.febbcc","4dc3c2a9.9b28ec"]]},{"id":"b794425b.97b8b","type":"switch","z":"6e4e7309.81165c","name":"RAG scale","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"11","vt":"str"},{"t":"btwn","v":"12","vt":"str","v2":"20","v2t":"str"},{"t":"gte","v":"21","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1030,"y":220,"wires":[["7d2760d2.febd6"],["82631610.583b78"],["5ac48bb7.fde664"]]},{"id":"7d2760d2.febd6","type":"function","z":"6e4e7309.81165c","name":"kk - green","func":"msg.topic ='karien'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'green'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":120,"wires":[["e6223a2b.130d28","f9a2bf40.e17e2"]]},{"id":"d7d6cc3a.f3411","type":"switch","z":"6e4e7309.81165c","name":"RAG scale","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"8","vt":"str"},{"t":"btwn","v":"9","vt":"str","v2":"12","v2t":"str"},{"t":"gte","v":"13","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1030,"y":340,"wires":[["80822b2b.0ebc18"],["ffbc4453.ac9408"],["30c8eb76.72fa54"]]},{"id":"75a3e0c8.9585b","type":"http request","z":"6e4e7309.81165c","name":"Fletcher Travel Time","method":"GET","ret":"obj","paytoqs":false,"url":"https://maps.googleapis.com/maps/api/distancematrix/json?origins=18+Forest+Drive+Lonehill&destinations=3012+william+Nicol+Drive+Bryanston&key={{secret}}&mode=driving&traffic_model=pessimistic&departure_time=now","tls":"","proxy":"","authType":"","x":420,"y":320,"wires":[["7ab08437.e641dc","dce5a2c4.8dd14"]]},{"id":"3b4abb08.ef19e4","type":"switch","z":"8c3854a8.1ec5c8","name":"","property":"StartupDelay","propertyType":"global","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":120,"wires":[[],["66ff4b09.c97e84"]]},{"id":"66ff4b09.c97e84","type":"delay","z":"8c3854a8.1ec5c8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":180,"wires":[["3b4abb08.ef19e4"]]},{"id":"9b33cb8d.70f6c8","type":"delay","z":"8c3854a8.1ec5c8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":180,"y":120,"wires":[["3b4abb08.ef19e4"]]},{"id":"d679ca69.a5eff8","type":"mqtt in","z":"247a7db4.488d62","name":"OwnTracks","topic":"owntracks/+/+","qos":"2","datatype":"auto","broker":"66726911.b76f98","x":100,"y":220,"wires":[["19de6bc8.135374"]]},{"id":"2456d521.b9e6fa","type":"json","z":"247a7db4.488d62","name":"","property":"payload","action":"","pretty":false,"x":410,"y":220,"wires":[["3a89732c.33e0dc"]]},{"id":"3a89732c.33e0dc","type":"function","z":"247a7db4.488d62","name":"Parse","func":"if (msg.payload._type === \"location\")\n{\n//    var date = new Date(parseInt(msg.payload.tst) * 1000);\n    \n    msg.payload.data = {\n        \"battery\" : parseInt(msg.payload.batt),\n        \"dev_id\" : msg.topic.replace(/\\/|-/g, \"_\").toLowerCase(),\n        \"gps\" : [parseFloat(msg.payload.lat),parseFloat(msg.payload.lon)],\n        \"gps_accuracy\" : msg.payload.acc\n    };\n    msg.timestamp = msg.payload.tst;\n}\nelse\n    msg = null;\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":220,"wires":[["168ca38f.8671fc"]]},{"id":"2f3f7007.462dd","type":"switch","z":"247a7db4.488d62","name":"At Home?","property":"location.inarea","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":220,"wires":[["ed3c34.610fd3d"],["3662be20.6c7fc2","53657ae0.e1e554"]]},{"id":"3662be20.6c7fc2","type":"change","z":"247a7db4.488d62","name":"Home","rules":[{"t":"set","p":"payload.data.location_name","pt":"msg","to":"home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":240,"wires":[["c0e92bed.0c7bd8","3aa1a5f6.11028a"]]},{"id":"ed3c34.610fd3d","type":"change","z":"247a7db4.488d62","name":"Away","rules":[{"t":"set","p":"payload.data.location_name","pt":"msg","to":"not_home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":200,"wires":[["3aa1a5f6.11028a","c0e92bed.0c7bd8","d3c2f4af.3d9fc8"]]},{"id":"c0e92bed.0c7bd8","type":"debug","z":"247a7db4.488d62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1070,"y":200,"wires":[]},{"id":"3aa1a5f6.11028a","type":"api-call-service","z":"247a7db4.488d62","name":"Update device_tracker","server":"","service_domain":"device_tracker","service":"see","data":"","mergecontext":"","x":1120,"y":240,"wires":[[]]},{"id":"19de6bc8.135374","type":"subflow:8c3854a8.1ec5c8","z":"247a7db4.488d62","name":"","env":[],"x":260,"y":220,"wires":[["2456d521.b9e6fa"]]},{"id":"53657ae0.e1e554","type":"api-current-state","z":"247a7db4.488d62","name":"Recent Door Activity?","server":"","outputs":1,"halt_if":"","override_topic":false,"entity_id":"input_boolean.door_activity","override_payload":true,"override_data":true,"x":940,"y":320,"wires":[["d72f7d3b.51632","1a2c4c63.6126f4"]]},{"id":"d72f7d3b.51632","type":"switch","z":"247a7db4.488d62","name":"On / Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1140,"y":320,"wires":[["d3c2f4af.3d9fc8"],["7c4518f1.d4e128"]]},{"id":"d3c2f4af.3d9fc8","type":"function","z":"247a7db4.488d62","name":"OwnTracks variable","func":"distance = parseInt(msg.location.distances.Home);\ninterval = parseInt(0.000000000000475 * Math.pow(distance,4) - 0.00000000475 * Math.pow(distance,3) + 0.0000265 * Math.pow(distance,2) + 0.0037 * distance + 1.43);\ndev_id = msg.topic.replace(/\\/|-/g, \"_\").toLowerCase();\n\nif (interval < 3) interval = 3;\nif (interval > 300) interval = 300;\n\nlastInterval = flow.get(dev_id + '_last_owntracks_interval');\nlastTimestamp = flow.get(dev_id + '_last_owntracks_timestamp');\n\nvar temp = new Date(parseInt(msg.timestamp) * 1000);\nnode.status({fill: \"green\", shape: \"dot\", text: interval + \" at \" + temp.toLocaleString()});\n\nif (typeof(lastInterval) != \"undefined\")\n{\n\tif ((msg.timestamp - 3600) < lastTimestamp) // less than 1 hour since last update?\n\t{\n\t\tif (lastInterval > (interval / 1.05) && lastInterval < (interval * 1.05)) // within 5% of last update?\n        {\n            node.status({fill: \"red\", shape: \"ring\", text: interval + \" at \" + temp.toLocaleString()});\n            msg = null;\n        }\n        else\n\t\t{\n            node.status({fill: \"green\", shape: \"dot\", text: msg.timestamp + \" versus \" + lastTimestamp});\n            flow.set('_last_owntracks_interval', interval);\n            flow.set('_last_owntracks_timestamp', msg.timestamp);\n\n            msg.topic = msg.topic + \"/cmd\";\n            msg.payload = {\n                \"_type\" : \"cmd\",\n                \"action\" : \"setConfiguration\",\n                \"configuration\" : {\n                    \"_type\" : \"configuration\",\n                    \"beaconMode\" : 2,\n                    \"locatorDisplacement\" : interval * 2,\n                    \"locatorInterval\" : interval,\n                    \"pub\" : \"true\",\n                    \"pubQos\" : 2\n                }\n            };\n        }\n    }\n    else\n    {\n        flow.set(dev_id + '_last_owntracks_interval', interval);\n        flow.set(dev_id + '_last_owntracks_timestamp', msg.timestamp);\n\n        msg.topic = msg.topic + \"/cmd\";\n        msg.payload = {\n            \"_type\" : \"cmd\",\n            \"action\" : \"setConfiguration\",\n            \"configuration\" : {\n                \"_type\" : \"configuration\",\n                \"beaconMode\" : 2,\n                \"locatorDisplacement\" : interval * 2,\n                \"locatorInterval\" : interval,\n                \"pub\" : \"true\",\n                \"pubQos\" : 2\n            }\n        };\n    }\n}\nelse\n{\n    flow.set(dev_id + '_last_owntracks_interval', interval);\n    flow.set(dev_id + '_last_owntracks_timestamp', msg.timestamp);\n\n    msg.topic = msg.topic + \"/cmd\";\n    msg.payload = {\n        \"_type\" : \"cmd\",\n        \"action\" : \"setConfiguration\",\n        \"configuration\" : {\n            \"_type\" : \"configuration\",\n            \"beaconMode\" : 2,\n            \"locatorDisplacement\" : interval * 2,\n            \"locatorInterval\" : interval,\n            \"pub\" : \"true\",\n            \"pubQos\" : 2\n        }\n    };\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":300,"wires":[["91909a7c.9cb358","7b34452e.482e8c"]]},{"id":"7c4518f1.d4e128","type":"function","z":"247a7db4.488d62","name":"OwnTracks 120sec","func":"var timestamp = new Date(parseInt(msg.timestamp) * 1000);\nnode.status({fill: \"green\", shape: \"dot\", text: 120 + \" at \" + timestamp.toLocaleString()});\ndev_id = msg.topic.replace(/\\/|-/g, \"_\").toLowerCase();\n\nflow.set(dev_id + '_last_owntracks_timestamp', msg.timestamp);\nflow.set(dev_id + '_last_owntracks_interval', 120);\n\nmsg.topic = msg.topic + \"/cmd\";\nmsg.payload = {\n    \"_type\" : \"cmd\",\n    \"action\" : \"setConfiguration\",\n    \"configuration\" : {\n        \"_type\" : \"configuration\",\n        \"beaconMode\" : 2,\n        \"locatorDisplacement\" : 50,\n        \"locatorInterval\" : 120,\n        \"pub\" : \"true\",\n        \"pubQos\" : 2\n    }\n};\n// beaconMode was 0\n\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":360,"wires":[["7b34452e.482e8c","91909a7c.9cb358"]]},{"id":"91909a7c.9cb358","type":"mqtt out","z":"247a7db4.488d62","name":"","topic":"","qos":"2","retain":"false","broker":"66726911.b76f98","x":1510,"y":340,"wires":[]},{"id":"7b34452e.482e8c","type":"debug","z":"247a7db4.488d62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1510,"y":300,"wires":[]},{"id":"5025b575.b2191c","type":"comment","z":"247a7db4.488d62","name":"Note: override topic is OFF","info":"","x":930,"y":360,"wires":[]},{"id":"1a2c4c63.6126f4","type":"debug","z":"247a7db4.488d62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1130,"y":360,"wires":[]},{"id":"168ca38f.8671fc","type":"geofence","z":"247a7db4.488d62","name":"Home","mode":"polyline","inside":"both","rad":0,"points":[{"latitude":0.470799056043745,"longitude":40.95746326446533},{"latitude":0.47222352757142,"longitude":40.95632600784302},{"latitude":0.4736796205139,"longitude":40.95759201049805},{"latitude":0.4736796205139,"longitude":40.96282768249512},{"latitude":0.47220770028812,"longitude":40.96387910842896},{"latitude":0.47083071131877,"longitude":40.96278476715088}],"centre":{},"x":650,"y":220,"wires":[["2f3f7007.462dd"]]},{"id":"28eff82f.ca78b8","type":"server-state-changed","z":"690339e0.145a08","name":"owntracks - fk_s9_2","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.fk_fsksg9","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":220,"wires":[["fe3bbea7.0d5d6","9410eb33.646268"]]},{"id":"114de7e4.3e35a8","type":"debug","z":"690339e0.145a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1090,"y":120,"wires":[]},{"id":"c7104eaf.bb384","type":"comment","z":"690339e0.145a08","name":"Track FK S9 OwnTracks","info":"","x":150,"y":180,"wires":[]},{"id":"9d234afc.ff0698","type":"secret","z":"eddcae95.aa2d6","name":"IFTTT API Key","x":400,"y":260,"wires":[["45c311e4.b3ef6"]]},{"id":"45c311e4.b3ef6","type":"template","z":"eddcae95.aa2d6","name":"Set msg.url","field":"url","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"https://maker.ifttt.com/trigger/doorbell/with/key/{{secret}}","x":510,"y":320,"wires":[["cd2b4da9.7683d","5c498709.f71758"]]},{"id":"5c498709.f71758","type":"http request","z":"eddcae95.aa2d6","name":"IFTTT","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","x":670,"y":340,"wires":[[]]},{"id":"cd2b4da9.7683d","type":"debug","z":"eddcae95.aa2d6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":300,"wires":[]},{"id":"eaef44f7.309e58","type":"inject","z":"eddcae95.aa2d6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":280,"y":200,"wires":[["9d234afc.ff0698"]]},{"id":"2cc6e2d8.58622e","type":"switch","z":"690339e0.145a08","name":"==home, Check if state has actually changed","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"neq","v":"data.new_state.state","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":120,"wires":[["114de7e4.3e35a8"]]},{"id":"fe3bbea7.0d5d6","type":"switch","z":"690339e0.145a08","name":"Home? or Not Home?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":220,"wires":[["2cc6e2d8.58622e"],["e5e844b8.4a7478","545cbe7d.2f528"]]},{"id":"e5e844b8.4a7478","type":"switch","z":"690339e0.145a08","name":"==not_home, Check if state has actually changed","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"neq","v":"data.new_state.state","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":340,"wires":[["263a43f6.68bdfc"]]},{"id":"263a43f6.68bdfc","type":"debug","z":"690339e0.145a08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1110,"y":340,"wires":[]},{"id":"9410eb33.646268","type":"debug","z":"690339e0.145a08","name":"owntracks_status","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":370,"y":340,"wires":[]},{"id":"545cbe7d.2f528","type":"debug","z":"690339e0.145a08","name":"not_home_debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":220,"wires":[]},{"id":"363494c0.c247ac","type":"pushover","z":"6e4e7309.81165c","name":"","device":"","title":"Travel Time","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1750,"y":240,"wires":[]},{"id":"80822b2b.0ebc18","type":"function","z":"6e4e7309.81165c","name":"fk - green","func":"msg.topic ='fletcher'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'green'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":320,"wires":[["77e84e5f.cac4f","2c2befab.60d54"]]},{"id":"e78056ed.d2c348","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","version":1,"service_domain":"media_player","service":"alexa_tts","entityId":"media_player.fletcher_s_echo_plus","data":"{\"message\":\"{{payload.message}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":240,"wires":[[]]},{"id":"e09804ce.b2c8e8","type":"inject","z":"15c157a1.27c788","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":260,"wires":[["e811d255.7c29d","8727ab18.ed3a88"]]},{"id":"8727ab18.ed3a88","type":"function","z":"15c157a1.27c788","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":260,"wires":[[]]},{"id":"a317812d.8fab6","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":320,"wires":[[]]},{"id":"e811d255.7c29d","type":"function","z":"15c157a1.27c788","name":"create Karien Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: 'Weclome home ' + name ,\n};\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":320,"wires":[[]]},{"id":"b3aa40d6.c99f9","type":"switch","z":"95334549.408f08","name":"HOME / NOT HOME","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":180,"wires":[["27c84a0d.495506"],["2db90c5e.f2e6c4"]],"outputLabels":["Fletcher",""]},{"id":"fc784599.17c248","type":"switch","z":"95334549.408f08","name":"HOME / NOT HOME","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":500,"wires":[["3b91f5b.b89f90a"],["63cb3cd9.29a4c4"]],"outputLabels":["Fletcher",null]},{"id":"8e13aa60.5dc868","type":"server-state-changed","z":"95334549.408f08","name":"karien-home-devicetracker","server":"abc5f2b.6bde21","version":1,"entityidfilter":"device_tracker.karien_s_s8","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":110,"y":500,"wires":[["fc784599.17c248"]]},{"id":"c0ae4fd.b6596b","type":"server-state-changed","z":"95334549.408f08","name":"fletcher-home-devicetracker","server":"abc5f2b.6bde21","version":1,"entityidfilter":"device_tracker.fletcher_s_s9","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":80,"wires":[["b3aa40d6.c99f9","ba93698d.f96ba8"]]},{"id":"cb418d52.19d0d","type":"api-call-service","z":"95334549.408f08","name":"Alexa Plus - Karien is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"Welcome home babe!!\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":440,"wires":[[]]},{"id":"8c367b1a.45e958","type":"api-call-service","z":"95334549.408f08","name":"Alexa Dot - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\" media_player.fletcher_s_echo_dot\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1120,"y":140,"wires":[[]]},{"id":"694d285d.0cade8","type":"api-call-service","z":"95334549.408f08","name":"Alexa - Karien is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\" media_player.fletcher_s_echo_dot\",\"message\":\"Welcome home babe!!\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1080,"y":500,"wires":[[]]},{"id":"27c84a0d.495506","type":"function","z":"95334549.408f08","name":"create \"fletcher\" home message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":100,"wires":[["d387f597.672e18","8c367b1a.45e958","14d036c2.d8f819"]]},{"id":"d387f597.672e18","type":"api-call-service","z":"95334549.408f08","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1120,"y":80,"wires":[[]]},{"id":"2db90c5e.f2e6c4","type":"function","z":"95334549.408f08","name":"create \"fletcher\" away message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is away',\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":340,"wires":[["14d036c2.d8f819"]]},{"id":"14d036c2.d8f819","type":"change","z":"95334549.408f08","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":280,"wires":[["6e9500b0.89b8"]]},{"id":"6e9500b0.89b8","type":"pushover","z":"95334549.408f08","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1120,"y":280,"wires":[]},{"id":"131463a6.8be71c","type":"change","z":"95334549.408f08","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":580,"wires":[["8bae1578.74a698"]]},{"id":"8bae1578.74a698","type":"pushover","z":"95334549.408f08","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1180,"y":580,"wires":[]},{"id":"3b91f5b.b89f90a","type":"function","z":"95334549.408f08","name":"create Karien Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: 'Weclome home ' + name ,\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":440,"wires":[["131463a6.8be71c","cb418d52.19d0d","694d285d.0cade8"]]},{"id":"63cb3cd9.29a4c4","type":"function","z":"95334549.408f08","name":"create Karien away Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: name + ' is away' ,\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":640,"wires":[["131463a6.8be71c"]]},{"id":"b0ff6576.7a4728","type":"inject","z":"15c157a1.27c788","name":"","topic":"node-red-tracker","payload":"Test from Node-red","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":120,"wires":[["f35c8f94.5f047"]]},{"id":"f35c8f94.5f047","type":"pushover","z":"15c157a1.27c788","name":"","device":"","title":"","priority":0,"sound":"","url":"","url_title":"","html":false,"x":580,"y":120,"wires":[]},{"id":"31618ae6.532246","type":"comment","z":"15c157a1.27c788","name":"Node-red-contrib-testing","info":"","x":130,"y":80,"wires":[]},{"id":"a7f1c5aa.7b4528","type":"comment","z":"15c157a1.27c788","name":"Alexa testing with Home Assistant service","info":"","x":180,"y":220,"wires":[]},{"id":"253083b6.febbcc","type":"secret","z":"6e4e7309.81165c","name":"secret","x":250,"y":160,"wires":[["feb63a70.687138"]]},{"id":"d60ca853.67e678","type":"mqtt out","z":"6e4e7309.81165c","name":"whale - MQTT","topic":"","qos":"","retain":"","broker":"66726911.b76f98","x":1780,"y":120,"wires":[]},{"id":"e6223a2b.130d28","type":"change","z":"6e4e7309.81165c","name":"Travel Time Text","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopictext","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":120,"wires":[["d60ca853.67e678","132ac459.9fd4bc","363494c0.c247ac"]]},{"id":"77e84e5f.cac4f","type":"change","z":"6e4e7309.81165c","name":"Travel Time Text","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopictext","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":320,"wires":[["4926198c.c16bc8","858d37e.2dbe8c8","363494c0.c247ac"]]},{"id":"4926198c.c16bc8","type":"mqtt out","z":"6e4e7309.81165c","name":"whale - mqtt","topic":"","qos":"","retain":"","broker":"66726911.b76f98","x":1750,"y":320,"wires":[]},{"id":"82631610.583b78","type":"function","z":"6e4e7309.81165c","name":"kk - amber","func":"msg.topic ='karien'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'amber'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":180,"wires":[["e6223a2b.130d28","f9a2bf40.e17e2"]]},{"id":"5ac48bb7.fde664","type":"function","z":"6e4e7309.81165c","name":"kk - red","func":"msg.topic ='karien'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'red'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":240,"wires":[["f9a2bf40.e17e2","e6223a2b.130d28"]]},{"id":"f9a2bf40.e17e2","type":"change","z":"6e4e7309.81165c","name":"Travel Time Color","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopicled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"led","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":240,"wires":[["d60ca853.67e678","132ac459.9fd4bc"]]},{"id":"ffbc4453.ac9408","type":"function","z":"6e4e7309.81165c","name":"fk - amber","func":"msg.topic ='fletcher'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'amber'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":380,"wires":[["77e84e5f.cac4f","2c2befab.60d54"]]},{"id":"30c8eb76.72fa54","type":"function","z":"6e4e7309.81165c","name":"fk - red","func":"msg.topic =' fletcher'\nmsg.payload = msg.topic + ' travel time is ' + msg.traveltime;\nmsg.mqtttopictext = 'tele/travel/' + msg.topic\nmsg.led = 'red'\nmsg.mqtttopicled = 'tele/travel/' + msg.topic + '/led/'\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":440,"wires":[["77e84e5f.cac4f","2c2befab.60d54"]]},{"id":"2c2befab.60d54","type":"change","z":"6e4e7309.81165c","name":"Travel Time Color","rules":[{"t":"set","p":"topic","pt":"msg","to":"mqtttopicled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"led","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":440,"wires":[["4926198c.c16bc8","858d37e.2dbe8c8"]]},{"id":"7dc1bb08.e935f4","type":"mqtt in","z":"d58c58f8.8219f8","name":"MXChip Telemetry","topic":"tele/mxchip1/#","qos":"0","datatype":"json","broker":"6eb36010.171f5","x":250,"y":360,"wires":[["5b55320.6d00bd","6c425fbc.46415"]]},{"id":"b42e1599.015548","type":"comment","z":"d58c58f8.8219f8","name":"MQTT -> Node-Red -> mongoDB","info":"","x":270,"y":300,"wires":[]},{"id":"6c425fbc.46415","type":"switch","z":"d58c58f8.8219f8","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"tele/mxchip1/temp","vt":"str"},{"t":"eq","v":"tele/mxchip1/humidity","vt":"str"},{"t":"eq","v":"pressure","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":580,"y":400,"wires":[["d06cae10.30a38"],["67c4d1b8.6d37a"],[]]},{"id":"d06cae10.30a38","type":"function","z":"d58c58f8.8219f8","name":"format for influx - temperature","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    temperature: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":380,"wires":[["cf8492f0.89e8a"]]},{"id":"67c4d1b8.6d37a","type":"function","z":"d58c58f8.8219f8","name":"format for influx - humidity","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    humidity: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":440,"wires":[["f337d8b6.fc67e8"]]},{"id":"cf8492f0.89e8a","type":"influxdb out","z":"d58c58f8.8219f8","influxdb":"beb2d5b5.e9a6f8","name":"influx insert","measurement":"temperature","precision":"","retentionPolicy":"","x":1210,"y":320,"wires":[]},{"id":"f337d8b6.fc67e8","type":"influxdb out","z":"d58c58f8.8219f8","influxdb":"beb2d5b5.e9a6f8","name":"influx insert","measurement":"humidity","precision":"","retentionPolicy":"","x":1210,"y":480,"wires":[]},{"id":"5b55320.6d00bd","type":"mongodb out","z":"d58c58f8.8219f8","mongodb":"60641eba.4e311","name":"","collection":"MXChip","payonly":false,"upsert":false,"multi":false,"operation":"insert","x":920,"y":260,"wires":[]},{"id":"bbd4df20.427f","type":"http in","z":"6e4e7309.81165c","name":"","url":"/karientraffic","method":"get","upload":false,"swaggerDoc":"","x":110,"y":100,"wires":[["253083b6.febbcc"]]},{"id":"7ab08437.e641dc","type":"change","z":"6e4e7309.81165c","name":"duration in traffic to traveltime","rules":[{"t":"set","p":"traveltime","pt":"msg","to":"payload.rows[0].elements[0].duration_in_traffic.text","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["b55b4d25.80e9c"]]},{"id":"bffb20b4.e6fdd","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"+CSIM: 201,\"90CC715D02E87B9BF513.....\"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":220,"wires":[["4bd8caf1.9667a4"]]},{"id":"4bd8caf1.9667a4","type":"function","z":"8c52d380.fec46","name":"Extract bit in quotes","func":"var part = msg.payload.split(\" \")[0];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":200,"wires":[["b674c484.f834b8","c06e9451.771448"]]},{"id":"b674c484.f834b8","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":550,"y":220,"wires":[]},{"id":"1bc23905.c2a187","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"16 mins","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":160,"wires":[["4bd8caf1.9667a4"]]},{"id":"b55b4d25.80e9c","type":"function","z":"6e4e7309.81165c","name":"Extract bit in quotes","func":"var part = msg.traveltime.split(\" \")[0];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":480,"wires":[["49727091.39b16"]]},{"id":"5ded3759.4b0b58","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"+CSIM: 201,\"90CC715D02E87B9BF513.....\"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":320,"wires":[["e53d6db7.21953"]]},{"id":"e53d6db7.21953","type":"function","z":"8c52d380.fec46","name":"Extract bit in quotes","func":"var part = msg.payload.split(\"\\\"\")[1];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":320,"wires":[["6d23d1ac.7a8a5"]]},{"id":"6d23d1ac.7a8a5","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":570,"y":320,"wires":[]},{"id":"c06e9451.771448","type":"change","z":"8c52d380.fec46","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":160,"wires":[["bdb4337.db257d"]]},{"id":"bdb4337.db257d","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":790,"y":180,"wires":[]},{"id":"49727091.39b16","type":"change","z":"6e4e7309.81165c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":480,"wires":[["d7d6cc3a.f3411"]]},{"id":"8b6353a0.5542d","type":"change","z":"6e4e7309.81165c","name":"duration in traffic to traveltime","rules":[{"t":"set","p":"traveltime","pt":"msg","to":"payload.rows[0].elements[0].duration_in_traffic.text","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":140,"wires":[["18f34b20.314c25"]]},{"id":"18f34b20.314c25","type":"function","z":"6e4e7309.81165c","name":"Extract bit in quotes","func":"var part = msg.traveltime.split(\" \")[0];\nmsg.payload = part;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":60,"wires":[["4446730.a42858c"]]},{"id":"4446730.a42858c","type":"change","z":"6e4e7309.81165c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":60,"wires":[["b794425b.97b8b"]]},{"id":"132ac459.9fd4bc","type":"mqtt out","z":"6e4e7309.81165c","name":"unraid - mqtt","topic":"","qos":"","retain":"","broker":"6eb36010.171f5","x":1750,"y":180,"wires":[]},{"id":"858d37e.2dbe8c8","type":"mqtt out","z":"6e4e7309.81165c","name":"unraid - mqtt","topic":"","qos":"","retain":"","broker":"6eb36010.171f5","x":1770,"y":420,"wires":[]},{"id":"46e79f70.e37b6","type":"server-state-changed","z":"a7fe27bd.2509f8","name":"Life360 - Fletcher","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":340,"wires":[["c7361d4c.1a0fd"]]},{"id":"69b1fe35.2b348","type":"debug","z":"a7fe27bd.2509f8","name":"fletcher_work","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":965,"y":160,"wires":[]},{"id":"9f372854.a64408","type":"switch","z":"a7fe27bd.2509f8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"fletcher_work","vt":"str"},{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":610,"y":340,"wires":[["69b1fe35.2b348"],["ae8093b3.e6b9a","d15b7cca.4448"],["5256da42.a63034"]]},{"id":"5256da42.a63034","type":"debug","z":"a7fe27bd.2509f8","name":"not_home","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":955,"y":540,"wires":[]},{"id":"ae8093b3.e6b9a","type":"debug","z":"a7fe27bd.2509f8","name":"home","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":945,"y":360,"wires":[]},{"id":"abfcdd3b.9c68c","type":"pushover","z":"a7fe27bd.2509f8","name":"","device":"","title":"fletcher_work_nodered","priority":0,"sound":"","url":"","url_title":"","html":false,"x":995,"y":120,"wires":[]},{"id":"857acace.da57f8","type":"pushover","z":"a7fe27bd.2509f8","name":"","device":"","title":"fletcher_home_nodered","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1005,"y":320,"wires":[]},{"id":"c0809818.e6f5c8","type":"pushover","z":"a7fe27bd.2509f8","name":"","device":"","title":"fletcher_not_home_nodered","priority":0,"sound":"","url":"","url_title":"","html":false,"x":1015,"y":500,"wires":[]},{"id":"2b49fd6d.c19912","type":"mqtt in","z":"b9fe7189.3c263","name":"","topic":"tele/d1minikitchen/SENSOR","qos":"2","datatype":"auto","broker":"6eb36010.171f5","x":170,"y":260,"wires":[["e88e7ac2.d7d088","ea5c971d.967638"]]},{"id":"ea5c971d.967638","type":"debug","z":"b9fe7189.3c263","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":420,"y":420,"wires":[]},{"id":"e88e7ac2.d7d088","type":"json","z":"b9fe7189.3c263","name":"","property":"payload","action":"","pretty":false,"x":480,"y":240,"wires":[["ea5c971d.967638","fa3b4b4b.d85858","9830f0df.29c7b"]]},{"id":"e8c59da0.d7771","type":"mqtt out","z":"b9fe7189.3c263","name":"","topic":"tele/mxchip1/temp","qos":"","retain":"","broker":"6eb36010.171f5","x":870,"y":100,"wires":[]},{"id":"fa3b4b4b.d85858","type":"change","z":"b9fe7189.3c263","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.AM2301.Temperature","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":160,"wires":[["e8c59da0.d7771"]]},{"id":"9830f0df.29c7b","type":"change","z":"b9fe7189.3c263","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.AM2301.Humidity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["650e86e7.ececf8"]]},{"id":"650e86e7.ececf8","type":"mqtt out","z":"b9fe7189.3c263","name":"","topic":"tele/mxchip1/humidity","qos":"","retain":"","broker":"6eb36010.171f5","x":920,"y":320,"wires":[]},{"id":"ba93698d.f96ba8","type":"debug","z":"95334549.408f08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":310,"y":300,"wires":[]},{"id":"4dc3c2a9.9b28ec","type":"secret","z":"6e4e7309.81165c","name":"secret","x":290,"y":460,"wires":[["75a3e0c8.9585b"]]},{"id":"7444290a.ae9af8","type":"http in","z":"6e4e7309.81165c","name":"","url":"/fletchertraffic","method":"get","upload":false,"swaggerDoc":"","x":110,"y":600,"wires":[["4dc3c2a9.9b28ec"]]},{"id":"5fc83e4e.e1a0a","type":"http in","z":"6e4e7309.81165c","name":"","url":"/traffic","method":"get","upload":false,"swaggerDoc":"","x":70,"y":260,"wires":[["253083b6.febbcc","4dc3c2a9.9b28ec"]]},{"id":"c7361d4c.1a0fd","type":"switch","z":"a7fe27bd.2509f8","name":"Check if state has actually changed","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"neq","v":"data.new_state.state","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":340,"wires":[["9f372854.a64408"]]},{"id":"4a3d556c.135414","type":"mqtt in","z":"d90740e8.853308","name":"D1MiniKitchen - Sensor","topic":"tele/d1minikitchen/SENSOR","qos":"0","datatype":"json","broker":"16ebb146.299d6f","x":140,"y":100,"wires":[["287e4a24.981166","78dab763.eaeac"]]},{"id":"287e4a24.981166","type":"mongodb out","z":"d90740e8.853308","mongodb":"39e7b6cc.400702","name":"","collection":"D1Mini","payonly":false,"upsert":false,"multi":false,"operation":"insert","x":630,"y":80,"wires":[]},{"id":"163d1562.ff87fb","type":"comment","z":"d90740e8.853308","name":"MQTT -> Node-Red -> InfluxDB","info":"","x":170,"y":460,"wires":[]},{"id":"13719a21.ada6e6","type":"mqtt in","z":"d90740e8.853308","name":"Temperature - MXChip Telemetry","topic":"tele/mxchip1/temp","qos":"2","datatype":"auto","broker":"16ebb146.299d6f","x":170,"y":520,"wires":[[]]},{"id":"4859cbe6.f42e5c","type":"function","z":"d90740e8.853308","name":"format for influx","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    temperature: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":540,"wires":[["26a945bc.32027a","b0b009f2.297258"]]},{"id":"26a945bc.32027a","type":"debug","z":"d90740e8.853308","name":"known","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":790,"y":600,"wires":[]},{"id":"b0b009f2.297258","type":"influxdb out","z":"d90740e8.853308","influxdb":"87bc6ced.c12878","name":"influx insert","measurement":"temperature","precision":"","retentionPolicy":"","x":730,"y":500,"wires":[]},{"id":"2c972e35.3f0502","type":"inject","z":"d90740e8.853308","name":"inject timestamp","topic":"","payload":"","payloadType":"date","repeat":"600","crontab":"","once":false,"onceDelay":"","x":130,"y":900,"wires":[["74073002.a1df8"]]},{"id":"74073002.a1df8","type":"http request","z":"d90740e8.853308","name":"OpenWeatherMap API","method":"GET","ret":"txt","paytoqs":false,"url":"http://api.openweathermap.org/data/2.5/weather?q=Sandton,ZA&units=metric&APPID=de570399625a54769eaa09cef49a3706","tls":"","proxy":"","x":380,"y":900,"wires":[["10e9a275.6b41de"]]},{"id":"10e9a275.6b41de","type":"json","z":"d90740e8.853308","name":"","property":"payload","action":"","pretty":true,"x":630,"y":900,"wires":[["9bf99611.2f7cb","566e0f01.fc23f"]]},{"id":"9bf99611.2f7cb","type":"function","z":"d90740e8.853308","name":"format for influx","func":"msg.payload ={\n    locale: msg.payload.name,\n    temperature: parseFloat(msg.payload.main.temp),\n    humidity: parseFloat(msg.payload.main.humidity),\n    pressure: parseFloat(msg.payload.main.pressure)\n}\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":900,"wires":[["566e0f01.fc23f","2132911.7e5976e"]]},{"id":"566e0f01.fc23f","type":"debug","z":"d90740e8.853308","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":800,"wires":[]},{"id":"2132911.7e5976e","type":"influxdb out","z":"d90740e8.853308","influxdb":"e613cf86.3feb98","name":"influx insert","measurement":"weatherapis","precision":"","retentionPolicy":"","x":1090,"y":900,"wires":[]},{"id":"2bc95fdf.17f0e8","type":"mqtt in","z":"d90740e8.853308","name":"humidity - MXChip Telemetry","topic":"tele/mxchip1/humidity","qos":"2","datatype":"auto","broker":"16ebb146.299d6f","x":160,"y":700,"wires":[[]]},{"id":"b0ae4f85.5e312","type":"function","z":"d90740e8.853308","name":"format for influx","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    humidity: parseFloat(msg.payload)\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":720,"wires":[["79dfe1ca.060b48","a0e4c7a7.04b47"]]},{"id":"79dfe1ca.060b48","type":"influxdb out","z":"d90740e8.853308","influxdb":"87bc6ced.c12878","name":"influx insert","measurement":"humidity","precision":"","retentionPolicy":"","x":730,"y":680,"wires":[]},{"id":"ae28c4a.bd0a838","type":"comment","z":"d90740e8.853308","name":"MQTT -> Node-Red -> mongoDB","info":"","x":610,"y":40,"wires":[]},{"id":"acd84102.4793e8","type":"debug","z":"d90740e8.853308","name":"temperature debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":660,"wires":[]},{"id":"a0e4c7a7.04b47","type":"debug","z":"d90740e8.853308","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":700,"y":760,"wires":[]},{"id":"eb017c9a.3fa6a","type":"inject","z":"d90740e8.853308","name":"","topic":"","payload":"{\"Time\":\"2019-09-24T08:43:06\",\"DHT11\":{\"Temperature\":23,\"Humidity\":17},\"TempUnit\":\"C\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":360,"wires":[["78dab763.eaeac"]]},{"id":"78dab763.eaeac","type":"switch","z":"d90740e8.853308","name":"checking if temp and humidity valid","property":"payload.DHT11.Temperature","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"payload.DHT11.Temperature > 0","vt":"jsonata"},{"t":"jsonata_exp","v":"payload.DHT11.Humidity > 0","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":2,"x":540,"y":260,"wires":[["76f8b781.1136e"],["a4d1adec.c3da58"]]},{"id":"76f8b781.1136e","type":"function","z":"d90740e8.853308","name":"format for influx - temperature","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    temperature: parseFloat(msg.payload.DHT11.Temperature)\n}\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":220,"wires":[["694b35a7.79f07c","d4ee81e4.c9d4a"]]},{"id":"694b35a7.79f07c","type":"debug","z":"d90740e8.853308","name":"format","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1110,"y":240,"wires":[]},{"id":"d06c203a.84d03","type":"comment","z":"d90740e8.853308","name":"MQTT -> Node-Red -> InfluxDB","info":"","x":550,"y":220,"wires":[]},{"id":"a4d1adec.c3da58","type":"function","z":"d90740e8.853308","name":"format for influx - humidity","func":"msg.payload ={\n    locale: \"Breakfast-Nook\",\n    humidity: parseFloat(msg.payload.DHT11.Humidity)\n}\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":280,"wires":[["694b35a7.79f07c","c5802da6.2f4d98"]]},{"id":"d4ee81e4.c9d4a","type":"influxdb out","z":"d90740e8.853308","influxdb":"b08dc7ea.aabfd","name":"influx insert temp","measurement":"temperature","precision":"","retentionPolicy":"","x":1130,"y":160,"wires":[]},{"id":"c5802da6.2f4d98","type":"influxdb out","z":"d90740e8.853308","influxdb":"b08dc7ea.aabfd","name":"influx insert humidity","measurement":"humidity","precision":"","retentionPolicy":"","x":1140,"y":320,"wires":[]},{"id":"e255beb7.73e7e","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":500,"wires":[[]]},{"id":"6cc79023.76c3e","type":"inject","z":"15c157a1.27c788","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":540,"wires":[["cbc2fcc7.443d","d1b84f37.abf41"]]},{"id":"2f833142.f32dce","type":"function","z":"15c157a1.27c788","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":520,"wires":[["e255beb7.73e7e","765b3b9f.89c684"]]},{"id":"66a32193.c9fab","type":"function","z":"15c157a1.27c788","name":"create Karien Message","func":"var name = 'Karien';\nmsg.payload = { \n    message: 'Weclome home ' + name ,\n};\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":580,"wires":[["8f4d96df.148cb8","d7cc91f3.75619"]]},{"id":"b423f8a4.bd2348","type":"comment","z":"15c157a1.27c788","name":"Alexa testing with Home Assistant service - notify.alexa_media","info":"","x":240,"y":480,"wires":[]},{"id":"aa993341.a2e07","type":"function","z":"f27aa045.98e9d","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":140,"wires":[["4055698e.897a68","6af7711e.25cf8"]]},{"id":"4055698e.897a68","type":"api-call-service","z":"f27aa045.98e9d","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":100,"wires":[[]]},{"id":"6af7711e.25cf8","type":"api-call-service","z":"f27aa045.98e9d","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":160,"wires":[[]]},{"id":"d15b7cca.4448","type":"subflow:f27aa045.98e9d","z":"a7fe27bd.2509f8","name":"Alexa Messages","env":[],"x":980,"y":400,"wires":[]},{"id":"b0e0123c.81fd","type":"server-state-changed","z":"4770c0d7.397b","name":"Life360 - Fletcher","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":100,"wires":[["ee04eeaa.ad89f"]]},{"id":"69a38b51.df4044","type":"server-state-changed","z":"4770c0d7.397b","name":"Life360 - Karien","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":200,"wires":[["ee04eeaa.ad89f"]]},{"id":"d0f02aba.fa8a68","type":"BooleanLogicUltimate","z":"4770c0d7.397b","name":"","filtertrue":"both","persist":true,"sInitializeWith":"WaitForPayload","triggertopic":"trigger","outputtriggeredby":"all","inputCount":"2","topic":"result","x":720,"y":220,"wires":[["aaebda9e.ec9cb8","31977e07.708122","88356352.8de14"],["96d1f2eb.d94e6"],[]]},{"id":"ee04eeaa.ad89f","type":"switch","z":"4770c0d7.397b","name":"home or not_home","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"},{"t":"cont","v":"work","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":390,"y":160,"wires":[["3f52d095.c754d"],["ccdfba92.973078"],["ccdfba92.973078"]]},{"id":"3f52d095.c754d","type":"change","z":"4770c0d7.397b","name":"home","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":60,"wires":[["d0f02aba.fa8a68"]]},{"id":"ccdfba92.973078","type":"change","z":"4770c0d7.397b","name":"not_home","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":120,"wires":[["d0f02aba.fa8a68"]]},{"id":"aaebda9e.ec9cb8","type":"debug","z":"4770c0d7.397b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":40,"wires":[]},{"id":"31977e07.708122","type":"switch","z":"4770c0d7.397b","name":"not_home?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"turn_off","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":990,"y":100,"wires":[["88356352.8de14"],["96d1f2eb.d94e6"]]},{"id":"88356352.8de14","type":"api-call-service","z":"4770c0d7.397b","name":"PeopleHome - off","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1010,"y":300,"wires":[[]]},{"id":"97608325.277e","type":"api-call-service","z":"8a955ac7.209038","name":"","server":"","version":"1","service_domain":"light","service":"turn_on","entityId":"light.bedside_lights","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1090,"y":260,"wires":[[]]},{"id":"c2443c2c.41ffe","type":"change","z":"8a955ac7.209038","name":"Start Loop","rules":[{"t":"set","p":"brightness","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":245.99999237060547,"y":248.88888883590698,"wires":[["737e32bc.194b5c"]]},{"id":"a7c0f5e6.20ff98","type":"function","z":"8a955ac7.209038","name":"increase brightness","func":"msg.brightness = msg.brightness + 5\nreturn msg;","outputs":1,"noerr":0,"x":542.9999923706055,"y":410.88888931274414,"wires":[["737e32bc.194b5c"]]},{"id":"cd952f50.5613b","type":"switch","z":"8a955ac7.209038","name":"","property":"brightness","propertyType":"msg","rules":[{"t":"eq","v":"96","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":633.9999923706055,"y":246.88888883590698,"wires":[["f9433200.de3f2","5305b9ec.bd07c8"],["a7c0f5e6.20ff98","9ffc2d15.0d73a","d8b01565.f34578"]]},{"id":"d8b01565.f34578","type":"template","z":"8a955ac7.209038","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n  \"brightness_pct\": \"{{brightness\"}}\"\n  }","output":"str","x":853.9999961853027,"y":258.88888931274414,"wires":[["97608325.277e"]]},{"id":"7dbdf8d1.b3d288","type":"api-call-service","z":"8a955ac7.209038","name":"Turn Off Alarm clock","server":"","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.alarm_clock\"}","mergecontext":"","x":1416,"y":203,"wires":[[]]},{"id":"5305b9ec.bd07c8","type":"api-call-service","z":"8a955ac7.209038","name":"","server":"","version":"1","service_domain":"light","service":"turn_on","entityId":"light.bedside_lights","data":"{\"brightness_pct\":\"100\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":878.8333282470703,"y":202.11111164093018,"wires":[["a9fde19e.db9df"]]},{"id":"737e32bc.194b5c","type":"delay","z":"8a955ac7.209038","name":"","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":442.99999237060547,"y":249.43055486679077,"wires":[["cd952f50.5613b"]]},{"id":"66d4a28d.f79f4c","type":"trigger-state","z":"8a955ac7.209038","name":"Alarm Clock","server":"","entityid":"input_boolean.alarm_clock","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"a5l00itz2m","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":62.999977111816406,"y":254.11110591888428,"wires":[["c2443c2c.41ffe"],[]]},{"id":"9ffc2d15.0d73a","type":"change","z":"8a955ac7.209038","name":"disable","rules":[{"t":"set","p":"payload","pt":"msg","to":"disable","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":253.83332061767578,"y":401.1111125946045,"wires":[["66d4a28d.f79f4c"]]},{"id":"f9433200.de3f2","type":"change","z":"8a955ac7.209038","name":"enable","rules":[{"t":"set","p":"payload","pt":"msg","to":"enable","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":323.83332443237305,"y":174.11111068725586,"wires":[["66d4a28d.f79f4c"]]},{"id":"a9fde19e.db9df","type":"delay","z":"8a955ac7.209038","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1071.8333320617676,"y":202.11111068725586,"wires":[["b621b1cd.88729"]]},{"id":"b621b1cd.88729","type":"change","z":"8a955ac7.209038","name":"turn_off","rules":[{"t":"set","p":"payload","pt":"msg","to":"turn_off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1225.8333320617676,"y":202.11111068725586,"wires":[["7dbdf8d1.b3d288"]]},{"id":"2e3f4a64.97ec96","type":"comment","z":"8a955ac7.209038","name":"Disable to prevent any snooze issues","info":"","x":251.0000228881836,"y":448.3333349227905,"wires":[]},{"id":"4479ebb9.8a3e34","type":"comment","z":"8a955ac7.209038","name":"by 5 each loop","info":"","x":752.4999465942383,"y":329.9999589920044,"wires":[]},{"id":"7e6bda28.dc31a4","type":"comment","z":"8a955ac7.209038","name":"until 96","info":"","x":738.0555419921875,"y":167.77778911590576,"wires":[]},{"id":"717be497.62143c","type":"comment","z":"8a955ac7.209038","name":"enact light adjustment","info":"","x":1146.9443283081055,"y":311.11108684539795,"wires":[]},{"id":"e29209db.21cfd8","type":"comment","z":"8a955ac7.209038","name":"set light to max and turn off input_boolean.alarm_clock","info":"","x":1208.0555038452148,"y":149.99998664855957,"wires":[]},{"id":"96d1f2eb.d94e6","type":"api-call-service","z":"4770c0d7.397b","name":"PeopleHome - on","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1290,"y":40,"wires":[[]]},{"id":"65b2f9c1.81edc8","type":"server-state-changed","z":"67c3431e.c4b74c","name":"fletcher - Home?","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":160,"wires":[["4f603189.82c56"]]},{"id":"9ebf1d13.b62ba","type":"and-gate","z":"67c3431e.c4b74c","name":"AND","rules":[{"t":"eq","v":"not_home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_fletcher_kelly"},{"t":"eq","v":"not_home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_karien"}],"outputTopic":"","gateType":"and","emitOnlyIfTrue":true,"x":750,"y":160,"wires":[["8e892d93.6355"]],"icon":"node-red-contrib-bool-gate/and.png"},{"id":"984aef35.e4e5f","type":"server-state-changed","z":"67c3431e.c4b74c","name":"Karien - Home?","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":300,"wires":[["50cf83ca.08744c"]]},{"id":"4f603189.82c56","type":"switch","z":"67c3431e.c4b74c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not_home","vt":"str"},{"t":"eq","v":"fletcher_work","vt":"str"},{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":160,"wires":[["9097641b.1016f8"],["9097641b.1016f8"],["da176d54.ded89"]]},{"id":"9097641b.1016f8","type":"change","z":"67c3431e.c4b74c","name":"set to not_home","rules":[{"t":"set","p":"payload","pt":"msg","to":"not_home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":160,"wires":[["9ebf1d13.b62ba"]]},{"id":"50cf83ca.08744c","type":"switch","z":"67c3431e.c4b74c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not_home","vt":"str"},{"t":"eq","v":"karien_work","vt":"str"},{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":300,"wires":[["9097641b.1016f8"],["9097641b.1016f8"],["da176d54.ded89","350d534d.5d7d5c"]]},{"id":"da176d54.ded89","type":"or-gate","z":"67c3431e.c4b74c","name":"","rules":[{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_fletcher_kelly"},{"t":"eq","v":"home","vt":"str","propertyType":"msg","property":"payload","topic":"device_tracker.life360_karien"}],"outputTopic":"","gateType":"or","emitOnlyIfTrue":true,"x":760,"y":280,"wires":[["bb932300.9b8fa"]]},{"id":"bb932300.9b8fa","type":"api-call-service","z":"67c3431e.c4b74c","name":"PeopleHome - on","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":990,"y":280,"wires":[[]]},{"id":"8e892d93.6355","type":"api-call-service","z":"67c3431e.c4b74c","name":"PeopleHome - off","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.peoplehome","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":990,"y":160,"wires":[[]]},{"id":"301cb84d.0be808","type":"switch","z":"82378b51.cc8e28","name":"Home?","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":240,"y":260,"wires":[["d4c78ae2.07ee48"],["edb6be4a.e6579"]]},{"id":"d4c78ae2.07ee48","type":"template","z":"82378b51.cc8e28","name":"","field":"payload.entity_id","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"input_select.{{topic}}","output":"str","x":380,"y":220,"wires":[["d84d9479.555b78"]]},{"id":"d84d9479.555b78","type":"api-current-state","z":"82378b51.cc8e28","name":"Status?","server":"","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":520,"y":220,"wires":[["71499efc.15c28","9c34b86a.c59828"]]},{"id":"71499efc.15c28","type":"switch","z":"82378b51.cc8e28","name":"Just Left?","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Just Left","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":660,"y":200,"wires":[["18d00944.044dc7"],["719fdf17.48d9e"]]},{"id":"9c34b86a.c59828","type":"change","z":"82378b51.cc8e28","name":"RESET","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":240,"wires":[["59e0a0.98e16f6","29a7d352.fa5e9c"]]},{"id":"54e86573.d5828c","type":"change","z":"82378b51.cc8e28","name":"RESET","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":300,"wires":[["d3654df5.63704","29a7d352.fa5e9c"]]},{"id":"edb6be4a.e6579","type":"api-call-service","z":"82378b51.cc8e28","name":"Just Left","server":"f7db64c8.551da8","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Just Left\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":380,"y":300,"wires":[["59e0a0.98e16f6","54e86573.d5828c"]]},{"id":"18d00944.044dc7","type":"api-call-service","z":"82378b51.cc8e28","name":"Just Arrived","server":"","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Just Arrived\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":810,"y":180,"wires":[["d3654df5.63704"]]},{"id":"cf792a74.705668","type":"api-call-service","z":"82378b51.cc8e28","name":"Away","server":"f7db64c8.551da8","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Away\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":790,"y":260,"wires":[["29a7d352.fa5e9c"]]},{"id":"80ec70af.09848","type":"api-call-service","z":"82378b51.cc8e28","name":"Extended Away","server":"f7db64c8.551da8","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Extended Away\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1100,"y":240,"wires":[[]]},{"id":"59e0a0.98e16f6","type":"trigger","z":"82378b51.cc8e28","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"10","extend":false,"units":"min","reset":"","bytopic":"topic","name":"10 Min","x":650,"y":280,"wires":[["cf792a74.705668"]]},{"id":"29a7d352.fa5e9c","type":"trigger","z":"82378b51.cc8e28","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"24","extend":false,"units":"hr","reset":"","bytopic":"topic","name":"24 Hrs","x":950,"y":240,"wires":[["80ec70af.09848"]]},{"id":"d3654df5.63704","type":"trigger","z":"82378b51.cc8e28","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"10","extend":false,"units":"min","reset":"","bytopic":"topic","name":"10 Min","x":950,"y":180,"wires":[["719fdf17.48d9e"]]},{"id":"719fdf17.48d9e","type":"api-call-service","z":"82378b51.cc8e28","name":"Home","server":"","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Home\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1070,"y":200,"wires":[[]]},{"id":"d77f8eeb.331b4","type":"change","z":"82378b51.cc8e28","name":"Change","rules":[{"t":"move","p":"payload","pt":"msg","to":"status","tot":"msg"},{"t":"change","p":"topic","pt":"msg","from":"device_tracker.","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":100,"y":260,"wires":[["301cb84d.0be808"]]},{"id":"a5a8255d.21eb28","type":"api-call-service","z":"67c3431e.c4b74c","name":"Just Arrived","server":"a3722ee8.c88ce","version":1,"service_domain":"input_select","service":"select_option","entityId":"","data":"{\"entity_id\":\"input_select.{{topic}}\",\"option\":\"Just Arrived\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":790,"y":600,"wires":[[]]},{"id":"350d534d.5d7d5c","type":"function","z":"67c3431e.c4b74c","name":"kk - home","func":"msg.topic ='kk_status_dropdown'\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":460,"wires":[["a5a8255d.21eb28"]]},{"id":"e3769516.8ee298","type":"server-state-changed","z":"7481132e.5fea8c","name":"Fletcher Home","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"x":130,"y":140,"wires":[[],["4d920e37.2fb6d","4005ae3.1af685","39f8e7d6.4d0428"]]},{"id":"4d920e37.2fb6d","type":"api-call-service","z":"7481132e.5fea8c","name":"Home","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.home_occupied","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":350,"y":140,"wires":[[]]},{"id":"389d152d.bb15ba","type":"server-state-changed","z":"7481132e.5fea8c","name":"Karien Home","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"x":130,"y":200,"wires":[[],["4d920e37.2fb6d","74c0d891.465148","feb94ab7.3ffa48"]]},{"id":"4005ae3.1af685","type":"api-call-service","z":"7481132e.5fea8c","name":"Fletcher Home","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.fletcher_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":340,"y":80,"wires":[[]]},{"id":"74c0d891.465148","type":"api-call-service","z":"7481132e.5fea8c","name":"Karien Home","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.karien_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":350,"y":220,"wires":[[]]},{"id":"3759508f.fc7bb","type":"server-state-changed","z":"7481132e.5fea8c","name":"Fletcher Away","server":"a3722ee8.c88ce","version":"1","entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":130,"y":460,"wires":[[],["b8b68b15.04dcd8","76d5643f.9f7f8c"]]},{"id":"bde2d7fd.391968","type":"api-call-service","z":"7481132e.5fea8c","name":"Away","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.home_occupied","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":610,"y":500,"wires":[[]]},{"id":"8f0a8c0b.d3918","type":"server-state-changed","z":"7481132e.5fea8c","name":"Karien Away","server":"a3722ee8.c88ce","version":"1","entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":130,"y":540,"wires":[[],["d1e8f1cc.d7f15","6e00b193.0cef1"]]},{"id":"b8b68b15.04dcd8","type":"api-call-service","z":"7481132e.5fea8c","name":"Fletcher Away","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.fletcher_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":320,"y":400,"wires":[[]]},{"id":"d1e8f1cc.d7f15","type":"api-call-service","z":"7481132e.5fea8c","name":"Karien Away","server":"a3722ee8.c88ce","version":1,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.karien_home","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":310,"y":600,"wires":[[]]},{"id":"76d5643f.9f7f8c","type":"api-current-state","z":"7481132e.5fea8c","name":"Check Karien Home","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_boolean.karien_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":460,"wires":[[],["bde2d7fd.391968"]]},{"id":"6e00b193.0cef1","type":"api-current-state","z":"7481132e.5fea8c","name":"Check Fletcher Home","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"input_boolean.fletcher_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":540,"wires":[[],["bde2d7fd.391968"]]},{"id":"965c1baf.7fee88","type":"server-state-changed","z":"d335ec1.d977a1","name":"All Away","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":80,"y":380,"wires":[[],["ad831660.a04738","538283dc.fc73ec","4aee0a13.4a42a4"]]},{"id":"ad831660.a04738","type":"api-call-service","z":"d335ec1.d977a1","name":"Turn off Inside Lights","server":"","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.1545497469252\"}","mergecontext":"","x":360,"y":60,"wires":[[]]},{"id":"10263058.e21a8","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Heat (63)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"63\"}","mergecontext":"","x":570,"y":180,"wires":[[]]},{"id":"538283dc.fc73ec","type":"api-current-state","z":"d335ec1.d977a1","name":"Heating","server":"","outputs":1,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":320,"y":180,"wires":[["10263058.e21a8"]]},{"id":"4aee0a13.4a42a4","type":"api-current-state","z":"d335ec1.d977a1","name":"Cooling","server":"","outputs":1,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":320,"y":300,"wires":[["f8487dc2.51a8d"]]},{"id":"f8487dc2.51a8d","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Cool (78)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"78\"}","mergecontext":"","x":570,"y":300,"wires":[[]]},{"id":"f0abee84.2ad48","type":"poll-state","z":"d335ec1.d977a1","name":"All Away Time","server":"a3722ee8.c88ce","version":"1","updateinterval":"60","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":false,"entity_id":"input_boolean.home","state_type":"str","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":90,"y":660,"wires":[[],["5bce50a6.ffc1"]]},{"id":"5bce50a6.ffc1","type":"function","z":"d335ec1.d977a1","name":"If Away > 20 Hours","func":"// If away less than 20 hrs, no change\nif (msg.data.timeSinceChangedMs < 72000000 ) {\n    flow.set('awayOver20',0);  // Reset if needed\n    return null\n}\n// Check if already away more than 20 hours \nif (flow.get('awayOver20') == 1 ) {\n    return null\n}\n// Set flow variable to not repeat\nflow.set('awayOver20',1);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":540,"wires":[["60fd0797.d0db18","da7e2dc2.c050b"]]},{"id":"60fd0797.d0db18","type":"api-current-state","z":"d335ec1.d977a1","name":"Heating","server":"","outputs":1,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":520,"y":480,"wires":[["1782715a.ea8a7f"]]},{"id":"da7e2dc2.c050b","type":"api-current-state","z":"d335ec1.d977a1","name":"Cooling","server":"","outputs":1,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","override_payload":true,"override_data":true,"x":520,"y":580,"wires":[["308d9c.993f6264"]]},{"id":"1782715a.ea8a7f","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Heat (50)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"50\"}","mergecontext":"","x":750,"y":480,"wires":[[]]},{"id":"308d9c.993f6264","type":"api-call-service","z":"d335ec1.d977a1","name":"Set Away Cool (90)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"90\"}","mergecontext":"","x":750,"y":580,"wires":[[]]},{"id":"2c2ab383.294e0c","type":"server-state-changed","z":"edadc6b3.2cb078","name":"Karien Home","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.karien_home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":90,"y":240,"wires":[[],["9c09eb2f.d50f18"]]},{"id":"2df258fb.da1c38","type":"api-current-state","z":"edadc6b3.2cb078","name":"Sun Down","server":"a3722ee8.c88ce","version":"1","outputs":2,"halt_if":"above_horizon","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sun.sun","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":530,"y":60,"wires":[[],["1c15fc3c.7e1944"]]},{"id":"1c15fc3c.7e1944","type":"api-call-service","z":"edadc6b3.2cb078","name":"Turn On Family Room Light","server":"a3722ee8.c88ce","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.family_room_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":900,"y":60,"wires":[[]]},{"id":"17a49e4d.6ea052","type":"server-state-changed","z":"edadc6b3.2cb078","name":"Fletcher Home","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.fletcher_home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":100,"y":300,"wires":[[],["9c09eb2f.d50f18"]]},{"id":"9c09eb2f.d50f18","type":"function","z":"edadc6b3.2cb078","name":"No Changes","func":"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":260,"wires":[["2df258fb.da1c38"]]},{"id":"433d0791.dd30f8","type":"server-state-changed","z":"edadc6b3.2cb078","name":"Home","server":"a3722ee8.c88ce","version":"1","entityidfilter":"input_boolean.home","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":false,"x":70,"y":680,"wires":[[],["6575da86.2d4164","e2a63dc6.c23f6"]]},{"id":"64819578.05aaec","type":"api-call-service","z":"edadc6b3.2cb078","name":"Set Away Heat (67)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"67\"}","mergecontext":"","x":570,"y":480,"wires":[[]]},{"id":"6575da86.2d4164","type":"api-current-state","z":"edadc6b3.2cb078","name":"Heating","server":"a3722ee8.c88ce","version":"1","outputs":2,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":480,"wires":[[],["64819578.05aaec"]]},{"id":"e2a63dc6.c23f6","type":"api-current-state","z":"edadc6b3.2cb078","name":"Cooling","server":"a3722ee8.c88ce","version":"1","outputs":2,"halt_if":"cool","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"climate.hallway","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":600,"wires":[[],["e2e2eeca.7fb1c"]]},{"id":"e2e2eeca.7fb1c","type":"api-call-service","z":"edadc6b3.2cb078","name":"Set Away Cool (75)","server":"","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.hallway\",\"temperature\":\"75\"}","mergecontext":"","x":570,"y":600,"wires":[[]]},{"id":"765b3b9f.89c684","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":940,"y":440,"wires":[[]]},{"id":"d7cc91f3.75619","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":900,"y":640,"wires":[[]]},{"id":"8f4d96df.148cb8","type":"api-call-service","z":"15c157a1.27c788","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":580,"wires":[[]]},{"id":"cbc2fcc7.443d","type":"delay","z":"15c157a1.27c788","name":"Delay 1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":520,"wires":[["2f833142.f32dce"]]},{"id":"d1b84f37.abf41","type":"delay","z":"15c157a1.27c788","name":"delay 6 sec","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":580,"wires":[["66a32193.c9fab"]]},{"id":"39f8e7d6.4d0428","type":"subflow:f27aa045.98e9d","z":"7481132e.5fea8c","name":"","env":[],"x":340,"y":20,"wires":[]},{"id":"cbcc5460.e82ce8","type":"function","z":"89877c86.8bf5d","name":"create \"Karien\" message","func":"var name = 'Karien';\n\nmsg.payload = { \n    message: 'Welcome Home' + name\n};\nreturn msg;","outputs":1,"noerr":0,"x":367,"y":189,"wires":[["c29e3d01.e7cba","1c465c2b.0c1d44"]]},{"id":"c29e3d01.e7cba","type":"api-call-service","z":"89877c86.8bf5d","name":"Alexa Dot - Karien is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":717,"y":149,"wires":[[]]},{"id":"1c465c2b.0c1d44","type":"api-call-service","z":"89877c86.8bf5d","name":"Alexa Plus - Karien is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":717,"y":209,"wires":[[]]},{"id":"270dd986.0c0cc6","type":"subflow:89877c86.8bf5d","z":"7481132e.5fea8c","name":"","x":490,"y":320,"wires":[]},{"id":"feb94ab7.3ffa48","type":"delay","z":"7481132e.5fea8c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":300,"wires":[["270dd986.0c0cc6"]]},{"id":"5288f2d8.e9beac","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Dot - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\" media_player.fletcher_s_echo_dot\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":80,"wires":[[]]},{"id":"17b12df0.ca7292","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Plus - Fletcher is home","server":"abc5f2b.6bde21","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.fletcher_s_echo_plus\",\"message\":\"{{payload.message}}\"}","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":40,"wires":[[]]},{"id":"8fa4c195.aad3b","type":"function","z":"8c52d380.fec46","name":"create \"fletcher\" home message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nmsg.topic = 'Presence Tracker'\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":80,"wires":[["17b12df0.ca7292","5288f2d8.e9beac"]]},{"id":"38dd8142.57649e","type":"switch","z":"8c52d380.fec46","name":"HOME / NOT HOME","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":80,"wires":[["8fa4c195.aad3b"],[]],"outputLabels":["Fletcher",""]},{"id":"46b6afe4.58b25","type":"server-state-changed","z":"8c52d380.fec46","name":"fletcher-home-devicetracker","server":"","version":1,"entityidfilter":"device_tracker.fletcher_s_s9","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":40,"wires":[["38dd8142.57649e","4df0f067.e9d2d"]]},{"id":"4df0f067.e9d2d","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":40,"wires":[]},{"id":"4ed59c95.7cd5d4","type":"switch","z":"8c52d380.fec46","name":"","property":"payload","propertyType":"msg","rules":[{"t":"jsonata_exp","v":"payload.compact.outdoor.temperature > 0","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":460,"wires":[["c91cc0de.5a2d8"]],"inputLabels":["xxx"],"outputLabels":["yyy"]},{"id":"c91cc0de.5a2d8","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":490,"y":460,"wires":[]},{"id":"8f0a9011.f8148","type":"comment","z":"8c52d380.fec46","name":"**Explanation**","info":"A JSONata Expression can be provided that will be evaluated against the whole message and will match if the expression returns a true value.","x":120,"y":400,"wires":[]},{"id":"8e4b29e.dc9e3d8","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"{\"compact\":{\"outdoor\":{\"temperature\":15.2,\"humidity\":19,\"temperatureTrend\":\"stable\",\"battery_percent\":57,\"rf_status\":71},\"rain\":{},\"temperature\":20.7,\"temperatureTrend\":\"stable\",\"co2\":486,\"humidity\":37,\"noise\":44,\"pressure\":1026,\"pressureTrend\":\"down\",\"station_name\":\"XXX\",\"last_status_store\":1542206768},\"detailed\":[{\"_id\":\"70:ee:50:00:ea:18\",\"cipher_id\":\"XXX\",\"date_setup\":1371091374,\"last_setup\":1371091374,\"type\":\"NAMain\",\"last_status_store\":1542206768,\"module_name\":\"XXX\",\"firmware\":132,\"last_upgrade\":1440121433,\"wifi_status\":50,\"co2_calibrating\":false,\"station_name\":\"XXX\",\"data_type\":[\"Temperature\",\"CO2\",\"Humidity\",\"Noise\",\"Pressure\"],\"place\":{\"altitude\":120.08533983542,\"city\":\"XXX\",\"country\":\"US\",\"timezone\":\"XXX\",\"location\":[\"XXX\",\"XXX\"]},\"dashboard_data\":{\"time_utc\":1542206753,\"Temperature\":20.7,\"CO2\":486,\"Humidity\":37,\"Noise\":44,\"Pressure\":1026,\"AbsolutePressure\":1011.5,\"min_temp\":20.6,\"max_temp\":21.4,\"date_min_temp\":1542204365,\"date_max_temp\":1542182477,\"temp_trend\":\"stable\",\"pressure_trend\":\"down\"},\"modules\":[{\"_id\":\"02:00:00:00:f8:c4\",\"type\":\"NAModule1\",\"module_name\":\"Outdoor\",\"data_type\":[\"Temperature\",\"Humidity\"],\"last_setup\":1371091749,\"dashboard_data\":{\"time_utc\":1542206723,\"Temperature\":15.2,\"Humidity\":19,\"min_temp\":14.8,\"max_temp\":17.3,\"date_min_temp\":1542203724,\"date_max_temp\":1542189727,\"temp_trend\":\"up\"},\"firmware\":44,\"last_message\":1542206762,\"last_seen\":1542206723,\"rf_status\":71,\"battery_vp\":4965,\"battery_percent\":57}]}]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":460,"wires":[["4ed59c95.7cd5d4"]]},{"id":"5a006441.51e3ec","type":"Sonoff device","z":"8c52d380.fec46","mode":"0","broker":"66726911.b76f98","device":"sonoff","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1110,"y":420,"wires":[[]]},{"id":"1a97aa50.ccb5c6","type":"function","z":"8c52d380.fec46","name":"create \"fletcher\" message","func":"var name = 'Fletcher';\n\nmsg.payload = { \n    message: name + ' is home',\n};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":540,"wires":[["cd059f1b.57dd1","54489108.6156c"]]},{"id":"cd059f1b.57dd1","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Dot - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_dot\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":500,"wires":[[]]},{"id":"54489108.6156c","type":"api-call-service","z":"8c52d380.fec46","name":"Alexa Plus - Fletcher is home","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload.message}}\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.fletcher_s_echo_plus\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":560,"wires":[[]]},{"id":"42f785b8.3296ac","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":540,"wires":[["1a97aa50.ccb5c6"]]},{"id":"995bcb87.17a158","type":"Sonoff device","z":"8c52d380.fec46","mode":"0","broker":"6eb36010.171f5","device":"sonoff-2-fibreextension","name":"test","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1110,"y":340,"wires":[["c56a72f0.1a877"]]},{"id":"2bde18d7.26a878","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":300,"wires":[["995bcb87.17a158"]]},{"id":"c56a72f0.1a877","type":"debug","z":"8c52d380.fec46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1250,"y":380,"wires":[]},{"id":"ef19bc03.6c28e","type":"inject","z":"8c52d380.fec46","name":"OFF","topic":"cmnd","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":360,"wires":[["995bcb87.17a158"]]},{"id":"1bb20e64.67f902","type":"inject","z":"8c52d380.fec46","name":"TELE","topic":"tele","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":440,"wires":[["995bcb87.17a158"]]},{"id":"1f22f1d7.f350ce","type":"inject","z":"8c52d380.fec46","name":"STAT","topic":"stat","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":520,"wires":[["995bcb87.17a158"]]},{"id":"c8ad468c.145c08","type":"tuya-smart","z":"9ed92167.b9b4c","deviceName":"Fletcher Lamp","deviceIp":"192.168.1.163","deviceId":"41450046cc50e314707a","deviceKey":"896da5d502f04d5c","request":"{\"schema\": true}","pollingInterval":10,"x":540,"y":140,"wires":[["e9226d51.f1f62"]]},{"id":"5589e786.558208","type":"inject","z":"9ed92167.b9b4c","name":"","topic":"on","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":340,"wires":[[]]},{"id":"4fb26c65.080984","type":"tuya-smart","z":"9ed92167.b9b4c","deviceName":"Karien Lamp","deviceIp":"192.168.1.162","deviceId":"41450046cc50e3147121","deviceKey":"4cfe12cfc5c37268","request":"{\"schema\": true}","pollingInterval":10,"x":570,"y":440,"wires":[["e9226d51.f1f62"]]},{"id":"e9226d51.f1f62","type":"debug","z":"9ed92167.b9b4c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":320,"wires":[]},{"id":"b5af18ba.dbf738","type":"api-call-service","z":"8c52d380.fec46","name":"Fletcher Lamp - On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":740,"wires":[[]]},{"id":"a07436eb.7aa228","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":740,"wires":[["b5af18ba.dbf738"]]},{"id":"5c566384.e9d70c","type":"api-call-service","z":"8c52d380.fec46","name":"Fletcher Lamp - Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":800,"wires":[[]]},{"id":"7d76c534.9df98c","type":"inject","z":"8c52d380.fec46","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":800,"wires":[["5c566384.e9d70c"]]},{"id":"bbd53764.a62468","type":"api-call-service","z":"8c52d380.fec46","name":"Fletcher Lamp - Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"toggle","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":350,"y":860,"wires":[[]]},{"id":"1f9053ca.8250fc","type":"inject","z":"8c52d380.fec46","name":"","topic":"toggle","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":860,"wires":[["bbd53764.a62468"]]},{"id":"dce5a2c4.8dd14","type":"debug","z":"6e4e7309.81165c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":660,"wires":[]},{"id":"d0866a5b.b80c18","type":"trigger-state","z":"745da3b4.61597c","name":"fk_status","server":"a3722ee8.c88ce","entityid":"sensor.fk_status","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"r96l4iynxcnj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":140,"y":220,"wires":[["143cdc40.324d64","4f2d8504.11b0fc"],[]]},{"id":"143cdc40.324d64","type":"api-call-service","z":"745da3b4.61597c","name":"Add Persitent","server":"a3722ee8.c88ce","version":1,"service_domain":"persistent_notification","service":"create","entityId":"","data":"{\"message\":\"You've got mail.\",\"title\":\"Mailbox\",\"notification_id\":\"letter\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":480,"y":280,"wires":[[]]},{"id":"4f2d8504.11b0fc","type":"switch","z":"745da3b4.61597c","name":"where you?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"not_home","vt":"str"},{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":400,"wires":[["c06e27a1.9b7e48"],["bfdcd5fa.b10728"]]},{"id":"c06e27a1.9b7e48","type":"api-call-service","z":"745da3b4.61597c","name":"Notify FK iPhone 8 Plus","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"You are NOT home anymore.\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":450,"y":380,"wires":[[]]},{"id":"bfdcd5fa.b10728","type":"api-call-service","z":"745da3b4.61597c","name":"Notify FK iPhone 8 Plus","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"Welcome home.\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":440,"wires":[[]]},{"id":"9f9c6c1f.7fdce","type":"server-state-changed","z":"48181911.c321a8","name":"Medine Reminder","server":"d80b819d.21ee7","version":1,"entityidfilter":"input_boolean.medicine_reminder","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"Off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":110,"y":240,"wires":[[],["66df9843.29ccb8"]]},{"id":"66df9843.29ccb8","type":"trigger","z":"48181911.c321a8","op1":"","op2":"on","op1type":"nul","op2type":"str","duration":"30","extend":false,"units":"min","reset":"off","bytopic":"all","name":"","x":290,"y":380,"wires":[["f0242812.df1db8"]]},{"id":"f0242812.df1db8","type":"api-call-service","z":"48181911.c321a8","name":"Notify Rob","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"Working from home?\",\"data\":{\"push\":{\"badge\":5,\"category\":\"working_from_home\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":590,"y":400,"wires":[[]]},{"id":"586f39ed.aea628","type":"server-events","z":"541a1cc7.93adc4","name":"All","server":"faf6f8d3.47cb18","x":90,"y":220,"wires":[["40e505c5.b8463c"]]},{"id":"40e505c5.b8463c","type":"switch","z":"541a1cc7.93adc4","name":"","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"SNOOZE","vt":"str"},{"t":"eq","v":"ALREADY_TAKEN","vt":"str"},{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":224.0000114440918,"y":220.0006103515625,"wires":[["695690e4.4feaa"],["2ded6529.c6801a"],["112d1f9.7b989e"]]},{"id":"695690e4.4feaa","type":"trigger","z":"541a1cc7.93adc4","op1":"","op2":"on","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"off","bytopic":"all","name":"","x":398.00000381469727,"y":124,"wires":[["d0c19ff3.137a8"]]},{"id":"d0c19ff3.137a8","type":"api-call-service","z":"541a1cc7.93adc4","name":"Notify Rob","server":"faf6f8d3.47cb18","service_domain":"notify","service":"ios_robs_iphone","data":"{   \"message\": \"Good Morning! Remember your meds!\",   \"data\": {     \"push\": {       \"badge\": 5,       \"category\": \"medicine\"     }   } }","mergecontext":"","x":657.0000343322754,"y":123.0000991821289,"wires":[[]]},{"id":"2ded6529.c6801a","type":"api-call-service","z":"541a1cc7.93adc4","name":"Turn off","server":"faf6f8d3.47cb18","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.medicine_reminder\" }","mergecontext":"","x":388.8636589050293,"y":220.63682556152344,"wires":[[]]},{"id":"3be0f02f.02c41","type":"change","z":"541a1cc7.93adc4","name":"trigger","rules":[{"t":"set","p":"trigger","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":225.86371231079102,"y":398.54698371887207,"wires":[["112d1f9.7b989e"]]},{"id":"c3748df3.49ee1","type":"server-state-changed","z":"541a1cc7.93adc4","name":"Rob Home","server":"faf6f8d3.47cb18","entityidfilter":"input_boolean.rob_home","entityidfiltertype":"substring","haltifstate":"off","outputs":1,"x":60.863651275634766,"y":398.3651657104492,"wires":[["3be0f02f.02c41"]]},{"id":"e0505a31.a866c8","type":"change","z":"541a1cc7.93adc4","name":"false","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":433.86365509033203,"y":386.7271137237549,"wires":[["112d1f9.7b989e"]]},{"id":"c87c3dd6.e97b3","type":"switch","z":"541a1cc7.93adc4","name":"","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":573.0000228881836,"y":220.9090175628662,"wires":[["d0c19ff3.137a8"]]},{"id":"112d1f9.7b989e","type":"hold","z":"541a1cc7.93adc4","name":"Hold until home","x":433.5000648498535,"y":306.5466251373291,"wires":[["e0505a31.a866c8","c87c3dd6.e97b3"]]},{"id":"79e893df.aa58ec","type":"api-call-service","z":"b9243eac.e962e","name":"Notify Fletch ","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"Node-Red: Working from home?\",\"data\":{\"push\":{\"badge\":5,\"category\":\"working_from_home\"}}}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":470,"y":160,"wires":[[]]},{"id":"6431308a.99ea9","type":"inject","z":"b9243eac.e962e","name":"Required Time - UTC","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"15 03 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"x":160,"y":220,"wires":[["79e893df.aa58ec"]]},{"id":"62da857b.80d86c","type":"inject","z":"48181911.c321a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":620,"wires":[["f0242812.df1db8"]]},{"id":"4da5f901.562be8","type":"server-events","z":"b9243eac.e962e","name":"All","server":"a3722ee8.c88ce","event_type":"","x":90,"y":380,"wires":[["aa670af2.19cc38"]]},{"id":"aa670af2.19cc38","type":"switch","z":"b9243eac.e962e","name":"Which Action?","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"WORKING_FROM_HOME_YES","vt":"str"},{"t":"eq","v":"WORKING_FROM_HOME_NO","vt":"str"},{"t":"eq","v":"REMIND_HOME","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":360,"y":380,"wires":[["5c436d3b.6496a4"],["fcb0091b.7cd368"],[]]},{"id":"5c436d3b.6496a4","type":"api-call-service","z":"b9243eac.e962e","name":"Notify Fletch ","server":"a3722ee8.c88ce","version":1,"service_domain":"notify","service":"ios_fletchers_iphone8","entityId":"","data":"{\"message\":\"HOME DAY.\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":530,"y":280,"wires":[[]]},{"id":"67b4192e.4d95c8","type":"http request","z":"b9243eac.e962e","name":"","method":"GET","ret":"bin","paytoqs":false,"url":"http://192.168.1.43:22880/fletchertraffic","tls":"","proxy":"","authType":"","x":790,"y":380,"wires":[["65612d7c.796504"]]},{"id":"fcb0091b.7cd368","type":"change","z":"b9243eac.e962e","name":"","rules":[{"t":"set","p":"URL","pt":"msg","to":"http://192.168.1.43:22880/fletchertraffic","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":380,"wires":[["67b4192e.4d95c8"]]},{"id":"65612d7c.796504","type":"debug","z":"b9243eac.e962e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":380,"wires":[]},{"id":"f326d94f.1f4598","type":"inject","z":"d597f158.7ca1b","name":"ON","topic":"ON","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":400,"wires":[["d0379ddf.ce97f","1ff2eff9.10bd2"]]},{"id":"a804298b.0d1288","type":"inject","z":"d597f158.7ca1b","name":"OFF","topic":"OFF","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":460,"wires":[["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"a4c478f6.0573b8","type":"api-call-service","z":"d597f158.7ca1b","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1070,"y":160,"wires":[[]]},{"id":"bc5a55f0.1dfd78","type":"api-call-service","z":"d597f158.7ca1b","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1030,"y":420,"wires":[[]]},{"id":"1f373747.10e009","type":"api-call-service","z":"d597f158.7ca1b","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1080,"y":320,"wires":[[]]},{"id":"80376116.a0f0d","type":"api-call-service","z":"d597f158.7ca1b","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1020,"y":480,"wires":[[]]},{"id":"e9ca123.59ae8f","type":"switch","z":"d597f158.7ca1b","name":"turn on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":400,"y":140,"wires":[["786776de.e06e88"],["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"14789446.1c5d8c","type":"inject","z":"d597f158.7ca1b","name":"21:40 (19:40 in UTC)","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"40 19 * * 1,2,3,4,5","once":false,"onceDelay":"","x":120,"y":520,"wires":[["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"47cdb59e.94150c","type":"ui_button","z":"931c0c64.df3c6","name":"","group":"aa4f59ff.e959e8","order":3,"width":0,"height":0,"passthru":false,"label":"Bedtime","tooltip":"","color":"Blue","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":140,"y":140,"wires":[["a0dc2dfa.ba98d","c384d449.66fa38"]]},{"id":"a0dc2dfa.ba98d","type":"api-call-service","z":"931c0c64.df3c6","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":140,"wires":[["1ad514e7.95eddb"]]},{"id":"c384d449.66fa38","type":"api-call-service","z":"931c0c64.df3c6","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":420,"y":200,"wires":[["1ad514e7.95eddb"]]},{"id":"3e0f074.3fe70f8","type":"ui_switch","z":"d270455.fae9bb8","name":"","label":"Karien Lamp","tooltip":"","group":"aa4f59ff.e959e8","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":190,"y":80,"wires":[[]]},{"id":"3258693b.16e486","type":"switch","z":"931c0c64.df3c6","name":"on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"On","vt":"str"},{"t":"eq","v":"Off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":440,"wires":[["d4ac24d2.272288"],["8fc088b1.151318"]]},{"id":"8fc088b1.151318","type":"api-call-service","z":"931c0c64.df3c6","name":"Karien Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1080,"y":480,"wires":[[]]},{"id":"d4ac24d2.272288","type":"api-call-service","z":"931c0c64.df3c6","name":"Karien Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e3147121","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":380,"wires":[[]]},{"id":"6a5ec3ec.62a65c","type":"ui_switch","z":"931c0c64.df3c6","name":"","label":"Fletcher Lamp","tooltip":"","group":"aa4f59ff.e959e8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":180,"y":660,"wires":[["2423ca26.918406"]]},{"id":"2423ca26.918406","type":"switch","z":"931c0c64.df3c6","name":"on or off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"On","vt":"str"},{"t":"eq","v":"Off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":700,"y":620,"wires":[["ca2639fa.3c7ba8"],["1306b8bb.e425c7"]]},{"id":"1306b8bb.e425c7","type":"api-call-service","z":"931c0c64.df3c6","name":"Fletcher Lamp Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1110,"y":640,"wires":[[]]},{"id":"ca2639fa.3c7ba8","type":"api-call-service","z":"931c0c64.df3c6","name":"Fletcher Lamp On","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.41450046cc50e314707a","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1090,"y":580,"wires":[[]]},{"id":"7eeb5d94.b7f904","type":"function","z":"d74e98b0.1e98b8","name":"Filter msg's","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    var msg3 = { payload:true };\n    var msg1 = { background:\"red\" };\n    var msg2 = { background:\"white\" };\n    return [[ msg1],[ msg2], msg3];\n}\nreturn null;","outputs":3,"noerr":0,"x":730,"y":320,"wires":[["fd7b5395.59fd7"],["2a5c538a.877adc"],["656ce546.fbf06c"]]},{"id":"8cf970ff.d07ac","type":"ui_button","z":"d74e98b0.1e98b8","name":"","group":"394c9b3f.da6e44","order":5,"width":1,"height":1,"passthru":false,"label":"Open","tooltip":"","color":"black","bgcolor":"{{msg.background}}","icon":"","payload":"Really open garage door?","payloadType":"str","topic":"","x":390,"y":330,"wires":[["e511222e.21dbb"]]},{"id":"e511222e.21dbb","type":"ui_toast","z":"d74e98b0.1e98b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"confirm deploy","x":540,"y":330,"wires":[["7eeb5d94.b7f904"]]},{"id":"fb1d8925.f0c0e8","type":"function","z":"d74e98b0.1e98b8","name":"Filter msg's","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    var msg1 = { payload:false };\n    var msg2 = { background:\"red\" };\n    var msg3 = { background:\"white\" };\n    return [[ msg1],[ msg2], msg3];\n}\nreturn null;","outputs":3,"noerr":0,"x":730,"y":380,"wires":[["656ce546.fbf06c"],["ca9d6b7a.9f9dd8"],["bd03ea9f.59ba08"]]},{"id":"51b800a0.17915","type":"ui_button","z":"d74e98b0.1e98b8","name":"","group":"394c9b3f.da6e44","order":5,"width":1,"height":1,"passthru":false,"label":"Close","tooltip":"","color":"black","bgcolor":"{{msg.background}}","icon":"","payload":"Really close garage door?","payloadType":"str","topic":"","x":390,"y":370,"wires":[["97e4287a.ec04d8"]]},{"id":"97e4287a.ec04d8","type":"ui_toast","z":"d74e98b0.1e98b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","topic":"","name":"confirm deploy","x":540,"y":370,"wires":[["fb1d8925.f0c0e8"]]},{"id":"656ce546.fbf06c","type":"debug","z":"d74e98b0.1e98b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":350,"wires":[]},{"id":"bd03ea9f.59ba08","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["8ad31ea5.ee27a"],"x":855,"y":430,"wires":[]},{"id":"8ad31ea5.ee27a","type":"link in","z":"d74e98b0.1e98b8","name":"","links":["bd03ea9f.59ba08","fd7b5395.59fd7"],"x":295,"y":330,"wires":[["8cf970ff.d07ac"]]},{"id":"fd7b5395.59fd7","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["8ad31ea5.ee27a"],"x":855,"y":270,"wires":[]},{"id":"ca9d6b7a.9f9dd8","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["2419a428.daf46c"],"x":855,"y":390,"wires":[]},{"id":"2419a428.daf46c","type":"link in","z":"d74e98b0.1e98b8","name":"","links":["ca9d6b7a.9f9dd8","2a5c538a.877adc"],"x":295,"y":370,"wires":[["51b800a0.17915"]]},{"id":"2a5c538a.877adc","type":"link out","z":"d74e98b0.1e98b8","name":"","links":["2419a428.daf46c"],"x":855,"y":310,"wires":[]},{"id":"1ad514e7.95eddb","type":"change","z":"931c0c64.df3c6","name":"set payload to off - update UI switches","rules":[{"t":"set","p":"payload","pt":"msg","to":"Off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":360,"wires":[["6a5ec3ec.62a65c","17d6c1c2.d75dbe"]]},{"id":"55d560f.77a98a","type":"function","z":"dac6431f.f0681","name":"Filter msg's","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    var msg1 = { payload:true };\n    var msg2 = { background:\"red\" };\n    return [[ msg1], msg2];\n}\nreturn null;","outputs":2,"noerr":0,"x":770,"y":400,"wires":[["8e663b4d.79a888"],["2709ea06.492cd6"]]},{"id":"2709ea06.492cd6","type":"ui_button","z":"dac6431f.f0681","name":"","group":"228f61f1.0e31ce","order":5,"width":1,"height":1,"passthru":false,"label":"Open","tooltip":"","color":"{{msg.background}}","bgcolor":"#2a2a2a","icon":"","payload":"Really open garage door?","payloadType":"str","topic":"","x":430,"y":450,"wires":[["febc25c.6ef31d8"]]},{"id":"febc25c.6ef31d8","type":"ui_toast","z":"dac6431f.f0681","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","topic":"","name":"confirm deploy","x":587,"y":400,"wires":[["55d560f.77a98a"]]},{"id":"8e663b4d.79a888","type":"debug","z":"dac6431f.f0681","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":940,"y":400,"wires":[]},{"id":"17d6c1c2.d75dbe","type":"ui_switch","z":"931c0c64.df3c6","name":"","label":"Karien Lamp","tooltip":"","group":"aa4f59ff.e959e8","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":190,"y":600,"wires":[["3258693b.16e486"]]},{"id":"cd50be44.04088","type":"ui_toast","z":"931c0c64.df3c6","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":320,"y":940,"wires":[]},{"id":"cf59c443.626788","type":"debug","z":"d597f158.7ca1b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":390,"y":60,"wires":[]},{"id":"4351b228.94b07c","type":"light-scheduler","z":"8584cb39.51bb48","settings":"36f19b4a.9303c4","events":"[]","topic":"","name":"","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":260,"y":160,"wires":[[]]},{"id":"d5620266.7e60a","type":"light-scheduler-filter","z":"8584cb39.51bb48","settings":"","events":"[]","name":"","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":false,"x":320,"y":260,"wires":[[],[]]},{"id":"5a8fd0dc.97f5d","type":"eztimer","z":"8584cb39.51bb48","name":"","autoname":null,"tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"","lon":"","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"dawn","ontimetod":"17:00","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":240,"y":460,"wires":[[]]},{"id":"122ace01.e1e252","type":"eztimer","z":"d597f158.7ca1b","name":"Wakeup (UTC)","autoname":"03:05 - 03:35","tag":"eztimer","suspended":false,"sendEventsOnSuspend":true,"lat":"-26.0188","lon":"28.0194","timerType":"1","startupMessage":true,"ontype":"2","ontimesun":"dawn","ontimetod":"03:05","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"2","offtimesun":"dusk","offtimetod":"03:35","offduration":"00:01:00","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"sun":false,"x":100,"y":80,"wires":[["e9ca123.59ae8f"]]},{"id":"8de9c3c3.49832","type":"eztimer","z":"d597f158.7ca1b","name":"Sunset (UTC)","autoname":"sunsetStart - 21:40","tag":"eztimer","suspended":false,"sendEventsOnSuspend":true,"lat":"-26.0188","lon":"28.0194","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"sunsetStart","ontimetod":"03:05","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":"-30","onrandomoffset":0,"onsuppressrepeats":false,"offtype":"2","offtimesun":"dusk","offtimetod":"21:40","offduration":"00:01:00","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":100,"y":180,"wires":[["e9ca123.59ae8f","cf59c443.626788"]]},{"id":"6f21e1c3.c6df1","type":"api-current-state","z":"d597f158.7ca1b","name":"Fletcher Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e314707a","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":420,"wires":[[],["bc5a55f0.1dfd78"]]},{"id":"6b7d8fdb.a1521","type":"api-current-state","z":"d597f158.7ca1b","name":"Karien Lamp Off Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e3147121","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":750,"y":480,"wires":[[],["80376116.a0f0d"]]},{"id":"d0379ddf.ce97f","type":"api-current-state","z":"d597f158.7ca1b","name":"Fletcher Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e314707a","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1120,"y":100,"wires":[[],["a4c478f6.0573b8"]]},{"id":"1ff2eff9.10bd2","type":"api-current-state","z":"d597f158.7ca1b","name":"Karien Lamp On Already?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.41450046cc50e3147121","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1090,"y":240,"wires":[[],["1f373747.10e009"]]},{"id":"751f9cfd.f9af54","type":"api-current-state","z":"8584cb39.51bb48","name":"At home","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":300,"y":680,"wires":[["8a687d2c.699e4"],["8a687d2c.699e4"]]},{"id":"35e04024.98b8a","type":"api-current-state","z":"8584cb39.51bb48","name":"","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":380,"y":760,"wires":[[],[]]},{"id":"8a687d2c.699e4","type":"debug","z":"8584cb39.51bb48","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":860,"y":740,"wires":[]},{"id":"64312dbe.2d1154","type":"inject","z":"8584cb39.51bb48","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":660,"wires":[["751f9cfd.f9af54"]]},{"id":"786776de.e06e88","type":"api-current-state","z":"d597f158.7ca1b","name":"Is someone at home?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.home_occupied","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":660,"y":100,"wires":[["fac6f328.60382"],["6f21e1c3.c6df1","6b7d8fdb.a1521"]]},{"id":"f3fbe085.26eca","type":"alexa-local","z":"cbfb483a.9b43f8","devicename":"Couch Shade","inputtrigger":false,"x":260,"y":300,"wires":[["94b8f76b.d78148"]]},{"id":"99159f42.e704a","type":"function","z":"cbfb483a.9b43f8","name":"Set Payload","func":"msg.payload = { data: {'entity_id': 'input_number.slider1','value': \nmsg.bri } };\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":360,"wires":[["415246dc.a23278"]]},{"id":"b81b65a6.3242f8","type":"range","z":"cbfb483a.9b43f8","minin":"0","maxin":"100","minout":"0","maxout":"13","action":"scale","round":true,"property":"bri","name":"","x":570,"y":360,"wires":[["99159f42.e704a"]]},{"id":"94b8f76b.d78148","type":"switch","z":"cbfb483a.9b43f8","name":"on/off","property":"on_off_command","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":300,"wires":[["62119a8.9164c64"],["b81b65a6.3242f8"]]},{"id":"415246dc.a23278","type":"api-call-service","z":"cbfb483a.9b43f8","name":"Set Couch Shade","server":"cbae6ef5.500b8","version":"1","service_domain":"input_number","service":"set_value","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":990,"y":360,"wires":[[]]},{"id":"62119a8.9164c64","type":"function","z":"cbfb483a.9b43f8","name":"Set Payload","func":"if (msg.payload == \"on\")\n{\nmsg.payload = { data: {\"entity_id\": \"input_number.slider1\",\"value\": \n'13' } };\n}\nif (msg.payload == \"off\")\n{\nmsg.payload = { data: {\"entity_id\": \"input_number.slider1\",\"value\": \n\"0\" } };\n}\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":240,"wires":[["7ebbee74.12697"]]},{"id":"7ebbee74.12697","type":"api-call-service","z":"cbfb483a.9b43f8","name":"Set Couch Shade","server":"cbae6ef5.500b8","version":0,"service_domain":"input_number","service":"set_value","data":"{}","x":850,"y":240,"wires":[[]]},{"id":"478330e3.245a6","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":5,"width":"2","height":"2","passthru":false,"label":"5","color":"","bgcolor":"","icon":"","payload":"5","payloadType":"str","topic":"","x":90,"y":500,"wires":[["34375a28.2d3dd6"]]},{"id":"34375a28.2d3dd6","type":"join","z":"59cb08a.8905ff8","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"","joinerType":"str","accumulate":false,"timeout":"20","count":"4","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":330,"y":560,"wires":[["3b066395.6e252c"]]},{"id":"3699a88b.255d88","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":2,"width":"2","height":"2","passthru":false,"label":"2","color":"","bgcolor":"","icon":"","payload":"2","payloadType":"str","topic":"","x":90,"y":379,"wires":[["34375a28.2d3dd6"]]},{"id":"e597a1a.e0ba56","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":3,"width":"2","height":"2","passthru":false,"label":"3","color":"","bgcolor":"","icon":"","payload":"3","payloadType":"str","topic":"","x":90,"y":419,"wires":[["34375a28.2d3dd6"]]},{"id":"d2fb2fd4.a4c71","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":4,"width":"2","height":"2","passthru":false,"label":"4","color":"","bgcolor":"","icon":"","payload":"4","payloadType":"str","topic":"","x":90,"y":460,"wires":[["34375a28.2d3dd6"]]},{"id":"979d5c96.e7311","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":6,"width":"2","height":"2","passthru":false,"label":"6","color":"","bgcolor":"","icon":"","payload":"6","payloadType":"str","topic":"","x":90,"y":540,"wires":[["34375a28.2d3dd6"]]},{"id":"f38f496d.dea228","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":7,"width":"2","height":"2","passthru":false,"label":"7","color":"","bgcolor":"","icon":"","payload":"7","payloadType":"str","topic":"","x":90,"y":580,"wires":[["34375a28.2d3dd6"]]},{"id":"1dd0c2f4.67f9ad","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":8,"width":"2","height":"2","passthru":false,"label":"8","color":"","bgcolor":"","icon":"","payload":"8","payloadType":"str","topic":"","x":90,"y":620,"wires":[["34375a28.2d3dd6"]]},{"id":"83ddb4db.80b318","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":9,"width":"2","height":"2","passthru":false,"label":"9","color":"","bgcolor":"","icon":"","payload":"9","payloadType":"str","topic":"","x":90,"y":660,"wires":[["34375a28.2d3dd6"]]},{"id":"219e2180.0492be","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":10,"width":"2","height":"2","passthru":false,"label":"*","color":"","bgcolor":"","icon":"","payload":"*","payloadType":"str","topic":"","x":90,"y":700,"wires":[["34375a28.2d3dd6"]]},{"id":"498533d8.44697c","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":11,"width":"2","height":"2","passthru":false,"label":"0","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"","x":90,"y":740,"wires":[["34375a28.2d3dd6"]]},{"id":"70050230.cc43fc","type":"change","z":"59cb08a.8905ff8","name":"Message Complete","rules":[{"t":"set","p":"complete","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":780,"wires":[["34375a28.2d3dd6"]]},{"id":"1d38104a.5342d","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":12,"width":"2","height":"2","passthru":false,"label":"Clear","color":"","bgcolor":"","icon":"","payload":"Clear","payloadType":"str","topic":"","x":90,"y":780,"wires":[["70050230.cc43fc"]]},{"id":"f1330738.2b14a8","type":"api-current-state","z":"59cb08a.8905ff8","name":"Exterior Alarm State","server":"d42c7e99.0018","outputs":1,"halt_if":"","entity_id":"input_boolean.notify_gates","x":660,"y":500,"wires":[["7ce48d22.62f444"]]},{"id":"7ce48d22.62f444","type":"switch","z":"59cb08a.8905ff8","name":"Check State","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":500,"wires":[["c535e46.0a07e18","66974872.8b0a28"],["523ce9c0.840db8"]]},{"id":"523ce9c0.840db8","type":"change","z":"59cb08a.8905ff8","name":"arming","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alarm Arming in 45 Seconds","tot":"str"},{"t":"set","p":"armingStatus","pt":"flow","to":"arming","tot":"str"},{"t":"set","p":"message","pt":"msg","to":"arming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":680,"wires":[["2e23248a.9fec5c","8f4619e4.7cfbb8","390450db.95b2e"]]},{"id":"c535e46.0a07e18","type":"change","z":"59cb08a.8905ff8","name":"\"alarm disarmed\"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alarm Disarmed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":420,"wires":[["da3d1125.3876"]]},{"id":"66974872.8b0a28","type":"api-call-service","z":"59cb08a.8905ff8","name":"Disarm Alarm","server":"d42c7e99.0018","service_domain":"input_boolean","service":"turn_off","data":"{ \"entity_id\":\"input_boolean.notify_gates\"}","x":1080,"y":480,"wires":[[]]},{"id":"2e23248a.9fec5c","type":"delay","z":"59cb08a.8905ff8","name":"Delay 45 Seconds","pauseType":"delayv","timeout":"45","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1150,"y":640,"wires":[["ff365e0f.4c236"]]},{"id":"da3d1125.3876","type":"ui_audio","z":"59cb08a.8905ff8","name":"Alarm Disarmed","group":"b33c9b3c.0231a8","voice":"en-US","always":"","x":1280,"y":420,"wires":[]},{"id":"a77d16a7.1f3548","type":"api-call-service","z":"59cb08a.8905ff8","name":"Arm Alarm","server":"d42c7e99.0018","service_domain":"input_boolean","service":"turn_on","data":"{ \"entity_id\":\"input_boolean.notify_gates\"}","x":1490,"y":700,"wires":[[]]},{"id":"8f4619e4.7cfbb8","type":"ui_text","z":"59cb08a.8905ff8","group":"b33c9b3c.0231a8","order":14,"width":"6","height":"1","name":"Alarm Status","label":"Alarm Status:","format":"{{msg.message}}","layout":"row-spread","x":1090,"y":860,"wires":[]},{"id":"f6f75e67.5c5ae","type":"server-state-changed","z":"59cb08a.8905ff8","name":"Exterior Alarm","server":"d42c7e99.0018","entityidfilter":"input_boolean.notify_gates","haltifstate":"","outputs":1,"x":690,"y":860,"wires":[["a1443965.770a08"]]},{"id":"e64d0c5.68663f","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"armingStatus","pt":"flow","to":"notArming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":580,"wires":[[]]},{"id":"ff365e0f.4c236","type":"switch","z":"59cb08a.8905ff8","name":"arming","property":"armingStatus","propertyType":"flow","rules":[{"t":"eq","v":"arming","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1330,"y":640,"wires":[["a77d16a7.1f3548","e64d0c5.68663f"]]},{"id":"3b066395.6e252c","type":"switch","z":"59cb08a.8905ff8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1457","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":480,"wires":[["e6ef0fa0.260e9"]]},{"id":"def0994.b0bd268","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"armingStatus","pt":"flow","to":"notArming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":640,"wires":[[]]},{"id":"e6ef0fa0.260e9","type":"switch","z":"59cb08a.8905ff8","name":"","property":"armingStatus","propertyType":"flow","rules":[{"t":"eq","v":"arming","vt":"str"},{"t":"eq","v":"notArming","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":560,"wires":[["def0994.b0bd268","f527183c.59b048"],["f1330738.2b14a8"]]},{"id":"f527183c.59b048","type":"trigger","z":"59cb08a.8905ff8","op1":"cancelled","op2":"off","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":680,"y":720,"wires":[["a1443965.770a08"]]},{"id":"a1443965.770a08","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"message","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":860,"wires":[["8f4619e4.7cfbb8"]]},{"id":"390450db.95b2e","type":"ui_audio","z":"59cb08a.8905ff8","name":"Arming 45 Seconds","group":"b33c9b3c.0231a8","voice":"en-US","always":"","x":1190,"y":740,"wires":[]},{"id":"30a2f752.950288","type":"inject","z":"59cb08a.8905ff8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":260,"wires":[["f5c561f8.d1bff"]]},{"id":"f5c561f8.d1bff","type":"change","z":"59cb08a.8905ff8","name":"","rules":[{"t":"set","p":"armingStatus","pt":"flow","to":"notArming","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":260,"wires":[[]]},{"id":"e78c197.2ff29e8","type":"ui_button","z":"59cb08a.8905ff8","name":"","group":"b33c9b3c.0231a8","order":1,"width":"2","height":"2","passthru":false,"label":"1","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"","x":90,"y":340,"wires":[["34375a28.2d3dd6"]]},{"id":"c4bb1e7e.48cc7","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"Front Door","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":920,"wires":[]},{"id":"5754413b.d8a2c","type":"server-state-changed","z":"59cb08a.8905ff8","name":"Front Door","server":"d42c7e99.0018","entityidfilter":"binary_sensor.front_door","haltifstate":"","outputs":1,"x":100,"y":920,"wires":[["341dc8bc.6c6f28"]]},{"id":"1b500f12.62e351","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"Back Door","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":960,"wires":[]},{"id":"66878055.a1497","type":"server-state-changed","z":"59cb08a.8905ff8","name":"Back Door","server":"d42c7e99.0018","version":"1","entityidfilter":"binary_sensor.sliding_glass_door","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":100,"y":960,"wires":[["53bd19c1.9fa508"]]},{"id":"85469df1.9d11e","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"North Gate","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":1000,"wires":[]},{"id":"a83ba298.4d624","type":"server-state-changed","z":"59cb08a.8905ff8","name":"North Gate","server":"d42c7e99.0018","entityidfilter":"binary_sensor.hittel_gate","haltifstate":"","outputs":1,"x":100,"y":1000,"wires":[["ead6d91b.01a068"]]},{"id":"ee148386.e5406","type":"ui_text","z":"59cb08a.8905ff8","group":"f203cb2a.343698","order":0,"width":"6","height":"1","name":"Dispay","label":"Front Door","format":"{{msg.payload}}","layout":"row-spread","x":430,"y":1040,"wires":[]},{"id":"87d93984.649e38","type":"server-state-changed","z":"59cb08a.8905ff8","name":"South Gate","server":"d42c7e99.0018","entityidfilter":"binary_sensor.zeier_gate","haltifstate":"","outputs":1,"x":100,"y":1040,"wires":[["f780989d.de88f8"]]},{"id":"341dc8bc.6c6f28","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":920,"wires":[["c4bb1e7e.48cc7"]]},{"id":"53bd19c1.9fa508","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":960,"wires":[["1b500f12.62e351"]]},{"id":"ead6d91b.01a068","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1000,"wires":[["85469df1.9d11e"]]},{"id":"f780989d.de88f8","type":"function","z":"59cb08a.8905ff8","name":"Change It","func":"if(msg.payload == \"off\")\n{\n    msg.payload = \"Closed\";\n}\nif(msg.payload == \"off\")\n{\n    msg.payload = \"Open\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1040,"wires":[["ee148386.e5406"]]},{"id":"3fed1d43.24a552","type":"light-scheduler","z":"cbfb483a.9b43f8","settings":"36f19b4a.9303c4","events":"[]","topic":"","name":"","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":0,"sunElevationThreshold":6,"sunShowElevationInStatus":true,"outputfreq":"output.statechange.startup","x":300,"y":580,"wires":[["f3ab9584.c81768"]]},{"id":"f3ab9584.c81768","type":"debug","z":"cbfb483a.9b43f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":520,"y":580,"wires":[]},{"id":"308c5290.f9a56e","type":"inject","z":"cbfb483a.9b43f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":480,"wires":[["3fed1d43.24a552"]]},{"id":"6d154411.67849c","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Rob Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.rob_home","haltifstate":"on","outputs":1,"x":160,"y":160,"wires":[["fdfc6125.3ad5e"]]},{"id":"2757ba3.b61eb46","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Lindsay Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.lindsay_home","haltifstate":"on","outputs":1,"x":170,"y":220,"wires":[["447c1578.a663fc"]]},{"id":"fdfc6125.3ad5e","type":"api-current-state","z":"767d6cf4.74a3f4","name":"Lindsay Home","server":"84ee05c2.2bb708","outputs":1,"halt_if":"on","entity_id":"input_boolean.lindsay_home","x":400,"y":160,"wires":[["657a032c.ddb0bc"]]},{"id":"447c1578.a663fc","type":"api-current-state","z":"767d6cf4.74a3f4","name":"Rob Home","server":"84ee05c2.2bb708","outputs":1,"halt_if":"on","entity_id":"input_boolean.rob_home","x":390,"y":220,"wires":[["657a032c.ddb0bc"]]},{"id":"420993f7.d16d4c","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Rob Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.rob_home","haltifstate":"off","outputs":1,"x":160,"y":300,"wires":[["a4be8fef.7e62"]]},{"id":"4ca5606.7adcfa","type":"server-state-changed","z":"767d6cf4.74a3f4","name":"Lindsay Home","server":"84ee05c2.2bb708","entityidfilter":"input_boolean.lindsay_home","haltifstate":"off","outputs":1,"x":170,"y":360,"wires":[["a4be8fef.7e62"]]},{"id":"57e56022.f528","type":"api-call-service","z":"767d6cf4.74a3f4","name":"Away","server":"84ee05c2.2bb708","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.home_occupied\" }","x":790,"y":160,"wires":[[]]},{"id":"a4be8fef.7e62","type":"api-call-service","z":"767d6cf4.74a3f4","name":"Home","server":"84ee05c2.2bb708","service_domain":"input_boolean","service":"turn_on","data":"{   \"entity_id\": \"input_boolean.home_occupied\" }","x":370,"y":300,"wires":[[]]},{"id":"657a032c.ddb0bc","type":"api-current-state","z":"767d6cf4.74a3f4","name":"House Guests","server":"84ee05c2.2bb708","outputs":1,"halt_if":"on","entity_id":"input_boolean.house_guests","x":620,"y":160,"wires":[["57e56022.f528"]]},{"id":"b9a3d8c7.d04d78","type":"change","z":"44dd03cf.d563cc","name":"Family Room Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Family Room Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.sliding_door?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":140,"wires":[["fc7d18b.5c520e8"]]},{"id":"815ddfec.c2a12","type":"change","z":"44dd03cf.d563cc","name":"Family Room Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Family Room Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.hittel_gate?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":260,"wires":[["fc7d18b.5c520e8"]]},{"id":"7a657a85.bc5e64","type":"change","z":"44dd03cf.d563cc","name":"Playroom Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Playroom Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.hittel_gate?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":320,"wires":[["fc7d18b.5c520e8"]]},{"id":"6d19532c.d5fe2c","type":"change","z":"44dd03cf.d563cc","name":"Kitchen Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Kitchen Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.sliding_door?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":380,"wires":[["fc7d18b.5c520e8"]]},{"id":"bccb2157.b13b9","type":"change","z":"44dd03cf.d563cc","name":"Dining Room Window Open","rules":[{"t":"set","p":"windowName","pt":"msg","to":"Dining Room Window Open","tot":"str"},{"t":"set","p":"image","pt":"msg","to":"https://Fake_HA_Server.duckdns.org:8123/api/camera_proxy/camera.front_door?api_password=notMyPassword","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":440,"wires":[["fc7d18b.5c520e8"]]},{"id":"763a9950.5acd48","type":"api-call-service","z":"44dd03cf.d563cc","name":"Notify Rob","server":"d934dccd.6ebae","service_domain":"notify","service":"ios_robs_iphone","data":"{}","x":1210,"y":220,"wires":[[]]},{"id":"fc7d18b.5c520e8","type":"function","z":"44dd03cf.d563cc","name":"Data","func":"msg.payload = \n{\n  \"data\": \n  {\n    \"message\": msg.windowName,\n    \"data\": \n    {\n      \"push\": \n      {\n        \"badge\": 5,\n        \"category\": \"siren\"\n      },\n      \"attachment\": \n      {\n        \"url\": msg.image,\n        \"content-type\": \"jpeg\",\n        \"hide-thumbnail\": false\n      }\n    }\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":280,"wires":[["763a9950.5acd48","e1464f31.952fc","460152f4.74a11c"]]},{"id":"e1464f31.952fc","type":"api-call-service","z":"44dd03cf.d563cc","name":"Notify Lindsay","server":"d934dccd.6ebae","service_domain":"notify","service":"ios_lindsays_iphone","data":"{}","x":1220,"y":320,"wires":[[]]},{"id":"74b36734.f06a78","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Family Room Window 1","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_1","haltifstate":"closed","outputs":1,"x":140,"y":140,"wires":[["7b31f08.6c8d31"]]},{"id":"3901435a.af422c","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Family Room Window 2","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_2","haltifstate":"closed","outputs":1,"x":140,"y":180,"wires":[["7b31f08.6c8d31"]]},{"id":"da9eab2e.7eb478","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Family Room Window 3","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_3","haltifstate":"closed","outputs":1,"x":140,"y":260,"wires":[["a35233c0.8bd38"]]},{"id":"5aa16773.235c88","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Playroom Window","server":"d934dccd.6ebae","entityidfilter":"sensor.family_room_window_1","haltifstate":"closed","outputs":1,"x":130,"y":320,"wires":[["4af7eddc.e22e94"]]},{"id":"c0ffe281.bfddc","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Kitchen Window","server":"d934dccd.6ebae","entityidfilter":"sensor.kitchen_window","haltifstate":"closed","outputs":1,"x":120,"y":380,"wires":[["1a15e1e8.46808e"]]},{"id":"44f69fbe.0bb8","type":"server-state-changed","z":"44dd03cf.d563cc","name":"Dining Room Window","server":"d934dccd.6ebae","entityidfilter":"sensor.dining_room_window","haltifstate":"closed","outputs":1,"x":140,"y":440,"wires":[["cfaf533e.cb3f9"]]},{"id":"7b31f08.6c8d31","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":140,"wires":[["b9a3d8c7.d04d78"],["9225fe1.dd451"]]},{"id":"a35233c0.8bd38","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":260,"wires":[["815ddfec.c2a12"],["9225fe1.dd451"]]},{"id":"4af7eddc.e22e94","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":320,"wires":[["7a657a85.bc5e64"],["9225fe1.dd451"]]},{"id":"1a15e1e8.46808e","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":380,"wires":[["6d19532c.d5fe2c"],["9225fe1.dd451"]]},{"id":"cfaf533e.cb3f9","type":"switch","z":"44dd03cf.d563cc","name":"Check Battery","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"neq","v":"open","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":440,"wires":[["bccb2157.b13b9"],["9225fe1.dd451"]]},{"id":"36fe43c7.52399c","type":"api-call-service","z":"44dd03cf.d563cc","name":"Notify Rob","server":"d934dccd.6ebae","service_domain":"notify","service":"ios_robs_iphone","data":"{}","x":810,"y":540,"wires":[[]]},{"id":"9225fe1.dd451","type":"function","z":"44dd03cf.d563cc","name":"Data","func":"msg.payload = \n{\n  \"data\": \n  {\n    \"message\": msg.payload\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":540,"wires":[["36fe43c7.52399c"]]},{"id":"460152f4.74a11c","type":"api-current-state","z":"44dd03cf.d563cc","name":"Exterior Alarms","server":"d934dccd.6ebae","outputs":1,"halt_if":"off","entity_id":"input_boolean.alarm_exterior","x":1020,"y":480,"wires":[["6b28cad0.683e54","c03d581d.2bffa8","ccfc2710.c7a618","2b7069c.25a1096","47eea46.092165c"]]},{"id":"2b7069c.25a1096","type":"api-call-service","z":"44dd03cf.d563cc","name":"Alarm Notify Lindsay","server":"d934dccd.6ebae","service_domain":"automation","service":"trigger","data":"{   \"entity_id\": \"automation.active_alarm_2\" }","x":1240,"y":540,"wires":[[]]},{"id":"ccfc2710.c7a618","type":"api-call-service","z":"44dd03cf.d563cc","name":"Alarm Notify Rob","server":"d934dccd.6ebae","service_domain":"automation","service":"trigger","data":"{   \"entity_id\": \"automation.active_alarm\" }","x":1230,"y":500,"wires":[[]]},{"id":"c03d581d.2bffa8","type":"api-call-service","z":"44dd03cf.d563cc","name":"Alarm Switch On","server":"d934dccd.6ebae","service_domain":"input_boolean","service":"turn_on","data":"{   \"entity_id\": \"input_boolean.alarm_siren\" }","x":1230,"y":460,"wires":[[]]},{"id":"6b28cad0.683e54","type":"change","z":"44dd03cf.d563cc","name":"Alarm Lights","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alarm Lights","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":420,"wires":[["4dd0e3ce.3c782c"]]},{"id":"4dd0e3ce.3c782c","type":"mqtt out","z":"44dd03cf.d563cc","name":"Alarm Lights","topic":"Commands","qos":"0","retain":"false","broker":"7a64aeda.d1efb","x":1370,"y":420,"wires":[]},{"id":"47eea46.092165c","type":"mqtt out","z":"44dd03cf.d563cc","name":"Send Alarm","topic":"Alarms","qos":"0","retain":"false","broker":"7a64aeda.d1efb","x":1210,"y":580,"wires":[]},{"id":"c9f347db.4d8bb8","type":"function","z":"213f77cb.cd9998","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":820,"wires":[["74a72ef8.e3ab9"]]},{"id":"c1784432.8d7a38","type":"function","z":"213f77cb.cd9998","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":952,"y":917,"wires":[["405a0beb.ca1d94"]]},{"id":"74a72ef8.e3ab9","type":"api-call-service","z":"213f77cb.cd9998","name":"Buffet On","server":"35d4fcd5.04deb4","version":0,"service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.buffet_light\" }","x":1160,"y":820,"wires":[[]]},{"id":"405a0beb.ca1d94","type":"api-call-service","z":"213f77cb.cd9998","name":"Buffet Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.buffet_light\" }","x":1161.8333282470703,"y":917.5555572509766,"wires":[[]]},{"id":"d47bb3c1.389dc","type":"light-scheduler","z":"213f77cb.cd9998","settings":"36f19b4a.9303c4","events":"[{\"start\":{\"dow\":1,\"mod\":1020},\"end\":{\"dow\":1,\"mod\":1380}},{\"start\":{\"dow\":2,\"mod\":1020},\"end\":{\"dow\":2,\"mod\":1380}},{\"start\":{\"dow\":3,\"mod\":1020},\"end\":{\"dow\":3,\"mod\":1380}},{\"start\":{\"dow\":4,\"mod\":1020},\"end\":{\"dow\":4,\"mod\":1380}},{\"start\":{\"dow\":5,\"mod\":1020},\"end\":{\"dow\":5,\"mod\":1380}},{\"start\":{\"dow\":6,\"mod\":1020},\"end\":{\"dow\":6,\"mod\":1380}},{\"start\":{\"dow\":0,\"mod\":1020},\"end\":{\"dow\":0,\"mod\":1380}}]","topic":"Buffet","name":"Buffet Light","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":770,"y":860,"wires":[["c9f347db.4d8bb8","c1784432.8d7a38"]]},{"id":"e46c70e0.b6996","type":"light-scheduler","z":"213f77cb.cd9998","settings":"11ac16b6.0ab969","events":"[{\"start\":{\"dow\":1,\"mod\":360},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":360},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":360},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":360},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":360},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":360},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":360},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Cabinet Lights","name":"Cabinet Lights","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":780,"y":660,"wires":[["f269df85.099f4","18aeb9db.d86126"]]},{"id":"f269df85.099f4","type":"function","z":"213f77cb.cd9998","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":600,"wires":[["efc61c32.9a69"]]},{"id":"18aeb9db.d86126","type":"function","z":"213f77cb.cd9998","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":953,"y":705,"wires":[["c864947e.502f98"]]},{"id":"efc61c32.9a69","type":"api-call-service","z":"213f77cb.cd9998","name":"Cabinet Lights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.cabinet_lights\" }","x":1184.0000076293945,"y":599.2222032546997,"wires":[[]]},{"id":"c864947e.502f98","type":"api-call-service","z":"213f77cb.cd9998","name":"Cabinet Lights Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.cabinet_lights\" }","x":1183.8333435058594,"y":705.4446439743042,"wires":[[]]},{"id":"8b25ff59.83a3e","type":"api-call-service","z":"213f77cb.cd9998","name":"Exterior Notifications On","server":"35d4fcd5.04deb4","service_domain":"input_boolean","service":"turn_on","data":"{   \"entity_id\": \"input_boolean.notify_exterior\" }","x":630,"y":280,"wires":[[]]},{"id":"3cb87300.b5b83e","type":"server-state-changed","z":"213f77cb.cd9998","name":"Away","server":"35d4fcd5.04deb4","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":560,"wires":[[],["f31f2e04.e0048","1ef5280e.e3e398","c56d5651.48dff8","754865e4.490d4c","41fa5b35.8296c4","61ddaeab.7d36c","7f3392d7.cd73fc"]]},{"id":"1aec9d5b.c7a9d3","type":"api-call-service","z":"213f77cb.cd9998","name":"Garage Entry Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.garage_entry_light\" }","x":610,"y":80,"wires":[[]]},{"id":"3e093e31.7d7c32","type":"api-call-service","z":"213f77cb.cd9998","name":"Uplights Off","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_off","data":"{   \"entity_id\": \"switch.uplights\" }","x":590,"y":120,"wires":[[]]},{"id":"6e4f9a95.e60764","type":"api-call-service","z":"213f77cb.cd9998","name":"Ben Light Off","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_off","data":"{   \"entity_id\": \"light.ben_light\" }","x":590,"y":160,"wires":[[]]},{"id":"8d5d71ba.aa9cd","type":"api-call-service","z":"213f77cb.cd9998","name":"Other Ben Light Off","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_off","data":"{   \"entity_id\": \"light.other_ben_light\" }","x":610,"y":200,"wires":[[]]},{"id":"47964349.c21d4c","type":"api-call-service","z":"213f77cb.cd9998","name":"Kitchen Lights Off","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_off","data":"{   \"entity_id\": \"light.kitchen_lights\" }","x":610,"y":240,"wires":[[]]},{"id":"a65e5ad9.83bc58","type":"server-state-changed","z":"213f77cb.cd9998","name":"Home","server":"35d4fcd5.04deb4","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":880,"wires":[[],["1b9da1f5.8ff3ae","eaeb66ae.669b58","adba54f4.3cee38","89afd836.c65858","5928cefb.21775","4e53153e.5a842c","9c2f1317.0d57e"]]},{"id":"1b9da1f5.8ff3ae","type":"api-call-service","z":"213f77cb.cd9998","name":"Exterior Notifications Off","server":"35d4fcd5.04deb4","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.notify_exterior\" }","x":470,"y":1180,"wires":[[]]},{"id":"eaeb66ae.669b58","type":"change","z":"213f77cb.cd9998","name":"auto","rules":[{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":860,"wires":[["d47bb3c1.389dc","e46c70e0.b6996"]]},{"id":"f31f2e04.e0048","type":"change","z":"213f77cb.cd9998","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":780,"wires":[["d47bb3c1.389dc","e46c70e0.b6996"]]},{"id":"1ef5280e.e3e398","type":"delay","z":"213f77cb.cd9998","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":220,"wires":[["1aec9d5b.c7a9d3","3e093e31.7d7c32","6e4f9a95.e60764","8d5d71ba.aa9cd","47964349.c21d4c","8b25ff59.83a3e"]]},{"id":"c56d5651.48dff8","type":"api-current-state","z":"213f77cb.cd9998","name":"Garage Entry State","server":"35d4fcd5.04deb4","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.garage_entry_light","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410,"y":400,"wires":[["eb4dddeb.5c901"]]},{"id":"41fa5b35.8296c4","type":"api-current-state","z":"213f77cb.cd9998","name":"Ben Light State","server":"35d4fcd5.04deb4","outputs":1,"halt_if":"","entity_id":"light.ben_light","x":400,"y":480,"wires":[["f068921.b826b7"]]},{"id":"754865e4.490d4c","type":"api-current-state","z":"213f77cb.cd9998","name":"Uplights State","server":"35d4fcd5.04deb4","outputs":1,"halt_if":"","entity_id":"switch.uplights","x":400,"y":440,"wires":[["74288dc1.38e964"]]},{"id":"61ddaeab.7d36c","type":"api-current-state","z":"213f77cb.cd9998","name":"Other Ben Light","server":"35d4fcd5.04deb4","outputs":1,"halt_if":"","entity_id":"light.other_ben_light","x":400,"y":520,"wires":[["eb72ab20.cdb1f8"]]},{"id":"7f3392d7.cd73fc","type":"api-current-state","z":"213f77cb.cd9998","name":"Kitchen Light State","server":"35d4fcd5.04deb4","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.kitchen_lights","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410,"y":560,"wires":[["3f3dc1b7.53e59e"]]},{"id":"eb4dddeb.5c901","type":"change","z":"213f77cb.cd9998","name":"Garage Flow","rules":[{"t":"set","p":"garageEntry","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":400,"wires":[[]]},{"id":"74288dc1.38e964","type":"change","z":"213f77cb.cd9998","name":"Uplights Flow","rules":[{"t":"set","p":"uplights","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":440,"wires":[[]]},{"id":"f068921.b826b7","type":"change","z":"213f77cb.cd9998","name":"Ben Light Flow","rules":[{"t":"set","p":"benLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":480,"wires":[[]]},{"id":"eb72ab20.cdb1f8","type":"change","z":"213f77cb.cd9998","name":"Other Ben Light Flow","rules":[{"t":"set","p":"otherBenLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":520,"wires":[[]]},{"id":"3f3dc1b7.53e59e","type":"change","z":"213f77cb.cd9998","name":"Kitchen Light Flow","rules":[{"t":"set","p":"kichenLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":560,"wires":[[]]},{"id":"adba54f4.3cee38","type":"switch","z":"213f77cb.cd9998","name":"Garage Flow","property":"garageEntry","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":960,"wires":[["5011e905.8afa78"]]},{"id":"89afd836.c65858","type":"switch","z":"213f77cb.cd9998","name":"Uplights Flow","property":"uplights","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":1000,"wires":[["d300623e.aafbe"]]},{"id":"5928cefb.21775","type":"switch","z":"213f77cb.cd9998","name":"Ben Light Flow","property":"benLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":1040,"wires":[["3b131f70.ca98c"]]},{"id":"4e53153e.5a842c","type":"switch","z":"213f77cb.cd9998","name":"Other Ben Light Flow","property":"otherBenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":1080,"wires":[["74685339.824c8c"]]},{"id":"9c2f1317.0d57e","type":"switch","z":"213f77cb.cd9998","name":"Kitchen Light Flow","property":"kitchenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":1120,"wires":[["40e1d41f.f49e0c"]]},{"id":"5011e905.8afa78","type":"api-call-service","z":"213f77cb.cd9998","name":"Garage Entry On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.garage_entry_light\" }","x":750,"y":960,"wires":[[]]},{"id":"d300623e.aafbe","type":"api-call-service","z":"213f77cb.cd9998","name":"Uplights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.uplights\" }","x":730,"y":1000,"wires":[[]]},{"id":"3b131f70.ca98c","type":"api-call-service","z":"213f77cb.cd9998","name":"Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.ben_light\" }","x":730,"y":1040,"wires":[[]]},{"id":"74685339.824c8c","type":"api-call-service","z":"213f77cb.cd9998","name":"Other Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.other_ben_light\" }","x":750,"y":1080,"wires":[[]]},{"id":"40e1d41f.f49e0c","type":"api-call-service","z":"213f77cb.cd9998","name":"Kitchen Lights On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.kitchen_lights\" }","x":750,"y":1120,"wires":[[]]},{"id":"6b087471.e715bc","type":"function","z":"e7a4486b.b864c8","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":780,"wires":[["aae7bcd3.6e66b"]]},{"id":"a8630e06.ef84d","type":"function","z":"e7a4486b.b864c8","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":952,"y":877,"wires":[["dbcd7fb2.b7ca9"]]},{"id":"aae7bcd3.6e66b","type":"api-call-service","z":"e7a4486b.b864c8","name":"Bedroom Lamps ON","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_on","entityId":"light.bedroom_lamps","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1200,"y":780,"wires":[[]]},{"id":"dbcd7fb2.b7ca9","type":"api-call-service","z":"e7a4486b.b864c8","name":"Bedroom Lamps Of","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.bedroom_lamps","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1191.8333282470703,"y":877.5555572509766,"wires":[[]]},{"id":"b1d68f82.4711f","type":"light-scheduler","z":"e7a4486b.b864c8","settings":"36f19b4a.9303c4","events":"[{\"start\":{\"dow\":1,\"mod\":1020},\"end\":{\"dow\":1,\"mod\":1305}},{\"start\":{\"dow\":2,\"mod\":1020},\"end\":{\"dow\":2,\"mod\":1305}},{\"start\":{\"dow\":3,\"mod\":1020},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":4,\"mod\":1020},\"end\":{\"dow\":4,\"mod\":1305}},{\"start\":{\"dow\":5,\"mod\":1020},\"end\":{\"dow\":5,\"mod\":1305}},{\"start\":{\"dow\":6,\"mod\":1020},\"end\":{\"dow\":6,\"mod\":1305}},{\"start\":{\"dow\":0,\"mod\":1020},\"end\":{\"dow\":0,\"mod\":1305}}]","topic":"Buffet","name":"Sunset","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"scheduleRndMax":"","sunElevationThreshold":"0","sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":750,"y":820,"wires":[["6b087471.e715bc","a8630e06.ef84d","5bae0ac2.9b8ff4"]]},{"id":"62f1e812.716818","type":"light-scheduler","z":"e7a4486b.b864c8","settings":"36f19b4a.9303c4","events":"[{\"start\":{\"dow\":1,\"mod\":360},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":360},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":360},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":360},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":360},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":360},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":360},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Cabinet Lights","name":"Cabinet Lights","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":780,"y":620,"wires":[["9d236c9c.6ba19","28c189ae.fe2446"]]},{"id":"9d236c9c.6ba19","type":"function","z":"e7a4486b.b864c8","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"x":950,"y":560,"wires":[["d6fcecc6.65a92"]]},{"id":"28c189ae.fe2446","type":"function","z":"e7a4486b.b864c8","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":953,"y":665,"wires":[["8798f6f3.c44068"]]},{"id":"d6fcecc6.65a92","type":"api-call-service","z":"e7a4486b.b864c8","name":"Cabinet Lights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.cabinet_lights\" }","x":1184.0000076293945,"y":559.2222032546997,"wires":[[]]},{"id":"8798f6f3.c44068","type":"api-call-service","z":"e7a4486b.b864c8","name":"Cabinet Lights Off","server":"35d4fcd5.04deb4","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.cabinet_lights","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1183.8333435058594,"y":665.4446439743042,"wires":[[]]},{"id":"e18c460b.38e4b8","type":"server-state-changed","z":"e7a4486b.b864c8","name":"Away","server":"a3722ee8.c88ce","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":520,"wires":[[],["c252a380.bf37e","d1e34fbc.cc4e1","d75a415.33181c"]]},{"id":"ddb5bf4b.f87","type":"api-call-service","z":"e7a4486b.b864c8","name":"Bedroom Lamps Off","server":"a3722ee8.c88ce","version":1,"service_domain":"light","service":"turn_off","entityId":"light.bedroom_lamps","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":640,"y":340,"wires":[[]]},{"id":"302a5797.1322c8","type":"server-state-changed","z":"e7a4486b.b864c8","name":"Home","server":"a3722ee8.c88ce","version":1,"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":150,"y":840,"wires":[[],["cfec9497.77d428","cdfef369.7b95c","2d89b15a.5e138e","3370e229.43e90e","21e3627f.12998e","1337228.40c2ede","9a936774.ec3b18"]]},{"id":"cfec9497.77d428","type":"api-call-service","z":"e7a4486b.b864c8","name":"Exterior Notifications Off","server":"35d4fcd5.04deb4","service_domain":"input_boolean","service":"turn_off","data":"{   \"entity_id\": \"input_boolean.notify_exterior\" }","x":470,"y":1140,"wires":[[]]},{"id":"cdfef369.7b95c","type":"change","z":"e7a4486b.b864c8","name":"auto","rules":[{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":820,"wires":[["b1d68f82.4711f","62f1e812.716818"]]},{"id":"c252a380.bf37e","type":"change","z":"e7a4486b.b864c8","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":740,"wires":[["b1d68f82.4711f","62f1e812.716818"]]},{"id":"d1e34fbc.cc4e1","type":"delay","z":"e7a4486b.b864c8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":380,"y":340,"wires":[["ddb5bf4b.f87"]]},{"id":"d75a415.33181c","type":"api-current-state","z":"e7a4486b.b864c8","name":"Bedroom Lamps State","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_lamps","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":400,"wires":[["ac2ec21.1c0064"]]},{"id":"ac2ec21.1c0064","type":"change","z":"e7a4486b.b864c8","name":"Kitchen Light Flow","rules":[{"t":"set","p":"bedroomLamps","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":400,"wires":[[]]},{"id":"2d89b15a.5e138e","type":"switch","z":"e7a4486b.b864c8","name":"Garage Flow","property":"garageEntry","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":920,"wires":[["2d39016e.057a8e"]]},{"id":"3370e229.43e90e","type":"switch","z":"e7a4486b.b864c8","name":"Uplights Flow","property":"uplights","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":960,"wires":[["f8f1d29e.beece"]]},{"id":"21e3627f.12998e","type":"switch","z":"e7a4486b.b864c8","name":"Ben Light Flow","property":"benLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":1000,"wires":[["1cf7bf93.6115b"]]},{"id":"1337228.40c2ede","type":"switch","z":"e7a4486b.b864c8","name":"Other Ben Light Flow","property":"otherBenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":1040,"wires":[["774f4327.1b690c"]]},{"id":"9a936774.ec3b18","type":"switch","z":"e7a4486b.b864c8","name":"Bedroom Lamps Flow","property":"bedroomLamps","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":1080,"wires":[["2fea6d3.89e0992"]]},{"id":"2d39016e.057a8e","type":"api-call-service","z":"e7a4486b.b864c8","name":"Garage Entry On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.garage_entry_light\" }","x":750,"y":920,"wires":[[]]},{"id":"f8f1d29e.beece","type":"api-call-service","z":"e7a4486b.b864c8","name":"Uplights On","server":"35d4fcd5.04deb4","service_domain":"switch","service":"turn_on","data":"{   \"entity_id\": \"switch.uplights\" }","x":730,"y":960,"wires":[[]]},{"id":"1cf7bf93.6115b","type":"api-call-service","z":"e7a4486b.b864c8","name":"Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.ben_light\" }","x":730,"y":1000,"wires":[[]]},{"id":"774f4327.1b690c","type":"api-call-service","z":"e7a4486b.b864c8","name":"Other Ben Light On","server":"35d4fcd5.04deb4","service_domain":"light","service":"turn_on","data":"{   \"entity_id\": \"light.other_ben_light\" }","x":750,"y":1040,"wires":[[]]},{"id":"2fea6d3.89e0992","type":"api-call-service","z":"e7a4486b.b864c8","name":"Kitchen Lights On","server":"35d4fcd5.04deb4","version":"1","service_domain":"light","service":"turn_on","entityId":"light.kitchen_lights","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":750,"y":1080,"wires":[[]]},{"id":"5bae0ac2.9b8ff4","type":"debug","z":"e7a4486b.b864c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1040,"y":1020,"wires":[]},{"id":"402ccb44.7492c4","type":"inject","z":"e7a4486b.b864c8","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":740,"wires":[["b1d68f82.4711f"]]},{"id":"5ec5c890.bae208","type":"bigtimer","z":"8b9a916e.ca4ec","outtopic":"","outpayload1":"","outpayload2":"","name":"Sunset","comment":"","lat":"-26.0188","lon":"28.0194","starttime":"5004","endtime":1425,"starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":390,"y":200,"wires":[["7d000b22.d4aea4"],["d6eeb3b0.c06b2"],["e0dcea29.49e458"]]},{"id":"9d8f92b5.38af7","type":"bigtimer","z":"8b9a916e.ca4ec","outtopic":"","outpayload1":"","outpayload2":"","name":"Dusk","comment":"","lat":"","lon":"","starttime":"5001","endtime":1425,"starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":390,"y":280,"wires":[[],[],[]]},{"id":"1c22069e.0fc999","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":180,"wires":[["5ec5c890.bae208"]]},{"id":"46f60626.f66378","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"toggle","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":360,"wires":[["5ec5c890.bae208"]]},{"id":"4771443c.0362ac","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":300,"wires":[["5ec5c890.bae208"]]},{"id":"5b54dcb6.4be814","type":"inject","z":"8b9a916e.ca4ec","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":240,"wires":[["5ec5c890.bae208"]]},{"id":"7d000b22.d4aea4","type":"debug","z":"8b9a916e.ca4ec","name":"one-off","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":640,"y":180,"wires":[]},{"id":"d6eeb3b0.c06b2","type":"debug","z":"8b9a916e.ca4ec","name":"every minute","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":660,"y":240,"wires":[]},{"id":"e0dcea29.49e458","type":"debug","z":"8b9a916e.ca4ec","name":"output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":640,"y":300,"wires":[]},{"id":"49ebce23.e0be","type":"server-state-changed","z":"fb4a9edc.82ff2","name":"Sleep Mode Enabled","server":"a3342807.115888","version":0,"entityidfilter":"input_boolean.sleep_mode","entityidfiltertype":"substring","haltifstate":"off","outputs":1,"x":210,"y":220,"wires":[["fa6c6e21.6d8e8"]]},{"id":"fa6c6e21.6d8e8","type":"switch","z":"fb4a9edc.82ff2","name":"Halt If Routine Already Executed","property":"sleep_routine_fired","propertyType":"global","rules":[{"t":"false"}],"checkall":"false","repair":false,"outputs":1,"x":470,"y":220,"wires":[["80c76267.006fd","fc65f70d.a12678"]]},{"id":"80c76267.006fd","type":"api-render-template","z":"fb4a9edc.82ff2","name":"Door Lock Status Message","server":"a3342807.115888","template":"{% if is_state(\"lock.front_door\", \"locked\") and\n      is_state(\"lock.back_door\", \"locked\") and\n      is_state(\"lock.side_entry\", \"locked\") and\n      is_state(\"lock.garage_entry\", \"locked\") -%}\nAll doors are locked.  Good night.\n  \n{%- else -%} \n    {% set unlockedCount = 0 %}\n  \n  {%- if is_state(\"lock.front_door\", \"unlocked\") -%}\nThe front door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n\n  {%- if is_state(\"lock.back_door\", \"unlocked\") -%}\nThe back door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n\n  {%- endif %}\n\n  {%- if is_state(\"lock.garage_entry\", \"unlocked\") -%}\nThe garage door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n\n  {%- endif %}\n\n  {%- if is_state(\"lock.side_entry\", \"unlocked\") -%}\nThe side entry door is unlocked.\n    {% set unlockedCount = unlockedCount + 1 %}\n\n  {%- endif %}\n  \n  {% if unlockedCount > 1 -%}\nAttempting to secure all doors now.\n  {%- else -%}\nAttempting to secure it now.\n  {%- endif %}\n  \n{%- endif %}","x":760,"y":220,"wires":[["f7e70916.935d18","8d78870e.678148"]]},{"id":"fc65f70d.a12678","type":"function","z":"fb4a9edc.82ff2","name":"Set Sleep Routine Fired","func":"global.set('sleep_routine_fired', true);\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":260,"wires":[[]]},{"id":"f7e70916.935d18","type":"switch","z":"fb4a9edc.82ff2","name":"Unlocked Doors Found","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"All doors are locked.  Good night.","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":260,"wires":[["3266a092.bfc12","cb89c4e9.63f018"]]},{"id":"3266a092.bfc12","type":"api-call-service","z":"fb4a9edc.82ff2","name":"Lock All Doors","server":"a3342807.115888","service_domain":"lock","service":"lock","data":"{\"entity_id\": \"lock.front_door, lock.back_door, lock.garage_entry, lock.side_entry\"}","mergecontext":"","x":800,"y":300,"wires":[["41b1599e.298858"]]},{"id":"cb89c4e9.63f018","type":"function","z":"fb4a9edc.82ff2","name":"Reset Sleep Routine","func":"global.set('sleep_routine_fired', false);\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":420,"wires":[[]]},{"id":"588de289.c2022c","type":"function","z":"fb4a9edc.82ff2","name":"Build Notification","func":"// switch (msg.topic) {\n//     case ''\n// }\n\nreturn {\n    payload: {\n        data: {\n            message: msg.payload,\n        }\n    }\n};","outputs":1,"noerr":0,"x":1090,"y":300,"wires":[["ec4841c9.ecbea"]]},{"id":"41b1599e.298858","type":"delay","z":"fb4a9edc.82ff2","name":"Delay","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":830,"y":340,"wires":[["18f5c45e.29e1dc"]]},{"id":"6fd62eee.655cb","type":"server-state-changed","z":"fb4a9edc.82ff2","name":"Exterior Door Unlocked","server":"a3342807.115888","entityidfilter":"group.exterior_locks","entityidfiltertype":"exact","haltifstate":"locked","outputs":1,"x":220,"y":420,"wires":[["cb89c4e9.63f018"]]},{"id":"2605b611.9fa6da","type":"inject","z":"fb4a9edc.82ff2","name":"Reset Sleep Routine","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":380,"wires":[["cb89c4e9.63f018"]]},{"id":"105102b3.f52c4d","type":"server-state-changed","z":"fb4a9edc.82ff2","name":"Both Get Out of Bed","server":"a3342807.115888","entityidfilter":"sensor.bed_either","entityidfiltertype":"exact","haltifstate":"Occupied","outputs":1,"x":230,"y":460,"wires":[["cb89c4e9.63f018"]]},{"id":"18f5c45e.29e1dc","type":"function","z":"fb4a9edc.82ff2","name":"Clear Template","func":"\nreturn {};","outputs":1,"noerr":0,"x":1080,"y":180,"wires":[["d789605c.f5686"]]},{"id":"ec4841c9.ecbea","type":"link out","z":"fb4a9edc.82ff2","name":"Door Lock Status @ Sleep Mode Enabled","links":["58dfbc1f.ec9674","d88ae7ad.72c5b8"],"x":1295,"y":300,"wires":[]},{"id":"8d78870e.678148","type":"string","z":"fb4a9edc.82ff2","name":"Strip Newlines","methods":[{"name":"strip","params":[{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":1080,"y":260,"wires":[["588de289.c2022c"]]},{"id":"d789605c.f5686","type":"api-render-template","z":"fb4a9edc.82ff2","name":"Door Lock Status Message","server":"a3342807.115888","template":"{% if is_state(\"lock.front_door\", \"locked\") and\n      is_state(\"lock.back_door\", \"locked\") and\n      is_state(\"lock.side_entry\", \"locked\") and\n      is_state(\"lock.garage_entry\", \"locked\") -%}\n  I was able to secure all doors. Good night.\n{%- else -%} \n\n  {%- if is_state(\"lock.front_door\", \"unlocked\") -%}\n    I was unable to lock the front door.\n  {%- endif %}\n\n  {%- if is_state(\"lock.back_door\", \"unlocked\") -%}\n    I was unable to lock the back door.\n  {%- endif %}\n\n  {%- if is_state(\"lock.garage_entry\", \"unlocked\") -%}\n    I was unable to lock the garage door.\n  {%- endif %}\n\n  {%- if is_state(\"lock.side_entry\", \"unlocked\") -%}\n    I was unable to lock the side entry door.\n  {%- endif %}\n  \n  Please double check the door to make sure it is secure.\n  \n{%- endif %}","x":1120,"y":220,"wires":[["8d78870e.678148"]]},{"id":"a52e3fb3.b9545","type":"ui_text_input","z":"9b2a9527.03a138","name":"","label":"","group":"a0afaa39.4de1a8","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"1","topic":"","x":100,"y":320,"wires":[["d26c2db3.f6def"]]},{"id":"d26c2db3.f6def","type":"change","z":"9b2a9527.03a138","name":"","rules":[{"t":"set","p":"textToSpeak","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":320,"wires":[[]]},{"id":"a1cee148.f0a66","type":"ui_button","z":"9b2a9527.03a138","name":"","group":"a0afaa39.4de1a8","order":4,"width":0,"height":0,"passthru":false,"label":"Speak","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":130,"y":420,"wires":[["65e3518d.e5cf7"]]},{"id":"3777368a.740fda","type":"change","z":"9b2a9527.03a138","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":160,"wires":[[]]},{"id":"2479e766.5c7df8","type":"change","z":"9b2a9527.03a138","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.accountName[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":120,"y":160,"wires":[["2074c467.d3c33c"]]},{"id":"2074c467.d3c33c","type":"ui_dropdown","z":"9b2a9527.03a138","name":"","label":"Device","tooltip":"","place":"","group":"a0afaa39.4de1a8","order":1,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":290,"y":160,"wires":[["3777368a.740fda"]]},{"id":"83321d0e.fb45e","type":"ui_button","z":"9b2a9527.03a138","name":"","group":"a0afaa39.4de1a8","order":2,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":110,"y":60,"wires":[["efd70c12.1c90b"]]},{"id":"65e3518d.e5cf7","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"","account":"5d0de7fb.a20278","routineNode":{"type":"speak","payload":{"type":"regular","text":{"type":"flow","value":"textToSpeak"},"devices":{"type":"flow","value":"device"}}},"x":340,"y":420,"wires":[[]]},{"id":"efd70c12.1c90b","type":"alexa-remote-echo","z":"9b2a9527.03a138","name":"","account":"5d0de7fb.a20278","config":{"option":"get","value":{"what":"device","device":{"type":"str","value":"ALEXA_ALL_DSN"}}},"x":270,"y":60,"wires":[["2479e766.5c7df8"]]},{"id":"2c3352be.830a6e","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"speak","payload":{"type":"regular","text":{"type":"msg","value":"payload"},"devices":["G090U50784240Q4D"]}},"x":507,"y":577,"wires":[[]]},{"id":"b402ecb2.8f245","type":"inject","z":"9b2a9527.03a138","name":"","topic":"","payload":"Hello World!","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":600,"wires":[["15315b96.97d624","d510ea6f.241098"]]},{"id":"bc1d5497.5fdfc8","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"msg","value":"payload"},"volume":{"type":"num","value":"50"},"mode":"set","devices":["G090U50784240Q4D"]}},"x":800,"y":680,"wires":[[]]},{"id":"dfbe9343.ead9b","type":"delay","z":"9b2a9527.03a138","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":680,"wires":[["bc1d5497.5fdfc8"]]},{"id":"cfa0dec9.1ff0f","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"music","payload":{"device":{"type":"str","value":"G090U50784240Q4D"},"provider":{"type":"str","value":"SPOTIFY"},"search":{"type":"str","value":"Wanted Dead or Alive"},"duration":{"type":"num","value":""}}},"x":800,"y":760,"wires":[["eb5bdfe8.d62a4"]]},{"id":"d510ea6f.241098","type":"delay","z":"9b2a9527.03a138","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":760,"wires":[["cfa0dec9.1ff0f"]]},{"id":"8be65514.d10d58","type":"ui_dropdown","z":"590246e0.d58c08","name":"","label":"Provider","tooltip":"","place":" ","group":"2631de14.3000c2","order":5,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":280,"y":340,"wires":[["a5d36233.e660c"]]},{"id":"a5d36233.e660c","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"provider","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":380,"wires":[[]]},{"id":"6656aa91.60be54","type":"ui_button","z":"590246e0.d58c08","name":"","group":"2631de14.3000c2","order":9,"width":"0","height":"0","passthru":false,"label":"Play","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":70,"y":480,"wires":[["3b836cdc.e22a24"]]},{"id":"9d69f2be.3b4d9","type":"ui_text_input","z":"590246e0.d58c08","name":"","label":"Query","tooltip":"","group":"2631de14.3000c2","order":8,"width":"0","height":"0","passthru":true,"mode":"text","delay":300,"topic":"","x":70,"y":440,"wires":[["7b6ff7.88195008"]]},{"id":"7b6ff7.88195008","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"query","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":440,"wires":[[]]},{"id":"14cc5f14.a84d41","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":180,"wires":[[]]},{"id":"925b190e.45ec48","type":"ui_button","z":"590246e0.d58c08","name":"Pause","group":"8ed891bd.550a7","order":1,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-pause","payload":"","payloadType":"str","topic":"","x":70,"y":540,"wires":[["e5a94e24.b219"]]},{"id":"333ad56c.28655a","type":"ui_button","z":"590246e0.d58c08","name":"Resume","group":"8ed891bd.550a7","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-play","payload":"","payloadType":"str","topic":"","x":80,"y":580,"wires":[["b024dedd.042c2"]]},{"id":"1cc6c37c.31f87d","type":"ui_slider","z":"590246e0.d58c08","name":"Volume Slider","label":"","tooltip":"","group":"8ed891bd.550a7","order":6,"width":"4","height":"1","passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":240,"y":720,"wires":[["384d1368.9d7c5c"]]},{"id":"15a22c75.a6b904","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.accountName[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":100,"wires":[["11847232.afae9e"]]},{"id":"11847232.afae9e","type":"ui_dropdown","z":"590246e0.d58c08","name":"","label":"Device","tooltip":"","place":" ","group":"2631de14.3000c2","order":2,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":270,"y":140,"wires":[["14cc5f14.a84d41"]]},{"id":"4233b28c.e9a9fc","type":"change","z":"590246e0.d58c08","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.id[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":260,"wires":[["b9f0b5d4.d4c888"]]},{"id":"b9f0b5d4.d4c888","type":"function","z":"590246e0.d58c08","name":"pretty label","func":"let prettify = s => {\n\ts = s.replace('_', ' ');\n\ts = s.toLowerCase();\n\ts = s.split(' ').map(w => w[0].toUpperCase() + w.slice(1)).join(' ');\n\treturn s;\n};\n\nmsg.options = msg.options.map(o => {\n    let obj = {};\n    obj[prettify(o)] = o;\n    return obj;\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":300,"wires":[["8be65514.d10d58"]]},{"id":"3fbb3b89.b0c6f4","type":"ui_template","z":"590246e0.d58c08","group":"8ed891bd.550a7","name":"Repeat","order":7,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Repeat</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":80,"y":780,"wires":[[]]},{"id":"95f26a27.dd5c38","type":"ui_button","z":"590246e0.d58c08","name":"Repeat On","group":"8ed891bd.550a7","order":8,"width":"2","height":"1","passthru":false,"label":"On","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":780,"wires":[["7a06baf4.178284"]]},{"id":"b7e8443b.8a98d8","type":"ui_button","z":"590246e0.d58c08","name":"Repeat Off","group":"8ed891bd.550a7","order":9,"width":"2","height":"1","passthru":false,"label":"Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":820,"wires":[["574c142a.b7ecec"]]},{"id":"87515f4b.0f6f8","type":"ui_template","z":"590246e0.d58c08","group":"8ed891bd.550a7","name":"Shuffle","order":10,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Shuffle</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":70,"y":860,"wires":[[]]},{"id":"a3dc0b27.263448","type":"ui_button","z":"590246e0.d58c08","name":"Shuffle On","group":"8ed891bd.550a7","order":11,"width":"2","height":"1","passthru":false,"label":"On","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":860,"wires":[["6b6f388c.df9288"]]},{"id":"f8fb6fb8.f358","type":"ui_button","z":"590246e0.d58c08","name":"Shuffle Off","group":"8ed891bd.550a7","order":12,"width":"2","height":"1","passthru":false,"label":"Off","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":230,"y":900,"wires":[["128da965.443027"]]},{"id":"86a009bb.87e108","type":"ui_button","z":"590246e0.d58c08","name":"Refresh Device","group":"2631de14.3000c2","order":3,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":120,"y":60,"wires":[["cc35038d.c4aa"]]},{"id":"7f972f4.3c5e7d","type":"ui_button","z":"590246e0.d58c08","name":"Refresh Provider","group":"2631de14.3000c2","order":6,"width":"1","height":"1","passthru":false,"label":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":110,"y":220,"wires":[["3bd7d77e.529778"]]},{"id":"43de8785.cb9a38","type":"alexa-remote-event","z":"590246e0.d58c08","name":"","account":"","event":"ws-audio-player-state-change","x":150,"y":1000,"wires":[["55ca7ecb.90ca6"]]},{"id":"e2780d4c.dd3c6","type":"ui_template","z":"590246e0.d58c08","group":"363b5f3e.6e4e2","name":"Image","order":2,"width":"6","height":"7","format":"<a href=\"{{msg.payload}}\">\n    <img src=\"{{msg.payload}}\" alt=\"oh no\" width=\"310\">\n</a>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":570,"y":1040,"wires":[[]]},{"id":"d07543.ec8e4ac","type":"ui_template","z":"590246e0.d58c08","group":"363b5f3e.6e4e2","name":"Title","order":1,"width":"6","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"margin:auto; margin-top:0;\">\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":570,"y":1000,"wires":[[]]},{"id":"fb5fa433.f3fb28","type":"ui_slider","z":"590246e0.d58c08","name":"","label":"","tooltip":"","group":"363b5f3e.6e4e2","order":3,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":"100","step":"1","x":570,"y":1080,"wires":[[]]},{"id":"f8547807.bf5498","type":"function","z":"590246e0.d58c08","name":"progress","func":"let interval = context.get('interval');\nif(interval) clearInterval(interval);\ncontext.set('interval', undefined);\n\nif(!msg.payload.progress) return;\n\nconst updateTime = Date.now();\nconst updateProgress = msg.payload.progress.mediaProgress;\nconst mediaLength = msg.payload.progress.mediaLength;\nconst fraction = updateProgress / mediaLength;\nnode.send({ payload: fraction * 100 });\n\nif(msg.payload.state !== 'PLAYING') return;\n\ncontext.set('interval', setInterval(() => {\n    const elapsed = Date.now() - updateTime;\n    const progress = updateProgress + elapsed / 1000;\n    const fraction = progress / mediaLength;\n    node.send({ payload: fraction * 100 });\n}, 1000));\n\n\n\n","outputs":1,"noerr":0,"x":440,"y":1080,"wires":[["fb5fa433.f3fb28"]]},{"id":"43d8c882.625148","type":"change","z":"590246e0.d58c08","name":"infoText","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.infoText.title","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1000,"wires":[["d07543.ec8e4ac"]]},{"id":"4925a1e6.0973c","type":"change","z":"590246e0.d58c08","name":"mainArt","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.mainArt.url","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1040,"wires":[["e2780d4c.dd3c6"]]},{"id":"cc35038d.c4aa","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"get","value":{"what":"device","device":{"type":"str","value":"ALEXA_ALL_DSN"}}},"x":310,"y":60,"wires":[["15a22c75.a6b904"]]},{"id":"3bd7d77e.529778","type":"alexa-remote-other","z":"590246e0.d58c08","name":"","account":"","config":{"option":"get","value":{"what":"musicProviders"}},"x":320,"y":220,"wires":[["4233b28c.e9a9fc"]]},{"id":"e5a94e24.b219","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"pause"}},"x":230,"y":540,"wires":[[]]},{"id":"b024dedd.042c2","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"play"}},"x":220,"y":580,"wires":[[]]},{"id":"3b836cdc.e22a24","type":"alexa-remote-routine","z":"590246e0.d58c08","name":"","account":"","routineNode":{"type":"music","payload":{"device":{"type":"flow","value":"device"},"provider":{"type":"flow","value":"provider"},"search":{"type":"flow","value":"query"},"duration":{"type":"num","value":""}}},"x":240,"y":480,"wires":[[]]},{"id":"384d1368.9d7c5c","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"volume","value":{"type":"msg","value":"payload"}}},"x":410,"y":720,"wires":[[]]},{"id":"7a06baf4.178284","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"repeat","value":{"type":"bool","value":"true"}}},"x":410,"y":780,"wires":[[]]},{"id":"574c142a.b7ecec","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"repeat","value":{"type":"bool","value":"true"}}},"x":410,"y":820,"wires":[[]]},{"id":"6b6f388c.df9288","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"shuffle","value":{"type":"bool","value":"true"}}},"x":400,"y":860,"wires":[[]]},{"id":"128da965.443027","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"shuffle","value":{"type":"bool","value":"false"}}},"x":400,"y":900,"wires":[[]]},{"id":"55ca7ecb.90ca6","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"get","value":{"what":"playerInfo","device":{"type":"flow","value":"device"}}},"x":240,"y":1040,"wires":[["43d8c882.625148","4925a1e6.0973c","f8547807.bf5498"]]},{"id":"efe02951.5fda68","type":"ui_button","z":"590246e0.d58c08","name":"Previous","group":"8ed891bd.550a7","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"","payloadType":"str","topic":"","x":80,"y":620,"wires":[["468847d5.7f11d8"]]},{"id":"430af5f2.fef38c","type":"ui_button","z":"590246e0.d58c08","name":"Next","group":"8ed891bd.550a7","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"","payloadType":"str","topic":"","x":70,"y":660,"wires":[["e69cf7c6.55f168"]]},{"id":"468847d5.7f11d8","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"previous"}},"x":240,"y":620,"wires":[[]]},{"id":"e69cf7c6.55f168","type":"alexa-remote-echo","z":"590246e0.d58c08","name":"","account":"","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"next"}},"x":230,"y":660,"wires":[[]]},{"id":"f8207cb0.7118a","type":"ui_template","z":"590246e0.d58c08","group":"8ed891bd.550a7","name":"Volume","order":5,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Volume</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":80,"y":720,"wires":[[]]},{"id":"eb5bdfe8.d62a4","type":"debug","z":"9b2a9527.03a138","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":880,"y":880,"wires":[]},{"id":"15315b96.97d624","type":"alexa-remote-routine","z":"9b2a9527.03a138","name":"Echo Dot","account":"5d0de7fb.a20278","routineNode":{"type":"skill","payload":{"skill":{"type":"str","value":"amzn1.ask.skill.da0bbfcb-a814-4c18-9293-77e78ceb3061"},"device":{"type":"str","value":"G090U50784240Q4D"}}},"x":520,"y":940,"wires":[[]]},{"id":"337be2c9.73710e","type":"inject","z":"4d548667.7a6948","name":"","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":true,"onceDelay":0.1,"x":310,"y":220,"wires":[["78c54847.c3f4e8","4ea36ac2.74f6b4"]]},{"id":"78c54847.c3f4e8","type":"api-current-state","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.yr_symbol","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":750,"y":260,"wires":[["6f09e9b.9533018"]]},{"id":"6f09e9b.9533018","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1000,"y":260,"wires":[]},{"id":"39eb405b.5a4ce","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":980,"y":380,"wires":[]},{"id":"4ea36ac2.74f6b4","type":"api-current-state","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"weather.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":740,"y":400,"wires":[["39eb405b.5a4ce"]]},{"id":"dc780bfc.79b9f8","type":"comment","z":"4d548667.7a6948","name":"Weather API Documentation","info":"https://api.met.no/weatherapi/weathericon/1.1/documentation","x":740,"y":360,"wires":[]},{"id":"802d75d5.8faba8","type":"server-state-changed","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_karien","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":380,"y":540,"wires":[["612e41f8.c951d"]]},{"id":"612e41f8.c951d","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":760,"y":540,"wires":[]},{"id":"8d38e416.ebaa48","type":"server-state-changed","z":"4d548667.7a6948","name":"","server":"a3722ee8.c88ce","version":1,"entityidfilter":"device_tracker.life360_fletcher_kelly","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":410,"y":640,"wires":[["96ecb7fa.66f658"]]},{"id":"96ecb7fa.66f658","type":"debug","z":"4d548667.7a6948","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":640,"wires":[]},{"id":"fac6f328.60382","type":"api-current-state","z":"d597f158.7ca1b","name":"workday?","server":"a3722ee8.c88ce","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.workday_sensor","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":880,"y":80,"wires":[["d0379ddf.ce97f","1ff2eff9.10bd2"],[]]}]